
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../../%E3%83%9E%E3%83%BC%E3%82%AB%E3%83%BC%E7%94%BB%E5%83%8F/">
      
      
        <link rel="next" href="../points.go/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.44">
    
    
      
        <title>PointLog構造体の詳細な解説と利用例 - My Docs</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.0253249f.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="cyan" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#pointlog" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="My Docs" class="md-header__button md-logo" aria-label="My Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            My Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              PointLog構造体の詳細な解説と利用例
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="My Docs" class="md-nav__button md-logo" aria-label="My Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    My Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Welcome to MkDocs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E3%83%9E%E3%83%BC%E3%82%AB%E3%83%BC%E7%94%BB%E5%83%8F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    画像の保存
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    DB
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            DB
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" checked>
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Model
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            Model
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    PointLog構造体の詳細な解説と利用例
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    PointLog構造体の詳細な解説と利用例
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      概要
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      パッケージとインポート
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pointlog_1" class="md-nav__link">
    <span class="md-ellipsis">
      PointLog構造体
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      カラム名の定義
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#where" class="md-nav__link">
    <span class="md-ellipsis">
      Where句のヘルパー
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      リレーションシップ定義
    </span>
  </a>
  
    <nav class="md-nav" aria-label="リレーションシップ定義">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      リレーションシップの初期化と取得
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      ロードメソッド
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      カラムとキーの定義
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      型エイリアスとクエリ構造体
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      キャッシュ関連の変数
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      その他の依存性
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      フックの定義と管理
    </span>
  </a>
  
    <nav class="md-nav" aria-label="フックの定義と管理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      フック用の変数とミューテックス
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      フックの実行メソッド
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      フックの登録
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      クエリメソッド
    </span>
  </a>
  
    <nav class="md-nav" aria-label="クエリメソッド">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#one" class="md-nav__link">
    <span class="md-ellipsis">
      Oneメソッド
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      開発者向け利用例
    </span>
  </a>
  
    <nav class="md-nav" aria-label="開発者向け利用例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      データベースへの接続
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      レコードの取得
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      レコードの挿入
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      レコードの更新
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      レコードの削除
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      トランザクションの使用
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      フックの使用
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    <span class="md-ellipsis">
      注意事項
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#all" class="md-nav__link">
    <span class="md-ellipsis">
      All 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="All 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    <span class="md-ellipsis">
      処理の流れ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#count" class="md-nav__link">
    <span class="md-ellipsis">
      Count 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Count 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exists" class="md-nav__link">
    <span class="md-ellipsis">
      Exists 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exists 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#user" class="md-nav__link">
    <span class="md-ellipsis">
      User 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="User 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#loaduser" class="md-nav__link">
    <span class="md-ellipsis">
      LoadUser 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LoadUser 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_34" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_35" class="md-nav__link">
    <span class="md-ellipsis">
      処理の流れ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_36" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setuser" class="md-nav__link">
    <span class="md-ellipsis">
      SetUser 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SetUser 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_37" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_38" class="md-nav__link">
    <span class="md-ellipsis">
      処理の流れ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_39" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pointlogs" class="md-nav__link">
    <span class="md-ellipsis">
      PointLogs 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PointLogs 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_40" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_41" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#findpointlog" class="md-nav__link">
    <span class="md-ellipsis">
      FindPointLog 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FindPointLog 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_42" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_43" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#insert" class="md-nav__link">
    <span class="md-ellipsis">
      Insert 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Insert 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_44" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_45" class="md-nav__link">
    <span class="md-ellipsis">
      処理の流れ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_46" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#update" class="md-nav__link">
    <span class="md-ellipsis">
      Update 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Update 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_47" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_48" class="md-nav__link">
    <span class="md-ellipsis">
      処理の流れ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_49" class="md-nav__link">
    <span class="md-ellipsis">
      注意点
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_50" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#updateall" class="md-nav__link">
    <span class="md-ellipsis">
      UpdateAll 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="UpdateAll 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_51" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_52" class="md-nav__link">
    <span class="md-ellipsis">
      処理の流れ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_53" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#updateall_1" class="md-nav__link">
    <span class="md-ellipsis">
      UpdateAll メソッド（スライス用）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="UpdateAll メソッド（スライス用）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_54" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_55" class="md-nav__link">
    <span class="md-ellipsis">
      処理の流れ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_56" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#upsert" class="md-nav__link">
    <span class="md-ellipsis">
      Upsert 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Upsert 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_57" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_58" class="md-nav__link">
    <span class="md-ellipsis">
      処理の流れ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_59" class="md-nav__link">
    <span class="md-ellipsis">
      注意点
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_60" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#delete" class="md-nav__link">
    <span class="md-ellipsis">
      Delete 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Delete 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_61" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_62" class="md-nav__link">
    <span class="md-ellipsis">
      処理の流れ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_63" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deleteall" class="md-nav__link">
    <span class="md-ellipsis">
      DeleteAll 関数（クエリ用）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DeleteAll 関数（クエリ用）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_64" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_65" class="md-nav__link">
    <span class="md-ellipsis">
      処理の流れ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_66" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deleteall_1" class="md-nav__link">
    <span class="md-ellipsis">
      DeleteAll 関数（スライス用）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DeleteAll 関数（スライス用）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_67" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_68" class="md-nav__link">
    <span class="md-ellipsis">
      処理の流れ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_69" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reload" class="md-nav__link">
    <span class="md-ellipsis">
      Reload 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Reload 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_70" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_71" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reloadall" class="md-nav__link">
    <span class="md-ellipsis">
      ReloadAll 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ReloadAll 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_72" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_73" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pointlogexists" class="md-nav__link">
    <span class="md-ellipsis">
      PointLogExists 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PointLogExists 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_74" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_75" class="md-nav__link">
    <span class="md-ellipsis">
      処理の流れ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_76" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exists_1" class="md-nav__link">
    <span class="md-ellipsis">
      Exists メソッド
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exists メソッド">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_77" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_78" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#seichy" class="md-nav__link">
    <span class="md-ellipsis">
      Seichy構造体と関連コードの詳細解説
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_79" class="md-nav__link">
    <span class="md-ellipsis">
      はじめに
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#seichy_1" class="md-nav__link">
    <span class="md-ellipsis">
      Seichy構造体の定義
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Seichy構造体の定義">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_80" class="md-nav__link">
    <span class="md-ellipsis">
      フィールドの解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_81" class="md-nav__link">
    <span class="md-ellipsis">
      リレーションフィールド
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_82" class="md-nav__link">
    <span class="md-ellipsis">
      カラム名の定義
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sqlboilerwhere" class="md-nav__link">
    <span class="md-ellipsis">
      SQLBoilerによるWhereヘルパーの生成
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SQLBoilerによるWhereヘルパーの生成">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nullstringwhere" class="md-nav__link">
    <span class="md-ellipsis">
      null.String用のWhereヘルパー
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#seichywhere" class="md-nav__link">
    <span class="md-ellipsis">
      SeichyWhere構造体
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_83" class="md-nav__link">
    <span class="md-ellipsis">
      リレーションシップの定義
    </span>
  </a>
  
    <nav class="md-nav" aria-label="リレーションシップの定義">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_84" class="md-nav__link">
    <span class="md-ellipsis">
      リレーション用構造体
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_85" class="md-nav__link">
    <span class="md-ellipsis">
      キャッシングと同期
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_86" class="md-nav__link">
    <span class="md-ellipsis">
      フックの定義
    </span>
  </a>
  
    <nav class="md-nav" aria-label="フックの定義">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_87" class="md-nav__link">
    <span class="md-ellipsis">
      フックの種類
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_88" class="md-nav__link">
    <span class="md-ellipsis">
      フックの実装例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_89" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
    <nav class="md-nav" aria-label="利用例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#seichy_2" class="md-nav__link">
    <span class="md-ellipsis">
      新しいSeichyレコードの作成
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#seichy_3" class="md-nav__link">
    <span class="md-ellipsis">
      Seichyレコードの取得とリレーションのロード
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#seichy_4" class="md-nav__link">
    <span class="md-ellipsis">
      Seichyレコードの更新
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#seichy_5" class="md-nav__link">
    <span class="md-ellipsis">
      Seichyレコードの削除
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#seichy_6" class="md-nav__link">
    <span class="md-ellipsis">
      Seichy構造体と関連するフック・クエリメソッドの詳細解説
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_90" class="md-nav__link">
    <span class="md-ellipsis">
      フック関数の詳細
    </span>
  </a>
  
    <nav class="md-nav" aria-label="フック関数の詳細">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_91" class="md-nav__link">
    <span class="md-ellipsis">
      フック関数の定義
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_92" class="md-nav__link">
    <span class="md-ellipsis">
      フック関数の実行
    </span>
  </a>
  
    <nav class="md-nav" aria-label="フック関数の実行">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dobeforeupdatehooks" class="md-nav__link">
    <span class="md-ellipsis">
      doBeforeUpdateHooks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_93" class="md-nav__link">
    <span class="md-ellipsis">
      その他のフック関数
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_94" class="md-nav__link">
    <span class="md-ellipsis">
      フック関数の登録
    </span>
  </a>
  
    <nav class="md-nav" aria-label="フック関数の登録">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_95" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_96" class="md-nav__link">
    <span class="md-ellipsis">
      クエリメソッドの詳細
    </span>
  </a>
  
    <nav class="md-nav" aria-label="クエリメソッドの詳細">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#one_1" class="md-nav__link">
    <span class="md-ellipsis">
      Oneメソッド
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Oneメソッド">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_97" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#all_1" class="md-nav__link">
    <span class="md-ellipsis">
      Allメソッド
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Allメソッド">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_98" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#count_1" class="md-nav__link">
    <span class="md-ellipsis">
      Countメソッド
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Countメソッド">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_99" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exists_2" class="md-nav__link">
    <span class="md-ellipsis">
      Existsメソッド
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Existsメソッド">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_100" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_101" class="md-nav__link">
    <span class="md-ellipsis">
      リレーションの取得
    </span>
  </a>
  
    <nav class="md-nav" aria-label="リレーションの取得">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#user_1" class="md-nav__link">
    <span class="md-ellipsis">
      Userメソッド
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Userメソッド">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_102" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#place" class="md-nav__link">
    <span class="md-ellipsis">
      Placeメソッド
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Placeメソッド">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_103" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#content" class="md-nav__link">
    <span class="md-ellipsis">
      Contentメソッド
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Contentメソッド">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_104" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#seichy_7" class="md-nav__link">
    <span class="md-ellipsis">
      Seichy 型の関連データのロードに関する詳細な解説
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#loaduser_1" class="md-nav__link">
    <span class="md-ellipsis">
      LoadUser 関数の詳細な解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LoadUser 関数の詳細な解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_105" class="md-nav__link">
    <span class="md-ellipsis">
      関数の概要
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_106" class="md-nav__link">
    <span class="md-ellipsis">
      関数のシグネチャ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_107" class="md-nav__link">
    <span class="md-ellipsis">
      コードの詳細な解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="コードの詳細な解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      1. 変数の宣言
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      2. オブジェクトの型アサーション
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-id" class="md-nav__link">
    <span class="md-ellipsis">
      3. 関連するユーザーIDを収集
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-id" class="md-nav__link">
    <span class="md-ellipsis">
      4. ユーザーIDがない場合の早期リターン
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    <span class="md-ellipsis">
      5. クエリの作成
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6" class="md-nav__link">
    <span class="md-ellipsis">
      6. クエリの実行と結果の取得
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7" class="md-nav__link">
    <span class="md-ellipsis">
      7. フックの実行
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8" class="md-nav__link">
    <span class="md-ellipsis">
      8. 結果の関連付け
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9" class="md-nav__link">
    <span class="md-ellipsis">
      9. エラーがない場合、成功を返す
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_108" class="md-nav__link">
    <span class="md-ellipsis">
      開発者向け利用例
    </span>
  </a>
  
    <nav class="md-nav" aria-label="開発者向け利用例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#seichy_8" class="md-nav__link">
    <span class="md-ellipsis">
      単一の Seichy オブジェクトの場合
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#seichy_9" class="md-nav__link">
    <span class="md-ellipsis">
      複数の Seichy オブジェクトの場合
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#loadplace" class="md-nav__link">
    <span class="md-ellipsis">
      LoadPlace 関数の詳細な解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LoadPlace 関数の詳細な解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_109" class="md-nav__link">
    <span class="md-ellipsis">
      関数の概要
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_110" class="md-nav__link">
    <span class="md-ellipsis">
      関数のシグネチャ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_111" class="md-nav__link">
    <span class="md-ellipsis">
      コードの詳細な解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="コードの詳細な解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_1" class="md-nav__link">
    <span class="md-ellipsis">
      1. 変数の宣言
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_1" class="md-nav__link">
    <span class="md-ellipsis">
      2. オブジェクトの型アサーション
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-id_1" class="md-nav__link">
    <span class="md-ellipsis">
      3. 関連する場所IDを収集
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-id_1" class="md-nav__link">
    <span class="md-ellipsis">
      4. 場所IDがない場合の早期リターン
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_1" class="md-nav__link">
    <span class="md-ellipsis">
      5. クエリの作成
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6_1" class="md-nav__link">
    <span class="md-ellipsis">
      6. クエリの実行と結果の取得
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7_1" class="md-nav__link">
    <span class="md-ellipsis">
      7. フックの実行
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8_1" class="md-nav__link">
    <span class="md-ellipsis">
      8. 結果の関連付け
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9_1" class="md-nav__link">
    <span class="md-ellipsis">
      9. エラーがない場合、成功を返す
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_112" class="md-nav__link">
    <span class="md-ellipsis">
      開発者向け利用例
    </span>
  </a>
  
    <nav class="md-nav" aria-label="開発者向け利用例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#seichy_10" class="md-nav__link">
    <span class="md-ellipsis">
      単一の Seichy オブジェクトの場合
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#seichy_11" class="md-nav__link">
    <span class="md-ellipsis">
      複数の Seichy オブジェクトの場合
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_113" class="md-nav__link">
    <span class="md-ellipsis">
      注意事項
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#loadcontent-setuser" class="md-nav__link">
    <span class="md-ellipsis">
      LoadContent 関数と SetUser 関数の詳細な解説
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#loadcontent" class="md-nav__link">
    <span class="md-ellipsis">
      LoadContent 関数の詳細な解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LoadContent 関数の詳細な解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_114" class="md-nav__link">
    <span class="md-ellipsis">
      関数の概要
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_115" class="md-nav__link">
    <span class="md-ellipsis">
      関数のシグネチャ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_116" class="md-nav__link">
    <span class="md-ellipsis">
      コードの詳細な解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="コードの詳細な解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_2" class="md-nav__link">
    <span class="md-ellipsis">
      1. 変数の宣言
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_2" class="md-nav__link">
    <span class="md-ellipsis">
      2. オブジェクトの型アサーション
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-id_2" class="md-nav__link">
    <span class="md-ellipsis">
      3. 関連するコンテンツIDを収集
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-id_2" class="md-nav__link">
    <span class="md-ellipsis">
      4. コンテンツIDがない場合の早期リターン
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_2" class="md-nav__link">
    <span class="md-ellipsis">
      5. クエリの作成
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6_2" class="md-nav__link">
    <span class="md-ellipsis">
      6. クエリの実行と結果の取得
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7_2" class="md-nav__link">
    <span class="md-ellipsis">
      7. フックの実行
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8_2" class="md-nav__link">
    <span class="md-ellipsis">
      8. 結果の関連付け
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9_2" class="md-nav__link">
    <span class="md-ellipsis">
      9. エラーがない場合、成功を返す
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_117" class="md-nav__link">
    <span class="md-ellipsis">
      開発者向け利用例
    </span>
  </a>
  
    <nav class="md-nav" aria-label="開発者向け利用例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#seichy_12" class="md-nav__link">
    <span class="md-ellipsis">
      単一の Seichy オブジェクトの場合
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#seichy_13" class="md-nav__link">
    <span class="md-ellipsis">
      複数の Seichy オブジェクトの場合
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setuser_1" class="md-nav__link">
    <span class="md-ellipsis">
      SetUser 関数の詳細な解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SetUser 関数の詳細な解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_118" class="md-nav__link">
    <span class="md-ellipsis">
      関数の概要
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_119" class="md-nav__link">
    <span class="md-ellipsis">
      関数のシグネチャ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_120" class="md-nav__link">
    <span class="md-ellipsis">
      コードの詳細な解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="コードの詳細な解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_3" class="md-nav__link">
    <span class="md-ellipsis">
      1. 変数の宣言
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_3" class="md-nav__link">
    <span class="md-ellipsis">
      2. 挿入フラグに基づく処理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-seichy" class="md-nav__link">
    <span class="md-ellipsis">
      3. Seichy テーブルの更新
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    <span class="md-ellipsis">
      4. ローカルオブジェクトのフィールド更新
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_3" class="md-nav__link">
    <span class="md-ellipsis">
      5. 関連オブジェクトのリレーションシップ設定
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6_3" class="md-nav__link">
    <span class="md-ellipsis">
      6. エラーがない場合、成功を返す
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_121" class="md-nav__link">
    <span class="md-ellipsis">
      開発者向け利用例
    </span>
  </a>
  
    <nav class="md-nav" aria-label="開発者向け利用例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#user_2" class="md-nav__link">
    <span class="md-ellipsis">
      新しい User を作成して関連付ける場合
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user_3" class="md-nav__link">
    <span class="md-ellipsis">
      既存の User を関連付ける場合
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_122" class="md-nav__link">
    <span class="md-ellipsis">
      注意事項
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setplace-setcontent" class="md-nav__link">
    <span class="md-ellipsis">
      SetPlace 関数、SetContent 関数、およびその他の関連関数の詳細な解説
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setplace" class="md-nav__link">
    <span class="md-ellipsis">
      SetPlace 関数の詳細な解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SetPlace 関数の詳細な解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_123" class="md-nav__link">
    <span class="md-ellipsis">
      関数の概要
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_124" class="md-nav__link">
    <span class="md-ellipsis">
      関数のシグネチャ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_125" class="md-nav__link">
    <span class="md-ellipsis">
      コードの詳細な解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="コードの詳細な解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_4" class="md-nav__link">
    <span class="md-ellipsis">
      1. 変数の宣言
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_4" class="md-nav__link">
    <span class="md-ellipsis">
      2. 挿入フラグに基づく処理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-seichy_1" class="md-nav__link">
    <span class="md-ellipsis">
      3. Seichy テーブルの更新
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_1" class="md-nav__link">
    <span class="md-ellipsis">
      4. ローカルオブジェクトのフィールド更新
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_4" class="md-nav__link">
    <span class="md-ellipsis">
      5. 関連オブジェクトのリレーションシップ設定
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6_4" class="md-nav__link">
    <span class="md-ellipsis">
      6. エラーがない場合、成功を返す
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_126" class="md-nav__link">
    <span class="md-ellipsis">
      開発者向け利用例
    </span>
  </a>
  
    <nav class="md-nav" aria-label="開発者向け利用例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#place_1" class="md-nav__link">
    <span class="md-ellipsis">
      新しい Place を作成して関連付ける場合
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#place_2" class="md-nav__link">
    <span class="md-ellipsis">
      既存の Place を関連付ける場合
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setcontent" class="md-nav__link">
    <span class="md-ellipsis">
      SetContent 関数の詳細な解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SetContent 関数の詳細な解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_127" class="md-nav__link">
    <span class="md-ellipsis">
      関数の概要
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_128" class="md-nav__link">
    <span class="md-ellipsis">
      関数のシグネチャ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_129" class="md-nav__link">
    <span class="md-ellipsis">
      コードの詳細な解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="コードの詳細な解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_5" class="md-nav__link">
    <span class="md-ellipsis">
      1. 変数の宣言
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_5" class="md-nav__link">
    <span class="md-ellipsis">
      2. 挿入フラグに基づく処理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-seichy_2" class="md-nav__link">
    <span class="md-ellipsis">
      3. Seichy テーブルの更新
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_2" class="md-nav__link">
    <span class="md-ellipsis">
      4. ローカルオブジェクトのフィールド更新
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_5" class="md-nav__link">
    <span class="md-ellipsis">
      5. 関連オブジェクトのリレーションシップ設定
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6_5" class="md-nav__link">
    <span class="md-ellipsis">
      6. エラーがない場合、成功を返す
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_130" class="md-nav__link">
    <span class="md-ellipsis">
      開発者向け利用例
    </span>
  </a>
  
    <nav class="md-nav" aria-label="開発者向け利用例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#content_1" class="md-nav__link">
    <span class="md-ellipsis">
      新しい Content を作成して関連付ける場合
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#content_2" class="md-nav__link">
    <span class="md-ellipsis">
      既存の Content を関連付ける場合
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#seichies" class="md-nav__link">
    <span class="md-ellipsis">
      Seichies 関数の詳細な解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Seichies 関数の詳細な解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_131" class="md-nav__link">
    <span class="md-ellipsis">
      関数の概要
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_132" class="md-nav__link">
    <span class="md-ellipsis">
      関数のシグネチャ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_133" class="md-nav__link">
    <span class="md-ellipsis">
      コードの詳細な解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="コードの詳細な解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_6" class="md-nav__link">
    <span class="md-ellipsis">
      1. クエリモディファイアの追加
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_6" class="md-nav__link">
    <span class="md-ellipsis">
      2. 新しいクエリの作成
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-select" class="md-nav__link">
    <span class="md-ellipsis">
      3. SELECT 文の設定
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_3" class="md-nav__link">
    <span class="md-ellipsis">
      4. クエリオブジェクトの返却
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_134" class="md-nav__link">
    <span class="md-ellipsis">
      開発者向け利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#findseichy" class="md-nav__link">
    <span class="md-ellipsis">
      FindSeichy 関数の詳細な解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FindSeichy 関数の詳細な解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_135" class="md-nav__link">
    <span class="md-ellipsis">
      関数の概要
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_136" class="md-nav__link">
    <span class="md-ellipsis">
      関数のシグネチャ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_137" class="md-nav__link">
    <span class="md-ellipsis">
      コードの詳細な解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="コードの詳細な解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_7" class="md-nav__link">
    <span class="md-ellipsis">
      1. オブジェクトの初期化
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-select" class="md-nav__link">
    <span class="md-ellipsis">
      2. SELECT 文の設定
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      3. クエリの構築
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_4" class="md-nav__link">
    <span class="md-ellipsis">
      4. クエリの実行と結果の取得
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_6" class="md-nav__link">
    <span class="md-ellipsis">
      5. フックの実行
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6_6" class="md-nav__link">
    <span class="md-ellipsis">
      6. オブジェクトの返却
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_138" class="md-nav__link">
    <span class="md-ellipsis">
      開発者向け利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#insert_1" class="md-nav__link">
    <span class="md-ellipsis">
      Insert 関数の詳細な解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Insert 関数の詳細な解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_139" class="md-nav__link">
    <span class="md-ellipsis">
      関数の概要
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_140" class="md-nav__link">
    <span class="md-ellipsis">
      関数のシグネチャ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_141" class="md-nav__link">
    <span class="md-ellipsis">
      コードの詳細な解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="コードの詳細な解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_8" class="md-nav__link">
    <span class="md-ellipsis">
      1. オブジェクトの存在確認
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_7" class="md-nav__link">
    <span class="md-ellipsis">
      2. タイムスタンプの設定
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-beforeinsert" class="md-nav__link">
    <span class="md-ellipsis">
      3. BeforeInsert フックの実行
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_5" class="md-nav__link">
    <span class="md-ellipsis">
      4. 非ゼロのデフォルト値セットの取得
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_7" class="md-nav__link">
    <span class="md-ellipsis">
      5. キャッシュキーの作成とキャッシュの確認
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6_7" class="md-nav__link">
    <span class="md-ellipsis">
      6. クエリとマッピングの準備
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7_3" class="md-nav__link">
    <span class="md-ellipsis">
      7. 値の取得とクエリの実行
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-id" class="md-nav__link">
    <span class="md-ellipsis">
      8. 最後の挿入IDの取得とオブジェクトへの反映
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9_3" class="md-nav__link">
    <span class="md-ellipsis">
      9. デフォルト値の取得（必要な場合）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10" class="md-nav__link">
    <span class="md-ellipsis">
      10. キャッシュの保存
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#11-afterinsert" class="md-nav__link">
    <span class="md-ellipsis">
      11. AfterInsert フックの実行
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_142" class="md-nav__link">
    <span class="md-ellipsis">
      開発者向け利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#update_1" class="md-nav__link">
    <span class="md-ellipsis">
      Update 関数の詳細な解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Update 関数の詳細な解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_143" class="md-nav__link">
    <span class="md-ellipsis">
      関数の概要
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_144" class="md-nav__link">
    <span class="md-ellipsis">
      関数のシグネチャ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_145" class="md-nav__link">
    <span class="md-ellipsis">
      コードの詳細な解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="コードの詳細な解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_9" class="md-nav__link">
    <span class="md-ellipsis">
      1. タイムスタンプの更新
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-beforeupdate" class="md-nav__link">
    <span class="md-ellipsis">
      2. BeforeUpdate フックの実行
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_1" class="md-nav__link">
    <span class="md-ellipsis">
      3. キャッシュキーの作成とキャッシュの確認
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_6" class="md-nav__link">
    <span class="md-ellipsis">
      4. クエリとマッピングの準備
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_8" class="md-nav__link">
    <span class="md-ellipsis">
      5. 値の取得とクエリの実行
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6_8" class="md-nav__link">
    <span class="md-ellipsis">
      6. 更新された行数の取得
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7_4" class="md-nav__link">
    <span class="md-ellipsis">
      7. キャッシュの保存
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-afterupdate" class="md-nav__link">
    <span class="md-ellipsis">
      8. AfterUpdate フックの実行
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_146" class="md-nav__link">
    <span class="md-ellipsis">
      開発者向け利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_147" class="md-nav__link">
    <span class="md-ellipsis">
      注意事項
    </span>
  </a>
  
    <nav class="md-nav" aria-label="注意事項">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#updateall_2" class="md-nav__link">
    <span class="md-ellipsis">
      UpdateAll 関数の解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="UpdateAll 関数の解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_148" class="md-nav__link">
    <span class="md-ellipsis">
      詳細な説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_149" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#updateall_3" class="md-nav__link">
    <span class="md-ellipsis">
      UpdateAll メソッド（スライス用）の解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="UpdateAll メソッド（スライス用）の解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_150" class="md-nav__link">
    <span class="md-ellipsis">
      詳細な説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_151" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#upsert_1" class="md-nav__link">
    <span class="md-ellipsis">
      Upsert 関数の解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Upsert 関数の解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_152" class="md-nav__link">
    <span class="md-ellipsis">
      詳細な説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_153" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete_1" class="md-nav__link">
    <span class="md-ellipsis">
      Delete 関数の解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Delete 関数の解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_154" class="md-nav__link">
    <span class="md-ellipsis">
      詳細な説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_155" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deleteall_2" class="md-nav__link">
    <span class="md-ellipsis">
      DeleteAll 関数（クエリ用）の解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DeleteAll 関数（クエリ用）の解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_156" class="md-nav__link">
    <span class="md-ellipsis">
      詳細な説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_157" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deleteall_3" class="md-nav__link">
    <span class="md-ellipsis">
      DeleteAll メソッド（スライス用）の解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DeleteAll メソッド（スライス用）の解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_158" class="md-nav__link">
    <span class="md-ellipsis">
      詳細な説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_159" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_160" class="md-nav__link">
    <span class="md-ellipsis">
      補足
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_161" class="md-nav__link">
    <span class="md-ellipsis">
      注意点
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reload_1" class="md-nav__link">
    <span class="md-ellipsis">
      Reload 関数の解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Reload 関数の解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_162" class="md-nav__link">
    <span class="md-ellipsis">
      詳細な説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_163" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reloadall_1" class="md-nav__link">
    <span class="md-ellipsis">
      ReloadAll 関数の解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ReloadAll 関数の解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_164" class="md-nav__link">
    <span class="md-ellipsis">
      詳細な説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_165" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#seichyexists" class="md-nav__link">
    <span class="md-ellipsis">
      SeichyExists 関数の解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SeichyExists 関数の解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_166" class="md-nav__link">
    <span class="md-ellipsis">
      詳細な説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_167" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exists_3" class="md-nav__link">
    <span class="md-ellipsis">
      Exists メソッドの解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exists メソッドの解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_168" class="md-nav__link">
    <span class="md-ellipsis">
      詳細な説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_169" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_170" class="md-nav__link">
    <span class="md-ellipsis">
      補足
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_171" class="md-nav__link">
    <span class="md-ellipsis">
      注意点
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../points.go/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pointモデルの詳細解説と利用例
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../users.go/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Userモデルの詳細解説と利用例
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Git
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Git
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Git/Fetch%E3%81%A8Pull/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fetchとpullはどう違うのか
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Git/origin%28%E3%83%AA%E3%83%A2%E3%83%BC%E3%83%88%29%E3%83%96%E3%83%A9%E3%83%B3%E3%83%81%E5%89%8A%E9%99%A4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Origin(リモート)ブランチ削除
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Google Maps
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Google Maps
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Google%20Maps/Maps%20JavaScript%20API/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Maps JavaScript API
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      概要
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      パッケージとインポート
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pointlog_1" class="md-nav__link">
    <span class="md-ellipsis">
      PointLog構造体
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      カラム名の定義
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#where" class="md-nav__link">
    <span class="md-ellipsis">
      Where句のヘルパー
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      リレーションシップ定義
    </span>
  </a>
  
    <nav class="md-nav" aria-label="リレーションシップ定義">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      リレーションシップの初期化と取得
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      ロードメソッド
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      カラムとキーの定義
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      型エイリアスとクエリ構造体
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      キャッシュ関連の変数
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      その他の依存性
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      フックの定義と管理
    </span>
  </a>
  
    <nav class="md-nav" aria-label="フックの定義と管理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      フック用の変数とミューテックス
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      フックの実行メソッド
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      フックの登録
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      クエリメソッド
    </span>
  </a>
  
    <nav class="md-nav" aria-label="クエリメソッド">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#one" class="md-nav__link">
    <span class="md-ellipsis">
      Oneメソッド
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      開発者向け利用例
    </span>
  </a>
  
    <nav class="md-nav" aria-label="開発者向け利用例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      データベースへの接続
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      レコードの取得
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      レコードの挿入
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      レコードの更新
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      レコードの削除
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      トランザクションの使用
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      フックの使用
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    <span class="md-ellipsis">
      注意事項
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#all" class="md-nav__link">
    <span class="md-ellipsis">
      All 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="All 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    <span class="md-ellipsis">
      処理の流れ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#count" class="md-nav__link">
    <span class="md-ellipsis">
      Count 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Count 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exists" class="md-nav__link">
    <span class="md-ellipsis">
      Exists 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exists 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#user" class="md-nav__link">
    <span class="md-ellipsis">
      User 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="User 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#loaduser" class="md-nav__link">
    <span class="md-ellipsis">
      LoadUser 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LoadUser 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_34" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_35" class="md-nav__link">
    <span class="md-ellipsis">
      処理の流れ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_36" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setuser" class="md-nav__link">
    <span class="md-ellipsis">
      SetUser 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SetUser 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_37" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_38" class="md-nav__link">
    <span class="md-ellipsis">
      処理の流れ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_39" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pointlogs" class="md-nav__link">
    <span class="md-ellipsis">
      PointLogs 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PointLogs 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_40" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_41" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#findpointlog" class="md-nav__link">
    <span class="md-ellipsis">
      FindPointLog 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FindPointLog 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_42" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_43" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#insert" class="md-nav__link">
    <span class="md-ellipsis">
      Insert 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Insert 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_44" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_45" class="md-nav__link">
    <span class="md-ellipsis">
      処理の流れ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_46" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#update" class="md-nav__link">
    <span class="md-ellipsis">
      Update 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Update 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_47" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_48" class="md-nav__link">
    <span class="md-ellipsis">
      処理の流れ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_49" class="md-nav__link">
    <span class="md-ellipsis">
      注意点
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_50" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#updateall" class="md-nav__link">
    <span class="md-ellipsis">
      UpdateAll 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="UpdateAll 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_51" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_52" class="md-nav__link">
    <span class="md-ellipsis">
      処理の流れ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_53" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#updateall_1" class="md-nav__link">
    <span class="md-ellipsis">
      UpdateAll メソッド（スライス用）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="UpdateAll メソッド（スライス用）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_54" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_55" class="md-nav__link">
    <span class="md-ellipsis">
      処理の流れ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_56" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#upsert" class="md-nav__link">
    <span class="md-ellipsis">
      Upsert 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Upsert 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_57" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_58" class="md-nav__link">
    <span class="md-ellipsis">
      処理の流れ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_59" class="md-nav__link">
    <span class="md-ellipsis">
      注意点
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_60" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#delete" class="md-nav__link">
    <span class="md-ellipsis">
      Delete 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Delete 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_61" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_62" class="md-nav__link">
    <span class="md-ellipsis">
      処理の流れ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_63" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deleteall" class="md-nav__link">
    <span class="md-ellipsis">
      DeleteAll 関数（クエリ用）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DeleteAll 関数（クエリ用）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_64" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_65" class="md-nav__link">
    <span class="md-ellipsis">
      処理の流れ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_66" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deleteall_1" class="md-nav__link">
    <span class="md-ellipsis">
      DeleteAll 関数（スライス用）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DeleteAll 関数（スライス用）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_67" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_68" class="md-nav__link">
    <span class="md-ellipsis">
      処理の流れ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_69" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reload" class="md-nav__link">
    <span class="md-ellipsis">
      Reload 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Reload 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_70" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_71" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reloadall" class="md-nav__link">
    <span class="md-ellipsis">
      ReloadAll 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ReloadAll 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_72" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_73" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pointlogexists" class="md-nav__link">
    <span class="md-ellipsis">
      PointLogExists 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PointLogExists 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_74" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_75" class="md-nav__link">
    <span class="md-ellipsis">
      処理の流れ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_76" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exists_1" class="md-nav__link">
    <span class="md-ellipsis">
      Exists メソッド
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exists メソッド">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_77" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_78" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#seichy" class="md-nav__link">
    <span class="md-ellipsis">
      Seichy構造体と関連コードの詳細解説
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_79" class="md-nav__link">
    <span class="md-ellipsis">
      はじめに
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#seichy_1" class="md-nav__link">
    <span class="md-ellipsis">
      Seichy構造体の定義
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Seichy構造体の定義">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_80" class="md-nav__link">
    <span class="md-ellipsis">
      フィールドの解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_81" class="md-nav__link">
    <span class="md-ellipsis">
      リレーションフィールド
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_82" class="md-nav__link">
    <span class="md-ellipsis">
      カラム名の定義
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sqlboilerwhere" class="md-nav__link">
    <span class="md-ellipsis">
      SQLBoilerによるWhereヘルパーの生成
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SQLBoilerによるWhereヘルパーの生成">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nullstringwhere" class="md-nav__link">
    <span class="md-ellipsis">
      null.String用のWhereヘルパー
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#seichywhere" class="md-nav__link">
    <span class="md-ellipsis">
      SeichyWhere構造体
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_83" class="md-nav__link">
    <span class="md-ellipsis">
      リレーションシップの定義
    </span>
  </a>
  
    <nav class="md-nav" aria-label="リレーションシップの定義">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_84" class="md-nav__link">
    <span class="md-ellipsis">
      リレーション用構造体
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_85" class="md-nav__link">
    <span class="md-ellipsis">
      キャッシングと同期
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_86" class="md-nav__link">
    <span class="md-ellipsis">
      フックの定義
    </span>
  </a>
  
    <nav class="md-nav" aria-label="フックの定義">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_87" class="md-nav__link">
    <span class="md-ellipsis">
      フックの種類
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_88" class="md-nav__link">
    <span class="md-ellipsis">
      フックの実装例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_89" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
    <nav class="md-nav" aria-label="利用例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#seichy_2" class="md-nav__link">
    <span class="md-ellipsis">
      新しいSeichyレコードの作成
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#seichy_3" class="md-nav__link">
    <span class="md-ellipsis">
      Seichyレコードの取得とリレーションのロード
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#seichy_4" class="md-nav__link">
    <span class="md-ellipsis">
      Seichyレコードの更新
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#seichy_5" class="md-nav__link">
    <span class="md-ellipsis">
      Seichyレコードの削除
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#seichy_6" class="md-nav__link">
    <span class="md-ellipsis">
      Seichy構造体と関連するフック・クエリメソッドの詳細解説
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_90" class="md-nav__link">
    <span class="md-ellipsis">
      フック関数の詳細
    </span>
  </a>
  
    <nav class="md-nav" aria-label="フック関数の詳細">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_91" class="md-nav__link">
    <span class="md-ellipsis">
      フック関数の定義
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_92" class="md-nav__link">
    <span class="md-ellipsis">
      フック関数の実行
    </span>
  </a>
  
    <nav class="md-nav" aria-label="フック関数の実行">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dobeforeupdatehooks" class="md-nav__link">
    <span class="md-ellipsis">
      doBeforeUpdateHooks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_93" class="md-nav__link">
    <span class="md-ellipsis">
      その他のフック関数
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_94" class="md-nav__link">
    <span class="md-ellipsis">
      フック関数の登録
    </span>
  </a>
  
    <nav class="md-nav" aria-label="フック関数の登録">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_95" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_96" class="md-nav__link">
    <span class="md-ellipsis">
      クエリメソッドの詳細
    </span>
  </a>
  
    <nav class="md-nav" aria-label="クエリメソッドの詳細">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#one_1" class="md-nav__link">
    <span class="md-ellipsis">
      Oneメソッド
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Oneメソッド">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_97" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#all_1" class="md-nav__link">
    <span class="md-ellipsis">
      Allメソッド
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Allメソッド">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_98" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#count_1" class="md-nav__link">
    <span class="md-ellipsis">
      Countメソッド
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Countメソッド">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_99" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exists_2" class="md-nav__link">
    <span class="md-ellipsis">
      Existsメソッド
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Existsメソッド">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_100" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_101" class="md-nav__link">
    <span class="md-ellipsis">
      リレーションの取得
    </span>
  </a>
  
    <nav class="md-nav" aria-label="リレーションの取得">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#user_1" class="md-nav__link">
    <span class="md-ellipsis">
      Userメソッド
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Userメソッド">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_102" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#place" class="md-nav__link">
    <span class="md-ellipsis">
      Placeメソッド
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Placeメソッド">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_103" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#content" class="md-nav__link">
    <span class="md-ellipsis">
      Contentメソッド
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Contentメソッド">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_104" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#seichy_7" class="md-nav__link">
    <span class="md-ellipsis">
      Seichy 型の関連データのロードに関する詳細な解説
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#loaduser_1" class="md-nav__link">
    <span class="md-ellipsis">
      LoadUser 関数の詳細な解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LoadUser 関数の詳細な解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_105" class="md-nav__link">
    <span class="md-ellipsis">
      関数の概要
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_106" class="md-nav__link">
    <span class="md-ellipsis">
      関数のシグネチャ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_107" class="md-nav__link">
    <span class="md-ellipsis">
      コードの詳細な解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="コードの詳細な解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      1. 変数の宣言
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      2. オブジェクトの型アサーション
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-id" class="md-nav__link">
    <span class="md-ellipsis">
      3. 関連するユーザーIDを収集
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-id" class="md-nav__link">
    <span class="md-ellipsis">
      4. ユーザーIDがない場合の早期リターン
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    <span class="md-ellipsis">
      5. クエリの作成
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6" class="md-nav__link">
    <span class="md-ellipsis">
      6. クエリの実行と結果の取得
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7" class="md-nav__link">
    <span class="md-ellipsis">
      7. フックの実行
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8" class="md-nav__link">
    <span class="md-ellipsis">
      8. 結果の関連付け
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9" class="md-nav__link">
    <span class="md-ellipsis">
      9. エラーがない場合、成功を返す
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_108" class="md-nav__link">
    <span class="md-ellipsis">
      開発者向け利用例
    </span>
  </a>
  
    <nav class="md-nav" aria-label="開発者向け利用例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#seichy_8" class="md-nav__link">
    <span class="md-ellipsis">
      単一の Seichy オブジェクトの場合
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#seichy_9" class="md-nav__link">
    <span class="md-ellipsis">
      複数の Seichy オブジェクトの場合
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#loadplace" class="md-nav__link">
    <span class="md-ellipsis">
      LoadPlace 関数の詳細な解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LoadPlace 関数の詳細な解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_109" class="md-nav__link">
    <span class="md-ellipsis">
      関数の概要
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_110" class="md-nav__link">
    <span class="md-ellipsis">
      関数のシグネチャ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_111" class="md-nav__link">
    <span class="md-ellipsis">
      コードの詳細な解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="コードの詳細な解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_1" class="md-nav__link">
    <span class="md-ellipsis">
      1. 変数の宣言
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_1" class="md-nav__link">
    <span class="md-ellipsis">
      2. オブジェクトの型アサーション
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-id_1" class="md-nav__link">
    <span class="md-ellipsis">
      3. 関連する場所IDを収集
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-id_1" class="md-nav__link">
    <span class="md-ellipsis">
      4. 場所IDがない場合の早期リターン
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_1" class="md-nav__link">
    <span class="md-ellipsis">
      5. クエリの作成
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6_1" class="md-nav__link">
    <span class="md-ellipsis">
      6. クエリの実行と結果の取得
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7_1" class="md-nav__link">
    <span class="md-ellipsis">
      7. フックの実行
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8_1" class="md-nav__link">
    <span class="md-ellipsis">
      8. 結果の関連付け
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9_1" class="md-nav__link">
    <span class="md-ellipsis">
      9. エラーがない場合、成功を返す
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_112" class="md-nav__link">
    <span class="md-ellipsis">
      開発者向け利用例
    </span>
  </a>
  
    <nav class="md-nav" aria-label="開発者向け利用例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#seichy_10" class="md-nav__link">
    <span class="md-ellipsis">
      単一の Seichy オブジェクトの場合
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#seichy_11" class="md-nav__link">
    <span class="md-ellipsis">
      複数の Seichy オブジェクトの場合
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_113" class="md-nav__link">
    <span class="md-ellipsis">
      注意事項
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#loadcontent-setuser" class="md-nav__link">
    <span class="md-ellipsis">
      LoadContent 関数と SetUser 関数の詳細な解説
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#loadcontent" class="md-nav__link">
    <span class="md-ellipsis">
      LoadContent 関数の詳細な解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LoadContent 関数の詳細な解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_114" class="md-nav__link">
    <span class="md-ellipsis">
      関数の概要
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_115" class="md-nav__link">
    <span class="md-ellipsis">
      関数のシグネチャ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_116" class="md-nav__link">
    <span class="md-ellipsis">
      コードの詳細な解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="コードの詳細な解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_2" class="md-nav__link">
    <span class="md-ellipsis">
      1. 変数の宣言
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_2" class="md-nav__link">
    <span class="md-ellipsis">
      2. オブジェクトの型アサーション
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-id_2" class="md-nav__link">
    <span class="md-ellipsis">
      3. 関連するコンテンツIDを収集
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-id_2" class="md-nav__link">
    <span class="md-ellipsis">
      4. コンテンツIDがない場合の早期リターン
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_2" class="md-nav__link">
    <span class="md-ellipsis">
      5. クエリの作成
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6_2" class="md-nav__link">
    <span class="md-ellipsis">
      6. クエリの実行と結果の取得
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7_2" class="md-nav__link">
    <span class="md-ellipsis">
      7. フックの実行
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8_2" class="md-nav__link">
    <span class="md-ellipsis">
      8. 結果の関連付け
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9_2" class="md-nav__link">
    <span class="md-ellipsis">
      9. エラーがない場合、成功を返す
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_117" class="md-nav__link">
    <span class="md-ellipsis">
      開発者向け利用例
    </span>
  </a>
  
    <nav class="md-nav" aria-label="開発者向け利用例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#seichy_12" class="md-nav__link">
    <span class="md-ellipsis">
      単一の Seichy オブジェクトの場合
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#seichy_13" class="md-nav__link">
    <span class="md-ellipsis">
      複数の Seichy オブジェクトの場合
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setuser_1" class="md-nav__link">
    <span class="md-ellipsis">
      SetUser 関数の詳細な解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SetUser 関数の詳細な解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_118" class="md-nav__link">
    <span class="md-ellipsis">
      関数の概要
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_119" class="md-nav__link">
    <span class="md-ellipsis">
      関数のシグネチャ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_120" class="md-nav__link">
    <span class="md-ellipsis">
      コードの詳細な解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="コードの詳細な解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_3" class="md-nav__link">
    <span class="md-ellipsis">
      1. 変数の宣言
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_3" class="md-nav__link">
    <span class="md-ellipsis">
      2. 挿入フラグに基づく処理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-seichy" class="md-nav__link">
    <span class="md-ellipsis">
      3. Seichy テーブルの更新
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    <span class="md-ellipsis">
      4. ローカルオブジェクトのフィールド更新
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_3" class="md-nav__link">
    <span class="md-ellipsis">
      5. 関連オブジェクトのリレーションシップ設定
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6_3" class="md-nav__link">
    <span class="md-ellipsis">
      6. エラーがない場合、成功を返す
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_121" class="md-nav__link">
    <span class="md-ellipsis">
      開発者向け利用例
    </span>
  </a>
  
    <nav class="md-nav" aria-label="開発者向け利用例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#user_2" class="md-nav__link">
    <span class="md-ellipsis">
      新しい User を作成して関連付ける場合
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user_3" class="md-nav__link">
    <span class="md-ellipsis">
      既存の User を関連付ける場合
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_122" class="md-nav__link">
    <span class="md-ellipsis">
      注意事項
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setplace-setcontent" class="md-nav__link">
    <span class="md-ellipsis">
      SetPlace 関数、SetContent 関数、およびその他の関連関数の詳細な解説
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setplace" class="md-nav__link">
    <span class="md-ellipsis">
      SetPlace 関数の詳細な解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SetPlace 関数の詳細な解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_123" class="md-nav__link">
    <span class="md-ellipsis">
      関数の概要
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_124" class="md-nav__link">
    <span class="md-ellipsis">
      関数のシグネチャ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_125" class="md-nav__link">
    <span class="md-ellipsis">
      コードの詳細な解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="コードの詳細な解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_4" class="md-nav__link">
    <span class="md-ellipsis">
      1. 変数の宣言
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_4" class="md-nav__link">
    <span class="md-ellipsis">
      2. 挿入フラグに基づく処理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-seichy_1" class="md-nav__link">
    <span class="md-ellipsis">
      3. Seichy テーブルの更新
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_1" class="md-nav__link">
    <span class="md-ellipsis">
      4. ローカルオブジェクトのフィールド更新
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_4" class="md-nav__link">
    <span class="md-ellipsis">
      5. 関連オブジェクトのリレーションシップ設定
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6_4" class="md-nav__link">
    <span class="md-ellipsis">
      6. エラーがない場合、成功を返す
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_126" class="md-nav__link">
    <span class="md-ellipsis">
      開発者向け利用例
    </span>
  </a>
  
    <nav class="md-nav" aria-label="開発者向け利用例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#place_1" class="md-nav__link">
    <span class="md-ellipsis">
      新しい Place を作成して関連付ける場合
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#place_2" class="md-nav__link">
    <span class="md-ellipsis">
      既存の Place を関連付ける場合
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setcontent" class="md-nav__link">
    <span class="md-ellipsis">
      SetContent 関数の詳細な解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SetContent 関数の詳細な解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_127" class="md-nav__link">
    <span class="md-ellipsis">
      関数の概要
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_128" class="md-nav__link">
    <span class="md-ellipsis">
      関数のシグネチャ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_129" class="md-nav__link">
    <span class="md-ellipsis">
      コードの詳細な解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="コードの詳細な解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_5" class="md-nav__link">
    <span class="md-ellipsis">
      1. 変数の宣言
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_5" class="md-nav__link">
    <span class="md-ellipsis">
      2. 挿入フラグに基づく処理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-seichy_2" class="md-nav__link">
    <span class="md-ellipsis">
      3. Seichy テーブルの更新
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_2" class="md-nav__link">
    <span class="md-ellipsis">
      4. ローカルオブジェクトのフィールド更新
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_5" class="md-nav__link">
    <span class="md-ellipsis">
      5. 関連オブジェクトのリレーションシップ設定
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6_5" class="md-nav__link">
    <span class="md-ellipsis">
      6. エラーがない場合、成功を返す
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_130" class="md-nav__link">
    <span class="md-ellipsis">
      開発者向け利用例
    </span>
  </a>
  
    <nav class="md-nav" aria-label="開発者向け利用例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#content_1" class="md-nav__link">
    <span class="md-ellipsis">
      新しい Content を作成して関連付ける場合
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#content_2" class="md-nav__link">
    <span class="md-ellipsis">
      既存の Content を関連付ける場合
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#seichies" class="md-nav__link">
    <span class="md-ellipsis">
      Seichies 関数の詳細な解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Seichies 関数の詳細な解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_131" class="md-nav__link">
    <span class="md-ellipsis">
      関数の概要
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_132" class="md-nav__link">
    <span class="md-ellipsis">
      関数のシグネチャ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_133" class="md-nav__link">
    <span class="md-ellipsis">
      コードの詳細な解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="コードの詳細な解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_6" class="md-nav__link">
    <span class="md-ellipsis">
      1. クエリモディファイアの追加
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_6" class="md-nav__link">
    <span class="md-ellipsis">
      2. 新しいクエリの作成
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-select" class="md-nav__link">
    <span class="md-ellipsis">
      3. SELECT 文の設定
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_3" class="md-nav__link">
    <span class="md-ellipsis">
      4. クエリオブジェクトの返却
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_134" class="md-nav__link">
    <span class="md-ellipsis">
      開発者向け利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#findseichy" class="md-nav__link">
    <span class="md-ellipsis">
      FindSeichy 関数の詳細な解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FindSeichy 関数の詳細な解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_135" class="md-nav__link">
    <span class="md-ellipsis">
      関数の概要
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_136" class="md-nav__link">
    <span class="md-ellipsis">
      関数のシグネチャ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_137" class="md-nav__link">
    <span class="md-ellipsis">
      コードの詳細な解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="コードの詳細な解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_7" class="md-nav__link">
    <span class="md-ellipsis">
      1. オブジェクトの初期化
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-select" class="md-nav__link">
    <span class="md-ellipsis">
      2. SELECT 文の設定
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      3. クエリの構築
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_4" class="md-nav__link">
    <span class="md-ellipsis">
      4. クエリの実行と結果の取得
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_6" class="md-nav__link">
    <span class="md-ellipsis">
      5. フックの実行
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6_6" class="md-nav__link">
    <span class="md-ellipsis">
      6. オブジェクトの返却
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_138" class="md-nav__link">
    <span class="md-ellipsis">
      開発者向け利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#insert_1" class="md-nav__link">
    <span class="md-ellipsis">
      Insert 関数の詳細な解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Insert 関数の詳細な解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_139" class="md-nav__link">
    <span class="md-ellipsis">
      関数の概要
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_140" class="md-nav__link">
    <span class="md-ellipsis">
      関数のシグネチャ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_141" class="md-nav__link">
    <span class="md-ellipsis">
      コードの詳細な解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="コードの詳細な解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_8" class="md-nav__link">
    <span class="md-ellipsis">
      1. オブジェクトの存在確認
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_7" class="md-nav__link">
    <span class="md-ellipsis">
      2. タイムスタンプの設定
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-beforeinsert" class="md-nav__link">
    <span class="md-ellipsis">
      3. BeforeInsert フックの実行
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_5" class="md-nav__link">
    <span class="md-ellipsis">
      4. 非ゼロのデフォルト値セットの取得
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_7" class="md-nav__link">
    <span class="md-ellipsis">
      5. キャッシュキーの作成とキャッシュの確認
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6_7" class="md-nav__link">
    <span class="md-ellipsis">
      6. クエリとマッピングの準備
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7_3" class="md-nav__link">
    <span class="md-ellipsis">
      7. 値の取得とクエリの実行
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-id" class="md-nav__link">
    <span class="md-ellipsis">
      8. 最後の挿入IDの取得とオブジェクトへの反映
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9_3" class="md-nav__link">
    <span class="md-ellipsis">
      9. デフォルト値の取得（必要な場合）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10" class="md-nav__link">
    <span class="md-ellipsis">
      10. キャッシュの保存
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#11-afterinsert" class="md-nav__link">
    <span class="md-ellipsis">
      11. AfterInsert フックの実行
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_142" class="md-nav__link">
    <span class="md-ellipsis">
      開発者向け利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#update_1" class="md-nav__link">
    <span class="md-ellipsis">
      Update 関数の詳細な解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Update 関数の詳細な解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_143" class="md-nav__link">
    <span class="md-ellipsis">
      関数の概要
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_144" class="md-nav__link">
    <span class="md-ellipsis">
      関数のシグネチャ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_145" class="md-nav__link">
    <span class="md-ellipsis">
      コードの詳細な解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="コードの詳細な解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_9" class="md-nav__link">
    <span class="md-ellipsis">
      1. タイムスタンプの更新
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-beforeupdate" class="md-nav__link">
    <span class="md-ellipsis">
      2. BeforeUpdate フックの実行
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_1" class="md-nav__link">
    <span class="md-ellipsis">
      3. キャッシュキーの作成とキャッシュの確認
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_6" class="md-nav__link">
    <span class="md-ellipsis">
      4. クエリとマッピングの準備
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_8" class="md-nav__link">
    <span class="md-ellipsis">
      5. 値の取得とクエリの実行
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6_8" class="md-nav__link">
    <span class="md-ellipsis">
      6. 更新された行数の取得
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7_4" class="md-nav__link">
    <span class="md-ellipsis">
      7. キャッシュの保存
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-afterupdate" class="md-nav__link">
    <span class="md-ellipsis">
      8. AfterUpdate フックの実行
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_146" class="md-nav__link">
    <span class="md-ellipsis">
      開発者向け利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_147" class="md-nav__link">
    <span class="md-ellipsis">
      注意事項
    </span>
  </a>
  
    <nav class="md-nav" aria-label="注意事項">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#updateall_2" class="md-nav__link">
    <span class="md-ellipsis">
      UpdateAll 関数の解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="UpdateAll 関数の解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_148" class="md-nav__link">
    <span class="md-ellipsis">
      詳細な説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_149" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#updateall_3" class="md-nav__link">
    <span class="md-ellipsis">
      UpdateAll メソッド（スライス用）の解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="UpdateAll メソッド（スライス用）の解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_150" class="md-nav__link">
    <span class="md-ellipsis">
      詳細な説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_151" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#upsert_1" class="md-nav__link">
    <span class="md-ellipsis">
      Upsert 関数の解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Upsert 関数の解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_152" class="md-nav__link">
    <span class="md-ellipsis">
      詳細な説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_153" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete_1" class="md-nav__link">
    <span class="md-ellipsis">
      Delete 関数の解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Delete 関数の解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_154" class="md-nav__link">
    <span class="md-ellipsis">
      詳細な説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_155" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deleteall_2" class="md-nav__link">
    <span class="md-ellipsis">
      DeleteAll 関数（クエリ用）の解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DeleteAll 関数（クエリ用）の解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_156" class="md-nav__link">
    <span class="md-ellipsis">
      詳細な説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_157" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deleteall_3" class="md-nav__link">
    <span class="md-ellipsis">
      DeleteAll メソッド（スライス用）の解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DeleteAll メソッド（スライス用）の解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_158" class="md-nav__link">
    <span class="md-ellipsis">
      詳細な説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_159" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_160" class="md-nav__link">
    <span class="md-ellipsis">
      補足
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_161" class="md-nav__link">
    <span class="md-ellipsis">
      注意点
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reload_1" class="md-nav__link">
    <span class="md-ellipsis">
      Reload 関数の解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Reload 関数の解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_162" class="md-nav__link">
    <span class="md-ellipsis">
      詳細な説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_163" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reloadall_1" class="md-nav__link">
    <span class="md-ellipsis">
      ReloadAll 関数の解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ReloadAll 関数の解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_164" class="md-nav__link">
    <span class="md-ellipsis">
      詳細な説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_165" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#seichyexists" class="md-nav__link">
    <span class="md-ellipsis">
      SeichyExists 関数の解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SeichyExists 関数の解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_166" class="md-nav__link">
    <span class="md-ellipsis">
      詳細な説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_167" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exists_3" class="md-nav__link">
    <span class="md-ellipsis">
      Exists メソッドの解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exists メソッドの解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_168" class="md-nav__link">
    <span class="md-ellipsis">
      詳細な説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_169" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_170" class="md-nav__link">
    <span class="md-ellipsis">
      補足
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_171" class="md-nav__link">
    <span class="md-ellipsis">
      注意点
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="pointlog">PointLog構造体の詳細な解説と利用例</h1>
<p>このドキュメントでは、<code>PointLog</code>構造体とその関連コードについて詳細に解説します。また、開発者向けに具体的な利用例も提供します。</p>
<h2 id="_1">概要</h2>
<p><code>PointLog</code>は、データベースの<code>point_logs</code>テーブルを表すGoの構造体です。ユーザーのポイントの履歴情報を格納するためのものと考えられます。本コードはSQLBoilerによって自動生成されており、ORM（Object-Relational Mapping）としてデータベース操作を簡潔に行えるようになっています。</p>
<h2 id="_2">パッケージとインポート</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-0-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-0-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-0-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">models</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="w">    </span><span class="s">&quot;context&quot;</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="w">    </span><span class="s">&quot;database/sql&quot;</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="w">    </span><span class="s">&quot;reflect&quot;</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="w">    </span><span class="s">&quot;strconv&quot;</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="w">    </span><span class="s">&quot;strings&quot;</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="w">    </span><span class="s">&quot;sync&quot;</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="w">    </span><span class="s">&quot;time&quot;</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="w">    </span><span class="s">&quot;github.com/friendsofgo/errors&quot;</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="w">    </span><span class="s">&quot;github.com/volatiletech/sqlboiler/v4/boil&quot;</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="w">    </span><span class="s">&quot;github.com/volatiletech/sqlboiler/v4/queries&quot;</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="w">    </span><span class="s">&quot;github.com/volatiletech/sqlboiler/v4/queries/qm&quot;</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="w">    </span><span class="s">&quot;github.com/volatiletech/sqlboiler/v4/queries/qmhelper&quot;</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="w">    </span><span class="s">&quot;github.com/volatiletech/strmangle&quot;</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>package models</strong>: このコードは<code>models</code>パッケージに属しています。</li>
<li><strong>インポート</strong>: 必要なパッケージをインポートしています。</li>
<li><code>context</code>, <code>database/sql</code>, <code>time</code>などの標準パッケージ。</li>
<li><code>errors</code>, <code>sqlboiler</code>, <code>strmangle</code>などの外部パッケージ。</li>
</ul>
<h2 id="pointlog_1">PointLog構造体</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span>
<span class="normal"><a href="#__codelineno-1-2">2</a></span>
<span class="normal"><a href="#__codelineno-1-3">3</a></span>
<span class="normal"><a href="#__codelineno-1-4">4</a></span>
<span class="normal"><a href="#__codelineno-1-5">5</a></span>
<span class="normal"><a href="#__codelineno-1-6">6</a></span>
<span class="normal"><a href="#__codelineno-1-7">7</a></span>
<span class="normal"><a href="#__codelineno-1-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="kd">type</span><span class="w"> </span><span class="nx">PointLog</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="w">    </span><span class="nx">CreatedAt</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Time</span><span class="w"> </span><span class="s">`boil:&quot;created_at&quot; json:&quot;created_at&quot; toml:&quot;created_at&quot; yaml:&quot;created_at&quot;`</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="w">    </span><span class="nx">UserID</span><span class="w">    </span><span class="kt">uint</span><span class="w">      </span><span class="s">`boil:&quot;user_id&quot; json:&quot;user_id&quot; toml:&quot;user_id&quot; yaml:&quot;user_id&quot;`</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="w">    </span><span class="nx">Point</span><span class="w">     </span><span class="kt">int</span><span class="w">       </span><span class="s">`boil:&quot;point&quot; json:&quot;point&quot; toml:&quot;point&quot; yaml:&quot;point&quot;`</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="w">    </span><span class="nx">R</span><span class="w"> </span><span class="o">*</span><span class="nx">pointLogR</span><span class="w"> </span><span class="s">`boil:&quot;-&quot; json:&quot;-&quot; toml:&quot;-&quot; yaml:&quot;-&quot;`</span>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="w">    </span><span class="nx">L</span><span class="w"> </span><span class="nx">pointLogL</span><span class="w">  </span><span class="s">`boil:&quot;-&quot; json:&quot;-&quot; toml:&quot;-&quot; yaml:&quot;-&quot;`</span>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><code>PointLog</code>構造体は、<code>point_logs</code>テーブルの各カラムに対応するフィールドを持っています。</p>
<ul>
<li><strong>CreatedAt</strong>: <code>time.Time</code>型。レコードの作成日時を表します。</li>
<li><strong>UserID</strong>: <code>uint</code>型。ユーザーのIDを表します。</li>
<li><strong>Point</strong>: <code>int</code>型。ポイントの値を表します。</li>
</ul>
<p>タグには以下の用途があります。</p>
<ul>
<li><strong>boil</strong>: SQLBoilerによるデータベースのカラム名とフィールドのマッピング。</li>
<li><strong>json</strong>, <strong>toml</strong>, <strong>yaml</strong>: それぞれのフォーマットでのシリアライズ／デシリアライズ時のフィールド名を指定。</li>
</ul>
<p><code>R</code>と<code>L</code>フィールドはリレーションシップの情報を保持するためのフィールドです。</p>
<ul>
<li><strong>R *pointLogR</strong>: リレーションデータを格納します。</li>
<li><strong>L pointLogL</strong>: リレーションをロードするためのメソッドを提供します。</li>
</ul>
<h2 id="_3">カラム名の定義</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-2-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-2-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-2-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-2-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-2-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-2-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-2-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-2-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-2-10">10</a></span>
<span class="normal"><a href="#__codelineno-2-11">11</a></span>
<span class="normal"><a href="#__codelineno-2-12">12</a></span>
<span class="normal"><a href="#__codelineno-2-13">13</a></span>
<span class="normal"><a href="#__codelineno-2-14">14</a></span>
<span class="normal"><a href="#__codelineno-2-15">15</a></span>
<span class="normal"><a href="#__codelineno-2-16">16</a></span>
<span class="normal"><a href="#__codelineno-2-17">17</a></span>
<span class="normal"><a href="#__codelineno-2-18">18</a></span>
<span class="normal"><a href="#__codelineno-2-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">PointLogColumns</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="w">    </span><span class="nx">CreatedAt</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="w">    </span><span class="nx">UserID</span><span class="w">    </span><span class="kt">string</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="w">    </span><span class="nx">Point</span><span class="w">     </span><span class="kt">string</span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="p">}{</span>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="w">    </span><span class="nx">CreatedAt</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;created_at&quot;</span><span class="p">,</span>
<a id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="w">    </span><span class="nx">UserID</span><span class="p">:</span><span class="w">    </span><span class="s">&quot;user_id&quot;</span><span class="p">,</span>
<a id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="w">    </span><span class="nx">Point</span><span class="p">:</span><span class="w">     </span><span class="s">&quot;point&quot;</span><span class="p">,</span>
<a id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="p">}</span>
<a id="__codelineno-2-10" name="__codelineno-2-10"></a>
<a id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="kd">var</span><span class="w"> </span><span class="nx">PointLogTableColumns</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-12" name="__codelineno-2-12"></a><span class="w">    </span><span class="nx">CreatedAt</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-2-13" name="__codelineno-2-13"></a><span class="w">    </span><span class="nx">UserID</span><span class="w">    </span><span class="kt">string</span>
<a id="__codelineno-2-14" name="__codelineno-2-14"></a><span class="w">    </span><span class="nx">Point</span><span class="w">     </span><span class="kt">string</span>
<a id="__codelineno-2-15" name="__codelineno-2-15"></a><span class="p">}{</span>
<a id="__codelineno-2-16" name="__codelineno-2-16"></a><span class="w">    </span><span class="nx">CreatedAt</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;point_logs.created_at&quot;</span><span class="p">,</span>
<a id="__codelineno-2-17" name="__codelineno-2-17"></a><span class="w">    </span><span class="nx">UserID</span><span class="p">:</span><span class="w">    </span><span class="s">&quot;point_logs.user_id&quot;</span><span class="p">,</span>
<a id="__codelineno-2-18" name="__codelineno-2-18"></a><span class="w">    </span><span class="nx">Point</span><span class="p">:</span><span class="w">     </span><span class="s">&quot;point_logs.point&quot;</span><span class="p">,</span>
<a id="__codelineno-2-19" name="__codelineno-2-19"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>PointLogColumns</strong>: テーブルのカラム名を定義しています。</li>
<li><strong>PointLogTableColumns</strong>: テーブル名を含めた完全なカラム名を定義しています。</li>
</ul>
<h2 id="where">Where句のヘルパー</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span>
<span class="normal"><a href="#__codelineno-3-2">2</a></span>
<span class="normal"><a href="#__codelineno-3-3">3</a></span>
<span class="normal"><a href="#__codelineno-3-4">4</a></span>
<span class="normal"><a href="#__codelineno-3-5">5</a></span>
<span class="normal"><a href="#__codelineno-3-6">6</a></span>
<span class="normal"><a href="#__codelineno-3-7">7</a></span>
<span class="normal"><a href="#__codelineno-3-8">8</a></span>
<span class="normal"><a href="#__codelineno-3-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">PointLogWhere</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="w">    </span><span class="nx">CreatedAt</span><span class="w"> </span><span class="nx">whereHelpertime_Time</span>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="w">    </span><span class="nx">UserID</span><span class="w">    </span><span class="nx">whereHelperuint</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="w">    </span><span class="nx">Point</span><span class="w">     </span><span class="nx">whereHelperint</span>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="p">}{</span>
<a id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="w">    </span><span class="nx">CreatedAt</span><span class="p">:</span><span class="w"> </span><span class="nx">whereHelpertime_Time</span><span class="p">{</span><span class="nx">field</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;`point_logs`.`created_at`&quot;</span><span class="p">},</span>
<a id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="w">    </span><span class="nx">UserID</span><span class="p">:</span><span class="w">    </span><span class="nx">whereHelperuint</span><span class="p">{</span><span class="nx">field</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;`point_logs`.`user_id`&quot;</span><span class="p">},</span>
<a id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="w">    </span><span class="nx">Point</span><span class="p">:</span><span class="w">     </span><span class="nx">whereHelperint</span><span class="p">{</span><span class="nx">field</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;`point_logs`.`point`&quot;</span><span class="p">},</span>
<a id="__codelineno-3-9" name="__codelineno-3-9"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>PointLogWhere</strong>: クエリを組み立てる際に使用するWhere句のヘルパー。</li>
</ul>
<h2 id="_4">リレーションシップ定義</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span>
<span class="normal"><a href="#__codelineno-4-2">2</a></span>
<span class="normal"><a href="#__codelineno-4-3">3</a></span>
<span class="normal"><a href="#__codelineno-4-4">4</a></span>
<span class="normal"><a href="#__codelineno-4-5">5</a></span>
<span class="normal"><a href="#__codelineno-4-6">6</a></span>
<span class="normal"><a href="#__codelineno-4-7">7</a></span>
<span class="normal"><a href="#__codelineno-4-8">8</a></span>
<span class="normal"><a href="#__codelineno-4-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">PointLogRels</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="w">    </span><span class="nx">User</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="p">}{</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="w">    </span><span class="nx">User</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;User&quot;</span><span class="p">,</span>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="p">}</span>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a>
<a id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="kd">type</span><span class="w"> </span><span class="nx">pointLogR</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-8" name="__codelineno-4-8"></a><span class="w">    </span><span class="nx">User</span><span class="w"> </span><span class="o">*</span><span class="nx">User</span><span class="w"> </span><span class="s">`boil:&quot;User&quot; json:&quot;User&quot; toml:&quot;User&quot; yaml:&quot;User&quot;`</span>
<a id="__codelineno-4-9" name="__codelineno-4-9"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>PointLogRels</strong>: リレーションシップの名前を定義しています。</li>
<li><strong>pointLogR</strong>: リレーションシップデータを保持する構造体です。</li>
</ul>
<h3 id="_5">リレーションシップの初期化と取得</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">pointLogR</span><span class="p">)</span><span class="w"> </span><span class="nx">NewStruct</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="nx">pointLogR</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">pointLogR</span><span class="p">{}</span>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="p">}</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">pointLogR</span><span class="p">)</span><span class="w"> </span><span class="nx">GetUser</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="nx">User</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-5-9" name="__codelineno-5-9"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">User</span>
<a id="__codelineno-5-10" name="__codelineno-5-10"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>NewStruct()</code>: 新しい<code>pointLogR</code>構造体を生成します。</li>
<li><code>GetUser()</code>: <code>User</code>リレーションを取得します。</li>
</ul>
<h2 id="_6">ロードメソッド</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="kd">type</span><span class="w"> </span><span class="nx">pointLogL</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>pointLogL</strong>: リレーションをロードするためのメソッドが定義される構造体です。</li>
</ul>
<h2 id="_7">カラムとキーの定義</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1">1</a></span>
<span class="normal"><a href="#__codelineno-7-2">2</a></span>
<span class="normal"><a href="#__codelineno-7-3">3</a></span>
<span class="normal"><a href="#__codelineno-7-4">4</a></span>
<span class="normal"><a href="#__codelineno-7-5">5</a></span>
<span class="normal"><a href="#__codelineno-7-6">6</a></span>
<span class="normal"><a href="#__codelineno-7-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="kd">var</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="w">    </span><span class="nx">pointLogAllColumns</span><span class="w">            </span><span class="p">=</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;created_at&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user_id&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;point&quot;</span><span class="p">}</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="w">    </span><span class="nx">pointLogColumnsWithoutDefault</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;user_id&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;point&quot;</span><span class="p">}</span>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="w">    </span><span class="nx">pointLogColumnsWithDefault</span><span class="w">    </span><span class="p">=</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;created_at&quot;</span><span class="p">}</span>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="w">    </span><span class="nx">pointLogPrimaryKeyColumns</span><span class="w">     </span><span class="p">=</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;created_at&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user_id&quot;</span><span class="p">}</span>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="w">    </span><span class="nx">pointLogGeneratedColumns</span><span class="w">      </span><span class="p">=</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{}</span>
<a id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>pointLogAllColumns</strong>: 全てのカラム名。</li>
<li><strong>pointLogColumnsWithoutDefault</strong>: デフォルト値を持たないカラム名。</li>
<li><strong>pointLogColumnsWithDefault</strong>: デフォルト値を持つカラム名。</li>
<li><strong>pointLogPrimaryKeyColumns</strong>: プライマリキーとなるカラム名。</li>
<li><strong>pointLogGeneratedColumns</strong>: 自動生成されるカラム名。</li>
</ul>
<h2 id="_8">型エイリアスとクエリ構造体</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span>
<span class="normal"><a href="#__codelineno-8-2">2</a></span>
<span class="normal"><a href="#__codelineno-8-3">3</a></span>
<span class="normal"><a href="#__codelineno-8-4">4</a></span>
<span class="normal"><a href="#__codelineno-8-5">5</a></span>
<span class="normal"><a href="#__codelineno-8-6">6</a></span>
<span class="normal"><a href="#__codelineno-8-7">7</a></span>
<span class="normal"><a href="#__codelineno-8-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="kd">type</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="w">    </span><span class="nx">PointLogSlice</span><span class="w"> </span><span class="p">[]</span><span class="o">*</span><span class="nx">PointLog</span>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="w">    </span><span class="nx">PointLogHook</span><span class="w">  </span><span class="kd">func</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">PointLog</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="w">    </span><span class="nx">pointLogQuery</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="w">        </span><span class="o">*</span><span class="nx">queries</span><span class="p">.</span><span class="nx">Query</span>
<a id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-8-8" name="__codelineno-8-8"></a><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>PointLogSlice</strong>: <code>PointLog</code>構造体のポインタのスライス。複数の<code>PointLog</code>を扱う際に使用。</li>
<li><strong>PointLogHook</strong>: フック関数の型定義。データベース操作の前後に実行されるカスタムロジックを定義できる。</li>
<li><strong>pointLogQuery</strong>: クエリを構築するための構造体。</li>
</ul>
<h2 id="_9">キャッシュ関連の変数</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-9-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-9-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-9-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-9-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-9-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-9-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-9-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-9-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-9-10">10</a></span>
<span class="normal"><a href="#__codelineno-9-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="kd">var</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="w">    </span><span class="nx">pointLogType</span><span class="w">                 </span><span class="p">=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">TypeOf</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">PointLog</span><span class="p">{})</span>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="w">    </span><span class="nx">pointLogMapping</span><span class="w">              </span><span class="p">=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">MakeStructMapping</span><span class="p">(</span><span class="nx">pointLogType</span><span class="p">)</span>
<a id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="w">    </span><span class="nx">pointLogPrimaryKeyMapping</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">BindMapping</span><span class="p">(</span><span class="nx">pointLogType</span><span class="p">,</span><span class="w"> </span><span class="nx">pointLogMapping</span><span class="p">,</span><span class="w"> </span><span class="nx">pointLogPrimaryKeyColumns</span><span class="p">)</span>
<a id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="w">    </span><span class="nx">pointLogInsertCacheMut</span><span class="w">       </span><span class="nx">sync</span><span class="p">.</span><span class="nx">RWMutex</span>
<a id="__codelineno-9-6" name="__codelineno-9-6"></a><span class="w">    </span><span class="nx">pointLogInsertCache</span><span class="w">          </span><span class="p">=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">insertCache</span><span class="p">)</span>
<a id="__codelineno-9-7" name="__codelineno-9-7"></a><span class="w">    </span><span class="nx">pointLogUpdateCacheMut</span><span class="w">       </span><span class="nx">sync</span><span class="p">.</span><span class="nx">RWMutex</span>
<a id="__codelineno-9-8" name="__codelineno-9-8"></a><span class="w">    </span><span class="nx">pointLogUpdateCache</span><span class="w">          </span><span class="p">=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">updateCache</span><span class="p">)</span>
<a id="__codelineno-9-9" name="__codelineno-9-9"></a><span class="w">    </span><span class="nx">pointLogUpsertCacheMut</span><span class="w">       </span><span class="nx">sync</span><span class="p">.</span><span class="nx">RWMutex</span>
<a id="__codelineno-9-10" name="__codelineno-9-10"></a><span class="w">    </span><span class="nx">pointLogUpsertCache</span><span class="w">          </span><span class="p">=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">insertCache</span><span class="p">)</span>
<a id="__codelineno-9-11" name="__codelineno-9-11"></a><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>キャッシュ</strong>: 挿入、更新、アップサート操作のパフォーマンスを向上させるためにキャッシュを使用しています。</li>
<li><strong>sync.RWMutex</strong>: キャッシュへの並行アクセスを制御するための読み書きミューテックス。</li>
</ul>
<h2 id="_10">その他の依存性</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1">1</a></span>
<span class="normal"><a href="#__codelineno-10-2">2</a></span>
<span class="normal"><a href="#__codelineno-10-3">3</a></span>
<span class="normal"><a href="#__codelineno-10-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="kd">var</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="w">    </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="w">    </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">qmhelper</span><span class="p">.</span><span class="nx">Where</span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>依存性の維持</strong>: これらの未使用変数は、依存パッケージが最適化で削除されるのを防ぐために存在します。</li>
</ul>
<h2 id="_11">フックの定義と管理</h2>
<h3 id="_12">フック用の変数とミューテックス</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1">1</a></span>
<span class="normal"><a href="#__codelineno-11-2">2</a></span>
<span class="normal"><a href="#__codelineno-11-3">3</a></span>
<span class="normal"><a href="#__codelineno-11-4">4</a></span>
<span class="normal"><a href="#__codelineno-11-5">5</a></span>
<span class="normal"><a href="#__codelineno-11-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">pointLogAfterSelectMu</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="kd">var</span><span class="w"> </span><span class="nx">pointLogAfterSelectHooks</span><span class="w"> </span><span class="p">[]</span><span class="nx">PointLogHook</span>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="kd">var</span><span class="w"> </span><span class="nx">pointLogBeforeInsertMu</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span>
<a id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="kd">var</span><span class="w"> </span><span class="nx">pointLogBeforeInsertHooks</span><span class="w"> </span><span class="p">[]</span><span class="nx">PointLogHook</span>
<a id="__codelineno-11-6" name="__codelineno-11-6"></a><span class="c1">// 他のフックポイントも同様に定義</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>フック</strong>: データベース操作の前後にカスタムロジックを挿入するためのもの。</li>
<li><strong>ミューテックス</strong>: フックの登録や実行時の並行性を制御。</li>
</ul>
<h3 id="_13">フックの実行メソッド</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-12-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-12-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-12-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-12-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-12-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-12-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-12-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-12-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-12-10">10</a></span>
<span class="normal"><a href="#__codelineno-12-11">11</a></span>
<span class="normal"><a href="#__codelineno-12-12">12</a></span>
<span class="normal"><a href="#__codelineno-12-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">PointLog</span><span class="p">)</span><span class="w"> </span><span class="nx">doAfterSelectHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">HooksAreSkipped</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-12-5" name="__codelineno-12-5"></a>
<a id="__codelineno-12-6" name="__codelineno-12-6"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">hook</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">pointLogAfterSelectHooks</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-7" name="__codelineno-12-7"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">hook</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-8" name="__codelineno-12-8"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-12-9" name="__codelineno-12-9"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-12-10" name="__codelineno-12-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-12-11" name="__codelineno-12-11"></a>
<a id="__codelineno-12-12" name="__codelineno-12-12"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-12-13" name="__codelineno-12-13"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>フックの実行</strong>: 登録された各フックを順次実行します。</li>
<li><strong>HooksAreSkipped</strong>: コンテキストでフックをスキップするかどうかを判定。</li>
</ul>
<h3 id="_14">フックの登録</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1">1</a></span>
<span class="normal"><a href="#__codelineno-13-2">2</a></span>
<span class="normal"><a href="#__codelineno-13-3">3</a></span>
<span class="normal"><a href="#__codelineno-13-4">4</a></span>
<span class="normal"><a href="#__codelineno-13-5">5</a></span>
<span class="normal"><a href="#__codelineno-13-6">6</a></span>
<span class="normal"><a href="#__codelineno-13-7">7</a></span>
<span class="normal"><a href="#__codelineno-13-8">8</a></span>
<span class="normal"><a href="#__codelineno-13-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">AddPointLogHook</span><span class="p">(</span><span class="nx">hookPoint</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">HookPoint</span><span class="p">,</span><span class="w"> </span><span class="nx">pointLogHook</span><span class="w"> </span><span class="nx">PointLogHook</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="nx">hookPoint</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">AfterSelectHook</span><span class="p">:</span>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="w">        </span><span class="nx">pointLogAfterSelectMu</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="w">        </span><span class="nx">pointLogAfterSelectHooks</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">pointLogAfterSelectHooks</span><span class="p">,</span><span class="w"> </span><span class="nx">pointLogHook</span><span class="p">)</span>
<a id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="w">        </span><span class="nx">pointLogAfterSelectMu</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>
<a id="__codelineno-13-7" name="__codelineno-13-7"></a><span class="w">    </span><span class="c1">// 他のフックポイントも同様に処理</span>
<a id="__codelineno-13-8" name="__codelineno-13-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-13-9" name="__codelineno-13-9"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>AddPointLogHook</strong>: フック関数を特定のフックポイントに登録します。</li>
</ul>
<h2 id="_15">クエリメソッド</h2>
<h3 id="one">Oneメソッド</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-14-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-14-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-14-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-14-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-14-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-14-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-14-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-14-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-14-10">10</a></span>
<span class="normal"><a href="#__codelineno-14-11">11</a></span>
<span class="normal"><a href="#__codelineno-14-12">12</a></span>
<span class="normal"><a href="#__codelineno-14-13">13</a></span>
<span class="normal"><a href="#__codelineno-14-14">14</a></span>
<span class="normal"><a href="#__codelineno-14-15">15</a></span>
<span class="normal"><a href="#__codelineno-14-16">16</a></span>
<span class="normal"><a href="#__codelineno-14-17">17</a></span>
<span class="normal"><a href="#__codelineno-14-18">18</a></span>
<span class="normal"><a href="#__codelineno-14-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">q</span><span class="w"> </span><span class="nx">pointLogQuery</span><span class="p">)</span><span class="w"> </span><span class="nx">One</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">PointLog</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="w">    </span><span class="nx">o</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">PointLog</span><span class="p">{}</span>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a>
<a id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="w">    </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetLimit</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-14-5" name="__codelineno-14-5"></a>
<a id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">q</span><span class="p">.</span><span class="nx">Bind</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">)</span>
<a id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-8" name="__codelineno-14-8"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Is</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">ErrNoRows</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-9" name="__codelineno-14-9"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">ErrNoRows</span>
<a id="__codelineno-14-10" name="__codelineno-14-10"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-14-11" name="__codelineno-14-11"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: failed to execute a one query for point_logs&quot;</span><span class="p">)</span>
<a id="__codelineno-14-12" name="__codelineno-14-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-14-13" name="__codelineno-14-13"></a>
<a id="__codelineno-14-14" name="__codelineno-14-14"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">doAfterSelectHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-15" name="__codelineno-14-15"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">o</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-14-16" name="__codelineno-14-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-14-17" name="__codelineno-14-17"></a>
<a id="__codelineno-14-18" name="__codelineno-14-18"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">o</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-14-19" name="__codelineno-14-19"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>One</strong>: クエリから1件の<code>PointLog</code>レコードを取得します。</li>
<li><strong>処理の流れ</strong>:</li>
<li><code>PointLog</code>構造体のインスタンスを作成。</li>
<li>クエリのリミットを1に設定。</li>
<li><code>Bind</code>メソッドで結果をバインド。</li>
<li>エラーチェックを行い、必要に応じてエラーをラップして返す。</li>
<li><code>AfterSelect</code>フックを実行。</li>
<li>結果を返す。</li>
</ul>
<h2 id="_16">開発者向け利用例</h2>
<h3 id="_17">データベースへの接続</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-15-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-15-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-15-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-15-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-15-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-15-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-15-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-15-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-15-10">10</a></span>
<span class="normal"><a href="#__codelineno-15-11">11</a></span>
<span class="normal"><a href="#__codelineno-15-12">12</a></span>
<span class="normal"><a href="#__codelineno-15-13">13</a></span>
<span class="normal"><a href="#__codelineno-15-14">14</a></span>
<span class="normal"><a href="#__codelineno-15-15">15</a></span>
<span class="normal"><a href="#__codelineno-15-16">16</a></span>
<span class="normal"><a href="#__codelineno-15-17">17</a></span>
<span class="normal"><a href="#__codelineno-15-18">18</a></span>
<span class="normal"><a href="#__codelineno-15-19">19</a></span>
<span class="normal"><a href="#__codelineno-15-20">20</a></span>
<span class="normal"><a href="#__codelineno-15-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="w">    </span><span class="s">&quot;context&quot;</span>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="w">    </span><span class="s">&quot;database/sql&quot;</span>
<a id="__codelineno-15-4" name="__codelineno-15-4"></a>
<a id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="w">    </span><span class="nx">_</span><span class="w"> </span><span class="s">&quot;github.com/go-sql-driver/mysql&quot;</span>
<a id="__codelineno-15-6" name="__codelineno-15-6"></a><span class="w">    </span><span class="s">&quot;github.com/yourusername/yourproject/models&quot;</span>
<a id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="p">)</span>
<a id="__codelineno-15-8" name="__codelineno-15-8"></a>
<a id="__codelineno-15-9" name="__codelineno-15-9"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-10" name="__codelineno-15-10"></a><span class="w">    </span><span class="c1">// データベースへの接続</span>
<a id="__codelineno-15-11" name="__codelineno-15-11"></a><span class="w">    </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@tcp(localhost:3306)/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-15-12" name="__codelineno-15-12"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-13" name="__codelineno-15-13"></a><span class="w">        </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-15-14" name="__codelineno-15-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-15-15" name="__codelineno-15-15"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-15-16" name="__codelineno-15-16"></a>
<a id="__codelineno-15-17" name="__codelineno-15-17"></a><span class="w">    </span><span class="c1">// コンテキストの作成</span>
<a id="__codelineno-15-18" name="__codelineno-15-18"></a><span class="w">    </span><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-15-19" name="__codelineno-15-19"></a>
<a id="__codelineno-15-20" name="__codelineno-15-20"></a><span class="w">    </span><span class="c1">// 以下でPointLogの操作を行います</span>
<a id="__codelineno-15-21" name="__codelineno-15-21"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_18">レコードの取得</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-16-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-16-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-16-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-16-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-16-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-16-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-16-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-16-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-16-10">10</a></span>
<span class="normal"><a href="#__codelineno-16-11">11</a></span>
<span class="normal"><a href="#__codelineno-16-12">12</a></span>
<span class="normal"><a href="#__codelineno-16-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="c1">// ユーザーIDが1のポイントログを取得</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="nx">pointLog</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">PointLogs</span><span class="p">(</span><span class="nx">models</span><span class="p">.</span><span class="nx">PointLogWhere</span><span class="p">.</span><span class="nx">UserID</span><span class="p">.</span><span class="nx">EQ</span><span class="p">(</span><span class="mi">1</span><span class="p">)).</span><span class="nx">One</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Is</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">ErrNoRows</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="w">        </span><span class="c1">// レコードが見つからない場合の処理</span>
<a id="__codelineno-16-6" name="__codelineno-16-6"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-7" name="__codelineno-16-7"></a><span class="w">        </span><span class="c1">// その他のエラー処理</span>
<a id="__codelineno-16-8" name="__codelineno-16-8"></a><span class="w">        </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-16-9" name="__codelineno-16-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-16-10" name="__codelineno-16-10"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-11" name="__codelineno-16-11"></a><span class="w">    </span><span class="c1">// 取得したデータの利用</span>
<a id="__codelineno-16-12" name="__codelineno-16-12"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;UserID: %d, Point: %d, CreatedAt: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">pointLog</span><span class="p">.</span><span class="nx">UserID</span><span class="p">,</span><span class="w"> </span><span class="nx">pointLog</span><span class="p">.</span><span class="nx">Point</span><span class="p">,</span><span class="w"> </span><span class="nx">pointLog</span><span class="p">.</span><span class="nx">CreatedAt</span><span class="p">)</span>
<a id="__codelineno-16-13" name="__codelineno-16-13"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_19">レコードの挿入</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-17-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-17-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-17-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-17-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-17-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-17-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-17-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-17-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-17-10">10</a></span>
<span class="normal"><a href="#__codelineno-17-11">11</a></span>
<span class="normal"><a href="#__codelineno-17-12">12</a></span>
<span class="normal"><a href="#__codelineno-17-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="nx">newPointLog</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">models</span><span class="p">.</span><span class="nx">PointLog</span><span class="p">{</span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="w">    </span><span class="nx">UserID</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="w">    </span><span class="nx">Point</span><span class="p">:</span><span class="w">  </span><span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="w">    </span><span class="c1">// CreatedAtはデフォルトで現在時刻が設定されることを想定</span>
<a id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="p">}</span>
<a id="__codelineno-17-6" name="__codelineno-17-6"></a>
<a id="__codelineno-17-7" name="__codelineno-17-7"></a><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">newPointLog</span><span class="p">.</span><span class="nx">Insert</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">Infer</span><span class="p">())</span>
<a id="__codelineno-17-8" name="__codelineno-17-8"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-9" name="__codelineno-17-9"></a><span class="w">    </span><span class="c1">// エラーハンドリング</span>
<a id="__codelineno-17-10" name="__codelineno-17-10"></a><span class="w">    </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-17-11" name="__codelineno-17-11"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-12" name="__codelineno-17-12"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;新しいポイントログが作成されました&quot;</span><span class="p">)</span>
<a id="__codelineno-17-13" name="__codelineno-17-13"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_20">レコードの更新</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-18-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-18-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-18-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-18-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-18-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-18-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-18-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-18-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-18-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="c1">// 既存のポイントログを更新</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="nx">pointLog</span><span class="p">.</span><span class="nx">Point</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">50</span>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">pointLog</span><span class="p">.</span><span class="nx">Update</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">Infer</span><span class="p">())</span>
<a id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-6" name="__codelineno-18-6"></a><span class="w">    </span><span class="c1">// エラーハンドリング</span>
<a id="__codelineno-18-7" name="__codelineno-18-7"></a><span class="w">    </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-18-8" name="__codelineno-18-8"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-9" name="__codelineno-18-9"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;ポイントログが更新されました&quot;</span><span class="p">)</span>
<a id="__codelineno-18-10" name="__codelineno-18-10"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_21">レコードの削除</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1">1</a></span>
<span class="normal"><a href="#__codelineno-19-2">2</a></span>
<span class="normal"><a href="#__codelineno-19-3">3</a></span>
<span class="normal"><a href="#__codelineno-19-4">4</a></span>
<span class="normal"><a href="#__codelineno-19-5">5</a></span>
<span class="normal"><a href="#__codelineno-19-6">6</a></span>
<span class="normal"><a href="#__codelineno-19-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">pointLog</span><span class="p">.</span><span class="nx">Delete</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="w">    </span><span class="c1">// エラーハンドリング</span>
<a id="__codelineno-19-4" name="__codelineno-19-4"></a><span class="w">    </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-19-5" name="__codelineno-19-5"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-6" name="__codelineno-19-6"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;ポイントログが削除されました&quot;</span><span class="p">)</span>
<a id="__codelineno-19-7" name="__codelineno-19-7"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_22">トランザクションの使用</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-20-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-20-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-20-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-20-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-20-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-20-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-20-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-20-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-20-10">10</a></span>
<span class="normal"><a href="#__codelineno-20-11">11</a></span>
<span class="normal"><a href="#__codelineno-20-12">12</a></span>
<span class="normal"><a href="#__codelineno-20-13">13</a></span>
<span class="normal"><a href="#__codelineno-20-14">14</a></span>
<span class="normal"><a href="#__codelineno-20-15">15</a></span>
<span class="normal"><a href="#__codelineno-20-16">16</a></span>
<span class="normal"><a href="#__codelineno-20-17">17</a></span>
<span class="normal"><a href="#__codelineno-20-18">18</a></span>
<span class="normal"><a href="#__codelineno-20-19">19</a></span>
<span class="normal"><a href="#__codelineno-20-20">20</a></span>
<span class="normal"><a href="#__codelineno-20-21">21</a></span>
<span class="normal"><a href="#__codelineno-20-22">22</a></span>
<span class="normal"><a href="#__codelineno-20-23">23</a></span>
<span class="normal"><a href="#__codelineno-20-24">24</a></span>
<span class="normal"><a href="#__codelineno-20-25">25</a></span>
<span class="normal"><a href="#__codelineno-20-26">26</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="nx">tx</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">BeginTx</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<a id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="w">    </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-20-4" name="__codelineno-20-4"></a><span class="p">}</span>
<a id="__codelineno-20-5" name="__codelineno-20-5"></a>
<a id="__codelineno-20-6" name="__codelineno-20-6"></a><span class="k">defer</span><span class="w"> </span><span class="nx">tx</span><span class="p">.</span><span class="nx">Rollback</span><span class="p">()</span>
<a id="__codelineno-20-7" name="__codelineno-20-7"></a>
<a id="__codelineno-20-8" name="__codelineno-20-8"></a><span class="c1">// トランザクション内での操作</span>
<a id="__codelineno-20-9" name="__codelineno-20-9"></a><span class="nx">newPointLog</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">models</span><span class="p">.</span><span class="nx">PointLog</span><span class="p">{</span>
<a id="__codelineno-20-10" name="__codelineno-20-10"></a><span class="w">    </span><span class="nx">UserID</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-20-11" name="__codelineno-20-11"></a><span class="w">    </span><span class="nx">Point</span><span class="p">:</span><span class="w">  </span><span class="mi">200</span><span class="p">,</span>
<a id="__codelineno-20-12" name="__codelineno-20-12"></a><span class="p">}</span>
<a id="__codelineno-20-13" name="__codelineno-20-13"></a>
<a id="__codelineno-20-14" name="__codelineno-20-14"></a><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">newPointLog</span><span class="p">.</span><span class="nx">Insert</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">tx</span><span class="p">,</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">Infer</span><span class="p">())</span>
<a id="__codelineno-20-15" name="__codelineno-20-15"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-16" name="__codelineno-20-16"></a><span class="w">    </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-20-17" name="__codelineno-20-17"></a><span class="p">}</span>
<a id="__codelineno-20-18" name="__codelineno-20-18"></a>
<a id="__codelineno-20-19" name="__codelineno-20-19"></a><span class="c1">// その他の操作...</span>
<a id="__codelineno-20-20" name="__codelineno-20-20"></a>
<a id="__codelineno-20-21" name="__codelineno-20-21"></a><span class="c1">// コミット</span>
<a id="__codelineno-20-22" name="__codelineno-20-22"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">tx</span><span class="p">.</span><span class="nx">Commit</span><span class="p">();</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-23" name="__codelineno-20-23"></a><span class="w">    </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-20-24" name="__codelineno-20-24"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-25" name="__codelineno-20-25"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;トランザクションが成功しました&quot;</span><span class="p">)</span>
<a id="__codelineno-20-26" name="__codelineno-20-26"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_23">フックの使用</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-21-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-21-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-21-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-21-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-21-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-21-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-21-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-21-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-21-10">10</a></span>
<span class="normal"><a href="#__codelineno-21-11">11</a></span>
<span class="normal"><a href="#__codelineno-21-12">12</a></span>
<span class="normal"><a href="#__codelineno-21-13">13</a></span>
<span class="normal"><a href="#__codelineno-21-14">14</a></span>
<span class="normal"><a href="#__codelineno-21-15">15</a></span>
<span class="normal"><a href="#__codelineno-21-16">16</a></span>
<span class="normal"><a href="#__codelineno-21-17">17</a></span>
<span class="normal"><a href="#__codelineno-21-18">18</a></span>
<span class="normal"><a href="#__codelineno-21-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="c1">// フック関数の定義</span>
<a id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="kd">func</span><span class="w"> </span><span class="nx">afterInsertHook</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="w"> </span><span class="o">*</span><span class="nx">models</span><span class="p">.</span><span class="nx">PointLog</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;ポイントログが挿入されました: UserID=%d, Point=%d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">UserID</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">Point</span><span class="p">)</span>
<a id="__codelineno-21-4" name="__codelineno-21-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-21-5" name="__codelineno-21-5"></a><span class="p">}</span>
<a id="__codelineno-21-6" name="__codelineno-21-6"></a>
<a id="__codelineno-21-7" name="__codelineno-21-7"></a><span class="c1">// フックの登録</span>
<a id="__codelineno-21-8" name="__codelineno-21-8"></a><span class="nx">models</span><span class="p">.</span><span class="nx">AddPointLogHook</span><span class="p">(</span><span class="nx">boil</span><span class="p">.</span><span class="nx">AfterInsertHook</span><span class="p">,</span><span class="w"> </span><span class="nx">afterInsertHook</span><span class="p">)</span>
<a id="__codelineno-21-9" name="__codelineno-21-9"></a>
<a id="__codelineno-21-10" name="__codelineno-21-10"></a><span class="c1">// 挿入操作（フックが自動的に呼び出される）</span>
<a id="__codelineno-21-11" name="__codelineno-21-11"></a><span class="nx">newPointLog</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">models</span><span class="p">.</span><span class="nx">PointLog</span><span class="p">{</span>
<a id="__codelineno-21-12" name="__codelineno-21-12"></a><span class="w">    </span><span class="nx">UserID</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-21-13" name="__codelineno-21-13"></a><span class="w">    </span><span class="nx">Point</span><span class="p">:</span><span class="w">  </span><span class="mi">300</span><span class="p">,</span>
<a id="__codelineno-21-14" name="__codelineno-21-14"></a><span class="p">}</span>
<a id="__codelineno-21-15" name="__codelineno-21-15"></a>
<a id="__codelineno-21-16" name="__codelineno-21-16"></a><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">newPointLog</span><span class="p">.</span><span class="nx">Insert</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">Infer</span><span class="p">())</span>
<a id="__codelineno-21-17" name="__codelineno-21-17"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-18" name="__codelineno-21-18"></a><span class="w">    </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-21-19" name="__codelineno-21-19"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="_24">注意事項</h2>
<ul>
<li><strong>エラーハンドリング</strong>: SQL操作はエラーを返す可能性があるため、適切なエラーハンドリングを行ってください。</li>
<li><strong>コンテキストの使用</strong>: <code>context.Context</code>を使用して、キャンセルシグナルやタイムアウトを扱うことができます。</li>
<li><strong>SQLインジェクションへの対策</strong>: パラメータバインディングを使用して、SQLインジェクションを防ぎます。</li>
</ul>
<hr />
<h2 id="all"><code>All</code> 関数</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-22-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-22-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-22-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-22-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-22-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-22-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-22-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-22-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-22-10">10</a></span>
<span class="normal"><a href="#__codelineno-22-11">11</a></span>
<span class="normal"><a href="#__codelineno-22-12">12</a></span>
<span class="normal"><a href="#__codelineno-22-13">13</a></span>
<span class="normal"><a href="#__codelineno-22-14">14</a></span>
<span class="normal"><a href="#__codelineno-22-15">15</a></span>
<span class="normal"><a href="#__codelineno-22-16">16</a></span>
<span class="normal"><a href="#__codelineno-22-17">17</a></span>
<span class="normal"><a href="#__codelineno-22-18">18</a></span>
<span class="normal"><a href="#__codelineno-22-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="c1">// All returns all PointLog records from the query.</span>
<a id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">q</span><span class="w"> </span><span class="nx">pointLogQuery</span><span class="p">)</span><span class="w"> </span><span class="nx">All</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">PointLogSlice</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-3" name="__codelineno-22-3"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">o</span><span class="w"> </span><span class="p">[]</span><span class="o">*</span><span class="nx">PointLog</span>
<a id="__codelineno-22-4" name="__codelineno-22-4"></a>
<a id="__codelineno-22-5" name="__codelineno-22-5"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">q</span><span class="p">.</span><span class="nx">Bind</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">o</span><span class="p">)</span>
<a id="__codelineno-22-6" name="__codelineno-22-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-7" name="__codelineno-22-7"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: failed to assign all query results to PointLog slice&quot;</span><span class="p">)</span>
<a id="__codelineno-22-8" name="__codelineno-22-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-22-9" name="__codelineno-22-9"></a>
<a id="__codelineno-22-10" name="__codelineno-22-10"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">pointLogAfterSelectHooks</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-11" name="__codelineno-22-11"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">o</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-12" name="__codelineno-22-12"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">obj</span><span class="p">.</span><span class="nx">doAfterSelectHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-13" name="__codelineno-22-13"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nx">o</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-22-14" name="__codelineno-22-14"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-22-15" name="__codelineno-22-15"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-22-16" name="__codelineno-22-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-22-17" name="__codelineno-22-17"></a>
<a id="__codelineno-22-18" name="__codelineno-22-18"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">o</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-22-19" name="__codelineno-22-19"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_25">解説</h3>
<ul>
<li><strong>目的</strong>: <code>All</code> 関数は、クエリからすべての <code>PointLog</code> レコードを取得します。</li>
<li><strong>パラメータ</strong>:</li>
<li><code>ctx context.Context</code>: コンテキストを渡します。タイムアウトやキャンセルを制御できます。</li>
<li><code>exec boil.ContextExecutor</code>: データベース操作を実行するためのエグゼキュータです。</li>
<li><strong>戻り値</strong>:</li>
<li><code>PointLogSlice</code>: <code>PointLog</code> のスライス（リスト）を返します。</li>
<li><code>error</code>: エラー情報を返します。</li>
</ul>
<h4 id="_26">処理の流れ</h4>
<ol>
<li><code>var o []*PointLog</code>:</li>
<li><code>PointLog</code> 型のスライスを宣言します。このスライスにデータベースから取得したレコードを格納します。</li>
<li><code>err := q.Bind(ctx, exec, &amp;o)</code>:</li>
<li>クエリ結果を <code>o</code> にバインドします。</li>
<li>エラーが発生した場合、ラップして返します。</li>
<li><code>if len(pointLogAfterSelectHooks) != 0</code>:</li>
<li><code>AfterSelect</code> のフックが設定されている場合、各オブジェクトに対してフックを実行します。</li>
<li><code>return o, nil</code>:</li>
<li>エラーがなければ、取得した <code>PointLog</code> のスライスを返します。</li>
</ol>
<h3 id="_27">利用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-23-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-23-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-23-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-23-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-23-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-23-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-23-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-23-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-23-10">10</a></span>
<span class="normal"><a href="#__codelineno-23-11">11</a></span>
<span class="normal"><a href="#__codelineno-23-12">12</a></span>
<span class="normal"><a href="#__codelineno-23-13">13</a></span>
<span class="normal"><a href="#__codelineno-23-14">14</a></span>
<span class="normal"><a href="#__codelineno-23-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-23-2" name="__codelineno-23-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-4" name="__codelineno-23-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-23-5" name="__codelineno-23-5"></a><span class="p">}</span>
<a id="__codelineno-23-6" name="__codelineno-23-6"></a><span class="k">defer</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-23-7" name="__codelineno-23-7"></a>
<a id="__codelineno-23-8" name="__codelineno-23-8"></a><span class="nx">pointLogs</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">PointLogs</span><span class="p">().</span><span class="nx">All</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-23-9" name="__codelineno-23-9"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-10" name="__codelineno-23-10"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-23-11" name="__codelineno-23-11"></a><span class="p">}</span>
<a id="__codelineno-23-12" name="__codelineno-23-12"></a>
<a id="__codelineno-23-13" name="__codelineno-23-13"></a><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">log</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">pointLogs</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-14" name="__codelineno-23-14"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;UserID: %d, CreatedAt: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">log</span><span class="p">.</span><span class="nx">UserID</span><span class="p">,</span><span class="w"> </span><span class="nx">log</span><span class="p">.</span><span class="nx">CreatedAt</span><span class="p">)</span>
<a id="__codelineno-23-15" name="__codelineno-23-15"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="count"><code>Count</code> 関数</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-24-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-24-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-24-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-24-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-24-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-24-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-24-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-24-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-24-10">10</a></span>
<span class="normal"><a href="#__codelineno-24-11">11</a></span>
<span class="normal"><a href="#__codelineno-24-12">12</a></span>
<span class="normal"><a href="#__codelineno-24-13">13</a></span>
<span class="normal"><a href="#__codelineno-24-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="c1">// Count returns the count of all PointLog records in the query.</span>
<a id="__codelineno-24-2" name="__codelineno-24-2"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">q</span><span class="w"> </span><span class="nx">pointLogQuery</span><span class="p">)</span><span class="w"> </span><span class="nx">Count</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">int64</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-24-3" name="__codelineno-24-3"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="kt">int64</span>
<a id="__codelineno-24-4" name="__codelineno-24-4"></a>
<a id="__codelineno-24-5" name="__codelineno-24-5"></a><span class="w">    </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetSelect</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<a id="__codelineno-24-6" name="__codelineno-24-6"></a><span class="w">    </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetCount</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">)</span>
<a id="__codelineno-24-7" name="__codelineno-24-7"></a>
<a id="__codelineno-24-8" name="__codelineno-24-8"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">.</span><span class="nx">QueryRowContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">).</span><span class="nx">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">count</span><span class="p">)</span>
<a id="__codelineno-24-9" name="__codelineno-24-9"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-24-10" name="__codelineno-24-10"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: failed to count point_logs rows&quot;</span><span class="p">)</span>
<a id="__codelineno-24-11" name="__codelineno-24-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-24-12" name="__codelineno-24-12"></a>
<a id="__codelineno-24-13" name="__codelineno-24-13"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">count</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-24-14" name="__codelineno-24-14"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_28">解説</h3>
<ul>
<li><strong>目的</strong>: クエリに一致する <code>PointLog</code> レコードの総数を返します。</li>
<li><strong>処理の流れ</strong>:</li>
<li><code>queries.SetSelect(q.Query, nil)</code>:<ul>
<li>SELECT 句をクリアします。</li>
</ul>
</li>
<li><code>queries.SetCount(q.Query)</code>:<ul>
<li>クエリを COUNT クエリに変換します。</li>
</ul>
</li>
<li><code>q.Query.QueryRowContext(ctx, exec).Scan(&amp;count)</code>:<ul>
<li>クエリを実行し、結果を <code>count</code> にスキャンします。</li>
</ul>
</li>
<li>エラー処理と結果の返却。</li>
</ul>
<h3 id="_29">利用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-25-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-25-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-25-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-25-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-25-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-25-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-25-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-25-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-25-10">10</a></span>
<span class="normal"><a href="#__codelineno-25-11">11</a></span>
<span class="normal"><a href="#__codelineno-25-12">12</a></span>
<span class="normal"><a href="#__codelineno-25-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-25-2" name="__codelineno-25-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-25-3" name="__codelineno-25-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-4" name="__codelineno-25-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-25-5" name="__codelineno-25-5"></a><span class="p">}</span>
<a id="__codelineno-25-6" name="__codelineno-25-6"></a><span class="k">defer</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-25-7" name="__codelineno-25-7"></a>
<a id="__codelineno-25-8" name="__codelineno-25-8"></a><span class="nx">count</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">PointLogs</span><span class="p">().</span><span class="nx">Count</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-25-9" name="__codelineno-25-9"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-10" name="__codelineno-25-10"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-25-11" name="__codelineno-25-11"></a><span class="p">}</span>
<a id="__codelineno-25-12" name="__codelineno-25-12"></a>
<a id="__codelineno-25-13" name="__codelineno-25-13"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Total PointLog records: %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">count</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h2 id="exists"><code>Exists</code> 関数</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-26-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-26-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-26-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-26-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-26-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-26-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-26-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-26-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-26-10">10</a></span>
<span class="normal"><a href="#__codelineno-26-11">11</a></span>
<span class="normal"><a href="#__codelineno-26-12">12</a></span>
<span class="normal"><a href="#__codelineno-26-13">13</a></span>
<span class="normal"><a href="#__codelineno-26-14">14</a></span>
<span class="normal"><a href="#__codelineno-26-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="c1">// Exists checks if the row exists in the table.</span>
<a id="__codelineno-26-2" name="__codelineno-26-2"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">q</span><span class="w"> </span><span class="nx">pointLogQuery</span><span class="p">)</span><span class="w"> </span><span class="nx">Exists</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-26-3" name="__codelineno-26-3"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="kt">int64</span>
<a id="__codelineno-26-4" name="__codelineno-26-4"></a>
<a id="__codelineno-26-5" name="__codelineno-26-5"></a><span class="w">    </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetSelect</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<a id="__codelineno-26-6" name="__codelineno-26-6"></a><span class="w">    </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetCount</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">)</span>
<a id="__codelineno-26-7" name="__codelineno-26-7"></a><span class="w">    </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetLimit</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-26-8" name="__codelineno-26-8"></a>
<a id="__codelineno-26-9" name="__codelineno-26-9"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">.</span><span class="nx">QueryRowContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">).</span><span class="nx">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">count</span><span class="p">)</span>
<a id="__codelineno-26-10" name="__codelineno-26-10"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-26-11" name="__codelineno-26-11"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: failed to check if point_logs exists&quot;</span><span class="p">)</span>
<a id="__codelineno-26-12" name="__codelineno-26-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-26-13" name="__codelineno-26-13"></a>
<a id="__codelineno-26-14" name="__codelineno-26-14"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-26-15" name="__codelineno-26-15"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_30">解説</h3>
<ul>
<li><strong>目的</strong>: クエリに一致するレコードが存在するかをチェックします。</li>
<li><strong>処理の流れ</strong>:</li>
<li>SELECT 句をクリアし、COUNT クエリに変換。</li>
<li>リミットを 1 に設定（存在確認のために最小限のデータ取得）。</li>
<li>クエリを実行し、結果を <code>count</code> にスキャン。</li>
<li><code>count &gt; 0</code> の結果を返します。</li>
</ul>
<h3 id="_31">利用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-27-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-27-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-27-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-27-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-27-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-27-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-27-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-27-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-27-10">10</a></span>
<span class="normal"><a href="#__codelineno-27-11">11</a></span>
<span class="normal"><a href="#__codelineno-27-12">12</a></span>
<span class="normal"><a href="#__codelineno-27-13">13</a></span>
<span class="normal"><a href="#__codelineno-27-14">14</a></span>
<span class="normal"><a href="#__codelineno-27-15">15</a></span>
<span class="normal"><a href="#__codelineno-27-16">16</a></span>
<span class="normal"><a href="#__codelineno-27-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-27-2" name="__codelineno-27-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-27-3" name="__codelineno-27-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-27-4" name="__codelineno-27-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-27-5" name="__codelineno-27-5"></a><span class="p">}</span>
<a id="__codelineno-27-6" name="__codelineno-27-6"></a><span class="k">defer</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-27-7" name="__codelineno-27-7"></a>
<a id="__codelineno-27-8" name="__codelineno-27-8"></a><span class="nx">exists</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">PointLogs</span><span class="p">(</span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;user_id = ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">123</span><span class="p">)).</span><span class="nx">Exists</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-27-9" name="__codelineno-27-9"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-27-10" name="__codelineno-27-10"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-27-11" name="__codelineno-27-11"></a><span class="p">}</span>
<a id="__codelineno-27-12" name="__codelineno-27-12"></a>
<a id="__codelineno-27-13" name="__codelineno-27-13"></a><span class="k">if</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-27-14" name="__codelineno-27-14"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;PointLog exists for user_id 123&quot;</span><span class="p">)</span>
<a id="__codelineno-27-15" name="__codelineno-27-15"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-27-16" name="__codelineno-27-16"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;No PointLog found for user_id 123&quot;</span><span class="p">)</span>
<a id="__codelineno-27-17" name="__codelineno-27-17"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="user"><code>User</code> 関数</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-28-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-28-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-28-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-28-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-28-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-28-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-28-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-28-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-28-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-28-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="c1">// User pointed to by the foreign key.</span>
<a id="__codelineno-28-2" name="__codelineno-28-2"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">PointLog</span><span class="p">)</span><span class="w"> </span><span class="nx">User</span><span class="p">(</span><span class="nx">mods</span><span class="w"> </span><span class="o">...</span><span class="nx">qm</span><span class="p">.</span><span class="nx">QueryMod</span><span class="p">)</span><span class="w"> </span><span class="nx">userQuery</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-28-3" name="__codelineno-28-3"></a><span class="w">    </span><span class="nx">queryMods</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="nx">qm</span><span class="p">.</span><span class="nx">QueryMod</span><span class="p">{</span>
<a id="__codelineno-28-4" name="__codelineno-28-4"></a><span class="w">        </span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;`user_id` = ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">UserID</span><span class="p">),</span>
<a id="__codelineno-28-5" name="__codelineno-28-5"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-28-6" name="__codelineno-28-6"></a>
<a id="__codelineno-28-7" name="__codelineno-28-7"></a><span class="w">    </span><span class="nx">queryMods</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">queryMods</span><span class="p">,</span><span class="w"> </span><span class="nx">mods</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-28-8" name="__codelineno-28-8"></a>
<a id="__codelineno-28-9" name="__codelineno-28-9"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">Users</span><span class="p">(</span><span class="nx">queryMods</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-28-10" name="__codelineno-28-10"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_32">解説</h3>
<ul>
<li><strong>目的</strong>: <code>PointLog</code> から関連する <code>User</code> を取得するクエリを生成します。</li>
<li><strong>処理の流れ</strong>:</li>
<li>デフォルトのクエリモディファイアを設定し、<code>user_id</code> を条件に追加。</li>
<li>追加のクエリモディファイアがあればそれらを結合。</li>
<li><code>Users</code> 関数を呼び出し、クエリを返します。</li>
</ul>
<h3 id="_33">利用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-29-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-29-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-29-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-29-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-29-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-29-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-29-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-29-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-29-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-29-10">10</a></span>
<span class="normal"><a href="#__codelineno-29-11">11</a></span>
<span class="normal"><a href="#__codelineno-29-12">12</a></span>
<span class="normal"><a href="#__codelineno-29-13">13</a></span>
<span class="normal"><a href="#__codelineno-29-14">14</a></span>
<span class="normal"><a href="#__codelineno-29-15">15</a></span>
<span class="normal"><a href="#__codelineno-29-16">16</a></span>
<span class="normal"><a href="#__codelineno-29-17">17</a></span>
<span class="normal"><a href="#__codelineno-29-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-29-2" name="__codelineno-29-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-29-3" name="__codelineno-29-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-4" name="__codelineno-29-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-29-5" name="__codelineno-29-5"></a><span class="p">}</span>
<a id="__codelineno-29-6" name="__codelineno-29-6"></a><span class="k">defer</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-29-7" name="__codelineno-29-7"></a>
<a id="__codelineno-29-8" name="__codelineno-29-8"></a><span class="nx">pointLog</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">FindPointLog</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">someTime</span><span class="p">,</span><span class="w"> </span><span class="nx">someUserID</span><span class="p">)</span>
<a id="__codelineno-29-9" name="__codelineno-29-9"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-10" name="__codelineno-29-10"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-29-11" name="__codelineno-29-11"></a><span class="p">}</span>
<a id="__codelineno-29-12" name="__codelineno-29-12"></a>
<a id="__codelineno-29-13" name="__codelineno-29-13"></a><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">pointLog</span><span class="p">.</span><span class="nx">User</span><span class="p">().</span><span class="nx">One</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-29-14" name="__codelineno-29-14"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-15" name="__codelineno-29-15"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-29-16" name="__codelineno-29-16"></a><span class="p">}</span>
<a id="__codelineno-29-17" name="__codelineno-29-17"></a>
<a id="__codelineno-29-18" name="__codelineno-29-18"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;User Name: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h2 id="loaduser"><code>LoadUser</code> 関数</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-30-1">1</a></span>
<span class="normal"><a href="#__codelineno-30-2">2</a></span>
<span class="normal"><a href="#__codelineno-30-3">3</a></span>
<span class="normal"><a href="#__codelineno-30-4">4</a></span>
<span class="normal"><a href="#__codelineno-30-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="c1">// LoadUser allows an eager lookup of values, cached into the</span>
<a id="__codelineno-30-2" name="__codelineno-30-2"></a><span class="c1">// loaded structs of the objects. This is for an N-1 relationship.</span>
<a id="__codelineno-30-3" name="__codelineno-30-3"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">pointLogL</span><span class="p">)</span><span class="w"> </span><span class="nx">LoadUser</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">singular</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="nx">maybePointLog</span><span class="w"> </span><span class="kd">interface</span><span class="p">{},</span><span class="w"> </span><span class="nx">mods</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">Applicator</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-30-4" name="__codelineno-30-4"></a><span class="w">    </span><span class="c1">// 関数内の詳細な処理...</span>
<a id="__codelineno-30-5" name="__codelineno-30-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_34">解説</h3>
<ul>
<li><strong>目的</strong>: <code>PointLog</code> オブジェクトまたはそのスライスに対して、関連する <code>User</code> を一括ロードします（Eager Loading）。</li>
<li><strong>パラメータ</strong>:</li>
<li><code>singular bool</code>: 単一の <code>PointLog</code> か複数かを指定。</li>
<li><code>maybePointLog interface{}</code>: <code>PointLog</code> または <code>[]*PointLog</code> を受け取ります。</li>
<li><code>mods queries.Applicator</code>: クエリに適用するモディファイア。</li>
</ul>
<h4 id="_35">処理の流れ</h4>
<ol>
<li><strong>オブジェクトの型判定と取得</strong>:</li>
<li>単一か複数かを判定し、適切な型にアサートします。</li>
<li><strong>関連する UserID の収集</strong>:</li>
<li><code>PointLog</code> オブジェクトから関連する <code>UserID</code> を収集します。</li>
<li><strong>クエリの作成と実行</strong>:</li>
<li><code>UserID</code> を条件に <code>users</code> テーブルから関連する <code>User</code> を取得します。</li>
<li><strong>結果のマッピング</strong>:</li>
<li>取得した <code>User</code> を <code>PointLog</code> のフィールド <code>R.User</code> に格納します。</li>
<li><code>User</code> のフィールド <code>R.PointLogs</code> にも関連付けを追加します。</li>
</ol>
<h3 id="_36">利用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-31-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-31-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-31-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-31-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-31-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-31-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-31-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-31-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-31-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-31-10">10</a></span>
<span class="normal"><a href="#__codelineno-31-11">11</a></span>
<span class="normal"><a href="#__codelineno-31-12">12</a></span>
<span class="normal"><a href="#__codelineno-31-13">13</a></span>
<span class="normal"><a href="#__codelineno-31-14">14</a></span>
<span class="normal"><a href="#__codelineno-31-15">15</a></span>
<span class="normal"><a href="#__codelineno-31-16">16</a></span>
<span class="normal"><a href="#__codelineno-31-17">17</a></span>
<span class="normal"><a href="#__codelineno-31-18">18</a></span>
<span class="normal"><a href="#__codelineno-31-19">19</a></span>
<span class="normal"><a href="#__codelineno-31-20">20</a></span>
<span class="normal"><a href="#__codelineno-31-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-31-2" name="__codelineno-31-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-31-3" name="__codelineno-31-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-31-4" name="__codelineno-31-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-31-5" name="__codelineno-31-5"></a><span class="p">}</span>
<a id="__codelineno-31-6" name="__codelineno-31-6"></a><span class="k">defer</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-31-7" name="__codelineno-31-7"></a>
<a id="__codelineno-31-8" name="__codelineno-31-8"></a><span class="nx">pointLogs</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">PointLogs</span><span class="p">().</span><span class="nx">All</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-31-9" name="__codelineno-31-9"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-31-10" name="__codelineno-31-10"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-31-11" name="__codelineno-31-11"></a><span class="p">}</span>
<a id="__codelineno-31-12" name="__codelineno-31-12"></a>
<a id="__codelineno-31-13" name="__codelineno-31-13"></a><span class="c1">// 関連するUserを一括ロード</span>
<a id="__codelineno-31-14" name="__codelineno-31-14"></a><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">pointLogL</span><span class="p">{}.</span><span class="nx">LoadUser</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">pointLogs</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<a id="__codelineno-31-15" name="__codelineno-31-15"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-31-16" name="__codelineno-31-16"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-31-17" name="__codelineno-31-17"></a><span class="p">}</span>
<a id="__codelineno-31-18" name="__codelineno-31-18"></a>
<a id="__codelineno-31-19" name="__codelineno-31-19"></a><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">log</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">pointLogs</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-31-20" name="__codelineno-31-20"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;PointLog CreatedAt: %s, User Name: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">log</span><span class="p">.</span><span class="nx">CreatedAt</span><span class="p">,</span><span class="w"> </span><span class="nx">log</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">User</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
<a id="__codelineno-31-21" name="__codelineno-31-21"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="setuser"><code>SetUser</code> 関数</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-32-1">1</a></span>
<span class="normal"><a href="#__codelineno-32-2">2</a></span>
<span class="normal"><a href="#__codelineno-32-3">3</a></span>
<span class="normal"><a href="#__codelineno-32-4">4</a></span>
<span class="normal"><a href="#__codelineno-32-5">5</a></span>
<span class="normal"><a href="#__codelineno-32-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="c1">// SetUser of the pointLog to the related item.</span>
<a id="__codelineno-32-2" name="__codelineno-32-2"></a><span class="c1">// Sets o.R.User to related.</span>
<a id="__codelineno-32-3" name="__codelineno-32-3"></a><span class="c1">// Adds o to related.R.PointLogs.</span>
<a id="__codelineno-32-4" name="__codelineno-32-4"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">PointLog</span><span class="p">)</span><span class="w"> </span><span class="nx">SetUser</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">insert</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="nx">related</span><span class="w"> </span><span class="o">*</span><span class="nx">User</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-5" name="__codelineno-32-5"></a><span class="w">    </span><span class="c1">// 関数内の詳細な処理...</span>
<a id="__codelineno-32-6" name="__codelineno-32-6"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_37">解説</h3>
<ul>
<li><strong>目的</strong>: <code>PointLog</code> オブジェクトに関連する <code>User</code> を設定します。双方向の関連付けも更新します。</li>
<li><strong>パラメータ</strong>:</li>
<li><code>insert bool</code>: <code>related</code> な <code>User</code> をデータベースに挿入するかどうか。</li>
<li><code>related *User</code>: 関連付ける <code>User</code> オブジェクト。</li>
</ul>
<h4 id="_38">処理の流れ</h4>
<ol>
<li><code>insert</code> フラグが立っている場合、<code>related</code> をデータベースに挿入します。</li>
<li><code>point_logs</code> テーブルの <code>user_id</code> を更新し、<code>related.UserID</code> に設定します。</li>
<li>オブジェクト間の関連付けを更新します:</li>
<li><code>o.R.User</code> に <code>related</code> を設定。</li>
<li><code>related.R.PointLogs</code> に <code>o</code> を追加。</li>
</ol>
<h3 id="_39">利用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-33-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-33-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-33-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-33-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-33-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-33-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-33-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-33-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-33-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-33-10">10</a></span>
<span class="normal"><a href="#__codelineno-33-11">11</a></span>
<span class="normal"><a href="#__codelineno-33-12">12</a></span>
<span class="normal"><a href="#__codelineno-33-13">13</a></span>
<span class="normal"><a href="#__codelineno-33-14">14</a></span>
<span class="normal"><a href="#__codelineno-33-15">15</a></span>
<span class="normal"><a href="#__codelineno-33-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-33-2" name="__codelineno-33-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-33-3" name="__codelineno-33-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-4" name="__codelineno-33-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-33-5" name="__codelineno-33-5"></a><span class="p">}</span>
<a id="__codelineno-33-6" name="__codelineno-33-6"></a><span class="k">defer</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-33-7" name="__codelineno-33-7"></a>
<a id="__codelineno-33-8" name="__codelineno-33-8"></a><span class="nx">user</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">User</span><span class="p">{</span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;New User&quot;</span><span class="p">}</span>
<a id="__codelineno-33-9" name="__codelineno-33-9"></a><span class="nx">pointLog</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">PointLog</span><span class="p">{</span><span class="nx">CreatedAt</span><span class="p">:</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">()}</span>
<a id="__codelineno-33-10" name="__codelineno-33-10"></a>
<a id="__codelineno-33-11" name="__codelineno-33-11"></a><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">pointLog</span><span class="p">.</span><span class="nx">SetUser</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">)</span>
<a id="__codelineno-33-12" name="__codelineno-33-12"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-13" name="__codelineno-33-13"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-33-14" name="__codelineno-33-14"></a><span class="p">}</span>
<a id="__codelineno-33-15" name="__codelineno-33-15"></a>
<a id="__codelineno-33-16" name="__codelineno-33-16"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;User and PointLog have been associated and saved.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h2 id="pointlogs"><code>PointLogs</code> 関数</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-34-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-34-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-34-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-34-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-34-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-34-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-34-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-34-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-34-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-34-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1"></a><span class="c1">// PointLogs retrieves all the records using an executor.</span>
<a id="__codelineno-34-2" name="__codelineno-34-2"></a><span class="kd">func</span><span class="w"> </span><span class="nx">PointLogs</span><span class="p">(</span><span class="nx">mods</span><span class="w"> </span><span class="o">...</span><span class="nx">qm</span><span class="p">.</span><span class="nx">QueryMod</span><span class="p">)</span><span class="w"> </span><span class="nx">pointLogQuery</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-34-3" name="__codelineno-34-3"></a><span class="w">    </span><span class="nx">mods</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">mods</span><span class="p">,</span><span class="w"> </span><span class="nx">qm</span><span class="p">.</span><span class="nx">From</span><span class="p">(</span><span class="s">&quot;`point_logs`&quot;</span><span class="p">))</span>
<a id="__codelineno-34-4" name="__codelineno-34-4"></a><span class="w">    </span><span class="nx">q</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">NewQuery</span><span class="p">(</span><span class="nx">mods</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-34-5" name="__codelineno-34-5"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">queries</span><span class="p">.</span><span class="nx">GetSelect</span><span class="p">(</span><span class="nx">q</span><span class="p">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-34-6" name="__codelineno-34-6"></a><span class="w">        </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetSelect</span><span class="p">(</span><span class="nx">q</span><span class="p">,</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;`point_logs`.*&quot;</span><span class="p">})</span>
<a id="__codelineno-34-7" name="__codelineno-34-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-34-8" name="__codelineno-34-8"></a>
<a id="__codelineno-34-9" name="__codelineno-34-9"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">pointLogQuery</span><span class="p">{</span><span class="nx">q</span><span class="p">}</span>
<a id="__codelineno-34-10" name="__codelineno-34-10"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_40">解説</h3>
<ul>
<li><strong>目的</strong>: <code>point_logs</code> テーブルからレコードを取得するためのクエリを生成します。</li>
<li><strong>処理の流れ</strong>:</li>
<li>クエリモディファイアに <code>FROM 'point_logs'</code> を追加。</li>
<li>新しいクエリを作成。</li>
<li>SELECT 句が設定されていない場合、<code>point_logs</code> の全カラムを選択。</li>
</ul>
<h3 id="_41">利用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-35-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-35-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-35-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-35-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-35-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-35-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-35-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-35-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-35-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-35-10">10</a></span>
<span class="normal"><a href="#__codelineno-35-11">11</a></span>
<span class="normal"><a href="#__codelineno-35-12">12</a></span>
<span class="normal"><a href="#__codelineno-35-13">13</a></span>
<span class="normal"><a href="#__codelineno-35-14">14</a></span>
<span class="normal"><a href="#__codelineno-35-15">15</a></span>
<span class="normal"><a href="#__codelineno-35-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-35-2" name="__codelineno-35-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-35-3" name="__codelineno-35-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-4" name="__codelineno-35-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-35-5" name="__codelineno-35-5"></a><span class="p">}</span>
<a id="__codelineno-35-6" name="__codelineno-35-6"></a><span class="k">defer</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-35-7" name="__codelineno-35-7"></a>
<a id="__codelineno-35-8" name="__codelineno-35-8"></a><span class="c1">// 特定の条件でPointLogsを取得</span>
<a id="__codelineno-35-9" name="__codelineno-35-9"></a><span class="nx">pointLogs</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">PointLogs</span><span class="p">(</span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;user_id = ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">123</span><span class="p">)).</span><span class="nx">All</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-35-10" name="__codelineno-35-10"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-11" name="__codelineno-35-11"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-35-12" name="__codelineno-35-12"></a><span class="p">}</span>
<a id="__codelineno-35-13" name="__codelineno-35-13"></a>
<a id="__codelineno-35-14" name="__codelineno-35-14"></a><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">log</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">pointLogs</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-15" name="__codelineno-35-15"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;PointLog CreatedAt: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">log</span><span class="p">.</span><span class="nx">CreatedAt</span><span class="p">)</span>
<a id="__codelineno-35-16" name="__codelineno-35-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="findpointlog"><code>FindPointLog</code> 関数</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-36-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-36-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-36-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-36-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-36-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-36-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-36-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-36-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-36-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-36-10">10</a></span>
<span class="normal"><a href="#__codelineno-36-11">11</a></span>
<span class="normal"><a href="#__codelineno-36-12">12</a></span>
<span class="normal"><a href="#__codelineno-36-13">13</a></span>
<span class="normal"><a href="#__codelineno-36-14">14</a></span>
<span class="normal"><a href="#__codelineno-36-15">15</a></span>
<span class="normal"><a href="#__codelineno-36-16">16</a></span>
<span class="normal"><a href="#__codelineno-36-17">17</a></span>
<span class="normal"><a href="#__codelineno-36-18">18</a></span>
<span class="normal"><a href="#__codelineno-36-19">19</a></span>
<span class="normal"><a href="#__codelineno-36-20">20</a></span>
<span class="normal"><a href="#__codelineno-36-21">21</a></span>
<span class="normal"><a href="#__codelineno-36-22">22</a></span>
<span class="normal"><a href="#__codelineno-36-23">23</a></span>
<span class="normal"><a href="#__codelineno-36-24">24</a></span>
<span class="normal"><a href="#__codelineno-36-25">25</a></span>
<span class="normal"><a href="#__codelineno-36-26">26</a></span>
<span class="normal"><a href="#__codelineno-36-27">27</a></span>
<span class="normal"><a href="#__codelineno-36-28">28</a></span>
<span class="normal"><a href="#__codelineno-36-29">29</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1"></a><span class="c1">// FindPointLog retrieves a single record by ID with an executor.</span>
<a id="__codelineno-36-2" name="__codelineno-36-2"></a><span class="c1">// If selectCols is empty Find will return all columns.</span>
<a id="__codelineno-36-3" name="__codelineno-36-3"></a><span class="kd">func</span><span class="w"> </span><span class="nx">FindPointLog</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">createdAt</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Time</span><span class="p">,</span><span class="w"> </span><span class="nx">userID</span><span class="w"> </span><span class="kt">uint</span><span class="p">,</span><span class="w"> </span><span class="nx">selectCols</span><span class="w"> </span><span class="o">...</span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">PointLog</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-4" name="__codelineno-36-4"></a><span class="w">    </span><span class="nx">pointLogObj</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">PointLog</span><span class="p">{}</span>
<a id="__codelineno-36-5" name="__codelineno-36-5"></a>
<a id="__codelineno-36-6" name="__codelineno-36-6"></a><span class="w">    </span><span class="nx">sel</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;*&quot;</span>
<a id="__codelineno-36-7" name="__codelineno-36-7"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">selectCols</span><span class="p">)</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-8" name="__codelineno-36-8"></a><span class="w">        </span><span class="nx">sel</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">Join</span><span class="p">(</span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">IdentQuoteSlice</span><span class="p">(</span><span class="nx">dialect</span><span class="p">.</span><span class="nx">LQ</span><span class="p">,</span><span class="w"> </span><span class="nx">dialect</span><span class="p">.</span><span class="nx">RQ</span><span class="p">,</span><span class="w"> </span><span class="nx">selectCols</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;,&quot;</span><span class="p">)</span>
<a id="__codelineno-36-9" name="__codelineno-36-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-36-10" name="__codelineno-36-10"></a><span class="w">    </span><span class="nx">query</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span>
<a id="__codelineno-36-11" name="__codelineno-36-11"></a><span class="w">        </span><span class="s">&quot;select %s from `point_logs` where `created_at`=? AND `user_id`=?&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">sel</span><span class="p">,</span>
<a id="__codelineno-36-12" name="__codelineno-36-12"></a><span class="w">    </span><span class="p">)</span>
<a id="__codelineno-36-13" name="__codelineno-36-13"></a>
<a id="__codelineno-36-14" name="__codelineno-36-14"></a><span class="w">    </span><span class="nx">q</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">Raw</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span><span class="w"> </span><span class="nx">createdAt</span><span class="p">,</span><span class="w"> </span><span class="nx">userID</span><span class="p">)</span>
<a id="__codelineno-36-15" name="__codelineno-36-15"></a>
<a id="__codelineno-36-16" name="__codelineno-36-16"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">q</span><span class="p">.</span><span class="nx">Bind</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="nx">pointLogObj</span><span class="p">)</span>
<a id="__codelineno-36-17" name="__codelineno-36-17"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-18" name="__codelineno-36-18"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Is</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">ErrNoRows</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-19" name="__codelineno-36-19"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">ErrNoRows</span>
<a id="__codelineno-36-20" name="__codelineno-36-20"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-36-21" name="__codelineno-36-21"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to select from point_logs&quot;</span><span class="p">)</span>
<a id="__codelineno-36-22" name="__codelineno-36-22"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-36-23" name="__codelineno-36-23"></a>
<a id="__codelineno-36-24" name="__codelineno-36-24"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">pointLogObj</span><span class="p">.</span><span class="nx">doAfterSelectHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-25" name="__codelineno-36-25"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">pointLogObj</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-36-26" name="__codelineno-36-26"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-36-27" name="__codelineno-36-27"></a>
<a id="__codelineno-36-28" name="__codelineno-36-28"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">pointLogObj</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-36-29" name="__codelineno-36-29"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_42">解説</h3>
<ul>
<li><strong>目的</strong>: プライマリキー（<code>created_at</code> と <code>user_id</code>）を使用して、単一の <code>PointLog</code> レコードを取得します。</li>
<li><strong>処理の流れ</strong>:</li>
<li><code>selectCols</code> が指定されていれば、そのカラムのみを選択。</li>
<li>クエリを組み立て、指定された <code>createdAt</code> と <code>userID</code> で検索。</li>
<li>結果を <code>pointLogObj</code> にバインド。</li>
<li>エラー処理と結果の返却。</li>
</ul>
<h3 id="_43">利用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-37-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-37-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-37-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-37-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-37-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-37-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-37-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-37-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-37-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-37-10">10</a></span>
<span class="normal"><a href="#__codelineno-37-11">11</a></span>
<span class="normal"><a href="#__codelineno-37-12">12</a></span>
<span class="normal"><a href="#__codelineno-37-13">13</a></span>
<span class="normal"><a href="#__codelineno-37-14">14</a></span>
<span class="normal"><a href="#__codelineno-37-15">15</a></span>
<span class="normal"><a href="#__codelineno-37-16">16</a></span>
<span class="normal"><a href="#__codelineno-37-17">17</a></span>
<span class="normal"><a href="#__codelineno-37-18">18</a></span>
<span class="normal"><a href="#__codelineno-37-19">19</a></span>
<span class="normal"><a href="#__codelineno-37-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-37-2" name="__codelineno-37-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-37-3" name="__codelineno-37-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-4" name="__codelineno-37-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-37-5" name="__codelineno-37-5"></a><span class="p">}</span>
<a id="__codelineno-37-6" name="__codelineno-37-6"></a><span class="k">defer</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-37-7" name="__codelineno-37-7"></a>
<a id="__codelineno-37-8" name="__codelineno-37-8"></a><span class="nx">createdAt</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">Add</span><span class="p">(</span><span class="o">-</span><span class="mi">24</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Hour</span><span class="p">)</span>
<a id="__codelineno-37-9" name="__codelineno-37-9"></a><span class="nx">userID</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">uint</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<a id="__codelineno-37-10" name="__codelineno-37-10"></a>
<a id="__codelineno-37-11" name="__codelineno-37-11"></a><span class="nx">pointLog</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">FindPointLog</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">createdAt</span><span class="p">,</span><span class="w"> </span><span class="nx">userID</span><span class="p">)</span>
<a id="__codelineno-37-12" name="__codelineno-37-12"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-13" name="__codelineno-37-13"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Is</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">ErrNoRows</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-14" name="__codelineno-37-14"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;No PointLog found.&quot;</span><span class="p">)</span>
<a id="__codelineno-37-15" name="__codelineno-37-15"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-16" name="__codelineno-37-16"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-37-17" name="__codelineno-37-17"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-37-18" name="__codelineno-37-18"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-19" name="__codelineno-37-19"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Found PointLog: %+v\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">pointLog</span><span class="p">)</span>
<a id="__codelineno-37-20" name="__codelineno-37-20"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="insert"><code>Insert</code> 関数</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-38-1">1</a></span>
<span class="normal"><a href="#__codelineno-38-2">2</a></span>
<span class="normal"><a href="#__codelineno-38-3">3</a></span>
<span class="normal"><a href="#__codelineno-38-4">4</a></span>
<span class="normal"><a href="#__codelineno-38-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1"></a><span class="c1">// Insert a single record using an executor.</span>
<a id="__codelineno-38-2" name="__codelineno-38-2"></a><span class="c1">// See boil.Columns.InsertColumnSet documentation to understand column list inference for inserts.</span>
<a id="__codelineno-38-3" name="__codelineno-38-3"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">PointLog</span><span class="p">)</span><span class="w"> </span><span class="nx">Insert</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">columns</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">Columns</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-38-4" name="__codelineno-38-4"></a><span class="w">    </span><span class="c1">// 関数内の詳細な処理...</span>
<a id="__codelineno-38-5" name="__codelineno-38-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_44">解説</h3>
<ul>
<li><strong>目的</strong>: <code>PointLog</code> オブジェクトをデータベースに新規挿入します。</li>
<li><strong>パラメータ</strong>:</li>
<li><code>columns boil.Columns</code>: 挿入するカラムを指定できます。通常は <code>boil.Infer()</code> を使用して自動推論します。</li>
</ul>
<h4 id="_45">処理の流れ</h4>
<ol>
<li><strong>タイムスタンプの設定</strong>:</li>
<li><code>CreatedAt</code> が未設定の場合、現在時刻で設定。</li>
<li><strong>BeforeInsert フックの実行</strong>:</li>
<li>挿入前のフックがあれば実行。</li>
<li><strong>クエリキャッシュの確認と構築</strong>:</li>
<li>パフォーマンス向上のため、クエリのキャッシュを確認し、なければ構築。</li>
<li><strong>値の抽出とクエリの実行</strong>:</li>
<li>構築したクエリに対して、値を渡して実行。</li>
<li><strong>AfterInsert フックの実行</strong>:</li>
<li>挿入後のフックがあれば実行。</li>
</ol>
<h3 id="_46">利用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-39-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-39-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-39-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-39-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-39-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-39-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-39-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-39-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-39-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-39-10">10</a></span>
<span class="normal"><a href="#__codelineno-39-11">11</a></span>
<span class="normal"><a href="#__codelineno-39-12">12</a></span>
<span class="normal"><a href="#__codelineno-39-13">13</a></span>
<span class="normal"><a href="#__codelineno-39-14">14</a></span>
<span class="normal"><a href="#__codelineno-39-15">15</a></span>
<span class="normal"><a href="#__codelineno-39-16">16</a></span>
<span class="normal"><a href="#__codelineno-39-17">17</a></span>
<span class="normal"><a href="#__codelineno-39-18">18</a></span>
<span class="normal"><a href="#__codelineno-39-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-39-2" name="__codelineno-39-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-39-3" name="__codelineno-39-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-4" name="__codelineno-39-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-39-5" name="__codelineno-39-5"></a><span class="p">}</span>
<a id="__codelineno-39-6" name="__codelineno-39-6"></a><span class="k">defer</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-39-7" name="__codelineno-39-7"></a>
<a id="__codelineno-39-8" name="__codelineno-39-8"></a><span class="nx">pointLog</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">PointLog</span><span class="p">{</span>
<a id="__codelineno-39-9" name="__codelineno-39-9"></a><span class="w">    </span><span class="nx">UserID</span><span class="p">:</span><span class="w">    </span><span class="mi">123</span><span class="p">,</span>
<a id="__codelineno-39-10" name="__codelineno-39-10"></a><span class="w">    </span><span class="nx">CreatedAt</span><span class="p">:</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">(),</span>
<a id="__codelineno-39-11" name="__codelineno-39-11"></a><span class="w">    </span><span class="c1">// その他のフィールドを設定</span>
<a id="__codelineno-39-12" name="__codelineno-39-12"></a><span class="p">}</span>
<a id="__codelineno-39-13" name="__codelineno-39-13"></a>
<a id="__codelineno-39-14" name="__codelineno-39-14"></a><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">pointLog</span><span class="p">.</span><span class="nx">Insert</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">Infer</span><span class="p">())</span>
<a id="__codelineno-39-15" name="__codelineno-39-15"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-16" name="__codelineno-39-16"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-39-17" name="__codelineno-39-17"></a><span class="p">}</span>
<a id="__codelineno-39-18" name="__codelineno-39-18"></a>
<a id="__codelineno-39-19" name="__codelineno-39-19"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;PointLog has been inserted.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="update"><code>Update</code> 関数</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-40-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-40-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-40-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-40-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-40-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-40-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-40-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-40-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-40-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-40-10">10</a></span>
<span class="normal"><a href="#__codelineno-40-11">11</a></span>
<span class="normal"><a href="#__codelineno-40-12">12</a></span>
<span class="normal"><a href="#__codelineno-40-13">13</a></span>
<span class="normal"><a href="#__codelineno-40-14">14</a></span>
<span class="normal"><a href="#__codelineno-40-15">15</a></span>
<span class="normal"><a href="#__codelineno-40-16">16</a></span>
<span class="normal"><a href="#__codelineno-40-17">17</a></span>
<span class="normal"><a href="#__codelineno-40-18">18</a></span>
<span class="normal"><a href="#__codelineno-40-19">19</a></span>
<span class="normal"><a href="#__codelineno-40-20">20</a></span>
<span class="normal"><a href="#__codelineno-40-21">21</a></span>
<span class="normal"><a href="#__codelineno-40-22">22</a></span>
<span class="normal"><a href="#__codelineno-40-23">23</a></span>
<span class="normal"><a href="#__codelineno-40-24">24</a></span>
<span class="normal"><a href="#__codelineno-40-25">25</a></span>
<span class="normal"><a href="#__codelineno-40-26">26</a></span>
<span class="normal"><a href="#__codelineno-40-27">27</a></span>
<span class="normal"><a href="#__codelineno-40-28">28</a></span>
<span class="normal"><a href="#__codelineno-40-29">29</a></span>
<span class="normal"><a href="#__codelineno-40-30">30</a></span>
<span class="normal"><a href="#__codelineno-40-31">31</a></span>
<span class="normal"><a href="#__codelineno-40-32">32</a></span>
<span class="normal"><a href="#__codelineno-40-33">33</a></span>
<span class="normal"><a href="#__codelineno-40-34">34</a></span>
<span class="normal"><a href="#__codelineno-40-35">35</a></span>
<span class="normal"><a href="#__codelineno-40-36">36</a></span>
<span class="normal"><a href="#__codelineno-40-37">37</a></span>
<span class="normal"><a href="#__codelineno-40-38">38</a></span>
<span class="normal"><a href="#__codelineno-40-39">39</a></span>
<span class="normal"><a href="#__codelineno-40-40">40</a></span>
<span class="normal"><a href="#__codelineno-40-41">41</a></span>
<span class="normal"><a href="#__codelineno-40-42">42</a></span>
<span class="normal"><a href="#__codelineno-40-43">43</a></span>
<span class="normal"><a href="#__codelineno-40-44">44</a></span>
<span class="normal"><a href="#__codelineno-40-45">45</a></span>
<span class="normal"><a href="#__codelineno-40-46">46</a></span>
<span class="normal"><a href="#__codelineno-40-47">47</a></span>
<span class="normal"><a href="#__codelineno-40-48">48</a></span>
<span class="normal"><a href="#__codelineno-40-49">49</a></span>
<span class="normal"><a href="#__codelineno-40-50">50</a></span>
<span class="normal"><a href="#__codelineno-40-51">51</a></span>
<span class="normal"><a href="#__codelineno-40-52">52</a></span>
<span class="normal"><a href="#__codelineno-40-53">53</a></span>
<span class="normal"><a href="#__codelineno-40-54">54</a></span>
<span class="normal"><a href="#__codelineno-40-55">55</a></span>
<span class="normal"><a href="#__codelineno-40-56">56</a></span>
<span class="normal"><a href="#__codelineno-40-57">57</a></span>
<span class="normal"><a href="#__codelineno-40-58">58</a></span>
<span class="normal"><a href="#__codelineno-40-59">59</a></span>
<span class="normal"><a href="#__codelineno-40-60">60</a></span>
<span class="normal"><a href="#__codelineno-40-61">61</a></span>
<span class="normal"><a href="#__codelineno-40-62">62</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1"></a><span class="c1">// Update uses an executor to update the PointLog.</span>
<a id="__codelineno-40-2" name="__codelineno-40-2"></a><span class="c1">// See boil.Columns.UpdateColumnSet documentation to understand column list inference for updates.</span>
<a id="__codelineno-40-3" name="__codelineno-40-3"></a><span class="c1">// Update does not automatically update the record in case of default values. Use .Reload() to refresh the records.</span>
<a id="__codelineno-40-4" name="__codelineno-40-4"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">PointLog</span><span class="p">)</span><span class="w"> </span><span class="nx">Update</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">columns</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">Columns</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">int64</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-5" name="__codelineno-40-5"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span>
<a id="__codelineno-40-6" name="__codelineno-40-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">doBeforeUpdateHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-7" name="__codelineno-40-7"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-40-8" name="__codelineno-40-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-40-9" name="__codelineno-40-9"></a><span class="w">    </span><span class="nx">key</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">makeCacheKey</span><span class="p">(</span><span class="nx">columns</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<a id="__codelineno-40-10" name="__codelineno-40-10"></a><span class="w">    </span><span class="nx">pointLogUpdateCacheMut</span><span class="p">.</span><span class="nx">RLock</span><span class="p">()</span>
<a id="__codelineno-40-11" name="__codelineno-40-11"></a><span class="w">    </span><span class="nx">cache</span><span class="p">,</span><span class="w"> </span><span class="nx">cached</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">pointLogUpdateCache</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
<a id="__codelineno-40-12" name="__codelineno-40-12"></a><span class="w">    </span><span class="nx">pointLogUpdateCacheMut</span><span class="p">.</span><span class="nx">RUnlock</span><span class="p">()</span>
<a id="__codelineno-40-13" name="__codelineno-40-13"></a>
<a id="__codelineno-40-14" name="__codelineno-40-14"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">cached</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-15" name="__codelineno-40-15"></a><span class="w">        </span><span class="nx">wl</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">columns</span><span class="p">.</span><span class="nx">UpdateColumnSet</span><span class="p">(</span>
<a id="__codelineno-40-16" name="__codelineno-40-16"></a><span class="w">            </span><span class="nx">pointLogAllColumns</span><span class="p">,</span>
<a id="__codelineno-40-17" name="__codelineno-40-17"></a><span class="w">            </span><span class="nx">pointLogPrimaryKeyColumns</span><span class="p">,</span>
<a id="__codelineno-40-18" name="__codelineno-40-18"></a><span class="w">        </span><span class="p">)</span>
<a id="__codelineno-40-19" name="__codelineno-40-19"></a>
<a id="__codelineno-40-20" name="__codelineno-40-20"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">columns</span><span class="p">.</span><span class="nx">IsWhitelist</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-21" name="__codelineno-40-21"></a><span class="w">            </span><span class="nx">wl</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">SetComplement</span><span class="p">(</span><span class="nx">wl</span><span class="p">,</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;created_at&quot;</span><span class="p">})</span>
<a id="__codelineno-40-22" name="__codelineno-40-22"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-40-23" name="__codelineno-40-23"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">wl</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-24" name="__codelineno-40-24"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;models: unable to update point_logs, could not build whitelist&quot;</span><span class="p">)</span>
<a id="__codelineno-40-25" name="__codelineno-40-25"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-40-26" name="__codelineno-40-26"></a>
<a id="__codelineno-40-27" name="__codelineno-40-27"></a><span class="w">        </span><span class="nx">cache</span><span class="p">.</span><span class="nx">query</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;UPDATE `point_logs` SET %s WHERE %s&quot;</span><span class="p">,</span>
<a id="__codelineno-40-28" name="__codelineno-40-28"></a><span class="w">            </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">SetParamNames</span><span class="p">(</span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">wl</span><span class="p">),</span>
<a id="__codelineno-40-29" name="__codelineno-40-29"></a><span class="w">            </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">WhereClause</span><span class="p">(</span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">pointLogPrimaryKeyColumns</span><span class="p">),</span>
<a id="__codelineno-40-30" name="__codelineno-40-30"></a><span class="w">        </span><span class="p">)</span>
<a id="__codelineno-40-31" name="__codelineno-40-31"></a><span class="w">        </span><span class="nx">cache</span><span class="p">.</span><span class="nx">valueMapping</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">BindMapping</span><span class="p">(</span><span class="nx">pointLogType</span><span class="p">,</span><span class="w"> </span><span class="nx">pointLogMapping</span><span class="p">,</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">wl</span><span class="p">,</span><span class="w"> </span><span class="nx">pointLogPrimaryKeyColumns</span><span class="o">...</span><span class="p">))</span>
<a id="__codelineno-40-32" name="__codelineno-40-32"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-33" name="__codelineno-40-33"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-40-34" name="__codelineno-40-34"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-40-35" name="__codelineno-40-35"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-40-36" name="__codelineno-40-36"></a>
<a id="__codelineno-40-37" name="__codelineno-40-37"></a><span class="w">    </span><span class="nx">values</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">ValuesFromMapping</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">Indirect</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="nx">o</span><span class="p">)),</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">valueMapping</span><span class="p">)</span>
<a id="__codelineno-40-38" name="__codelineno-40-38"></a>
<a id="__codelineno-40-39" name="__codelineno-40-39"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">IsDebug</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-40" name="__codelineno-40-40"></a><span class="w">        </span><span class="nx">writer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">DebugWriterFrom</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<a id="__codelineno-40-41" name="__codelineno-40-41"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">query</span><span class="p">)</span>
<a id="__codelineno-40-42" name="__codelineno-40-42"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">values</span><span class="p">)</span>
<a id="__codelineno-40-43" name="__codelineno-40-43"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-40-44" name="__codelineno-40-44"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Result</span>
<a id="__codelineno-40-45" name="__codelineno-40-45"></a><span class="w">    </span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">exec</span><span class="p">.</span><span class="nx">ExecContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">query</span><span class="p">,</span><span class="w"> </span><span class="nx">values</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-40-46" name="__codelineno-40-46"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-47" name="__codelineno-40-47"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to update point_logs row&quot;</span><span class="p">)</span>
<a id="__codelineno-40-48" name="__codelineno-40-48"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-40-49" name="__codelineno-40-49"></a>
<a id="__codelineno-40-50" name="__codelineno-40-50"></a><span class="w">    </span><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">RowsAffected</span><span class="p">()</span>
<a id="__codelineno-40-51" name="__codelineno-40-51"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-52" name="__codelineno-40-52"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: failed to get rows affected by update for point_logs&quot;</span><span class="p">)</span>
<a id="__codelineno-40-53" name="__codelineno-40-53"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-40-54" name="__codelineno-40-54"></a>
<a id="__codelineno-40-55" name="__codelineno-40-55"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">cached</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-56" name="__codelineno-40-56"></a><span class="w">        </span><span class="nx">pointLogUpdateCacheMut</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
<a id="__codelineno-40-57" name="__codelineno-40-57"></a><span class="w">        </span><span class="nx">pointLogUpdateCache</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">cache</span>
<a id="__codelineno-40-58" name="__codelineno-40-58"></a><span class="w">        </span><span class="nx">pointLogUpdateCacheMut</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>
<a id="__codelineno-40-59" name="__codelineno-40-59"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-40-60" name="__codelineno-40-60"></a>
<a id="__codelineno-40-61" name="__codelineno-40-61"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">doAfterUpdateHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">)</span>
<a id="__codelineno-40-62" name="__codelineno-40-62"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_47">解説</h3>
<ul>
<li><strong>目的</strong>: <code>PointLog</code> オブジェクトのデータベース上のレコードを更新します。</li>
<li><strong>パラメータ</strong>:</li>
<li><code>ctx context.Context</code>: コンテキストを渡します。</li>
<li><code>exec boil.ContextExecutor</code>: データベース操作を実行するためのエグゼキュータです。</li>
<li><code>columns boil.Columns</code>: 更新するカラムを指定します。</li>
<li><strong>戻り値</strong>:</li>
<li><code>int64</code>: 更新された行数を返します。</li>
<li><code>error</code>: エラー情報を返します。</li>
</ul>
<h4 id="_48">処理の流れ</h4>
<ol>
<li><strong>BeforeUpdate フックの実行</strong>:</li>
<li>更新前のフックがあれば実行します。</li>
<li><strong>キャッシュキーの作成とチェック</strong>:</li>
<li>更新クエリのキャッシュを使用してパフォーマンスを向上させます。</li>
<li><strong>更新するカラムのセットアップ</strong>:</li>
<li><code>columns.UpdateColumnSet</code> を使用して、更新対象のカラムを決定します。</li>
<li><code>columns</code> がホワイトリストでない場合、<code>created_at</code> カラムを除外します。</li>
<li>更新すべきカラムがない場合、エラーを返します。</li>
<li><strong>更新クエリの構築</strong>:</li>
<li><code>UPDATE</code> クエリを作成し、設定するパラメータ名と条件を指定します。</li>
<li><strong>値のマッピング</strong>:</li>
<li><code>cache.valueMapping</code> を使用して、オブジェクトの値を取得します。</li>
<li><strong>クエリの実行</strong>:</li>
<li>構築したクエリと値で <code>exec.ExecContext</code> を実行します。</li>
<li><strong>更新された行数の取得</strong>:</li>
<li><code>result.RowsAffected()</code> で更新された行数を取得します。</li>
<li><strong>AfterUpdate フックの実行</strong>:</li>
<li>更新後のフックがあれば実行します。</li>
</ol>
<h3 id="_49">注意点</h3>
<ul>
<li>デフォルト値が設定されている場合でも、自動的にレコードは更新されません。最新の値を取得するには、<code>.Reload()</code> を使用してレコードをリフレッシュする必要があります。</li>
</ul>
<h3 id="_50">利用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-41-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-41-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-41-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-41-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-41-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-41-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-41-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-41-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-41-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-41-10">10</a></span>
<span class="normal"><a href="#__codelineno-41-11">11</a></span>
<span class="normal"><a href="#__codelineno-41-12">12</a></span>
<span class="normal"><a href="#__codelineno-41-13">13</a></span>
<span class="normal"><a href="#__codelineno-41-14">14</a></span>
<span class="normal"><a href="#__codelineno-41-15">15</a></span>
<span class="normal"><a href="#__codelineno-41-16">16</a></span>
<span class="normal"><a href="#__codelineno-41-17">17</a></span>
<span class="normal"><a href="#__codelineno-41-18">18</a></span>
<span class="normal"><a href="#__codelineno-41-19">19</a></span>
<span class="normal"><a href="#__codelineno-41-20">20</a></span>
<span class="normal"><a href="#__codelineno-41-21">21</a></span>
<span class="normal"><a href="#__codelineno-41-22">22</a></span>
<span class="normal"><a href="#__codelineno-41-23">23</a></span>
<span class="normal"><a href="#__codelineno-41-24">24</a></span>
<span class="normal"><a href="#__codelineno-41-25">25</a></span>
<span class="normal"><a href="#__codelineno-41-26">26</a></span>
<span class="normal"><a href="#__codelineno-41-27">27</a></span>
<span class="normal"><a href="#__codelineno-41-28">28</a></span>
<span class="normal"><a href="#__codelineno-41-29">29</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-41-2" name="__codelineno-41-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-41-3" name="__codelineno-41-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-41-4" name="__codelineno-41-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-41-5" name="__codelineno-41-5"></a><span class="p">}</span>
<a id="__codelineno-41-6" name="__codelineno-41-6"></a><span class="k">defer</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-41-7" name="__codelineno-41-7"></a>
<a id="__codelineno-41-8" name="__codelineno-41-8"></a><span class="c1">// 更新したいPointLogを取得</span>
<a id="__codelineno-41-9" name="__codelineno-41-9"></a><span class="nx">pointLog</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">FindPointLog</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">someTime</span><span class="p">,</span><span class="w"> </span><span class="nx">someUserID</span><span class="p">)</span>
<a id="__codelineno-41-10" name="__codelineno-41-10"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-41-11" name="__codelineno-41-11"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-41-12" name="__codelineno-41-12"></a><span class="p">}</span>
<a id="__codelineno-41-13" name="__codelineno-41-13"></a>
<a id="__codelineno-41-14" name="__codelineno-41-14"></a><span class="c1">// 更新するフィールドを設定</span>
<a id="__codelineno-41-15" name="__codelineno-41-15"></a><span class="nx">pointLog</span><span class="p">.</span><span class="nx">Points</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">100</span>
<a id="__codelineno-41-16" name="__codelineno-41-16"></a>
<a id="__codelineno-41-17" name="__codelineno-41-17"></a><span class="c1">// 更新を実行</span>
<a id="__codelineno-41-18" name="__codelineno-41-18"></a><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">pointLog</span><span class="p">.</span><span class="nx">Update</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">Infer</span><span class="p">())</span><span class="w"> </span><span class="c1">// 更新するカラムを自動推論</span>
<a id="__codelineno-41-19" name="__codelineno-41-19"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-41-20" name="__codelineno-41-20"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-41-21" name="__codelineno-41-21"></a><span class="p">}</span>
<a id="__codelineno-41-22" name="__codelineno-41-22"></a>
<a id="__codelineno-41-23" name="__codelineno-41-23"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Updated %d rows.\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">rowsAff</span><span class="p">)</span>
<a id="__codelineno-41-24" name="__codelineno-41-24"></a>
<a id="__codelineno-41-25" name="__codelineno-41-25"></a><span class="c1">// 必要に応じてレコードをリロード</span>
<a id="__codelineno-41-26" name="__codelineno-41-26"></a><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">pointLog</span><span class="p">.</span><span class="nx">Reload</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-41-27" name="__codelineno-41-27"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-41-28" name="__codelineno-41-28"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-41-29" name="__codelineno-41-29"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="updateall"><code>UpdateAll</code> 関数</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-42-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-42-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-42-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-42-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-42-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-42-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-42-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-42-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-42-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-42-10">10</a></span>
<span class="normal"><a href="#__codelineno-42-11">11</a></span>
<span class="normal"><a href="#__codelineno-42-12">12</a></span>
<span class="normal"><a href="#__codelineno-42-13">13</a></span>
<span class="normal"><a href="#__codelineno-42-14">14</a></span>
<span class="normal"><a href="#__codelineno-42-15">15</a></span>
<span class="normal"><a href="#__codelineno-42-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1"></a><span class="c1">// UpdateAll updates all rows with the specified column values.</span>
<a id="__codelineno-42-2" name="__codelineno-42-2"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">q</span><span class="w"> </span><span class="nx">pointLogQuery</span><span class="p">)</span><span class="w"> </span><span class="nx">UpdateAll</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">cols</span><span class="w"> </span><span class="nx">M</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">int64</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-42-3" name="__codelineno-42-3"></a><span class="w">    </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetUpdate</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">,</span><span class="w"> </span><span class="nx">cols</span><span class="p">)</span>
<a id="__codelineno-42-4" name="__codelineno-42-4"></a>
<a id="__codelineno-42-5" name="__codelineno-42-5"></a><span class="w">    </span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">.</span><span class="nx">ExecContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">)</span>
<a id="__codelineno-42-6" name="__codelineno-42-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-42-7" name="__codelineno-42-7"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to update all for point_logs&quot;</span><span class="p">)</span>
<a id="__codelineno-42-8" name="__codelineno-42-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-42-9" name="__codelineno-42-9"></a>
<a id="__codelineno-42-10" name="__codelineno-42-10"></a><span class="w">    </span><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">RowsAffected</span><span class="p">()</span>
<a id="__codelineno-42-11" name="__codelineno-42-11"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-42-12" name="__codelineno-42-12"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to retrieve rows affected for point_logs&quot;</span><span class="p">)</span>
<a id="__codelineno-42-13" name="__codelineno-42-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-42-14" name="__codelineno-42-14"></a>
<a id="__codelineno-42-15" name="__codelineno-42-15"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-42-16" name="__codelineno-42-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_51">解説</h3>
<ul>
<li><strong>目的</strong>: クエリに一致するすべての <code>PointLog</code> レコードを一括で更新します。</li>
<li><strong>パラメータ</strong>:</li>
<li><code>cols M</code>: 更新するカラムと値のマップ。<code>M</code> は <code>map[string]interface{}</code> のエイリアス。</li>
<li><strong>戻り値</strong>:</li>
<li><code>int64</code>: 更新された行数を返します。</li>
</ul>
<h4 id="_52">処理の流れ</h4>
<ol>
<li><strong>更新クエリの設定</strong>:</li>
<li><code>queries.SetUpdate</code> を使用して、更新するカラムと値をクエリに設定します。</li>
<li><strong>クエリの実行</strong>:</li>
<li>クエリを実行し、結果を取得します。</li>
<li><strong>更新された行数の取得</strong>:</li>
<li><code>result.RowsAffected()</code> で更新された行数を取得します。</li>
</ol>
<h3 id="_53">利用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-43-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-43-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-43-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-43-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-43-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-43-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-43-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-43-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-43-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-43-10">10</a></span>
<span class="normal"><a href="#__codelineno-43-11">11</a></span>
<span class="normal"><a href="#__codelineno-43-12">12</a></span>
<span class="normal"><a href="#__codelineno-43-13">13</a></span>
<span class="normal"><a href="#__codelineno-43-14">14</a></span>
<span class="normal"><a href="#__codelineno-43-15">15</a></span>
<span class="normal"><a href="#__codelineno-43-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-43-2" name="__codelineno-43-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-43-3" name="__codelineno-43-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-4" name="__codelineno-43-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-43-5" name="__codelineno-43-5"></a><span class="p">}</span>
<a id="__codelineno-43-6" name="__codelineno-43-6"></a><span class="k">defer</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-43-7" name="__codelineno-43-7"></a>
<a id="__codelineno-43-8" name="__codelineno-43-8"></a><span class="c1">// user_idが123のPointLogのポイントを一括で200に更新</span>
<a id="__codelineno-43-9" name="__codelineno-43-9"></a><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">PointLogs</span><span class="p">(</span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;user_id = ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">123</span><span class="p">)).</span><span class="nx">UpdateAll</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">M</span><span class="p">{</span>
<a id="__codelineno-43-10" name="__codelineno-43-10"></a><span class="w">    </span><span class="s">&quot;points&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span>
<a id="__codelineno-43-11" name="__codelineno-43-11"></a><span class="p">})</span>
<a id="__codelineno-43-12" name="__codelineno-43-12"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-13" name="__codelineno-43-13"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-43-14" name="__codelineno-43-14"></a><span class="p">}</span>
<a id="__codelineno-43-15" name="__codelineno-43-15"></a>
<a id="__codelineno-43-16" name="__codelineno-43-16"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Updated %d rows.\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">rowsAff</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="updateall_1"><code>UpdateAll</code> メソッド（スライス用）</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-44-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-44-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-44-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-44-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-44-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-44-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-44-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-44-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-44-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-44-10">10</a></span>
<span class="normal"><a href="#__codelineno-44-11">11</a></span>
<span class="normal"><a href="#__codelineno-44-12">12</a></span>
<span class="normal"><a href="#__codelineno-44-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1"></a><span class="c1">// UpdateAll updates all rows with the specified column values, using an executor.</span>
<a id="__codelineno-44-2" name="__codelineno-44-2"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="nx">PointLogSlice</span><span class="p">)</span><span class="w"> </span><span class="nx">UpdateAll</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">cols</span><span class="w"> </span><span class="nx">M</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">int64</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-44-3" name="__codelineno-44-3"></a><span class="w">    </span><span class="nx">ln</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">int64</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">o</span><span class="p">))</span>
<a id="__codelineno-44-4" name="__codelineno-44-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">ln</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-44-5" name="__codelineno-44-5"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-44-6" name="__codelineno-44-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-44-7" name="__codelineno-44-7"></a>
<a id="__codelineno-44-8" name="__codelineno-44-8"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">cols</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-44-9" name="__codelineno-44-9"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;models: update all requires at least one column argument&quot;</span><span class="p">)</span>
<a id="__codelineno-44-10" name="__codelineno-44-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-44-11" name="__codelineno-44-11"></a>
<a id="__codelineno-44-12" name="__codelineno-44-12"></a><span class="w">    </span><span class="c1">// 以下、更新処理の実装...</span>
<a id="__codelineno-44-13" name="__codelineno-44-13"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_54">解説</h3>
<ul>
<li><strong>目的</strong>: <code>PointLog</code> のスライス（複数のレコード）に対して、一括で更新を行います。</li>
<li><strong>パラメータ</strong>:</li>
<li><code>cols M</code>: 更新するカラムと値のマップ。</li>
</ul>
<h4 id="_55">処理の流れ</h4>
<ol>
<li><strong>レコード数の確認</strong>:</li>
<li>スライスが空の場合は、何もせずに終了します。</li>
<li><strong>更新カラムの確認</strong>:</li>
<li>更新するカラムが指定されていない場合、エラーを返します。</li>
<li><strong>更新クエリの構築</strong>:</li>
<li>更新するカラム名と値を準備します。</li>
<li>プライマリキーを使用して、各レコードを特定するための条件を構築します。</li>
<li><strong>クエリの実行</strong>:</li>
<li>構築したクエリを実行し、更新された行数を取得します。</li>
</ol>
<h3 id="_56">利用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-45-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-45-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-45-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-45-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-45-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-45-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-45-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-45-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-45-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-45-10">10</a></span>
<span class="normal"><a href="#__codelineno-45-11">11</a></span>
<span class="normal"><a href="#__codelineno-45-12">12</a></span>
<span class="normal"><a href="#__codelineno-45-13">13</a></span>
<span class="normal"><a href="#__codelineno-45-14">14</a></span>
<span class="normal"><a href="#__codelineno-45-15">15</a></span>
<span class="normal"><a href="#__codelineno-45-16">16</a></span>
<span class="normal"><a href="#__codelineno-45-17">17</a></span>
<span class="normal"><a href="#__codelineno-45-18">18</a></span>
<span class="normal"><a href="#__codelineno-45-19">19</a></span>
<span class="normal"><a href="#__codelineno-45-20">20</a></span>
<span class="normal"><a href="#__codelineno-45-21">21</a></span>
<span class="normal"><a href="#__codelineno-45-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-45-2" name="__codelineno-45-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-45-3" name="__codelineno-45-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-45-4" name="__codelineno-45-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-45-5" name="__codelineno-45-5"></a><span class="p">}</span>
<a id="__codelineno-45-6" name="__codelineno-45-6"></a><span class="k">defer</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-45-7" name="__codelineno-45-7"></a>
<a id="__codelineno-45-8" name="__codelineno-45-8"></a><span class="c1">// PointLogのスライスを取得</span>
<a id="__codelineno-45-9" name="__codelineno-45-9"></a><span class="nx">pointLogs</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">PointLogs</span><span class="p">(</span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;user_id = ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">123</span><span class="p">)).</span><span class="nx">All</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-45-10" name="__codelineno-45-10"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-45-11" name="__codelineno-45-11"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-45-12" name="__codelineno-45-12"></a><span class="p">}</span>
<a id="__codelineno-45-13" name="__codelineno-45-13"></a>
<a id="__codelineno-45-14" name="__codelineno-45-14"></a><span class="c1">// スライス内の全てのPointLogのポイントを300に更新</span>
<a id="__codelineno-45-15" name="__codelineno-45-15"></a><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">pointLogs</span><span class="p">.</span><span class="nx">UpdateAll</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">M</span><span class="p">{</span>
<a id="__codelineno-45-16" name="__codelineno-45-16"></a><span class="w">    </span><span class="s">&quot;points&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span>
<a id="__codelineno-45-17" name="__codelineno-45-17"></a><span class="p">})</span>
<a id="__codelineno-45-18" name="__codelineno-45-18"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-45-19" name="__codelineno-45-19"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-45-20" name="__codelineno-45-20"></a><span class="p">}</span>
<a id="__codelineno-45-21" name="__codelineno-45-21"></a>
<a id="__codelineno-45-22" name="__codelineno-45-22"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Updated %d rows.\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">rowsAff</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="upsert"><code>Upsert</code> 関数</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-46-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-46-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-46-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-46-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-46-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-46-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-46-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-46-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-46-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-46-10">10</a></span>
<span class="normal"><a href="#__codelineno-46-11">11</a></span>
<span class="normal"><a href="#__codelineno-46-12">12</a></span>
<span class="normal"><a href="#__codelineno-46-13">13</a></span>
<span class="normal"><a href="#__codelineno-46-14">14</a></span>
<span class="normal"><a href="#__codelineno-46-15">15</a></span>
<span class="normal"><a href="#__codelineno-46-16">16</a></span>
<span class="normal"><a href="#__codelineno-46-17">17</a></span>
<span class="normal"><a href="#__codelineno-46-18">18</a></span>
<span class="normal"><a href="#__codelineno-46-19">19</a></span>
<span class="normal"><a href="#__codelineno-46-20">20</a></span>
<span class="normal"><a href="#__codelineno-46-21">21</a></span>
<span class="normal"><a href="#__codelineno-46-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">mySQLPointLogUniqueColumns</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{}</span>
<a id="__codelineno-46-2" name="__codelineno-46-2"></a>
<a id="__codelineno-46-3" name="__codelineno-46-3"></a><span class="c1">// Upsert attempts an insert using an executor, and does an update or ignore on conflict.</span>
<a id="__codelineno-46-4" name="__codelineno-46-4"></a><span class="c1">// See boil.Columns documentation for how to properly use updateColumns and insertColumns.</span>
<a id="__codelineno-46-5" name="__codelineno-46-5"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">PointLog</span><span class="p">)</span><span class="w"> </span><span class="nx">Upsert</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">updateColumns</span><span class="p">,</span><span class="w"> </span><span class="nx">insertColumns</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">Columns</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-46-6" name="__codelineno-46-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">o</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-46-7" name="__codelineno-46-7"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;models: no point_logs provided for upsert&quot;</span><span class="p">)</span>
<a id="__codelineno-46-8" name="__codelineno-46-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-46-9" name="__codelineno-46-9"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">boil</span><span class="p">.</span><span class="nx">TimestampsAreSkipped</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-46-10" name="__codelineno-46-10"></a><span class="w">        </span><span class="nx">currTime</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">In</span><span class="p">(</span><span class="nx">boil</span><span class="p">.</span><span class="nx">GetLocation</span><span class="p">())</span>
<a id="__codelineno-46-11" name="__codelineno-46-11"></a>
<a id="__codelineno-46-12" name="__codelineno-46-12"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">CreatedAt</span><span class="p">.</span><span class="nx">IsZero</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-46-13" name="__codelineno-46-13"></a><span class="w">            </span><span class="nx">o</span><span class="p">.</span><span class="nx">CreatedAt</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">currTime</span>
<a id="__codelineno-46-14" name="__codelineno-46-14"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-46-15" name="__codelineno-46-15"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-46-16" name="__codelineno-46-16"></a>
<a id="__codelineno-46-17" name="__codelineno-46-17"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">doBeforeUpsertHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-46-18" name="__codelineno-46-18"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-46-19" name="__codelineno-46-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-46-20" name="__codelineno-46-20"></a>
<a id="__codelineno-46-21" name="__codelineno-46-21"></a><span class="w">    </span><span class="c1">// 以下、Upsert処理の実装...</span>
<a id="__codelineno-46-22" name="__codelineno-46-22"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_57">解説</h3>
<ul>
<li><strong>目的</strong>: <code>PointLog</code> オブジェクトを挿入し、ユニーク制約に違反する場合は更新または無視します。</li>
<li><strong>パラメータ</strong>:</li>
<li><code>updateColumns boil.Columns</code>: 更新するカラムを指定します。</li>
<li><code>insertColumns boil.Columns</code>: 挿入するカラムを指定します。</li>
</ul>
<h4 id="_58">処理の流れ</h4>
<ol>
<li><strong>チェックと初期設定</strong>:</li>
<li>オブジェクトが <code>nil</code> でないか確認。</li>
<li>タイムスタンプの設定。</li>
<li><strong>BeforeUpsert フックの実行</strong>:</li>
<li>Upsert 前のフックがあれば実行。</li>
<li><strong>ユニークカラムの確認</strong>:</li>
<li><code>mySQLPointLogUniqueColumns</code> に基づいて、ユニークなカラムを確認。</li>
<li>ユニークカラムが設定されていない場合、エラーを返します。</li>
<li><strong>キャッシュキーの作成とクエリの構築</strong>:</li>
<li>クエリをキャッシュしてパフォーマンスを向上させます。</li>
<li><code>INSERT</code> クエリと <code>ON DUPLICATE KEY UPDATE</code> 部分を構築します。</li>
<li><strong>クエリの実行</strong>:</li>
<li>クエリを実行し、必要に応じてデフォルト値を取得します。</li>
<li><strong>AfterUpsert フックの実行</strong>:</li>
<li>Upsert 後のフックがあれば実行。</li>
</ol>
<h3 id="_59">注意点</h3>
<ul>
<li>このコードでは、<code>mySQLPointLogUniqueColumns</code> が空のため、ユニークカラムが存在しないため、エラーが発生します。</li>
<li>正しく動作させるためには、ユニーク制約を持つカラムを <code>mySQLPointLogUniqueColumns</code> に設定する必要があります。</li>
</ul>
<h3 id="_60">利用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-47-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-47-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-47-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-47-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-47-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-47-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-47-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-47-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-47-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-47-10">10</a></span>
<span class="normal"><a href="#__codelineno-47-11">11</a></span>
<span class="normal"><a href="#__codelineno-47-12">12</a></span>
<span class="normal"><a href="#__codelineno-47-13">13</a></span>
<span class="normal"><a href="#__codelineno-47-14">14</a></span>
<span class="normal"><a href="#__codelineno-47-15">15</a></span>
<span class="normal"><a href="#__codelineno-47-16">16</a></span>
<span class="normal"><a href="#__codelineno-47-17">17</a></span>
<span class="normal"><a href="#__codelineno-47-18">18</a></span>
<span class="normal"><a href="#__codelineno-47-19">19</a></span>
<span class="normal"><a href="#__codelineno-47-20">20</a></span>
<span class="normal"><a href="#__codelineno-47-21">21</a></span>
<span class="normal"><a href="#__codelineno-47-22">22</a></span>
<span class="normal"><a href="#__codelineno-47-23">23</a></span>
<span class="normal"><a href="#__codelineno-47-24">24</a></span>
<span class="normal"><a href="#__codelineno-47-25">25</a></span>
<span class="normal"><a href="#__codelineno-47-26">26</a></span>
<span class="normal"><a href="#__codelineno-47-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1"></a><span class="c1">// 例として、ユニークカラムを設定</span>
<a id="__codelineno-47-2" name="__codelineno-47-2"></a><span class="kd">var</span><span class="w"> </span><span class="nx">mySQLPointLogUniqueColumns</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;user_id&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;created_at&quot;</span><span class="p">}</span>
<a id="__codelineno-47-3" name="__codelineno-47-3"></a>
<a id="__codelineno-47-4" name="__codelineno-47-4"></a><span class="c1">// 以下、Upsertの利用例</span>
<a id="__codelineno-47-5" name="__codelineno-47-5"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-47-6" name="__codelineno-47-6"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-47-7" name="__codelineno-47-7"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-47-8" name="__codelineno-47-8"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-47-9" name="__codelineno-47-9"></a><span class="p">}</span>
<a id="__codelineno-47-10" name="__codelineno-47-10"></a><span class="k">defer</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-47-11" name="__codelineno-47-11"></a>
<a id="__codelineno-47-12" name="__codelineno-47-12"></a><span class="nx">pointLog</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">PointLog</span><span class="p">{</span>
<a id="__codelineno-47-13" name="__codelineno-47-13"></a><span class="w">    </span><span class="nx">UserID</span><span class="p">:</span><span class="w">    </span><span class="mi">123</span><span class="p">,</span>
<a id="__codelineno-47-14" name="__codelineno-47-14"></a><span class="w">    </span><span class="nx">CreatedAt</span><span class="p">:</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">(),</span>
<a id="__codelineno-47-15" name="__codelineno-47-15"></a><span class="w">    </span><span class="nx">Points</span><span class="p">:</span><span class="w">    </span><span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-47-16" name="__codelineno-47-16"></a><span class="p">}</span>
<a id="__codelineno-47-17" name="__codelineno-47-17"></a>
<a id="__codelineno-47-18" name="__codelineno-47-18"></a><span class="c1">// 挿入するカラムと更新するカラムを指定</span>
<a id="__codelineno-47-19" name="__codelineno-47-19"></a><span class="nx">insertCols</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">Whitelist</span><span class="p">(</span><span class="s">&quot;user_id&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;created_at&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;points&quot;</span><span class="p">)</span>
<a id="__codelineno-47-20" name="__codelineno-47-20"></a><span class="nx">updateCols</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">Whitelist</span><span class="p">(</span><span class="s">&quot;points&quot;</span><span class="p">)</span>
<a id="__codelineno-47-21" name="__codelineno-47-21"></a>
<a id="__codelineno-47-22" name="__codelineno-47-22"></a><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">pointLog</span><span class="p">.</span><span class="nx">Upsert</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">updateCols</span><span class="p">,</span><span class="w"> </span><span class="nx">insertCols</span><span class="p">)</span>
<a id="__codelineno-47-23" name="__codelineno-47-23"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-47-24" name="__codelineno-47-24"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-47-25" name="__codelineno-47-25"></a><span class="p">}</span>
<a id="__codelineno-47-26" name="__codelineno-47-26"></a>
<a id="__codelineno-47-27" name="__codelineno-47-27"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Upsert completed.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="delete"><code>Delete</code> 関数</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-48-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-48-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-48-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-48-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-48-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-48-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-48-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-48-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-48-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-48-10">10</a></span>
<span class="normal"><a href="#__codelineno-48-11">11</a></span>
<span class="normal"><a href="#__codelineno-48-12">12</a></span>
<span class="normal"><a href="#__codelineno-48-13">13</a></span>
<span class="normal"><a href="#__codelineno-48-14">14</a></span>
<span class="normal"><a href="#__codelineno-48-15">15</a></span>
<span class="normal"><a href="#__codelineno-48-16">16</a></span>
<span class="normal"><a href="#__codelineno-48-17">17</a></span>
<span class="normal"><a href="#__codelineno-48-18">18</a></span>
<span class="normal"><a href="#__codelineno-48-19">19</a></span>
<span class="normal"><a href="#__codelineno-48-20">20</a></span>
<span class="normal"><a href="#__codelineno-48-21">21</a></span>
<span class="normal"><a href="#__codelineno-48-22">22</a></span>
<span class="normal"><a href="#__codelineno-48-23">23</a></span>
<span class="normal"><a href="#__codelineno-48-24">24</a></span>
<span class="normal"><a href="#__codelineno-48-25">25</a></span>
<span class="normal"><a href="#__codelineno-48-26">26</a></span>
<span class="normal"><a href="#__codelineno-48-27">27</a></span>
<span class="normal"><a href="#__codelineno-48-28">28</a></span>
<span class="normal"><a href="#__codelineno-48-29">29</a></span>
<span class="normal"><a href="#__codelineno-48-30">30</a></span>
<span class="normal"><a href="#__codelineno-48-31">31</a></span>
<span class="normal"><a href="#__codelineno-48-32">32</a></span>
<span class="normal"><a href="#__codelineno-48-33">33</a></span>
<span class="normal"><a href="#__codelineno-48-34">34</a></span>
<span class="normal"><a href="#__codelineno-48-35">35</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1"></a><span class="c1">// Delete deletes a single PointLog record with an executor.</span>
<a id="__codelineno-48-2" name="__codelineno-48-2"></a><span class="c1">// Delete will match against the primary key column to find the record to delete.</span>
<a id="__codelineno-48-3" name="__codelineno-48-3"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">PointLog</span><span class="p">)</span><span class="w"> </span><span class="nx">Delete</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">int64</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-48-4" name="__codelineno-48-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">o</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-48-5" name="__codelineno-48-5"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;models: no PointLog provided for delete&quot;</span><span class="p">)</span>
<a id="__codelineno-48-6" name="__codelineno-48-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-48-7" name="__codelineno-48-7"></a>
<a id="__codelineno-48-8" name="__codelineno-48-8"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">doBeforeDeleteHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-48-9" name="__codelineno-48-9"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-48-10" name="__codelineno-48-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-48-11" name="__codelineno-48-11"></a>
<a id="__codelineno-48-12" name="__codelineno-48-12"></a><span class="w">    </span><span class="nx">args</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">ValuesFromMapping</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">Indirect</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="nx">o</span><span class="p">)),</span><span class="w"> </span><span class="nx">pointLogPrimaryKeyMapping</span><span class="p">)</span>
<a id="__codelineno-48-13" name="__codelineno-48-13"></a><span class="w">    </span><span class="nx">sql</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;DELETE FROM `point_logs` WHERE `created_at`=? AND `user_id`=?&quot;</span>
<a id="__codelineno-48-14" name="__codelineno-48-14"></a>
<a id="__codelineno-48-15" name="__codelineno-48-15"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">IsDebug</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-48-16" name="__codelineno-48-16"></a><span class="w">        </span><span class="nx">writer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">DebugWriterFrom</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<a id="__codelineno-48-17" name="__codelineno-48-17"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">)</span>
<a id="__codelineno-48-18" name="__codelineno-48-18"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-48-19" name="__codelineno-48-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-48-20" name="__codelineno-48-20"></a><span class="w">    </span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">exec</span><span class="p">.</span><span class="nx">ExecContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-48-21" name="__codelineno-48-21"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-48-22" name="__codelineno-48-22"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to delete from point_logs&quot;</span><span class="p">)</span>
<a id="__codelineno-48-23" name="__codelineno-48-23"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-48-24" name="__codelineno-48-24"></a>
<a id="__codelineno-48-25" name="__codelineno-48-25"></a><span class="w">    </span><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">RowsAffected</span><span class="p">()</span>
<a id="__codelineno-48-26" name="__codelineno-48-26"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-48-27" name="__codelineno-48-27"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: failed to get rows affected by delete for point_logs&quot;</span><span class="p">)</span>
<a id="__codelineno-48-28" name="__codelineno-48-28"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-48-29" name="__codelineno-48-29"></a>
<a id="__codelineno-48-30" name="__codelineno-48-30"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">doAfterDeleteHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-48-31" name="__codelineno-48-31"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-48-32" name="__codelineno-48-32"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-48-33" name="__codelineno-48-33"></a>
<a id="__codelineno-48-34" name="__codelineno-48-34"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-48-35" name="__codelineno-48-35"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_61">解説</h3>
<ul>
<li><strong>目的</strong>: <code>PointLog</code> オブジェクトに対応するデータベース上のレコードを削除します。</li>
<li><strong>戻り値</strong>:</li>
<li><code>int64</code>: 削除された行数を返します。</li>
</ul>
<h4 id="_62">処理の流れ</h4>
<ol>
<li><strong>チェック</strong>:</li>
<li>オブジェクトが <code>nil</code> でないか確認します。</li>
<li><strong>BeforeDelete フックの実行</strong>:</li>
<li>削除前のフックがあれば実行します。</li>
<li><strong>削除クエリの構築</strong>:</li>
<li>プライマリキー（<code>created_at</code> と <code>user_id</code>）を使用して、削除クエリを構築します。</li>
<li><strong>クエリの実行</strong>:</li>
<li>構築したクエリを実行し、結果を取得します。</li>
<li><strong>削除された行数の取得</strong>:</li>
<li><code>result.RowsAffected()</code> で削除された行数を取得します。</li>
<li><strong>AfterDelete フックの実行</strong>:</li>
<li>削除後のフックがあれば実行します。</li>
</ol>
<h3 id="_63">利用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-49-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-49-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-49-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-49-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-49-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-49-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-49-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-49-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-49-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-49-10">10</a></span>
<span class="normal"><a href="#__codelineno-49-11">11</a></span>
<span class="normal"><a href="#__codelineno-49-12">12</a></span>
<span class="normal"><a href="#__codelineno-49-13">13</a></span>
<span class="normal"><a href="#__codelineno-49-14">14</a></span>
<span class="normal"><a href="#__codelineno-49-15">15</a></span>
<span class="normal"><a href="#__codelineno-49-16">16</a></span>
<span class="normal"><a href="#__codelineno-49-17">17</a></span>
<span class="normal"><a href="#__codelineno-49-18">18</a></span>
<span class="normal"><a href="#__codelineno-49-19">19</a></span>
<span class="normal"><a href="#__codelineno-49-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-49-2" name="__codelineno-49-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-49-3" name="__codelineno-49-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-49-4" name="__codelineno-49-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-49-5" name="__codelineno-49-5"></a><span class="p">}</span>
<a id="__codelineno-49-6" name="__codelineno-49-6"></a><span class="k">defer</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-49-7" name="__codelineno-49-7"></a>
<a id="__codelineno-49-8" name="__codelineno-49-8"></a><span class="c1">// 削除したいPointLogを取得</span>
<a id="__codelineno-49-9" name="__codelineno-49-9"></a><span class="nx">pointLog</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">FindPointLog</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">someTime</span><span class="p">,</span><span class="w"> </span><span class="nx">someUserID</span><span class="p">)</span>
<a id="__codelineno-49-10" name="__codelineno-49-10"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-49-11" name="__codelineno-49-11"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-49-12" name="__codelineno-49-12"></a><span class="p">}</span>
<a id="__codelineno-49-13" name="__codelineno-49-13"></a>
<a id="__codelineno-49-14" name="__codelineno-49-14"></a><span class="c1">// 削除を実行</span>
<a id="__codelineno-49-15" name="__codelineno-49-15"></a><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">pointLog</span><span class="p">.</span><span class="nx">Delete</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-49-16" name="__codelineno-49-16"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-49-17" name="__codelineno-49-17"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-49-18" name="__codelineno-49-18"></a><span class="p">}</span>
<a id="__codelineno-49-19" name="__codelineno-49-19"></a>
<a id="__codelineno-49-20" name="__codelineno-49-20"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Deleted %d rows.\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">rowsAff</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="deleteall"><code>DeleteAll</code> 関数（クエリ用）</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-50-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-50-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-50-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-50-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-50-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-50-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-50-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-50-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-50-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-50-10">10</a></span>
<span class="normal"><a href="#__codelineno-50-11">11</a></span>
<span class="normal"><a href="#__codelineno-50-12">12</a></span>
<span class="normal"><a href="#__codelineno-50-13">13</a></span>
<span class="normal"><a href="#__codelineno-50-14">14</a></span>
<span class="normal"><a href="#__codelineno-50-15">15</a></span>
<span class="normal"><a href="#__codelineno-50-16">16</a></span>
<span class="normal"><a href="#__codelineno-50-17">17</a></span>
<span class="normal"><a href="#__codelineno-50-18">18</a></span>
<span class="normal"><a href="#__codelineno-50-19">19</a></span>
<span class="normal"><a href="#__codelineno-50-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1"></a><span class="c1">// DeleteAll deletes all matching rows.</span>
<a id="__codelineno-50-2" name="__codelineno-50-2"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">q</span><span class="w"> </span><span class="nx">pointLogQuery</span><span class="p">)</span><span class="w"> </span><span class="nx">DeleteAll</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">int64</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-50-3" name="__codelineno-50-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-50-4" name="__codelineno-50-4"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;models: no pointLogQuery provided for delete all&quot;</span><span class="p">)</span>
<a id="__codelineno-50-5" name="__codelineno-50-5"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-50-6" name="__codelineno-50-6"></a>
<a id="__codelineno-50-7" name="__codelineno-50-7"></a><span class="w">    </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetDelete</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">)</span>
<a id="__codelineno-50-8" name="__codelineno-50-8"></a>
<a id="__codelineno-50-9" name="__codelineno-50-9"></a><span class="w">    </span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">.</span><span class="nx">ExecContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">)</span>
<a id="__codelineno-50-10" name="__codelineno-50-10"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-50-11" name="__codelineno-50-11"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to delete all from point_logs&quot;</span><span class="p">)</span>
<a id="__codelineno-50-12" name="__codelineno-50-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-50-13" name="__codelineno-50-13"></a>
<a id="__codelineno-50-14" name="__codelineno-50-14"></a><span class="w">    </span><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">RowsAffected</span><span class="p">()</span>
<a id="__codelineno-50-15" name="__codelineno-50-15"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-50-16" name="__codelineno-50-16"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: failed to get rows affected by deleteall for point_logs&quot;</span><span class="p">)</span>
<a id="__codelineno-50-17" name="__codelineno-50-17"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-50-18" name="__codelineno-50-18"></a>
<a id="__codelineno-50-19" name="__codelineno-50-19"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-50-20" name="__codelineno-50-20"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_64">解説</h3>
<ul>
<li><strong>目的</strong>: <code>pointLogQuery</code> に基づいて、条件に一致するすべての <code>PointLog</code> レコードを削除します。</li>
<li><strong>パラメータ</strong>:</li>
<li><code>ctx context.Context</code>: コンテキストを渡します。</li>
<li><code>exec boil.ContextExecutor</code>: データベース操作を実行するエグゼキュータです。</li>
<li><strong>戻り値</strong>:</li>
<li><code>int64</code>: 削除された行数を返します。</li>
<li><code>error</code>: エラー情報を返します。</li>
</ul>
<h4 id="_65">処理の流れ</h4>
<ol>
<li><strong>クエリの検証</strong>:</li>
<li>クエリが <code>nil</code> でないか確認します。</li>
<li>
<p><code>nil</code> の場合、エラーを返します。</p>
</li>
<li>
<p><strong>削除クエリの設定</strong>:</p>
</li>
<li>
<p><code>queries.SetDelete(q.Query)</code> を使用して、クエリを削除操作に設定します。</p>
</li>
<li>
<p><strong>クエリの実行</strong>:</p>
</li>
<li>
<p><code>q.Query.ExecContext(ctx, exec)</code> を使用してクエリを実行し、結果を取得します。</p>
</li>
<li>
<p><strong>削除された行数の取得</strong>:</p>
</li>
<li>
<p><code>result.RowsAffected()</code> を使用して、削除された行数を取得します。</p>
</li>
<li>
<p><strong>結果の返却</strong>:</p>
</li>
<li>削除された行数とエラー情報を返します。</li>
</ol>
<h3 id="_66">利用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-51-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-51-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-51-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-51-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-51-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-51-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-51-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-51-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-51-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-51-10">10</a></span>
<span class="normal"><a href="#__codelineno-51-11">11</a></span>
<span class="normal"><a href="#__codelineno-51-12">12</a></span>
<span class="normal"><a href="#__codelineno-51-13">13</a></span>
<span class="normal"><a href="#__codelineno-51-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-51-2" name="__codelineno-51-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-51-3" name="__codelineno-51-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-51-4" name="__codelineno-51-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-51-5" name="__codelineno-51-5"></a><span class="p">}</span>
<a id="__codelineno-51-6" name="__codelineno-51-6"></a><span class="k">defer</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-51-7" name="__codelineno-51-7"></a>
<a id="__codelineno-51-8" name="__codelineno-51-8"></a><span class="c1">// 条件に一致するPointLogをすべて削除（例：user_idが123のレコード）</span>
<a id="__codelineno-51-9" name="__codelineno-51-9"></a><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">PointLogs</span><span class="p">(</span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;user_id = ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">123</span><span class="p">)).</span><span class="nx">DeleteAll</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-51-10" name="__codelineno-51-10"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-51-11" name="__codelineno-51-11"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-51-12" name="__codelineno-51-12"></a><span class="p">}</span>
<a id="__codelineno-51-13" name="__codelineno-51-13"></a>
<a id="__codelineno-51-14" name="__codelineno-51-14"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Deleted %d rows.\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">rowsAff</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="deleteall_1"><code>DeleteAll</code> 関数（スライス用）</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-52-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-52-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-52-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-52-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-52-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-52-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-52-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-52-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-52-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-52-10">10</a></span>
<span class="normal"><a href="#__codelineno-52-11">11</a></span>
<span class="normal"><a href="#__codelineno-52-12">12</a></span>
<span class="normal"><a href="#__codelineno-52-13">13</a></span>
<span class="normal"><a href="#__codelineno-52-14">14</a></span>
<span class="normal"><a href="#__codelineno-52-15">15</a></span>
<span class="normal"><a href="#__codelineno-52-16">16</a></span>
<span class="normal"><a href="#__codelineno-52-17">17</a></span>
<span class="normal"><a href="#__codelineno-52-18">18</a></span>
<span class="normal"><a href="#__codelineno-52-19">19</a></span>
<span class="normal"><a href="#__codelineno-52-20">20</a></span>
<span class="normal"><a href="#__codelineno-52-21">21</a></span>
<span class="normal"><a href="#__codelineno-52-22">22</a></span>
<span class="normal"><a href="#__codelineno-52-23">23</a></span>
<span class="normal"><a href="#__codelineno-52-24">24</a></span>
<span class="normal"><a href="#__codelineno-52-25">25</a></span>
<span class="normal"><a href="#__codelineno-52-26">26</a></span>
<span class="normal"><a href="#__codelineno-52-27">27</a></span>
<span class="normal"><a href="#__codelineno-52-28">28</a></span>
<span class="normal"><a href="#__codelineno-52-29">29</a></span>
<span class="normal"><a href="#__codelineno-52-30">30</a></span>
<span class="normal"><a href="#__codelineno-52-31">31</a></span>
<span class="normal"><a href="#__codelineno-52-32">32</a></span>
<span class="normal"><a href="#__codelineno-52-33">33</a></span>
<span class="normal"><a href="#__codelineno-52-34">34</a></span>
<span class="normal"><a href="#__codelineno-52-35">35</a></span>
<span class="normal"><a href="#__codelineno-52-36">36</a></span>
<span class="normal"><a href="#__codelineno-52-37">37</a></span>
<span class="normal"><a href="#__codelineno-52-38">38</a></span>
<span class="normal"><a href="#__codelineno-52-39">39</a></span>
<span class="normal"><a href="#__codelineno-52-40">40</a></span>
<span class="normal"><a href="#__codelineno-52-41">41</a></span>
<span class="normal"><a href="#__codelineno-52-42">42</a></span>
<span class="normal"><a href="#__codelineno-52-43">43</a></span>
<span class="normal"><a href="#__codelineno-52-44">44</a></span>
<span class="normal"><a href="#__codelineno-52-45">45</a></span>
<span class="normal"><a href="#__codelineno-52-46">46</a></span>
<span class="normal"><a href="#__codelineno-52-47">47</a></span>
<span class="normal"><a href="#__codelineno-52-48">48</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1"></a><span class="c1">// DeleteAll deletes all rows in the slice, using an executor.</span>
<a id="__codelineno-52-2" name="__codelineno-52-2"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="nx">PointLogSlice</span><span class="p">)</span><span class="w"> </span><span class="nx">DeleteAll</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">int64</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-52-3" name="__codelineno-52-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-52-4" name="__codelineno-52-4"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-52-5" name="__codelineno-52-5"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-52-6" name="__codelineno-52-6"></a>
<a id="__codelineno-52-7" name="__codelineno-52-7"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">pointLogBeforeDeleteHooks</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-52-8" name="__codelineno-52-8"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">o</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-52-9" name="__codelineno-52-9"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">obj</span><span class="p">.</span><span class="nx">doBeforeDeleteHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-52-10" name="__codelineno-52-10"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-52-11" name="__codelineno-52-11"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-52-12" name="__codelineno-52-12"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-52-13" name="__codelineno-52-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-52-14" name="__codelineno-52-14"></a>
<a id="__codelineno-52-15" name="__codelineno-52-15"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">args</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}</span>
<a id="__codelineno-52-16" name="__codelineno-52-16"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">o</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-52-17" name="__codelineno-52-17"></a><span class="w">        </span><span class="nx">pkeyArgs</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">ValuesFromMapping</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">Indirect</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="nx">obj</span><span class="p">)),</span><span class="w"> </span><span class="nx">pointLogPrimaryKeyMapping</span><span class="p">)</span>
<a id="__codelineno-52-18" name="__codelineno-52-18"></a><span class="w">        </span><span class="nx">args</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span><span class="w"> </span><span class="nx">pkeyArgs</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-52-19" name="__codelineno-52-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-52-20" name="__codelineno-52-20"></a>
<a id="__codelineno-52-21" name="__codelineno-52-21"></a><span class="w">    </span><span class="nx">sql</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;DELETE FROM `point_logs` WHERE &quot;</span><span class="w"> </span><span class="o">+</span>
<a id="__codelineno-52-22" name="__codelineno-52-22"></a><span class="w">        </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">WhereClauseRepeated</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">dialect</span><span class="p">.</span><span class="nx">LQ</span><span class="p">),</span><span class="w"> </span><span class="nb">string</span><span class="p">(</span><span class="nx">dialect</span><span class="p">.</span><span class="nx">RQ</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">pointLogPrimaryKeyColumns</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">o</span><span class="p">))</span>
<a id="__codelineno-52-23" name="__codelineno-52-23"></a>
<a id="__codelineno-52-24" name="__codelineno-52-24"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">IsDebug</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-52-25" name="__codelineno-52-25"></a><span class="w">        </span><span class="nx">writer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">DebugWriterFrom</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<a id="__codelineno-52-26" name="__codelineno-52-26"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">)</span>
<a id="__codelineno-52-27" name="__codelineno-52-27"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">)</span>
<a id="__codelineno-52-28" name="__codelineno-52-28"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-52-29" name="__codelineno-52-29"></a><span class="w">    </span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">exec</span><span class="p">.</span><span class="nx">ExecContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-52-30" name="__codelineno-52-30"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-52-31" name="__codelineno-52-31"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to delete all from pointLog slice&quot;</span><span class="p">)</span>
<a id="__codelineno-52-32" name="__codelineno-52-32"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-52-33" name="__codelineno-52-33"></a>
<a id="__codelineno-52-34" name="__codelineno-52-34"></a><span class="w">    </span><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">RowsAffected</span><span class="p">()</span>
<a id="__codelineno-52-35" name="__codelineno-52-35"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-52-36" name="__codelineno-52-36"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: failed to get rows affected by deleteall for point_logs&quot;</span><span class="p">)</span>
<a id="__codelineno-52-37" name="__codelineno-52-37"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-52-38" name="__codelineno-52-38"></a>
<a id="__codelineno-52-39" name="__codelineno-52-39"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">pointLogAfterDeleteHooks</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-52-40" name="__codelineno-52-40"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">o</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-52-41" name="__codelineno-52-41"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">obj</span><span class="p">.</span><span class="nx">doAfterDeleteHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-52-42" name="__codelineno-52-42"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-52-43" name="__codelineno-52-43"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-52-44" name="__codelineno-52-44"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-52-45" name="__codelineno-52-45"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-52-46" name="__codelineno-52-46"></a>
<a id="__codelineno-52-47" name="__codelineno-52-47"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-52-48" name="__codelineno-52-48"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_67">解説</h3>
<ul>
<li><strong>目的</strong>: <code>PointLogSlice</code>（<code>PointLog</code> のスライス）に含まれるすべてのオブジェクトに対応するデータベース上のレコードを削除します。</li>
<li><strong>パラメータ</strong>:</li>
<li><code>o PointLogSlice</code>: 削除対象の <code>PointLog</code> オブジェクトのスライス。</li>
</ul>
<h4 id="_68">処理の流れ</h4>
<ol>
<li><strong>スライスの検証</strong>:</li>
<li>
<p>スライスの長さが0であれば、何もせずに終了します。</p>
</li>
<li>
<p><strong>BeforeDelete フックの実行</strong>:</p>
</li>
<li>
<p>削除前のフックがあれば、各オブジェクトに対して実行します。</p>
</li>
<li>
<p><strong>削除クエリの構築</strong>:</p>
</li>
<li>
<p>各オブジェクトのプライマリキーを収集し、削除クエリの条件を構築します。</p>
</li>
<li>
<p><strong>クエリの実行</strong>:</p>
</li>
<li>
<p>構築したクエリを実行し、結果を取得します。</p>
</li>
<li>
<p><strong>削除された行数の取得</strong>:</p>
</li>
<li>
<p><code>result.RowsAffected()</code> を使用して、削除された行数を取得します。</p>
</li>
<li>
<p><strong>AfterDelete フックの実行</strong>:</p>
</li>
<li>削除後のフックがあれば、各オブジェクトに対して実行します。</li>
</ol>
<h3 id="_69">利用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-53-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-53-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-53-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-53-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-53-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-53-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-53-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-53-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-53-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-53-10">10</a></span>
<span class="normal"><a href="#__codelineno-53-11">11</a></span>
<span class="normal"><a href="#__codelineno-53-12">12</a></span>
<span class="normal"><a href="#__codelineno-53-13">13</a></span>
<span class="normal"><a href="#__codelineno-53-14">14</a></span>
<span class="normal"><a href="#__codelineno-53-15">15</a></span>
<span class="normal"><a href="#__codelineno-53-16">16</a></span>
<span class="normal"><a href="#__codelineno-53-17">17</a></span>
<span class="normal"><a href="#__codelineno-53-18">18</a></span>
<span class="normal"><a href="#__codelineno-53-19">19</a></span>
<span class="normal"><a href="#__codelineno-53-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-53-2" name="__codelineno-53-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-53-3" name="__codelineno-53-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-53-4" name="__codelineno-53-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-53-5" name="__codelineno-53-5"></a><span class="p">}</span>
<a id="__codelineno-53-6" name="__codelineno-53-6"></a><span class="k">defer</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-53-7" name="__codelineno-53-7"></a>
<a id="__codelineno-53-8" name="__codelineno-53-8"></a><span class="c1">// 削除対象のPointLogを取得</span>
<a id="__codelineno-53-9" name="__codelineno-53-9"></a><span class="nx">pointLogs</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">PointLogs</span><span class="p">(</span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;user_id = ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">123</span><span class="p">)).</span><span class="nx">All</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-53-10" name="__codelineno-53-10"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-53-11" name="__codelineno-53-11"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-53-12" name="__codelineno-53-12"></a><span class="p">}</span>
<a id="__codelineno-53-13" name="__codelineno-53-13"></a>
<a id="__codelineno-53-14" name="__codelineno-53-14"></a><span class="c1">// スライス内のPointLogをすべて削除</span>
<a id="__codelineno-53-15" name="__codelineno-53-15"></a><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">pointLogs</span><span class="p">.</span><span class="nx">DeleteAll</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-53-16" name="__codelineno-53-16"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-53-17" name="__codelineno-53-17"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-53-18" name="__codelineno-53-18"></a><span class="p">}</span>
<a id="__codelineno-53-19" name="__codelineno-53-19"></a>
<a id="__codelineno-53-20" name="__codelineno-53-20"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Deleted %d rows.\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">rowsAff</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="reload"><code>Reload</code> 関数</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-54-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-54-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-54-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-54-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-54-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-54-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-54-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-54-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-54-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-54-10">10</a></span>
<span class="normal"><a href="#__codelineno-54-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1"></a><span class="c1">// Reload refetches the object from the database</span>
<a id="__codelineno-54-2" name="__codelineno-54-2"></a><span class="c1">// using the primary keys with an executor.</span>
<a id="__codelineno-54-3" name="__codelineno-54-3"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">PointLog</span><span class="p">)</span><span class="w"> </span><span class="nx">Reload</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-54-4" name="__codelineno-54-4"></a><span class="w">    </span><span class="nx">ret</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">FindPointLog</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">CreatedAt</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">UserID</span><span class="p">)</span>
<a id="__codelineno-54-5" name="__codelineno-54-5"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-54-6" name="__codelineno-54-6"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-54-7" name="__codelineno-54-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-54-8" name="__codelineno-54-8"></a>
<a id="__codelineno-54-9" name="__codelineno-54-9"></a><span class="w">    </span><span class="o">*</span><span class="nx">o</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">*</span><span class="nx">ret</span>
<a id="__codelineno-54-10" name="__codelineno-54-10"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-54-11" name="__codelineno-54-11"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_70">解説</h3>
<ul>
<li><strong>目的</strong>: <code>PointLog</code> オブジェクトのデータをデータベースから再取得し、オブジェクトを最新の状態に更新します。</li>
<li><strong>処理の流れ</strong>:</li>
<li><strong>データの再取得</strong>:<ul>
<li>現在のオブジェクトのプライマリキー（<code>CreatedAt</code> と <code>UserID</code>）を使用して、<code>FindPointLog</code> 関数でデータベースから最新のレコードを取得します。</li>
</ul>
</li>
<li><strong>オブジェクトの更新</strong>:<ul>
<li>取得したデータで現在のオブジェクトを更新します。</li>
</ul>
</li>
</ul>
<h3 id="_71">利用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-55-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-55-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-55-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-55-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-55-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-55-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-55-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-55-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-55-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-55-10">10</a></span>
<span class="normal"><a href="#__codelineno-55-11">11</a></span>
<span class="normal"><a href="#__codelineno-55-12">12</a></span>
<span class="normal"><a href="#__codelineno-55-13">13</a></span>
<span class="normal"><a href="#__codelineno-55-14">14</a></span>
<span class="normal"><a href="#__codelineno-55-15">15</a></span>
<span class="normal"><a href="#__codelineno-55-16">16</a></span>
<span class="normal"><a href="#__codelineno-55-17">17</a></span>
<span class="normal"><a href="#__codelineno-55-18">18</a></span>
<span class="normal"><a href="#__codelineno-55-19">19</a></span>
<span class="normal"><a href="#__codelineno-55-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-55-2" name="__codelineno-55-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-55-3" name="__codelineno-55-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-55-4" name="__codelineno-55-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-55-5" name="__codelineno-55-5"></a><span class="p">}</span>
<a id="__codelineno-55-6" name="__codelineno-55-6"></a><span class="k">defer</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-55-7" name="__codelineno-55-7"></a>
<a id="__codelineno-55-8" name="__codelineno-55-8"></a><span class="c1">// 既存のPointLogを取得</span>
<a id="__codelineno-55-9" name="__codelineno-55-9"></a><span class="nx">pointLog</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">FindPointLog</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">someTime</span><span class="p">,</span><span class="w"> </span><span class="nx">someUserID</span><span class="p">)</span>
<a id="__codelineno-55-10" name="__codelineno-55-10"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-55-11" name="__codelineno-55-11"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-55-12" name="__codelineno-55-12"></a><span class="p">}</span>
<a id="__codelineno-55-13" name="__codelineno-55-13"></a>
<a id="__codelineno-55-14" name="__codelineno-55-14"></a><span class="c1">// 他の処理でデータが更新されたと仮定して、オブジェクトをリロード</span>
<a id="__codelineno-55-15" name="__codelineno-55-15"></a><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">pointLog</span><span class="p">.</span><span class="nx">Reload</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-55-16" name="__codelineno-55-16"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-55-17" name="__codelineno-55-17"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-55-18" name="__codelineno-55-18"></a><span class="p">}</span>
<a id="__codelineno-55-19" name="__codelineno-55-19"></a>
<a id="__codelineno-55-20" name="__codelineno-55-20"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Reloaded PointLog: %+v\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">pointLog</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="reloadall"><code>ReloadAll</code> 関数</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-56-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-56-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-56-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-56-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-56-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-56-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-56-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-56-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-56-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-56-10">10</a></span>
<span class="normal"><a href="#__codelineno-56-11">11</a></span>
<span class="normal"><a href="#__codelineno-56-12">12</a></span>
<span class="normal"><a href="#__codelineno-56-13">13</a></span>
<span class="normal"><a href="#__codelineno-56-14">14</a></span>
<span class="normal"><a href="#__codelineno-56-15">15</a></span>
<span class="normal"><a href="#__codelineno-56-16">16</a></span>
<span class="normal"><a href="#__codelineno-56-17">17</a></span>
<span class="normal"><a href="#__codelineno-56-18">18</a></span>
<span class="normal"><a href="#__codelineno-56-19">19</a></span>
<span class="normal"><a href="#__codelineno-56-20">20</a></span>
<span class="normal"><a href="#__codelineno-56-21">21</a></span>
<span class="normal"><a href="#__codelineno-56-22">22</a></span>
<span class="normal"><a href="#__codelineno-56-23">23</a></span>
<span class="normal"><a href="#__codelineno-56-24">24</a></span>
<span class="normal"><a href="#__codelineno-56-25">25</a></span>
<span class="normal"><a href="#__codelineno-56-26">26</a></span>
<span class="normal"><a href="#__codelineno-56-27">27</a></span>
<span class="normal"><a href="#__codelineno-56-28">28</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1"></a><span class="c1">// ReloadAll refetches every row with matching primary key column values</span>
<a id="__codelineno-56-2" name="__codelineno-56-2"></a><span class="c1">// and overwrites the original object slice with the newly updated slice.</span>
<a id="__codelineno-56-3" name="__codelineno-56-3"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">PointLogSlice</span><span class="p">)</span><span class="w"> </span><span class="nx">ReloadAll</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-4" name="__codelineno-56-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">o</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="o">*</span><span class="nx">o</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-5" name="__codelineno-56-5"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-56-6" name="__codelineno-56-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-56-7" name="__codelineno-56-7"></a>
<a id="__codelineno-56-8" name="__codelineno-56-8"></a><span class="w">    </span><span class="nx">slice</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">PointLogSlice</span><span class="p">{}</span>
<a id="__codelineno-56-9" name="__codelineno-56-9"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">args</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}</span>
<a id="__codelineno-56-10" name="__codelineno-56-10"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="o">*</span><span class="nx">o</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-11" name="__codelineno-56-11"></a><span class="w">        </span><span class="nx">pkeyArgs</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">ValuesFromMapping</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">Indirect</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="nx">obj</span><span class="p">)),</span><span class="w"> </span><span class="nx">pointLogPrimaryKeyMapping</span><span class="p">)</span>
<a id="__codelineno-56-12" name="__codelineno-56-12"></a><span class="w">        </span><span class="nx">args</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span><span class="w"> </span><span class="nx">pkeyArgs</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-56-13" name="__codelineno-56-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-56-14" name="__codelineno-56-14"></a>
<a id="__codelineno-56-15" name="__codelineno-56-15"></a><span class="w">    </span><span class="nx">sql</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;SELECT `point_logs`.* FROM `point_logs` WHERE &quot;</span><span class="w"> </span><span class="o">+</span>
<a id="__codelineno-56-16" name="__codelineno-56-16"></a><span class="w">        </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">WhereClauseRepeated</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">dialect</span><span class="p">.</span><span class="nx">LQ</span><span class="p">),</span><span class="w"> </span><span class="nb">string</span><span class="p">(</span><span class="nx">dialect</span><span class="p">.</span><span class="nx">RQ</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">pointLogPrimaryKeyColumns</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="o">*</span><span class="nx">o</span><span class="p">))</span>
<a id="__codelineno-56-17" name="__codelineno-56-17"></a>
<a id="__codelineno-56-18" name="__codelineno-56-18"></a><span class="w">    </span><span class="nx">q</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">Raw</span><span class="p">(</span><span class="nx">sql</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-56-19" name="__codelineno-56-19"></a>
<a id="__codelineno-56-20" name="__codelineno-56-20"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">q</span><span class="p">.</span><span class="nx">Bind</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">slice</span><span class="p">)</span>
<a id="__codelineno-56-21" name="__codelineno-56-21"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-22" name="__codelineno-56-22"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to reload all in PointLogSlice&quot;</span><span class="p">)</span>
<a id="__codelineno-56-23" name="__codelineno-56-23"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-56-24" name="__codelineno-56-24"></a>
<a id="__codelineno-56-25" name="__codelineno-56-25"></a><span class="w">    </span><span class="o">*</span><span class="nx">o</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">slice</span>
<a id="__codelineno-56-26" name="__codelineno-56-26"></a>
<a id="__codelineno-56-27" name="__codelineno-56-27"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-56-28" name="__codelineno-56-28"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_72">解説</h3>
<ul>
<li><strong>目的</strong>: <code>PointLogSlice</code> 内の全ての <code>PointLog</code> オブジェクトをデータベースから再取得し、スライスを最新の状態に更新します。</li>
<li><strong>処理の流れ</strong>:</li>
<li><strong>スライスの検証</strong>:<ul>
<li>スライスが <code>nil</code> または空の場合、何もせずに終了します。</li>
</ul>
</li>
<li><strong>データの再取得</strong>:<ul>
<li>各オブジェクトのプライマリキーを収集し、それらを使用してデータベースから最新のレコードを一括で取得します。</li>
</ul>
</li>
<li><strong>スライスの更新</strong>:<ul>
<li>取得したデータでスライスを更新します。</li>
</ul>
</li>
</ul>
<h3 id="_73">利用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-57-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-57-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-57-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-57-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-57-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-57-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-57-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-57-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-57-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-57-10">10</a></span>
<span class="normal"><a href="#__codelineno-57-11">11</a></span>
<span class="normal"><a href="#__codelineno-57-12">12</a></span>
<span class="normal"><a href="#__codelineno-57-13">13</a></span>
<span class="normal"><a href="#__codelineno-57-14">14</a></span>
<span class="normal"><a href="#__codelineno-57-15">15</a></span>
<span class="normal"><a href="#__codelineno-57-16">16</a></span>
<span class="normal"><a href="#__codelineno-57-17">17</a></span>
<span class="normal"><a href="#__codelineno-57-18">18</a></span>
<span class="normal"><a href="#__codelineno-57-19">19</a></span>
<span class="normal"><a href="#__codelineno-57-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-57-2" name="__codelineno-57-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-57-3" name="__codelineno-57-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-57-4" name="__codelineno-57-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-57-5" name="__codelineno-57-5"></a><span class="p">}</span>
<a id="__codelineno-57-6" name="__codelineno-57-6"></a><span class="k">defer</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-57-7" name="__codelineno-57-7"></a>
<a id="__codelineno-57-8" name="__codelineno-57-8"></a><span class="c1">// PointLogのスライスを取得</span>
<a id="__codelineno-57-9" name="__codelineno-57-9"></a><span class="nx">pointLogs</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">PointLogs</span><span class="p">(</span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;user_id = ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">123</span><span class="p">)).</span><span class="nx">All</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-57-10" name="__codelineno-57-10"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-57-11" name="__codelineno-57-11"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-57-12" name="__codelineno-57-12"></a><span class="p">}</span>
<a id="__codelineno-57-13" name="__codelineno-57-13"></a>
<a id="__codelineno-57-14" name="__codelineno-57-14"></a><span class="c1">// スライス内のPointLogをすべてリロード</span>
<a id="__codelineno-57-15" name="__codelineno-57-15"></a><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="nx">pointLogs</span><span class="p">).</span><span class="nx">ReloadAll</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-57-16" name="__codelineno-57-16"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-57-17" name="__codelineno-57-17"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-57-18" name="__codelineno-57-18"></a><span class="p">}</span>
<a id="__codelineno-57-19" name="__codelineno-57-19"></a>
<a id="__codelineno-57-20" name="__codelineno-57-20"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Reloaded all PointLogs.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="pointlogexists"><code>PointLogExists</code> 関数</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-58-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-58-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-58-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-58-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-58-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-58-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-58-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-58-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-58-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-58-10">10</a></span>
<span class="normal"><a href="#__codelineno-58-11">11</a></span>
<span class="normal"><a href="#__codelineno-58-12">12</a></span>
<span class="normal"><a href="#__codelineno-58-13">13</a></span>
<span class="normal"><a href="#__codelineno-58-14">14</a></span>
<span class="normal"><a href="#__codelineno-58-15">15</a></span>
<span class="normal"><a href="#__codelineno-58-16">16</a></span>
<span class="normal"><a href="#__codelineno-58-17">17</a></span>
<span class="normal"><a href="#__codelineno-58-18">18</a></span>
<span class="normal"><a href="#__codelineno-58-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1"></a><span class="c1">// PointLogExists checks if the PointLog row exists.</span>
<a id="__codelineno-58-2" name="__codelineno-58-2"></a><span class="kd">func</span><span class="w"> </span><span class="nx">PointLogExists</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">createdAt</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Time</span><span class="p">,</span><span class="w"> </span><span class="nx">userID</span><span class="w"> </span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-58-3" name="__codelineno-58-3"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="kt">bool</span>
<a id="__codelineno-58-4" name="__codelineno-58-4"></a><span class="w">    </span><span class="nx">sql</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;select exists(select 1 from `point_logs` where `created_at`=? AND `user_id`=? limit 1)&quot;</span>
<a id="__codelineno-58-5" name="__codelineno-58-5"></a>
<a id="__codelineno-58-6" name="__codelineno-58-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">IsDebug</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-58-7" name="__codelineno-58-7"></a><span class="w">        </span><span class="nx">writer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">DebugWriterFrom</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<a id="__codelineno-58-8" name="__codelineno-58-8"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">)</span>
<a id="__codelineno-58-9" name="__codelineno-58-9"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">createdAt</span><span class="p">,</span><span class="w"> </span><span class="nx">userID</span><span class="p">)</span>
<a id="__codelineno-58-10" name="__codelineno-58-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-58-11" name="__codelineno-58-11"></a><span class="w">    </span><span class="nx">row</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">exec</span><span class="p">.</span><span class="nx">QueryRowContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">,</span><span class="w"> </span><span class="nx">createdAt</span><span class="p">,</span><span class="w"> </span><span class="nx">userID</span><span class="p">)</span>
<a id="__codelineno-58-12" name="__codelineno-58-12"></a>
<a id="__codelineno-58-13" name="__codelineno-58-13"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">row</span><span class="p">.</span><span class="nx">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">exists</span><span class="p">)</span>
<a id="__codelineno-58-14" name="__codelineno-58-14"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-58-15" name="__codelineno-58-15"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to check if point_logs exists&quot;</span><span class="p">)</span>
<a id="__codelineno-58-16" name="__codelineno-58-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-58-17" name="__codelineno-58-17"></a>
<a id="__codelineno-58-18" name="__codelineno-58-18"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">exists</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-58-19" name="__codelineno-58-19"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_74">解説</h3>
<ul>
<li><strong>目的</strong>: 指定したプライマリキー（<code>createdAt</code> と <code>userID</code>）に該当する <code>PointLog</code> レコードがデータベースに存在するかを確認します。</li>
<li><strong>パラメータ</strong>:</li>
<li><code>createdAt time.Time</code>: レコードの <code>CreatedAt</code> 値。</li>
<li><code>userID uint</code>: レコードの <code>UserID</code> 値。</li>
<li><strong>戻り値</strong>:</li>
<li><code>bool</code>: レコードが存在すれば <code>true</code>、存在しなければ <code>false</code> を返します。</li>
<li><code>error</code>: エラー情報を返します。</li>
</ul>
<h4 id="_75">処理の流れ</h4>
<ol>
<li><strong>クエリの作成</strong>:</li>
<li>
<p><code>EXISTS</code> を使ったクエリを作成し、指定したプライマリキーに一致するレコードが存在するかを確認します。</p>
</li>
<li>
<p><strong>クエリの実行と結果の取得</strong>:</p>
</li>
<li>
<p>クエリを実行し、結果を <code>exists</code> 変数にスキャンします。</p>
</li>
<li>
<p><strong>結果の返却</strong>:</p>
</li>
<li>レコードの存在有無を返します。</li>
</ol>
<h3 id="_76">利用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-59-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-59-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-59-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-59-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-59-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-59-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-59-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-59-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-59-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-59-10">10</a></span>
<span class="normal"><a href="#__codelineno-59-11">11</a></span>
<span class="normal"><a href="#__codelineno-59-12">12</a></span>
<span class="normal"><a href="#__codelineno-59-13">13</a></span>
<span class="normal"><a href="#__codelineno-59-14">14</a></span>
<span class="normal"><a href="#__codelineno-59-15">15</a></span>
<span class="normal"><a href="#__codelineno-59-16">16</a></span>
<span class="normal"><a href="#__codelineno-59-17">17</a></span>
<span class="normal"><a href="#__codelineno-59-18">18</a></span>
<span class="normal"><a href="#__codelineno-59-19">19</a></span>
<span class="normal"><a href="#__codelineno-59-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-59-2" name="__codelineno-59-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-59-3" name="__codelineno-59-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-59-4" name="__codelineno-59-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-59-5" name="__codelineno-59-5"></a><span class="p">}</span>
<a id="__codelineno-59-6" name="__codelineno-59-6"></a><span class="k">defer</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-59-7" name="__codelineno-59-7"></a>
<a id="__codelineno-59-8" name="__codelineno-59-8"></a><span class="nx">createdAt</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">Add</span><span class="p">(</span><span class="o">-</span><span class="mi">24</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Hour</span><span class="p">)</span>
<a id="__codelineno-59-9" name="__codelineno-59-9"></a><span class="nx">userID</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">uint</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<a id="__codelineno-59-10" name="__codelineno-59-10"></a>
<a id="__codelineno-59-11" name="__codelineno-59-11"></a><span class="nx">exists</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">PointLogExists</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">createdAt</span><span class="p">,</span><span class="w"> </span><span class="nx">userID</span><span class="p">)</span>
<a id="__codelineno-59-12" name="__codelineno-59-12"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-59-13" name="__codelineno-59-13"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-59-14" name="__codelineno-59-14"></a><span class="p">}</span>
<a id="__codelineno-59-15" name="__codelineno-59-15"></a>
<a id="__codelineno-59-16" name="__codelineno-59-16"></a><span class="k">if</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-59-17" name="__codelineno-59-17"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;The PointLog exists.&quot;</span><span class="p">)</span>
<a id="__codelineno-59-18" name="__codelineno-59-18"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-59-19" name="__codelineno-59-19"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;The PointLog does not exist.&quot;</span><span class="p">)</span>
<a id="__codelineno-59-20" name="__codelineno-59-20"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="exists_1"><code>Exists</code> メソッド</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-60-1">1</a></span>
<span class="normal"><a href="#__codelineno-60-2">2</a></span>
<span class="normal"><a href="#__codelineno-60-3">3</a></span>
<span class="normal"><a href="#__codelineno-60-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1"></a><span class="c1">// Exists checks if the PointLog row exists.</span>
<a id="__codelineno-60-2" name="__codelineno-60-2"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">PointLog</span><span class="p">)</span><span class="w"> </span><span class="nx">Exists</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-60-3" name="__codelineno-60-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">PointLogExists</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">CreatedAt</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">UserID</span><span class="p">)</span>
<a id="__codelineno-60-4" name="__codelineno-60-4"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_77">解説</h3>
<ul>
<li><strong>目的</strong>: <code>PointLog</code> オブジェクトに対応するデータベース上のレコードが存在するかを確認します。</li>
<li><strong>処理の流れ</strong>:</li>
<li><strong><code>PointLogExists</code> 関数の呼び出し</strong>:<ul>
<li>現在のオブジェクトのプライマリキーを使用して、<code>PointLogExists</code> 関数を呼び出します。</li>
</ul>
</li>
<li><strong>結果の返却</strong>:<ul>
<li>レコードの存在有無を返します。</li>
</ul>
</li>
</ul>
<h3 id="_78">利用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-61-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-61-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-61-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-61-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-61-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-61-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-61-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-61-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-61-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-61-10">10</a></span>
<span class="normal"><a href="#__codelineno-61-11">11</a></span>
<span class="normal"><a href="#__codelineno-61-12">12</a></span>
<span class="normal"><a href="#__codelineno-61-13">13</a></span>
<span class="normal"><a href="#__codelineno-61-14">14</a></span>
<span class="normal"><a href="#__codelineno-61-15">15</a></span>
<span class="normal"><a href="#__codelineno-61-16">16</a></span>
<span class="normal"><a href="#__codelineno-61-17">17</a></span>
<span class="normal"><a href="#__codelineno-61-18">18</a></span>
<span class="normal"><a href="#__codelineno-61-19">19</a></span>
<span class="normal"><a href="#__codelineno-61-20">20</a></span>
<span class="normal"><a href="#__codelineno-61-21">21</a></span>
<span class="normal"><a href="#__codelineno-61-22">22</a></span>
<span class="normal"><a href="#__codelineno-61-23">23</a></span>
<span class="normal"><a href="#__codelineno-61-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-61-2" name="__codelineno-61-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-61-3" name="__codelineno-61-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-61-4" name="__codelineno-61-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-61-5" name="__codelineno-61-5"></a><span class="p">}</span>
<a id="__codelineno-61-6" name="__codelineno-61-6"></a><span class="k">defer</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-61-7" name="__codelineno-61-7"></a>
<a id="__codelineno-61-8" name="__codelineno-61-8"></a><span class="c1">// 既存のPointLogオブジェクト</span>
<a id="__codelineno-61-9" name="__codelineno-61-9"></a><span class="nx">pointLog</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">PointLog</span><span class="p">{</span>
<a id="__codelineno-61-10" name="__codelineno-61-10"></a><span class="w">    </span><span class="nx">CreatedAt</span><span class="p">:</span><span class="w"> </span><span class="nx">someTime</span><span class="p">,</span>
<a id="__codelineno-61-11" name="__codelineno-61-11"></a><span class="w">    </span><span class="nx">UserID</span><span class="p">:</span><span class="w">    </span><span class="nx">someUserID</span><span class="p">,</span>
<a id="__codelineno-61-12" name="__codelineno-61-12"></a><span class="p">}</span>
<a id="__codelineno-61-13" name="__codelineno-61-13"></a>
<a id="__codelineno-61-14" name="__codelineno-61-14"></a><span class="c1">// レコードの存在を確認</span>
<a id="__codelineno-61-15" name="__codelineno-61-15"></a><span class="nx">exists</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">pointLog</span><span class="p">.</span><span class="nx">Exists</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-61-16" name="__codelineno-61-16"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-61-17" name="__codelineno-61-17"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-61-18" name="__codelineno-61-18"></a><span class="p">}</span>
<a id="__codelineno-61-19" name="__codelineno-61-19"></a>
<a id="__codelineno-61-20" name="__codelineno-61-20"></a><span class="k">if</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-61-21" name="__codelineno-61-21"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;The PointLog exists.&quot;</span><span class="p">)</span>
<a id="__codelineno-61-22" name="__codelineno-61-22"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-61-23" name="__codelineno-61-23"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;The PointLog does not exist.&quot;</span><span class="p">)</span>
<a id="__codelineno-61-24" name="__codelineno-61-24"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="seichy">Seichy構造体と関連コードの詳細解説</h2>
<p><code>Seichy</code>構造体とその関連コードについて、開発者向けに詳細に解説しています。各コード部分の役割や利用方法を理解することで、効果的にデータベース操作を行うことができます。</p>
<hr />
<h2 id="_79">はじめに</h2>
<p><code>Seichy</code>構造体は、SQLBoilerを使用して自動生成されたデータベーステーブルを表すオブジェクトです。この構造体を使用して、データベースとのやり取りを効率的に行うことができます。</p>
<hr />
<h2 id="seichy_1">Seichy構造体の定義</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-62-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-62-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-62-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-62-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-62-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-62-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-62-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-62-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-62-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-62-10">10</a></span>
<span class="normal"><a href="#__codelineno-62-11">11</a></span>
<span class="normal"><a href="#__codelineno-62-12">12</a></span>
<span class="normal"><a href="#__codelineno-62-13">13</a></span>
<span class="normal"><a href="#__codelineno-62-14">14</a></span>
<span class="normal"><a href="#__codelineno-62-15">15</a></span>
<span class="normal"><a href="#__codelineno-62-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1"></a><span class="c1">// Seichyはデータベーステーブルを表すオブジェクトです。</span>
<a id="__codelineno-62-2" name="__codelineno-62-2"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Seichy</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-62-3" name="__codelineno-62-3"></a><span class="w">    </span><span class="nx">SeichiID</span><span class="w">   </span><span class="kt">int</span><span class="w">           </span><span class="s">`boil:&quot;seichi_id&quot; json:&quot;seichi_id&quot; toml:&quot;seichi_id&quot; yaml:&quot;seichi_id&quot;`</span>
<a id="__codelineno-62-4" name="__codelineno-62-4"></a><span class="w">    </span><span class="nx">UserID</span><span class="w">     </span><span class="kt">uint</span><span class="w">          </span><span class="s">`boil:&quot;user_id&quot; json:&quot;user_id&quot; toml:&quot;user_id&quot; yaml:&quot;user_id&quot;`</span>
<a id="__codelineno-62-5" name="__codelineno-62-5"></a><span class="w">    </span><span class="nx">SeichiName</span><span class="w"> </span><span class="kt">string</span><span class="w">        </span><span class="s">`boil:&quot;seichi_name&quot; json:&quot;seichi_name&quot; toml:&quot;seichi_name&quot; yaml:&quot;seichi_name&quot;`</span>
<a id="__codelineno-62-6" name="__codelineno-62-6"></a><span class="w">    </span><span class="nx">Comment</span><span class="w">    </span><span class="nx">null</span><span class="p">.</span><span class="nx">String</span><span class="w">   </span><span class="s">`boil:&quot;comment&quot; json:&quot;comment,omitempty&quot; toml:&quot;comment&quot; yaml:&quot;comment,omitempty&quot;`</span>
<a id="__codelineno-62-7" name="__codelineno-62-7"></a><span class="w">    </span><span class="nx">Latitude</span><span class="w">   </span><span class="nx">types</span><span class="p">.</span><span class="nx">Decimal</span><span class="w"> </span><span class="s">`boil:&quot;latitude&quot; json:&quot;latitude&quot; toml:&quot;latitude&quot; yaml:&quot;latitude&quot;`</span>
<a id="__codelineno-62-8" name="__codelineno-62-8"></a><span class="w">    </span><span class="nx">Longitude</span><span class="w">  </span><span class="nx">types</span><span class="p">.</span><span class="nx">Decimal</span><span class="w"> </span><span class="s">`boil:&quot;longitude&quot; json:&quot;longitude&quot; toml:&quot;longitude&quot; yaml:&quot;longitude&quot;`</span>
<a id="__codelineno-62-9" name="__codelineno-62-9"></a><span class="w">    </span><span class="nx">PlaceID</span><span class="w">    </span><span class="kt">int</span><span class="w">           </span><span class="s">`boil:&quot;place_id&quot; json:&quot;place_id&quot; toml:&quot;place_id&quot; yaml:&quot;place_id&quot;`</span>
<a id="__codelineno-62-10" name="__codelineno-62-10"></a><span class="w">    </span><span class="nx">ContentID</span><span class="w">  </span><span class="kt">int</span><span class="w">           </span><span class="s">`boil:&quot;content_id&quot; json:&quot;content_id&quot; toml:&quot;content_id&quot; yaml:&quot;content_id&quot;`</span>
<a id="__codelineno-62-11" name="__codelineno-62-11"></a><span class="w">    </span><span class="nx">CreatedAt</span><span class="w">  </span><span class="nx">null</span><span class="p">.</span><span class="nx">Time</span><span class="w">     </span><span class="s">`boil:&quot;created_at&quot; json:&quot;created_at,omitempty&quot; toml:&quot;created_at&quot; yaml:&quot;created_at,omitempty&quot;`</span>
<a id="__codelineno-62-12" name="__codelineno-62-12"></a><span class="w">    </span><span class="nx">UpdatedAt</span><span class="w">  </span><span class="nx">null</span><span class="p">.</span><span class="nx">Time</span><span class="w">     </span><span class="s">`boil:&quot;updated_at&quot; json:&quot;updated_at,omitempty&quot; toml:&quot;updated_at&quot; yaml:&quot;updated_at,omitempty&quot;`</span>
<a id="__codelineno-62-13" name="__codelineno-62-13"></a>
<a id="__codelineno-62-14" name="__codelineno-62-14"></a><span class="w">    </span><span class="nx">R</span><span class="w"> </span><span class="o">*</span><span class="nx">seichyR</span><span class="w"> </span><span class="s">`boil:&quot;-&quot; json:&quot;-&quot; toml:&quot;-&quot; yaml:&quot;-&quot;`</span>
<a id="__codelineno-62-15" name="__codelineno-62-15"></a><span class="w">    </span><span class="nx">L</span><span class="w"> </span><span class="nx">seichyL</span><span class="w">  </span><span class="s">`boil:&quot;-&quot; json:&quot;-&quot; toml:&quot;-&quot; yaml:&quot;-&quot;`</span>
<a id="__codelineno-62-16" name="__codelineno-62-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_80">フィールドの解説</h3>
<ul>
<li><strong>SeichiID</strong> (<code>int</code>): 聖地の一意な識別子。プライマリキーとして機能します。</li>
<li><strong>UserID</strong> (<code>uint</code>): 聖地を登録したユーザーのID。外部キーとしてユーザーテーブルと関連付けられます。</li>
<li><strong>SeichiName</strong> (<code>string</code>): 聖地の名前。</li>
<li><strong>Comment</strong> (<code>null.String</code>): 聖地に関するコメント。<code>null</code>を許容するため<code>null.String</code>型を使用しています。</li>
<li><strong>Latitude</strong> (<code>types.Decimal</code>): 聖地の緯度。<code>types.Decimal</code>型は正確な小数点数を表現します。</li>
<li><strong>Longitude</strong> (<code>types.Decimal</code>): 聖地の経度。</li>
<li><strong>PlaceID</strong> (<code>int</code>): 場所のID。<code>Place</code>テーブルと関連付けられます。</li>
<li><strong>ContentID</strong> (<code>int</code>): コンテンツのID。<code>Content</code>テーブルと関連付けられます。</li>
<li><strong>CreatedAt</strong> (<code>null.Time</code>): レコードの作成日時。自動生成され、<code>null</code>を許容します。</li>
<li><strong>UpdatedAt</strong> (<code>null.Time</code>): レコードの更新日時。自動生成され、<code>null</code>を許容します。</li>
</ul>
<h3 id="_81">リレーションフィールド</h3>
<ul>
<li><strong>R</strong> (<code>*seichyR</code>): リレーション情報を保持するためのフィールド。</li>
<li><strong>L</strong> (<code>seichyL</code>): リレーションロード用のヘルパーフィールド。</li>
</ul>
<hr />
<h2 id="_82">カラム名の定義</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-63-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-63-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-63-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-63-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-63-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-63-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-63-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-63-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-63-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-63-10">10</a></span>
<span class="normal"><a href="#__codelineno-63-11">11</a></span>
<span class="normal"><a href="#__codelineno-63-12">12</a></span>
<span class="normal"><a href="#__codelineno-63-13">13</a></span>
<span class="normal"><a href="#__codelineno-63-14">14</a></span>
<span class="normal"><a href="#__codelineno-63-15">15</a></span>
<span class="normal"><a href="#__codelineno-63-16">16</a></span>
<span class="normal"><a href="#__codelineno-63-17">17</a></span>
<span class="normal"><a href="#__codelineno-63-18">18</a></span>
<span class="normal"><a href="#__codelineno-63-19">19</a></span>
<span class="normal"><a href="#__codelineno-63-20">20</a></span>
<span class="normal"><a href="#__codelineno-63-21">21</a></span>
<span class="normal"><a href="#__codelineno-63-22">22</a></span>
<span class="normal"><a href="#__codelineno-63-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">SeichyColumns</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-63-2" name="__codelineno-63-2"></a><span class="w">    </span><span class="nx">SeichiID</span><span class="w">   </span><span class="kt">string</span>
<a id="__codelineno-63-3" name="__codelineno-63-3"></a><span class="w">    </span><span class="nx">UserID</span><span class="w">     </span><span class="kt">string</span>
<a id="__codelineno-63-4" name="__codelineno-63-4"></a><span class="w">    </span><span class="nx">SeichiName</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-63-5" name="__codelineno-63-5"></a><span class="w">    </span><span class="nx">Comment</span><span class="w">    </span><span class="kt">string</span>
<a id="__codelineno-63-6" name="__codelineno-63-6"></a><span class="w">    </span><span class="nx">Latitude</span><span class="w">   </span><span class="kt">string</span>
<a id="__codelineno-63-7" name="__codelineno-63-7"></a><span class="w">    </span><span class="nx">Longitude</span><span class="w">  </span><span class="kt">string</span>
<a id="__codelineno-63-8" name="__codelineno-63-8"></a><span class="w">    </span><span class="nx">PlaceID</span><span class="w">    </span><span class="kt">string</span>
<a id="__codelineno-63-9" name="__codelineno-63-9"></a><span class="w">    </span><span class="nx">ContentID</span><span class="w">  </span><span class="kt">string</span>
<a id="__codelineno-63-10" name="__codelineno-63-10"></a><span class="w">    </span><span class="nx">CreatedAt</span><span class="w">  </span><span class="kt">string</span>
<a id="__codelineno-63-11" name="__codelineno-63-11"></a><span class="w">    </span><span class="nx">UpdatedAt</span><span class="w">  </span><span class="kt">string</span>
<a id="__codelineno-63-12" name="__codelineno-63-12"></a><span class="p">}{</span>
<a id="__codelineno-63-13" name="__codelineno-63-13"></a><span class="w">    </span><span class="nx">SeichiID</span><span class="p">:</span><span class="w">   </span><span class="s">&quot;seichi_id&quot;</span><span class="p">,</span>
<a id="__codelineno-63-14" name="__codelineno-63-14"></a><span class="w">    </span><span class="nx">UserID</span><span class="p">:</span><span class="w">     </span><span class="s">&quot;user_id&quot;</span><span class="p">,</span>
<a id="__codelineno-63-15" name="__codelineno-63-15"></a><span class="w">    </span><span class="nx">SeichiName</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;seichi_name&quot;</span><span class="p">,</span>
<a id="__codelineno-63-16" name="__codelineno-63-16"></a><span class="w">    </span><span class="nx">Comment</span><span class="p">:</span><span class="w">    </span><span class="s">&quot;comment&quot;</span><span class="p">,</span>
<a id="__codelineno-63-17" name="__codelineno-63-17"></a><span class="w">    </span><span class="nx">Latitude</span><span class="p">:</span><span class="w">   </span><span class="s">&quot;latitude&quot;</span><span class="p">,</span>
<a id="__codelineno-63-18" name="__codelineno-63-18"></a><span class="w">    </span><span class="nx">Longitude</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;longitude&quot;</span><span class="p">,</span>
<a id="__codelineno-63-19" name="__codelineno-63-19"></a><span class="w">    </span><span class="nx">PlaceID</span><span class="p">:</span><span class="w">    </span><span class="s">&quot;place_id&quot;</span><span class="p">,</span>
<a id="__codelineno-63-20" name="__codelineno-63-20"></a><span class="w">    </span><span class="nx">ContentID</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;content_id&quot;</span><span class="p">,</span>
<a id="__codelineno-63-21" name="__codelineno-63-21"></a><span class="w">    </span><span class="nx">CreatedAt</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;created_at&quot;</span><span class="p">,</span>
<a id="__codelineno-63-22" name="__codelineno-63-22"></a><span class="w">    </span><span class="nx">UpdatedAt</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;updated_at&quot;</span><span class="p">,</span>
<a id="__codelineno-63-23" name="__codelineno-63-23"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>カラム名を定義することにより、クエリを組み立てる際にタイポなどのミスを減らすことができます。</p>
<hr />
<h2 id="sqlboilerwhere">SQLBoilerによるWhereヘルパーの生成</h2>
<p><code>whereHelper</code>構造体は、クエリ条件を簡潔に記述するためのヘルパーです。</p>
<h3 id="nullstringwhere">null.String用のWhereヘルパー</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-64-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-64-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-64-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-64-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-64-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-64-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-64-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-64-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-64-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-64-10">10</a></span>
<span class="normal"><a href="#__codelineno-64-11">11</a></span>
<span class="normal"><a href="#__codelineno-64-12">12</a></span>
<span class="normal"><a href="#__codelineno-64-13">13</a></span>
<span class="normal"><a href="#__codelineno-64-14">14</a></span>
<span class="normal"><a href="#__codelineno-64-15">15</a></span>
<span class="normal"><a href="#__codelineno-64-16">16</a></span>
<span class="normal"><a href="#__codelineno-64-17">17</a></span>
<span class="normal"><a href="#__codelineno-64-18">18</a></span>
<span class="normal"><a href="#__codelineno-64-19">19</a></span>
<span class="normal"><a href="#__codelineno-64-20">20</a></span>
<span class="normal"><a href="#__codelineno-64-21">21</a></span>
<span class="normal"><a href="#__codelineno-64-22">22</a></span>
<span class="normal"><a href="#__codelineno-64-23">23</a></span>
<span class="normal"><a href="#__codelineno-64-24">24</a></span>
<span class="normal"><a href="#__codelineno-64-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1"></a><span class="kd">type</span><span class="w"> </span><span class="nx">whereHelpernull_String</span><span class="w"> </span><span class="kd">struct</span><span class="p">{</span><span class="w"> </span><span class="nx">field</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-64-2" name="__codelineno-64-2"></a>
<a id="__codelineno-64-3" name="__codelineno-64-3"></a><span class="c1">// 等価比較</span>
<a id="__codelineno-64-4" name="__codelineno-64-4"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">whereHelpernull_String</span><span class="p">)</span><span class="w"> </span><span class="nx">EQ</span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="nx">null</span><span class="p">.</span><span class="nx">String</span><span class="p">)</span><span class="w"> </span><span class="nx">qm</span><span class="p">.</span><span class="nx">QueryMod</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-64-5" name="__codelineno-64-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">qmhelper</span><span class="p">.</span><span class="nx">WhereNullEQ</span><span class="p">(</span><span class="nx">w</span><span class="p">.</span><span class="nx">field</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">)</span>
<a id="__codelineno-64-6" name="__codelineno-64-6"></a><span class="p">}</span>
<a id="__codelineno-64-7" name="__codelineno-64-7"></a>
<a id="__codelineno-64-8" name="__codelineno-64-8"></a><span class="c1">// 非等価比較</span>
<a id="__codelineno-64-9" name="__codelineno-64-9"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">whereHelpernull_String</span><span class="p">)</span><span class="w"> </span><span class="nx">NEQ</span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="nx">null</span><span class="p">.</span><span class="nx">String</span><span class="p">)</span><span class="w"> </span><span class="nx">qm</span><span class="p">.</span><span class="nx">QueryMod</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-64-10" name="__codelineno-64-10"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">qmhelper</span><span class="p">.</span><span class="nx">WhereNullEQ</span><span class="p">(</span><span class="nx">w</span><span class="p">.</span><span class="nx">field</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">)</span>
<a id="__codelineno-64-11" name="__codelineno-64-11"></a><span class="p">}</span>
<a id="__codelineno-64-12" name="__codelineno-64-12"></a>
<a id="__codelineno-64-13" name="__codelineno-64-13"></a><span class="c1">// その他の比較演算子</span>
<a id="__codelineno-64-14" name="__codelineno-64-14"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">whereHelpernull_String</span><span class="p">)</span><span class="w"> </span><span class="nx">LT</span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="nx">null</span><span class="p">.</span><span class="nx">String</span><span class="p">)</span><span class="w"> </span><span class="nx">qm</span><span class="p">.</span><span class="nx">QueryMod</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* ... */</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-64-15" name="__codelineno-64-15"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">whereHelpernull_String</span><span class="p">)</span><span class="w"> </span><span class="nx">LTE</span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="nx">null</span><span class="p">.</span><span class="nx">String</span><span class="p">)</span><span class="w"> </span><span class="nx">qm</span><span class="p">.</span><span class="nx">QueryMod</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* ... */</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-64-16" name="__codelineno-64-16"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">whereHelpernull_String</span><span class="p">)</span><span class="w"> </span><span class="nx">GT</span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="nx">null</span><span class="p">.</span><span class="nx">String</span><span class="p">)</span><span class="w"> </span><span class="nx">qm</span><span class="p">.</span><span class="nx">QueryMod</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* ... */</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-64-17" name="__codelineno-64-17"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">whereHelpernull_String</span><span class="p">)</span><span class="w"> </span><span class="nx">GTE</span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="nx">null</span><span class="p">.</span><span class="nx">String</span><span class="p">)</span><span class="w"> </span><span class="nx">qm</span><span class="p">.</span><span class="nx">QueryMod</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* ... */</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-64-18" name="__codelineno-64-18"></a>
<a id="__codelineno-64-19" name="__codelineno-64-19"></a><span class="c1">// LIKE句</span>
<a id="__codelineno-64-20" name="__codelineno-64-20"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">whereHelpernull_String</span><span class="p">)</span><span class="w"> </span><span class="nx">LIKE</span><span class="p">(</span><span class="nx">x</span><span class="w"> </span><span class="nx">null</span><span class="p">.</span><span class="nx">String</span><span class="p">)</span><span class="w"> </span><span class="nx">qm</span><span class="p">.</span><span class="nx">QueryMod</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-64-21" name="__codelineno-64-21"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="nx">w</span><span class="p">.</span><span class="nx">field</span><span class="o">+</span><span class="s">&quot; LIKE ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">)</span>
<a id="__codelineno-64-22" name="__codelineno-64-22"></a><span class="p">}</span>
<a id="__codelineno-64-23" name="__codelineno-64-23"></a>
<a id="__codelineno-64-24" name="__codelineno-64-24"></a><span class="c1">// IN句</span>
<a id="__codelineno-64-25" name="__codelineno-64-25"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">whereHelpernull_String</span><span class="p">)</span><span class="w"> </span><span class="nx">IN</span><span class="p">(</span><span class="nx">slice</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="nx">qm</span><span class="p">.</span><span class="nx">QueryMod</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* ... */</span><span class="w"> </span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>これらのヘルパーを使用することで、条件付きクエリを簡潔に記述できます。</p>
<hr />
<h2 id="seichywhere">SeichyWhere構造体</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-65-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-65-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-65-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-65-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-65-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-65-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-65-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-65-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-65-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-65-10">10</a></span>
<span class="normal"><a href="#__codelineno-65-11">11</a></span>
<span class="normal"><a href="#__codelineno-65-12">12</a></span>
<span class="normal"><a href="#__codelineno-65-13">13</a></span>
<span class="normal"><a href="#__codelineno-65-14">14</a></span>
<span class="normal"><a href="#__codelineno-65-15">15</a></span>
<span class="normal"><a href="#__codelineno-65-16">16</a></span>
<span class="normal"><a href="#__codelineno-65-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">SeichyWhere</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-65-2" name="__codelineno-65-2"></a><span class="w">    </span><span class="nx">SeichiID</span><span class="w">   </span><span class="nx">whereHelperint</span>
<a id="__codelineno-65-3" name="__codelineno-65-3"></a><span class="w">    </span><span class="nx">UserID</span><span class="w">     </span><span class="nx">whereHelperuint</span>
<a id="__codelineno-65-4" name="__codelineno-65-4"></a><span class="w">    </span><span class="nx">SeichiName</span><span class="w"> </span><span class="nx">whereHelperstring</span>
<a id="__codelineno-65-5" name="__codelineno-65-5"></a><span class="w">    </span><span class="nx">Comment</span><span class="w">    </span><span class="nx">whereHelpernull_String</span>
<a id="__codelineno-65-6" name="__codelineno-65-6"></a><span class="w">    </span><span class="nx">Latitude</span><span class="w">   </span><span class="nx">whereHelpertypes_Decimal</span>
<a id="__codelineno-65-7" name="__codelineno-65-7"></a><span class="w">    </span><span class="nx">Longitude</span><span class="w">  </span><span class="nx">whereHelpertypes_Decimal</span>
<a id="__codelineno-65-8" name="__codelineno-65-8"></a><span class="w">    </span><span class="nx">PlaceID</span><span class="w">    </span><span class="nx">whereHelperint</span>
<a id="__codelineno-65-9" name="__codelineno-65-9"></a><span class="w">    </span><span class="nx">ContentID</span><span class="w">  </span><span class="nx">whereHelperint</span>
<a id="__codelineno-65-10" name="__codelineno-65-10"></a><span class="w">    </span><span class="nx">CreatedAt</span><span class="w">  </span><span class="nx">whereHelpernull_Time</span>
<a id="__codelineno-65-11" name="__codelineno-65-11"></a><span class="w">    </span><span class="nx">UpdatedAt</span><span class="w">  </span><span class="nx">whereHelpernull_Time</span>
<a id="__codelineno-65-12" name="__codelineno-65-12"></a><span class="p">}{</span>
<a id="__codelineno-65-13" name="__codelineno-65-13"></a><span class="w">    </span><span class="nx">SeichiID</span><span class="p">:</span><span class="w">   </span><span class="nx">whereHelperint</span><span class="p">{</span><span class="nx">field</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;`seichies`.`seichi_id`&quot;</span><span class="p">},</span>
<a id="__codelineno-65-14" name="__codelineno-65-14"></a><span class="w">    </span><span class="nx">UserID</span><span class="p">:</span><span class="w">     </span><span class="nx">whereHelperuint</span><span class="p">{</span><span class="nx">field</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;`seichies`.`user_id`&quot;</span><span class="p">},</span>
<a id="__codelineno-65-15" name="__codelineno-65-15"></a><span class="w">    </span><span class="nx">SeichiName</span><span class="p">:</span><span class="w"> </span><span class="nx">whereHelperstring</span><span class="p">{</span><span class="nx">field</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;`seichies`.`seichi_name`&quot;</span><span class="p">},</span>
<a id="__codelineno-65-16" name="__codelineno-65-16"></a><span class="w">    </span><span class="c1">// 省略</span>
<a id="__codelineno-65-17" name="__codelineno-65-17"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><code>SeichyWhere</code>を使用して、クエリ内での条件指定を簡潔に行えます。</p>
<p><strong>利用例:</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-66-1">1</a></span>
<span class="normal"><a href="#__codelineno-66-2">2</a></span>
<span class="normal"><a href="#__codelineno-66-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1"></a><span class="nx">seichies</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">Seichies</span><span class="p">(</span>
<a id="__codelineno-66-2" name="__codelineno-66-2"></a><span class="w">    </span><span class="nx">models</span><span class="p">.</span><span class="nx">SeichyWhere</span><span class="p">.</span><span class="nx">SeichiName</span><span class="p">.</span><span class="nx">LIKE</span><span class="p">(</span><span class="s">&quot;%神社%&quot;</span><span class="p">),</span>
<a id="__codelineno-66-3" name="__codelineno-66-3"></a><span class="p">).</span><span class="nx">All</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="_83">リレーションシップの定義</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-67-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-67-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-67-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-67-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-67-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-67-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-67-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-67-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-67-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-67-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1"></a><span class="c1">// SeichyRelsはリレーションシップ名を保持します。</span>
<a id="__codelineno-67-2" name="__codelineno-67-2"></a><span class="kd">var</span><span class="w"> </span><span class="nx">SeichyRels</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-67-3" name="__codelineno-67-3"></a><span class="w">    </span><span class="nx">User</span><span class="w">    </span><span class="kt">string</span>
<a id="__codelineno-67-4" name="__codelineno-67-4"></a><span class="w">    </span><span class="nx">Place</span><span class="w">   </span><span class="kt">string</span>
<a id="__codelineno-67-5" name="__codelineno-67-5"></a><span class="w">    </span><span class="nx">Content</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-67-6" name="__codelineno-67-6"></a><span class="p">}{</span>
<a id="__codelineno-67-7" name="__codelineno-67-7"></a><span class="w">    </span><span class="nx">User</span><span class="p">:</span><span class="w">    </span><span class="s">&quot;User&quot;</span><span class="p">,</span>
<a id="__codelineno-67-8" name="__codelineno-67-8"></a><span class="w">    </span><span class="nx">Place</span><span class="p">:</span><span class="w">   </span><span class="s">&quot;Place&quot;</span><span class="p">,</span>
<a id="__codelineno-67-9" name="__codelineno-67-9"></a><span class="w">    </span><span class="nx">Content</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Content&quot;</span><span class="p">,</span>
<a id="__codelineno-67-10" name="__codelineno-67-10"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_84">リレーション用構造体</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-68-1">1</a></span>
<span class="normal"><a href="#__codelineno-68-2">2</a></span>
<span class="normal"><a href="#__codelineno-68-3">3</a></span>
<span class="normal"><a href="#__codelineno-68-4">4</a></span>
<span class="normal"><a href="#__codelineno-68-5">5</a></span>
<span class="normal"><a href="#__codelineno-68-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1"></a><span class="c1">// seichyRはリレーションシップを格納します。</span>
<a id="__codelineno-68-2" name="__codelineno-68-2"></a><span class="kd">type</span><span class="w"> </span><span class="nx">seichyR</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-68-3" name="__codelineno-68-3"></a><span class="w">    </span><span class="nx">User</span><span class="w">    </span><span class="o">*</span><span class="nx">User</span><span class="w">    </span><span class="s">`boil:&quot;User&quot; json:&quot;User&quot; toml:&quot;User&quot; yaml:&quot;User&quot;`</span>
<a id="__codelineno-68-4" name="__codelineno-68-4"></a><span class="w">    </span><span class="nx">Place</span><span class="w">   </span><span class="o">*</span><span class="nx">Place</span><span class="w">   </span><span class="s">`boil:&quot;Place&quot; json:&quot;Place&quot; toml:&quot;Place&quot; yaml:&quot;Place&quot;`</span>
<a id="__codelineno-68-5" name="__codelineno-68-5"></a><span class="w">    </span><span class="nx">Content</span><span class="w"> </span><span class="o">*</span><span class="nx">Content</span><span class="w"> </span><span class="s">`boil:&quot;Content&quot; json:&quot;Content&quot; toml:&quot;Content&quot; yaml:&quot;Content&quot;`</span>
<a id="__codelineno-68-6" name="__codelineno-68-6"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>リレーションをロードすることで、関連するデータを一度に取得できます。</p>
<p><strong>利用例:</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-69-1">1</a></span>
<span class="normal"><a href="#__codelineno-69-2">2</a></span>
<span class="normal"><a href="#__codelineno-69-3">3</a></span>
<span class="normal"><a href="#__codelineno-69-4">4</a></span>
<span class="normal"><a href="#__codelineno-69-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1"></a><span class="nx">seichi</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">Seichies</span><span class="p">(</span>
<a id="__codelineno-69-2" name="__codelineno-69-2"></a><span class="w">    </span><span class="nx">qm</span><span class="p">.</span><span class="nx">Load</span><span class="p">(</span><span class="nx">models</span><span class="p">.</span><span class="nx">SeichyRels</span><span class="p">.</span><span class="nx">User</span><span class="p">),</span>
<a id="__codelineno-69-3" name="__codelineno-69-3"></a><span class="p">).</span><span class="nx">One</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-69-4" name="__codelineno-69-4"></a>
<a id="__codelineno-69-5" name="__codelineno-69-5"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">seichi</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">User</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="_85">キャッシングと同期</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-70-1">1</a></span>
<span class="normal"><a href="#__codelineno-70-2">2</a></span>
<span class="normal"><a href="#__codelineno-70-3">3</a></span>
<span class="normal"><a href="#__codelineno-70-4">4</a></span>
<span class="normal"><a href="#__codelineno-70-5">5</a></span>
<span class="normal"><a href="#__codelineno-70-6">6</a></span>
<span class="normal"><a href="#__codelineno-70-7">7</a></span>
<span class="normal"><a href="#__codelineno-70-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1"></a><span class="kd">var</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-70-2" name="__codelineno-70-2"></a><span class="w">    </span><span class="nx">seichyInsertCacheMut</span><span class="w">       </span><span class="nx">sync</span><span class="p">.</span><span class="nx">RWMutex</span>
<a id="__codelineno-70-3" name="__codelineno-70-3"></a><span class="w">    </span><span class="nx">seichyInsertCache</span><span class="w">          </span><span class="p">=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">insertCache</span><span class="p">)</span>
<a id="__codelineno-70-4" name="__codelineno-70-4"></a><span class="w">    </span><span class="nx">seichyUpdateCacheMut</span><span class="w">       </span><span class="nx">sync</span><span class="p">.</span><span class="nx">RWMutex</span>
<a id="__codelineno-70-5" name="__codelineno-70-5"></a><span class="w">    </span><span class="nx">seichyUpdateCache</span><span class="w">          </span><span class="p">=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">updateCache</span><span class="p">)</span>
<a id="__codelineno-70-6" name="__codelineno-70-6"></a><span class="w">    </span><span class="nx">seichyUpsertCacheMut</span><span class="w">       </span><span class="nx">sync</span><span class="p">.</span><span class="nx">RWMutex</span>
<a id="__codelineno-70-7" name="__codelineno-70-7"></a><span class="w">    </span><span class="nx">seichyUpsertCache</span><span class="w">          </span><span class="p">=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">insertCache</span><span class="p">)</span>
<a id="__codelineno-70-8" name="__codelineno-70-8"></a><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>クエリのパフォーマンスを向上させるために、挿入・更新・アップサートのキャッシュを活用しています。</p>
<hr />
<h2 id="_86">フックの定義</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-71-1">1</a></span>
<span class="normal"><a href="#__codelineno-71-2">2</a></span>
<span class="normal"><a href="#__codelineno-71-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">seichyAfterSelectMu</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span>
<a id="__codelineno-71-2" name="__codelineno-71-2"></a><span class="kd">var</span><span class="w"> </span><span class="nx">seichyAfterSelectHooks</span><span class="w"> </span><span class="p">[]</span><span class="nx">SeichyHook</span>
<a id="__codelineno-71-3" name="__codelineno-71-3"></a><span class="c1">// その他のフック...</span>
</code></pre></div></td></tr></table></div>
<p>フックを使用することで、特定のタイミングでカスタム処理を挿入できます。</p>
<h3 id="_87">フックの種類</h3>
<ul>
<li><strong>AfterSelect</strong>: レコードがデータベースから選択された後に呼び出されます。</li>
<li><strong>BeforeInsert</strong>: レコードがデータベースに挿入される前に呼び出されます。</li>
<li><strong>AfterInsert</strong>: レコードがデータベースに挿入された後に呼び出されます。</li>
<li><strong>BeforeUpdate</strong>: レコードが更新される前に呼び出されます。</li>
<li><strong>AfterUpdate</strong>: レコードが更新された後に呼び出されます。</li>
<li><strong>BeforeDelete</strong>: レコードが削除される前に呼び出されます。</li>
<li><strong>AfterDelete</strong>: レコードが削除された後に呼び出されます。</li>
<li><strong>BeforeUpsert</strong>: レコードがアップサートされる前に呼び出されます。</li>
<li><strong>AfterUpsert</strong>: レコードがアップサートされた後に呼び出されます。</li>
</ul>
<h3 id="_88">フックの実装例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-72-1">1</a></span>
<span class="normal"><a href="#__codelineno-72-2">2</a></span>
<span class="normal"><a href="#__codelineno-72-3">3</a></span>
<span class="normal"><a href="#__codelineno-72-4">4</a></span>
<span class="normal"><a href="#__codelineno-72-5">5</a></span>
<span class="normal"><a href="#__codelineno-72-6">6</a></span>
<span class="normal"><a href="#__codelineno-72-7">7</a></span>
<span class="normal"><a href="#__codelineno-72-8">8</a></span>
<span class="normal"><a href="#__codelineno-72-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-72-2" name="__codelineno-72-2"></a><span class="w">    </span><span class="nx">models</span><span class="p">.</span><span class="nx">AddSeichyHook</span><span class="p">(</span><span class="nx">boil</span><span class="p">.</span><span class="nx">BeforeInsertHook</span><span class="p">,</span><span class="w"> </span><span class="nx">seichyBeforeInsert</span><span class="p">)</span>
<a id="__codelineno-72-3" name="__codelineno-72-3"></a><span class="p">}</span>
<a id="__codelineno-72-4" name="__codelineno-72-4"></a>
<a id="__codelineno-72-5" name="__codelineno-72-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">seichyBeforeInsert</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="nx">models</span><span class="p">.</span><span class="nx">Seichy</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-72-6" name="__codelineno-72-6"></a><span class="w">    </span><span class="c1">// カスタム処理</span>
<a id="__codelineno-72-7" name="__codelineno-72-7"></a><span class="w">    </span><span class="nx">s</span><span class="p">.</span><span class="nx">CreatedAt</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">null</span><span class="p">.</span><span class="nx">TimeFrom</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">())</span>
<a id="__codelineno-72-8" name="__codelineno-72-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-72-9" name="__codelineno-72-9"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="_89">利用例</h2>
<h3 id="seichy_2">新しいSeichyレコードの作成</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-73-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-73-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-73-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-73-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-73-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-73-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-73-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-73-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-73-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-73-10">10</a></span>
<span class="normal"><a href="#__codelineno-73-11">11</a></span>
<span class="normal"><a href="#__codelineno-73-12">12</a></span>
<span class="normal"><a href="#__codelineno-73-13">13</a></span>
<span class="normal"><a href="#__codelineno-73-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1"></a><span class="nx">seichi</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">models</span><span class="p">.</span><span class="nx">Seichy</span><span class="p">{</span>
<a id="__codelineno-73-2" name="__codelineno-73-2"></a><span class="w">    </span><span class="nx">UserID</span><span class="p">:</span><span class="w">     </span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-73-3" name="__codelineno-73-3"></a><span class="w">    </span><span class="nx">SeichiName</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;伏見稲荷大社&quot;</span><span class="p">,</span>
<a id="__codelineno-73-4" name="__codelineno-73-4"></a><span class="w">    </span><span class="nx">Latitude</span><span class="p">:</span><span class="w">   </span><span class="nx">types</span><span class="p">.</span><span class="nx">NewDecimal</span><span class="p">(</span><span class="nx">decimal</span><span class="p">.</span><span class="nx">NewFromFloat</span><span class="p">(</span><span class="mf">34.967140</span><span class="p">)),</span>
<a id="__codelineno-73-5" name="__codelineno-73-5"></a><span class="w">    </span><span class="nx">Longitude</span><span class="p">:</span><span class="w">  </span><span class="nx">types</span><span class="p">.</span><span class="nx">NewDecimal</span><span class="p">(</span><span class="nx">decimal</span><span class="p">.</span><span class="nx">NewFromFloat</span><span class="p">(</span><span class="mf">135.772673</span><span class="p">)),</span>
<a id="__codelineno-73-6" name="__codelineno-73-6"></a><span class="w">    </span><span class="nx">PlaceID</span><span class="p">:</span><span class="w">    </span><span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-73-7" name="__codelineno-73-7"></a><span class="w">    </span><span class="nx">ContentID</span><span class="p">:</span><span class="w">  </span><span class="mi">200</span><span class="p">,</span>
<a id="__codelineno-73-8" name="__codelineno-73-8"></a><span class="p">}</span>
<a id="__codelineno-73-9" name="__codelineno-73-9"></a>
<a id="__codelineno-73-10" name="__codelineno-73-10"></a><span class="c1">// データベースに挿入</span>
<a id="__codelineno-73-11" name="__codelineno-73-11"></a><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">seichi</span><span class="p">.</span><span class="nx">Insert</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">Infer</span><span class="p">())</span>
<a id="__codelineno-73-12" name="__codelineno-73-12"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-73-13" name="__codelineno-73-13"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-73-14" name="__codelineno-73-14"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="seichy_3">Seichyレコードの取得とリレーションのロード</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-74-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-74-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-74-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-74-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-74-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-74-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-74-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-74-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-74-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-74-10">10</a></span>
<span class="normal"><a href="#__codelineno-74-11">11</a></span>
<span class="normal"><a href="#__codelineno-74-12">12</a></span>
<span class="normal"><a href="#__codelineno-74-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1"></a><span class="c1">// IDが1のSeichyを取得し、関連するUserをロード</span>
<a id="__codelineno-74-2" name="__codelineno-74-2"></a><span class="nx">seichi</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">Seichies</span><span class="p">(</span>
<a id="__codelineno-74-3" name="__codelineno-74-3"></a><span class="w">    </span><span class="nx">models</span><span class="p">.</span><span class="nx">SeichyWhere</span><span class="p">.</span><span class="nx">SeichiID</span><span class="p">.</span><span class="nx">EQ</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
<a id="__codelineno-74-4" name="__codelineno-74-4"></a><span class="w">    </span><span class="nx">qm</span><span class="p">.</span><span class="nx">Load</span><span class="p">(</span><span class="nx">models</span><span class="p">.</span><span class="nx">SeichyRels</span><span class="p">.</span><span class="nx">User</span><span class="p">),</span>
<a id="__codelineno-74-5" name="__codelineno-74-5"></a><span class="p">).</span><span class="nx">One</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-74-6" name="__codelineno-74-6"></a>
<a id="__codelineno-74-7" name="__codelineno-74-7"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-74-8" name="__codelineno-74-8"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-74-9" name="__codelineno-74-9"></a><span class="p">}</span>
<a id="__codelineno-74-10" name="__codelineno-74-10"></a>
<a id="__codelineno-74-11" name="__codelineno-74-11"></a><span class="c1">// ロードされたUserを使用</span>
<a id="__codelineno-74-12" name="__codelineno-74-12"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Seichi Name:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">seichi</span><span class="p">.</span><span class="nx">SeichiName</span><span class="p">)</span>
<a id="__codelineno-74-13" name="__codelineno-74-13"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Registered by:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">seichi</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">User</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h3 id="seichy_4">Seichyレコードの更新</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-75-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-75-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-75-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-75-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-75-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-75-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-75-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-75-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-75-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-75-10">10</a></span>
<span class="normal"><a href="#__codelineno-75-11">11</a></span>
<span class="normal"><a href="#__codelineno-75-12">12</a></span>
<span class="normal"><a href="#__codelineno-75-13">13</a></span>
<span class="normal"><a href="#__codelineno-75-14">14</a></span>
<span class="normal"><a href="#__codelineno-75-15">15</a></span>
<span class="normal"><a href="#__codelineno-75-16">16</a></span>
<span class="normal"><a href="#__codelineno-75-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1"></a><span class="c1">// レコードの取得</span>
<a id="__codelineno-75-2" name="__codelineno-75-2"></a><span class="nx">seichi</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">Seichies</span><span class="p">(</span>
<a id="__codelineno-75-3" name="__codelineno-75-3"></a><span class="w">    </span><span class="nx">models</span><span class="p">.</span><span class="nx">SeichyWhere</span><span class="p">.</span><span class="nx">SeichiID</span><span class="p">.</span><span class="nx">EQ</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
<a id="__codelineno-75-4" name="__codelineno-75-4"></a><span class="p">).</span><span class="nx">One</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-75-5" name="__codelineno-75-5"></a>
<a id="__codelineno-75-6" name="__codelineno-75-6"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-75-7" name="__codelineno-75-7"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-75-8" name="__codelineno-75-8"></a><span class="p">}</span>
<a id="__codelineno-75-9" name="__codelineno-75-9"></a>
<a id="__codelineno-75-10" name="__codelineno-75-10"></a><span class="c1">// フィールドの更新</span>
<a id="__codelineno-75-11" name="__codelineno-75-11"></a><span class="nx">seichi</span><span class="p">.</span><span class="nx">Comment</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">null</span><span class="p">.</span><span class="nx">StringFrom</span><span class="p">(</span><span class="s">&quot;とても美しい場所です&quot;</span><span class="p">)</span>
<a id="__codelineno-75-12" name="__codelineno-75-12"></a>
<a id="__codelineno-75-13" name="__codelineno-75-13"></a><span class="c1">// データベースに保存</span>
<a id="__codelineno-75-14" name="__codelineno-75-14"></a><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">seichi</span><span class="p">.</span><span class="nx">Update</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">Infer</span><span class="p">())</span>
<a id="__codelineno-75-15" name="__codelineno-75-15"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-75-16" name="__codelineno-75-16"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-75-17" name="__codelineno-75-17"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="seichy_5">Seichyレコードの削除</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-76-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-76-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-76-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-76-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-76-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-76-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-76-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-76-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-76-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-76-10">10</a></span>
<span class="normal"><a href="#__codelineno-76-11">11</a></span>
<span class="normal"><a href="#__codelineno-76-12">12</a></span>
<span class="normal"><a href="#__codelineno-76-13">13</a></span>
<span class="normal"><a href="#__codelineno-76-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1"></a><span class="c1">// レコードの取得</span>
<a id="__codelineno-76-2" name="__codelineno-76-2"></a><span class="nx">seichi</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">Seichies</span><span class="p">(</span>
<a id="__codelineno-76-3" name="__codelineno-76-3"></a><span class="w">    </span><span class="nx">models</span><span class="p">.</span><span class="nx">SeichyWhere</span><span class="p">.</span><span class="nx">SeichiID</span><span class="p">.</span><span class="nx">EQ</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
<a id="__codelineno-76-4" name="__codelineno-76-4"></a><span class="p">).</span><span class="nx">One</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-76-5" name="__codelineno-76-5"></a>
<a id="__codelineno-76-6" name="__codelineno-76-6"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-76-7" name="__codelineno-76-7"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-76-8" name="__codelineno-76-8"></a><span class="p">}</span>
<a id="__codelineno-76-9" name="__codelineno-76-9"></a>
<a id="__codelineno-76-10" name="__codelineno-76-10"></a><span class="c1">// レコードの削除</span>
<a id="__codelineno-76-11" name="__codelineno-76-11"></a><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">seichi</span><span class="p">.</span><span class="nx">Delete</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-76-12" name="__codelineno-76-12"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-76-13" name="__codelineno-76-13"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-76-14" name="__codelineno-76-14"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>注意</strong>: <code>SQLBoiler</code>、<code>null</code>、<code>types.Decimal</code>、およびその他の外部パッケージを使用しています。これらのパッケージのインポートと設定が必要です。</p>
<hr />
<h2 id="seichy_6">Seichy構造体と関連するフック・クエリメソッドの詳細解説</h2>
<p><code>Seichy</code>構造体に関連するフック関数やクエリメソッドについて、開発者向けに詳細に解説します。各コード部分の役割や利用方法を理解することで、データベース操作を効果的に行うことができます。</p>
<hr />
<h2 id="_90">フック関数の詳細</h2>
<p>フック関数は、特定のデータベース操作の前後にカスタム処理を挿入するために使用されます。これにより、トリガーのような機能を実現できます。</p>
<h3 id="_91">フック関数の定義</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-77-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1"></a><span class="kd">type</span><span class="w"> </span><span class="nx">SeichyHook</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">Seichy</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>
</code></pre></div></td></tr></table></div>
<p><code>SeichyHook</code>は、<code>Seichy</code>構造体に対して適用されるフック関数の型定義です。</p>
<h3 id="_92">フック関数の実行</h3>
<p>各操作（<code>Insert</code>、<code>Update</code>、<code>Delete</code>、<code>Upsert</code>など）の前後で、対応するフック関数が実行されます。</p>
<h4 id="dobeforeupdatehooks">doBeforeUpdateHooks</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-78-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-78-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-78-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-78-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-78-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-78-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-78-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-78-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-78-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-78-10">10</a></span>
<span class="normal"><a href="#__codelineno-78-11">11</a></span>
<span class="normal"><a href="#__codelineno-78-12">12</a></span>
<span class="normal"><a href="#__codelineno-78-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-78-1" name="__codelineno-78-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">Seichy</span><span class="p">)</span><span class="w"> </span><span class="nx">doBeforeUpdateHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-78-2" name="__codelineno-78-2"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">HooksAreSkipped</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-78-3" name="__codelineno-78-3"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-78-4" name="__codelineno-78-4"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-78-5" name="__codelineno-78-5"></a>
<a id="__codelineno-78-6" name="__codelineno-78-6"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">hook</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">seichyBeforeUpdateHooks</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-78-7" name="__codelineno-78-7"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">hook</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-78-8" name="__codelineno-78-8"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-78-9" name="__codelineno-78-9"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-78-10" name="__codelineno-78-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-78-11" name="__codelineno-78-11"></a>
<a id="__codelineno-78-12" name="__codelineno-78-12"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-78-13" name="__codelineno-78-13"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><code>doBeforeUpdateHooks</code>は、更新操作の前に登録されたフック関数を実行します。</p>
<ul>
<li><strong>boil.HooksAreSkipped(ctx)</strong>: コンテキストでフックをスキップする設定がされている場合、何もせずに終了します。</li>
<li><strong>seichyBeforeUpdateHooks</strong>: 登録された全ての<code>BeforeUpdate</code>フック関数のスライス。</li>
<li>フック関数がエラーを返した場合、そのエラーを返します。</li>
</ul>
<h4 id="_93">その他のフック関数</h4>
<p>同様のパターンで、以下のフック関数があります。</p>
<ul>
<li><code>doAfterUpdateHooks</code>: 更新操作の後に実行。</li>
<li><code>doBeforeDeleteHooks</code>: 削除操作の前に実行。</li>
<li><code>doAfterDeleteHooks</code>: 削除操作の後に実行。</li>
<li><code>doBeforeUpsertHooks</code>: アップサート操作の前に実行。</li>
<li><code>doAfterUpsertHooks</code>: アップサート操作の後に実行。</li>
</ul>
<h3 id="_94">フック関数の登録</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-79-1">1</a></span>
<span class="normal"><a href="#__codelineno-79-2">2</a></span>
<span class="normal"><a href="#__codelineno-79-3">3</a></span>
<span class="normal"><a href="#__codelineno-79-4">4</a></span>
<span class="normal"><a href="#__codelineno-79-5">5</a></span>
<span class="normal"><a href="#__codelineno-79-6">6</a></span>
<span class="normal"><a href="#__codelineno-79-7">7</a></span>
<span class="normal"><a href="#__codelineno-79-8">8</a></span>
<span class="normal"><a href="#__codelineno-79-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">AddSeichyHook</span><span class="p">(</span><span class="nx">hookPoint</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">HookPoint</span><span class="p">,</span><span class="w"> </span><span class="nx">seichyHook</span><span class="w"> </span><span class="nx">SeichyHook</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-2" name="__codelineno-79-2"></a><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="nx">hookPoint</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-3" name="__codelineno-79-3"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">AfterSelectHook</span><span class="p">:</span>
<a id="__codelineno-79-4" name="__codelineno-79-4"></a><span class="w">        </span><span class="c1">//...</span>
<a id="__codelineno-79-5" name="__codelineno-79-5"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">BeforeInsertHook</span><span class="p">:</span>
<a id="__codelineno-79-6" name="__codelineno-79-6"></a><span class="w">        </span><span class="c1">//...</span>
<a id="__codelineno-79-7" name="__codelineno-79-7"></a><span class="w">    </span><span class="c1">// その他のフックポイント</span>
<a id="__codelineno-79-8" name="__codelineno-79-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-79-9" name="__codelineno-79-9"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><code>AddSeichyHook</code>関数を使用して、特定のフックポイントにフック関数を登録できます。</p>
<ul>
<li><strong>hookPoint</strong>: フックのタイミングを指定する。<code>boil.BeforeInsertHook</code>など。</li>
<li><strong>seichyHook</strong>: 登録するフック関数。</li>
</ul>
<h4 id="_95">利用例</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-80-1">1</a></span>
<span class="normal"><a href="#__codelineno-80-2">2</a></span>
<span class="normal"><a href="#__codelineno-80-3">3</a></span>
<span class="normal"><a href="#__codelineno-80-4">4</a></span>
<span class="normal"><a href="#__codelineno-80-5">5</a></span>
<span class="normal"><a href="#__codelineno-80-6">6</a></span>
<span class="normal"><a href="#__codelineno-80-7">7</a></span>
<span class="normal"><a href="#__codelineno-80-8">8</a></span>
<span class="normal"><a href="#__codelineno-80-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-80-1" name="__codelineno-80-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-80-2" name="__codelineno-80-2"></a><span class="w">    </span><span class="nx">models</span><span class="p">.</span><span class="nx">AddSeichyHook</span><span class="p">(</span><span class="nx">boil</span><span class="p">.</span><span class="nx">BeforeInsertHook</span><span class="p">,</span><span class="w"> </span><span class="nx">beforeInsertSeichy</span><span class="p">)</span>
<a id="__codelineno-80-3" name="__codelineno-80-3"></a><span class="p">}</span>
<a id="__codelineno-80-4" name="__codelineno-80-4"></a>
<a id="__codelineno-80-5" name="__codelineno-80-5"></a><span class="kd">func</span><span class="w"> </span><span class="nx">beforeInsertSeichy</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="nx">models</span><span class="p">.</span><span class="nx">Seichy</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-80-6" name="__codelineno-80-6"></a><span class="w">    </span><span class="c1">// 例: 作成日時を設定</span>
<a id="__codelineno-80-7" name="__codelineno-80-7"></a><span class="w">    </span><span class="nx">s</span><span class="p">.</span><span class="nx">CreatedAt</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">null</span><span class="p">.</span><span class="nx">TimeFrom</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">())</span>
<a id="__codelineno-80-8" name="__codelineno-80-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-80-9" name="__codelineno-80-9"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="_96">クエリメソッドの詳細</h2>
<p><code>Seichy</code>構造体に対するクエリメソッドを使用して、データベース操作を行います。</p>
<h3 id="one_1">Oneメソッド</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-81-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-81-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-81-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-81-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-81-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-81-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-81-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-81-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-81-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-81-10">10</a></span>
<span class="normal"><a href="#__codelineno-81-11">11</a></span>
<span class="normal"><a href="#__codelineno-81-12">12</a></span>
<span class="normal"><a href="#__codelineno-81-13">13</a></span>
<span class="normal"><a href="#__codelineno-81-14">14</a></span>
<span class="normal"><a href="#__codelineno-81-15">15</a></span>
<span class="normal"><a href="#__codelineno-81-16">16</a></span>
<span class="normal"><a href="#__codelineno-81-17">17</a></span>
<span class="normal"><a href="#__codelineno-81-18">18</a></span>
<span class="normal"><a href="#__codelineno-81-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-81-1" name="__codelineno-81-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">q</span><span class="w"> </span><span class="nx">seichyQuery</span><span class="p">)</span><span class="w"> </span><span class="nx">One</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">Seichy</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-81-2" name="__codelineno-81-2"></a><span class="w">    </span><span class="nx">o</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Seichy</span><span class="p">{}</span>
<a id="__codelineno-81-3" name="__codelineno-81-3"></a>
<a id="__codelineno-81-4" name="__codelineno-81-4"></a><span class="w">    </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetLimit</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-81-5" name="__codelineno-81-5"></a>
<a id="__codelineno-81-6" name="__codelineno-81-6"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">q</span><span class="p">.</span><span class="nx">Bind</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">)</span>
<a id="__codelineno-81-7" name="__codelineno-81-7"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-81-8" name="__codelineno-81-8"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Is</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">ErrNoRows</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-81-9" name="__codelineno-81-9"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">ErrNoRows</span>
<a id="__codelineno-81-10" name="__codelineno-81-10"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-81-11" name="__codelineno-81-11"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: failed to execute a one query for seichies&quot;</span><span class="p">)</span>
<a id="__codelineno-81-12" name="__codelineno-81-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-81-13" name="__codelineno-81-13"></a>
<a id="__codelineno-81-14" name="__codelineno-81-14"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">doAfterSelectHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-81-15" name="__codelineno-81-15"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">o</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-81-16" name="__codelineno-81-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-81-17" name="__codelineno-81-17"></a>
<a id="__codelineno-81-18" name="__codelineno-81-18"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">o</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-81-19" name="__codelineno-81-19"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>One</strong>: クエリの結果から1つの<code>Seichy</code>レコードを取得します。</li>
<li><strong>SetLimit</strong>: 取得するレコード数を1に設定。</li>
<li><strong>Bind</strong>: クエリを実行し、結果を<code>Seichy</code>構造体にバインド。</li>
<li><strong>doAfterSelectHooks</strong>: 選択後のフック関数を実行。</li>
</ul>
<h4 id="_97">利用例</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-82-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-82-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-82-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-82-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-82-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-82-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-82-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-82-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-82-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-82-10">10</a></span>
<span class="normal"><a href="#__codelineno-82-11">11</a></span>
<span class="normal"><a href="#__codelineno-82-12">12</a></span>
<span class="normal"><a href="#__codelineno-82-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-82-1" name="__codelineno-82-1"></a><span class="nx">seichi</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">Seichies</span><span class="p">(</span>
<a id="__codelineno-82-2" name="__codelineno-82-2"></a><span class="w">    </span><span class="nx">models</span><span class="p">.</span><span class="nx">SeichyWhere</span><span class="p">.</span><span class="nx">SeichiID</span><span class="p">.</span><span class="nx">EQ</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
<a id="__codelineno-82-3" name="__codelineno-82-3"></a><span class="p">).</span><span class="nx">One</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-82-4" name="__codelineno-82-4"></a>
<a id="__codelineno-82-5" name="__codelineno-82-5"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-82-6" name="__codelineno-82-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Is</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">ErrNoRows</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-82-7" name="__codelineno-82-7"></a><span class="w">        </span><span class="c1">// レコードが存在しない場合の処理</span>
<a id="__codelineno-82-8" name="__codelineno-82-8"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-82-9" name="__codelineno-82-9"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-82-10" name="__codelineno-82-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-82-11" name="__codelineno-82-11"></a><span class="p">}</span>
<a id="__codelineno-82-12" name="__codelineno-82-12"></a>
<a id="__codelineno-82-13" name="__codelineno-82-13"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Seichi Name:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">seichi</span><span class="p">.</span><span class="nx">SeichiName</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h3 id="all_1">Allメソッド</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-83-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-83-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-83-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-83-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-83-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-83-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-83-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-83-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-83-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-83-10">10</a></span>
<span class="normal"><a href="#__codelineno-83-11">11</a></span>
<span class="normal"><a href="#__codelineno-83-12">12</a></span>
<span class="normal"><a href="#__codelineno-83-13">13</a></span>
<span class="normal"><a href="#__codelineno-83-14">14</a></span>
<span class="normal"><a href="#__codelineno-83-15">15</a></span>
<span class="normal"><a href="#__codelineno-83-16">16</a></span>
<span class="normal"><a href="#__codelineno-83-17">17</a></span>
<span class="normal"><a href="#__codelineno-83-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-83-1" name="__codelineno-83-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">q</span><span class="w"> </span><span class="nx">seichyQuery</span><span class="p">)</span><span class="w"> </span><span class="nx">All</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">SeichySlice</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-83-2" name="__codelineno-83-2"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">o</span><span class="w"> </span><span class="p">[]</span><span class="o">*</span><span class="nx">Seichy</span>
<a id="__codelineno-83-3" name="__codelineno-83-3"></a>
<a id="__codelineno-83-4" name="__codelineno-83-4"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">q</span><span class="p">.</span><span class="nx">Bind</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">o</span><span class="p">)</span>
<a id="__codelineno-83-5" name="__codelineno-83-5"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-83-6" name="__codelineno-83-6"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: failed to assign all query results to Seichy slice&quot;</span><span class="p">)</span>
<a id="__codelineno-83-7" name="__codelineno-83-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-83-8" name="__codelineno-83-8"></a>
<a id="__codelineno-83-9" name="__codelineno-83-9"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">seichyAfterSelectHooks</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-83-10" name="__codelineno-83-10"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">o</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-83-11" name="__codelineno-83-11"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">obj</span><span class="p">.</span><span class="nx">doAfterSelectHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-83-12" name="__codelineno-83-12"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nx">o</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-83-13" name="__codelineno-83-13"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-83-14" name="__codelineno-83-14"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-83-15" name="__codelineno-83-15"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-83-16" name="__codelineno-83-16"></a>
<a id="__codelineno-83-17" name="__codelineno-83-17"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">o</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-83-18" name="__codelineno-83-18"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>All</strong>: クエリの結果から全ての<code>Seichy</code>レコードを取得します。</li>
<li><strong>Bind</strong>: 結果をスライスにバインド。</li>
<li><strong>doAfterSelectHooks</strong>: 各レコードに対して選択後のフック関数を実行。</li>
</ul>
<h4 id="_98">利用例</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-84-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-84-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-84-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-84-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-84-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-84-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-84-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-84-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-84-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-84-10">10</a></span>
<span class="normal"><a href="#__codelineno-84-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-84-1" name="__codelineno-84-1"></a><span class="nx">seichies</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">Seichies</span><span class="p">(</span>
<a id="__codelineno-84-2" name="__codelineno-84-2"></a><span class="w">    </span><span class="nx">models</span><span class="p">.</span><span class="nx">SeichyWhere</span><span class="p">.</span><span class="nx">UserID</span><span class="p">.</span><span class="nx">EQ</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
<a id="__codelineno-84-3" name="__codelineno-84-3"></a><span class="p">).</span><span class="nx">All</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-84-4" name="__codelineno-84-4"></a>
<a id="__codelineno-84-5" name="__codelineno-84-5"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-84-6" name="__codelineno-84-6"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-84-7" name="__codelineno-84-7"></a><span class="p">}</span>
<a id="__codelineno-84-8" name="__codelineno-84-8"></a>
<a id="__codelineno-84-9" name="__codelineno-84-9"></a><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">seichies</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-84-10" name="__codelineno-84-10"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Seichi:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">SeichiName</span><span class="p">)</span>
<a id="__codelineno-84-11" name="__codelineno-84-11"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="count_1">Countメソッド</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-85-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-85-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-85-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-85-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-85-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-85-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-85-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-85-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-85-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-85-10">10</a></span>
<span class="normal"><a href="#__codelineno-85-11">11</a></span>
<span class="normal"><a href="#__codelineno-85-12">12</a></span>
<span class="normal"><a href="#__codelineno-85-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-85-1" name="__codelineno-85-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">q</span><span class="w"> </span><span class="nx">seichyQuery</span><span class="p">)</span><span class="w"> </span><span class="nx">Count</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">int64</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-85-2" name="__codelineno-85-2"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="kt">int64</span>
<a id="__codelineno-85-3" name="__codelineno-85-3"></a>
<a id="__codelineno-85-4" name="__codelineno-85-4"></a><span class="w">    </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetSelect</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<a id="__codelineno-85-5" name="__codelineno-85-5"></a><span class="w">    </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetCount</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">)</span>
<a id="__codelineno-85-6" name="__codelineno-85-6"></a>
<a id="__codelineno-85-7" name="__codelineno-85-7"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">.</span><span class="nx">QueryRowContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">).</span><span class="nx">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">count</span><span class="p">)</span>
<a id="__codelineno-85-8" name="__codelineno-85-8"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-85-9" name="__codelineno-85-9"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: failed to count seichies rows&quot;</span><span class="p">)</span>
<a id="__codelineno-85-10" name="__codelineno-85-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-85-11" name="__codelineno-85-11"></a>
<a id="__codelineno-85-12" name="__codelineno-85-12"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">count</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-85-13" name="__codelineno-85-13"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>Count</strong>: クエリの結果のレコード数を取得します。</li>
</ul>
<h4 id="_99">利用例</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-86-1">1</a></span>
<span class="normal"><a href="#__codelineno-86-2">2</a></span>
<span class="normal"><a href="#__codelineno-86-3">3</a></span>
<span class="normal"><a href="#__codelineno-86-4">4</a></span>
<span class="normal"><a href="#__codelineno-86-5">5</a></span>
<span class="normal"><a href="#__codelineno-86-6">6</a></span>
<span class="normal"><a href="#__codelineno-86-7">7</a></span>
<span class="normal"><a href="#__codelineno-86-8">8</a></span>
<span class="normal"><a href="#__codelineno-86-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-86-1" name="__codelineno-86-1"></a><span class="nx">count</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">Seichies</span><span class="p">(</span>
<a id="__codelineno-86-2" name="__codelineno-86-2"></a><span class="w">    </span><span class="nx">models</span><span class="p">.</span><span class="nx">SeichyWhere</span><span class="p">.</span><span class="nx">UserID</span><span class="p">.</span><span class="nx">EQ</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
<a id="__codelineno-86-3" name="__codelineno-86-3"></a><span class="p">).</span><span class="nx">Count</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-86-4" name="__codelineno-86-4"></a>
<a id="__codelineno-86-5" name="__codelineno-86-5"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-86-6" name="__codelineno-86-6"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-86-7" name="__codelineno-86-7"></a><span class="p">}</span>
<a id="__codelineno-86-8" name="__codelineno-86-8"></a>
<a id="__codelineno-86-9" name="__codelineno-86-9"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Total Seichies:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">count</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h3 id="exists_2">Existsメソッド</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-87-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-87-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-87-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-87-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-87-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-87-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-87-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-87-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-87-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-87-10">10</a></span>
<span class="normal"><a href="#__codelineno-87-11">11</a></span>
<span class="normal"><a href="#__codelineno-87-12">12</a></span>
<span class="normal"><a href="#__codelineno-87-13">13</a></span>
<span class="normal"><a href="#__codelineno-87-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-87-1" name="__codelineno-87-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">q</span><span class="w"> </span><span class="nx">seichyQuery</span><span class="p">)</span><span class="w"> </span><span class="nx">Exists</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-87-2" name="__codelineno-87-2"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="kt">int64</span>
<a id="__codelineno-87-3" name="__codelineno-87-3"></a>
<a id="__codelineno-87-4" name="__codelineno-87-4"></a><span class="w">    </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetSelect</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<a id="__codelineno-87-5" name="__codelineno-87-5"></a><span class="w">    </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetCount</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">)</span>
<a id="__codelineno-87-6" name="__codelineno-87-6"></a><span class="w">    </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetLimit</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-87-7" name="__codelineno-87-7"></a>
<a id="__codelineno-87-8" name="__codelineno-87-8"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">.</span><span class="nx">QueryRowContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">).</span><span class="nx">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">count</span><span class="p">)</span>
<a id="__codelineno-87-9" name="__codelineno-87-9"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-87-10" name="__codelineno-87-10"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: failed to check if seichies exists&quot;</span><span class="p">)</span>
<a id="__codelineno-87-11" name="__codelineno-87-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-87-12" name="__codelineno-87-12"></a>
<a id="__codelineno-87-13" name="__codelineno-87-13"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-87-14" name="__codelineno-87-14"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>Exists</strong>: クエリに該当するレコードが存在するかを確認します。</li>
</ul>
<h4 id="_100">利用例</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-88-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-88-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-88-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-88-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-88-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-88-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-88-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-88-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-88-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-88-10">10</a></span>
<span class="normal"><a href="#__codelineno-88-11">11</a></span>
<span class="normal"><a href="#__codelineno-88-12">12</a></span>
<span class="normal"><a href="#__codelineno-88-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-88-1" name="__codelineno-88-1"></a><span class="nx">exists</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">models</span><span class="p">.</span><span class="nx">Seichies</span><span class="p">(</span>
<a id="__codelineno-88-2" name="__codelineno-88-2"></a><span class="w">    </span><span class="nx">models</span><span class="p">.</span><span class="nx">SeichyWhere</span><span class="p">.</span><span class="nx">SeichiName</span><span class="p">.</span><span class="nx">EQ</span><span class="p">(</span><span class="s">&quot;伏見稲荷大社&quot;</span><span class="p">),</span>
<a id="__codelineno-88-3" name="__codelineno-88-3"></a><span class="p">).</span><span class="nx">Exists</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-88-4" name="__codelineno-88-4"></a>
<a id="__codelineno-88-5" name="__codelineno-88-5"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-88-6" name="__codelineno-88-6"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-88-7" name="__codelineno-88-7"></a><span class="p">}</span>
<a id="__codelineno-88-8" name="__codelineno-88-8"></a>
<a id="__codelineno-88-9" name="__codelineno-88-9"></a><span class="k">if</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-88-10" name="__codelineno-88-10"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;The seichi exists.&quot;</span><span class="p">)</span>
<a id="__codelineno-88-11" name="__codelineno-88-11"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-88-12" name="__codelineno-88-12"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;The seichi does not exist.&quot;</span><span class="p">)</span>
<a id="__codelineno-88-13" name="__codelineno-88-13"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="_101">リレーションの取得</h2>
<p><code>Seichy</code>構造体は、他のテーブルとのリレーション（外部キー）を持っています。これらのリレーションを使用して、関連するデータを取得できます。</p>
<h3 id="user_1">Userメソッド</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-89-1">1</a></span>
<span class="normal"><a href="#__codelineno-89-2">2</a></span>
<span class="normal"><a href="#__codelineno-89-3">3</a></span>
<span class="normal"><a href="#__codelineno-89-4">4</a></span>
<span class="normal"><a href="#__codelineno-89-5">5</a></span>
<span class="normal"><a href="#__codelineno-89-6">6</a></span>
<span class="normal"><a href="#__codelineno-89-7">7</a></span>
<span class="normal"><a href="#__codelineno-89-8">8</a></span>
<span class="normal"><a href="#__codelineno-89-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-89-1" name="__codelineno-89-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">Seichy</span><span class="p">)</span><span class="w"> </span><span class="nx">User</span><span class="p">(</span><span class="nx">mods</span><span class="w"> </span><span class="o">...</span><span class="nx">qm</span><span class="p">.</span><span class="nx">QueryMod</span><span class="p">)</span><span class="w"> </span><span class="nx">userQuery</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-89-2" name="__codelineno-89-2"></a><span class="w">    </span><span class="nx">queryMods</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="nx">qm</span><span class="p">.</span><span class="nx">QueryMod</span><span class="p">{</span>
<a id="__codelineno-89-3" name="__codelineno-89-3"></a><span class="w">        </span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;`user_id` = ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">UserID</span><span class="p">),</span>
<a id="__codelineno-89-4" name="__codelineno-89-4"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-89-5" name="__codelineno-89-5"></a>
<a id="__codelineno-89-6" name="__codelineno-89-6"></a><span class="w">    </span><span class="nx">queryMods</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">queryMods</span><span class="p">,</span><span class="w"> </span><span class="nx">mods</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-89-7" name="__codelineno-89-7"></a>
<a id="__codelineno-89-8" name="__codelineno-89-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">Users</span><span class="p">(</span><span class="nx">queryMods</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-89-9" name="__codelineno-89-9"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>User</strong>: <code>Seichy</code>に関連付けられた<code>User</code>を取得するクエリを返します。</li>
</ul>
<h4 id="_102">利用例</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-90-1">1</a></span>
<span class="normal"><a href="#__codelineno-90-2">2</a></span>
<span class="normal"><a href="#__codelineno-90-3">3</a></span>
<span class="normal"><a href="#__codelineno-90-4">4</a></span>
<span class="normal"><a href="#__codelineno-90-5">5</a></span>
<span class="normal"><a href="#__codelineno-90-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-90-1" name="__codelineno-90-1"></a><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">seichi</span><span class="p">.</span><span class="nx">User</span><span class="p">().</span><span class="nx">One</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-90-2" name="__codelineno-90-2"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-90-3" name="__codelineno-90-3"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-90-4" name="__codelineno-90-4"></a><span class="p">}</span>
<a id="__codelineno-90-5" name="__codelineno-90-5"></a>
<a id="__codelineno-90-6" name="__codelineno-90-6"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;User Name:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h3 id="place">Placeメソッド</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-91-1">1</a></span>
<span class="normal"><a href="#__codelineno-91-2">2</a></span>
<span class="normal"><a href="#__codelineno-91-3">3</a></span>
<span class="normal"><a href="#__codelineno-91-4">4</a></span>
<span class="normal"><a href="#__codelineno-91-5">5</a></span>
<span class="normal"><a href="#__codelineno-91-6">6</a></span>
<span class="normal"><a href="#__codelineno-91-7">7</a></span>
<span class="normal"><a href="#__codelineno-91-8">8</a></span>
<span class="normal"><a href="#__codelineno-91-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-91-1" name="__codelineno-91-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">Seichy</span><span class="p">)</span><span class="w"> </span><span class="nx">Place</span><span class="p">(</span><span class="nx">mods</span><span class="w"> </span><span class="o">...</span><span class="nx">qm</span><span class="p">.</span><span class="nx">QueryMod</span><span class="p">)</span><span class="w"> </span><span class="nx">placeQuery</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-91-2" name="__codelineno-91-2"></a><span class="w">    </span><span class="nx">queryMods</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="nx">qm</span><span class="p">.</span><span class="nx">QueryMod</span><span class="p">{</span>
<a id="__codelineno-91-3" name="__codelineno-91-3"></a><span class="w">        </span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;`place_id` = ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">PlaceID</span><span class="p">),</span>
<a id="__codelineno-91-4" name="__codelineno-91-4"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-91-5" name="__codelineno-91-5"></a>
<a id="__codelineno-91-6" name="__codelineno-91-6"></a><span class="w">    </span><span class="nx">queryMods</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">queryMods</span><span class="p">,</span><span class="w"> </span><span class="nx">mods</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-91-7" name="__codelineno-91-7"></a>
<a id="__codelineno-91-8" name="__codelineno-91-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">Places</span><span class="p">(</span><span class="nx">queryMods</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-91-9" name="__codelineno-91-9"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>Place</strong>: <code>Seichy</code>に関連付けられた<code>Place</code>を取得するクエリを返します。</li>
</ul>
<h4 id="_103">利用例</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-92-1">1</a></span>
<span class="normal"><a href="#__codelineno-92-2">2</a></span>
<span class="normal"><a href="#__codelineno-92-3">3</a></span>
<span class="normal"><a href="#__codelineno-92-4">4</a></span>
<span class="normal"><a href="#__codelineno-92-5">5</a></span>
<span class="normal"><a href="#__codelineno-92-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-92-1" name="__codelineno-92-1"></a><span class="nx">place</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">seichi</span><span class="p">.</span><span class="nx">Place</span><span class="p">().</span><span class="nx">One</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-92-2" name="__codelineno-92-2"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-92-3" name="__codelineno-92-3"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-92-4" name="__codelineno-92-4"></a><span class="p">}</span>
<a id="__codelineno-92-5" name="__codelineno-92-5"></a>
<a id="__codelineno-92-6" name="__codelineno-92-6"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Place Name:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">place</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h3 id="content">Contentメソッド</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-93-1">1</a></span>
<span class="normal"><a href="#__codelineno-93-2">2</a></span>
<span class="normal"><a href="#__codelineno-93-3">3</a></span>
<span class="normal"><a href="#__codelineno-93-4">4</a></span>
<span class="normal"><a href="#__codelineno-93-5">5</a></span>
<span class="normal"><a href="#__codelineno-93-6">6</a></span>
<span class="normal"><a href="#__codelineno-93-7">7</a></span>
<span class="normal"><a href="#__codelineno-93-8">8</a></span>
<span class="normal"><a href="#__codelineno-93-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-93-1" name="__codelineno-93-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">Seichy</span><span class="p">)</span><span class="w"> </span><span class="nx">Content</span><span class="p">(</span><span class="nx">mods</span><span class="w"> </span><span class="o">...</span><span class="nx">qm</span><span class="p">.</span><span class="nx">QueryMod</span><span class="p">)</span><span class="w"> </span><span class="nx">contentQuery</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-93-2" name="__codelineno-93-2"></a><span class="w">    </span><span class="nx">queryMods</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="nx">qm</span><span class="p">.</span><span class="nx">QueryMod</span><span class="p">{</span>
<a id="__codelineno-93-3" name="__codelineno-93-3"></a><span class="w">        </span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;`content_id` = ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">ContentID</span><span class="p">),</span>
<a id="__codelineno-93-4" name="__codelineno-93-4"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-93-5" name="__codelineno-93-5"></a>
<a id="__codelineno-93-6" name="__codelineno-93-6"></a><span class="w">    </span><span class="nx">queryMods</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">queryMods</span><span class="p">,</span><span class="w"> </span><span class="nx">mods</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-93-7" name="__codelineno-93-7"></a>
<a id="__codelineno-93-8" name="__codelineno-93-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">Contents</span><span class="p">(</span><span class="nx">queryMods</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-93-9" name="__codelineno-93-9"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>Content</strong>: <code>Seichy</code>に関連付けられた<code>Content</code>を取得するクエリを返します。</li>
</ul>
<h4 id="_104">利用例</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-94-1">1</a></span>
<span class="normal"><a href="#__codelineno-94-2">2</a></span>
<span class="normal"><a href="#__codelineno-94-3">3</a></span>
<span class="normal"><a href="#__codelineno-94-4">4</a></span>
<span class="normal"><a href="#__codelineno-94-5">5</a></span>
<span class="normal"><a href="#__codelineno-94-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-94-1" name="__codelineno-94-1"></a><span class="nx">content</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">seichi</span><span class="p">.</span><span class="nx">Content</span><span class="p">().</span><span class="nx">One</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-94-2" name="__codelineno-94-2"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-94-3" name="__codelineno-94-3"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-94-4" name="__codelineno-94-4"></a><span class="p">}</span>
<a id="__codelineno-94-5" name="__codelineno-94-5"></a>
<a id="__codelineno-94-6" name="__codelineno-94-6"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Content Title:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">content</span><span class="p">.</span><span class="nx">Title</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="seichy_7">Seichy 型の関連データのロードに関する詳細な解説</h2>
<p><code>LoadUser</code> および <code>LoadPlace</code> 関数について、コードの全ての部分を詳細に解説します。これらの関数は、データベースから関連するデータを効率的にロードするためのものであり、N対1のリレーションシップを持つデータの取得を行います。開発者がこれらの関数を理解し、適切に利用できるように、具体的なコード例も含めて説明します。</p>
<hr />
<h2 id="loaduser_1"><code>LoadUser</code> 関数の詳細な解説</h2>
<h3 id="_105">関数の概要</h3>
<p><code>LoadUser</code> 関数は、<code>Seichy</code> 構造体（またはそのスライス）に関連する <code>User</code> データを一括でロードし、キャッシュします。これにより、N対1のリレーションシップにおいて、関連するユーザーデータを効率的に取得できます。</p>
<h3 id="_106">関数のシグネチャ</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-95-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-95-1" name="__codelineno-95-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">seichyL</span><span class="p">)</span><span class="w"> </span><span class="nx">LoadUser</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">singular</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="nx">maybeSeichy</span><span class="w"> </span><span class="kd">interface</span><span class="p">{},</span><span class="w"> </span><span class="nx">mods</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">Applicator</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>ctx context.Context</code>：コンテキスト情報を渡すためのもの。</li>
<li><code>e boil.ContextExecutor</code>：データベース操作を行うためのエグゼキューター。</li>
<li><code>singular bool</code>：単一の <code>Seichy</code> オブジェクトか、スライス（複数）のどちらを処理するかを指定。</li>
<li><code>maybeSeichy interface{}</code>：ロード対象の <code>Seichy</code> オブジェクトまたはそのスライス。</li>
<li><code>mods queries.Applicator</code>：クエリに適用する追加の修飾子。</li>
</ul>
<h3 id="_107">コードの詳細な解説</h3>
<h4 id="1">1. 変数の宣言</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-96-1">1</a></span>
<span class="normal"><a href="#__codelineno-96-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-96-1" name="__codelineno-96-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">slice</span><span class="w"> </span><span class="p">[]</span><span class="o">*</span><span class="nx">Seichy</span>
<a id="__codelineno-96-2" name="__codelineno-96-2"></a><span class="kd">var</span><span class="w"> </span><span class="nx">object</span><span class="w"> </span><span class="o">*</span><span class="nx">Seichy</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>単一または複数の <code>Seichy</code> オブジェクトを格納するための変数を宣言します。</li>
</ul>
<h4 id="2">2. オブジェクトの型アサーション</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-97-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-97-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-97-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-97-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-97-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-97-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-97-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-97-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-97-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-97-10">10</a></span>
<span class="normal"><a href="#__codelineno-97-11">11</a></span>
<span class="normal"><a href="#__codelineno-97-12">12</a></span>
<span class="normal"><a href="#__codelineno-97-13">13</a></span>
<span class="normal"><a href="#__codelineno-97-14">14</a></span>
<span class="normal"><a href="#__codelineno-97-15">15</a></span>
<span class="normal"><a href="#__codelineno-97-16">16</a></span>
<span class="normal"><a href="#__codelineno-97-17">17</a></span>
<span class="normal"><a href="#__codelineno-97-18">18</a></span>
<span class="normal"><a href="#__codelineno-97-19">19</a></span>
<span class="normal"><a href="#__codelineno-97-20">20</a></span>
<span class="normal"><a href="#__codelineno-97-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-97-1" name="__codelineno-97-1"></a><span class="k">if</span><span class="w"> </span><span class="nx">singular</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-97-2" name="__codelineno-97-2"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="kt">bool</span>
<a id="__codelineno-97-3" name="__codelineno-97-3"></a><span class="w">    </span><span class="nx">object</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">maybeSeichy</span><span class="p">.(</span><span class="o">*</span><span class="nx">Seichy</span><span class="p">)</span>
<a id="__codelineno-97-4" name="__codelineno-97-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-97-5" name="__codelineno-97-5"></a><span class="w">        </span><span class="nx">object</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">new</span><span class="p">(</span><span class="nx">Seichy</span><span class="p">)</span>
<a id="__codelineno-97-6" name="__codelineno-97-6"></a><span class="w">        </span><span class="nx">ok</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetFromEmbeddedStruct</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">object</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">maybeSeichy</span><span class="p">)</span>
<a id="__codelineno-97-7" name="__codelineno-97-7"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-97-8" name="__codelineno-97-8"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;failed to set %T from embedded struct %T&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">object</span><span class="p">,</span><span class="w"> </span><span class="nx">maybeSeichy</span><span class="p">))</span>
<a id="__codelineno-97-9" name="__codelineno-97-9"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-97-10" name="__codelineno-97-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-97-11" name="__codelineno-97-11"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-97-12" name="__codelineno-97-12"></a><span class="w">    </span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">maybeSeichy</span><span class="p">.(</span><span class="o">*</span><span class="p">[]</span><span class="o">*</span><span class="nx">Seichy</span><span class="p">)</span>
<a id="__codelineno-97-13" name="__codelineno-97-13"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-97-14" name="__codelineno-97-14"></a><span class="w">        </span><span class="nx">slice</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">*</span><span class="nx">s</span>
<a id="__codelineno-97-15" name="__codelineno-97-15"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-97-16" name="__codelineno-97-16"></a><span class="w">        </span><span class="nx">ok</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetFromEmbeddedStruct</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">slice</span><span class="p">,</span><span class="w"> </span><span class="nx">maybeSeichy</span><span class="p">)</span>
<a id="__codelineno-97-17" name="__codelineno-97-17"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-97-18" name="__codelineno-97-18"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;failed to set %T from embedded struct %T&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">slice</span><span class="p">,</span><span class="w"> </span><span class="nx">maybeSeichy</span><span class="p">))</span>
<a id="__codelineno-97-19" name="__codelineno-97-19"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-97-20" name="__codelineno-97-20"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-97-21" name="__codelineno-97-21"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>singular</code> フラグに基づいて、<code>maybeSeichy</code> を適切な型にアサートします。</li>
<li>型アサーションが失敗した場合、埋め込み構造体から値を設定します。</li>
</ul>
<h4 id="3-id">3. 関連するユーザーIDを収集</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-98-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-98-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-98-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-98-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-98-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-98-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-98-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-98-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-98-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-98-10">10</a></span>
<span class="normal"><a href="#__codelineno-98-11">11</a></span>
<span class="normal"><a href="#__codelineno-98-12">12</a></span>
<span class="normal"><a href="#__codelineno-98-13">13</a></span>
<span class="normal"><a href="#__codelineno-98-14">14</a></span>
<span class="normal"><a href="#__codelineno-98-15">15</a></span>
<span class="normal"><a href="#__codelineno-98-16">16</a></span>
<span class="normal"><a href="#__codelineno-98-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-98-1" name="__codelineno-98-1"></a><span class="nx">args</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kd">interface</span><span class="p">{}]</span><span class="kd">struct</span><span class="p">{})</span>
<a id="__codelineno-98-2" name="__codelineno-98-2"></a><span class="k">if</span><span class="w"> </span><span class="nx">singular</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-98-3" name="__codelineno-98-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">object</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-98-4" name="__codelineno-98-4"></a><span class="w">        </span><span class="nx">object</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">seichyR</span><span class="p">{}</span>
<a id="__codelineno-98-5" name="__codelineno-98-5"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-98-6" name="__codelineno-98-6"></a><span class="w">    </span><span class="nx">args</span><span class="p">[</span><span class="nx">object</span><span class="p">.</span><span class="nx">UserID</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}{}</span>
<a id="__codelineno-98-7" name="__codelineno-98-7"></a>
<a id="__codelineno-98-8" name="__codelineno-98-8"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-98-9" name="__codelineno-98-9"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">slice</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-98-10" name="__codelineno-98-10"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">obj</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-98-11" name="__codelineno-98-11"></a><span class="w">            </span><span class="nx">obj</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">seichyR</span><span class="p">{}</span>
<a id="__codelineno-98-12" name="__codelineno-98-12"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-98-13" name="__codelineno-98-13"></a>
<a id="__codelineno-98-14" name="__codelineno-98-14"></a><span class="w">        </span><span class="nx">args</span><span class="p">[</span><span class="nx">obj</span><span class="p">.</span><span class="nx">UserID</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}{}</span>
<a id="__codelineno-98-15" name="__codelineno-98-15"></a>
<a id="__codelineno-98-16" name="__codelineno-98-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-98-17" name="__codelineno-98-17"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>重複を避けるために、マップを使用してユーザーIDを収集します。</li>
<li><code>object.R</code> が <code>nil</code> の場合、新しいリレーションシップフィールドを初期化します。</li>
</ul>
<h4 id="4-id">4. ユーザーIDがない場合の早期リターン</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-99-1">1</a></span>
<span class="normal"><a href="#__codelineno-99-2">2</a></span>
<span class="normal"><a href="#__codelineno-99-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-99-1" name="__codelineno-99-1"></a><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-99-2" name="__codelineno-99-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-99-3" name="__codelineno-99-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ユーザーIDが収集されていない場合、処理を終了します。</li>
</ul>
<h4 id="5">5. クエリの作成</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-100-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-100-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-100-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-100-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-100-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-100-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-100-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-100-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-100-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-100-10">10</a></span>
<span class="normal"><a href="#__codelineno-100-11">11</a></span>
<span class="normal"><a href="#__codelineno-100-12">12</a></span>
<span class="normal"><a href="#__codelineno-100-13">13</a></span>
<span class="normal"><a href="#__codelineno-100-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-100-1" name="__codelineno-100-1"></a><span class="nx">argsSlice</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kd">interface</span><span class="p">{},</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">args</span><span class="p">))</span>
<a id="__codelineno-100-2" name="__codelineno-100-2"></a><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span>
<a id="__codelineno-100-3" name="__codelineno-100-3"></a><span class="k">for</span><span class="w"> </span><span class="nx">arg</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">args</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-100-4" name="__codelineno-100-4"></a><span class="w">    </span><span class="nx">argsSlice</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">arg</span>
<a id="__codelineno-100-5" name="__codelineno-100-5"></a><span class="w">    </span><span class="nx">i</span><span class="o">++</span>
<a id="__codelineno-100-6" name="__codelineno-100-6"></a><span class="p">}</span>
<a id="__codelineno-100-7" name="__codelineno-100-7"></a>
<a id="__codelineno-100-8" name="__codelineno-100-8"></a><span class="nx">query</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">NewQuery</span><span class="p">(</span>
<a id="__codelineno-100-9" name="__codelineno-100-9"></a><span class="w">    </span><span class="nx">qm</span><span class="p">.</span><span class="nx">From</span><span class="p">(</span><span class="s">`users`</span><span class="p">),</span>
<a id="__codelineno-100-10" name="__codelineno-100-10"></a><span class="w">    </span><span class="nx">qm</span><span class="p">.</span><span class="nx">WhereIn</span><span class="p">(</span><span class="s">`users.user_id in ?`</span><span class="p">,</span><span class="w"> </span><span class="nx">argsSlice</span><span class="o">...</span><span class="p">),</span>
<a id="__codelineno-100-11" name="__codelineno-100-11"></a><span class="p">)</span>
<a id="__codelineno-100-12" name="__codelineno-100-12"></a><span class="k">if</span><span class="w"> </span><span class="nx">mods</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-100-13" name="__codelineno-100-13"></a><span class="w">    </span><span class="nx">mods</span><span class="p">.</span><span class="nx">Apply</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span>
<a id="__codelineno-100-14" name="__codelineno-100-14"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>マップからスライスにユーザーIDを変換します。</li>
<li><code>users</code> テーブルから対象のユーザーを取得するクエリを作成します。</li>
<li>追加のクエリ修飾子がある場合、それを適用します。</li>
</ul>
<h4 id="6">6. クエリの実行と結果の取得</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-101-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-101-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-101-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-101-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-101-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-101-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-101-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-101-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-101-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-101-10">10</a></span>
<span class="normal"><a href="#__codelineno-101-11">11</a></span>
<span class="normal"><a href="#__codelineno-101-12">12</a></span>
<span class="normal"><a href="#__codelineno-101-13">13</a></span>
<span class="normal"><a href="#__codelineno-101-14">14</a></span>
<span class="normal"><a href="#__codelineno-101-15">15</a></span>
<span class="normal"><a href="#__codelineno-101-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-101-1" name="__codelineno-101-1"></a><span class="nx">results</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">query</span><span class="p">.</span><span class="nx">QueryContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="p">)</span>
<a id="__codelineno-101-2" name="__codelineno-101-2"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-3" name="__codelineno-101-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;failed to eager load User&quot;</span><span class="p">)</span>
<a id="__codelineno-101-4" name="__codelineno-101-4"></a><span class="p">}</span>
<a id="__codelineno-101-5" name="__codelineno-101-5"></a>
<a id="__codelineno-101-6" name="__codelineno-101-6"></a><span class="kd">var</span><span class="w"> </span><span class="nx">resultSlice</span><span class="w"> </span><span class="p">[]</span><span class="o">*</span><span class="nx">User</span>
<a id="__codelineno-101-7" name="__codelineno-101-7"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">Bind</span><span class="p">(</span><span class="nx">results</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">resultSlice</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-8" name="__codelineno-101-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;failed to bind eager loaded slice User&quot;</span><span class="p">)</span>
<a id="__codelineno-101-9" name="__codelineno-101-9"></a><span class="p">}</span>
<a id="__codelineno-101-10" name="__codelineno-101-10"></a>
<a id="__codelineno-101-11" name="__codelineno-101-11"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">results</span><span class="p">.</span><span class="nx">Close</span><span class="p">();</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-12" name="__codelineno-101-12"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;failed to close results of eager load for users&quot;</span><span class="p">)</span>
<a id="__codelineno-101-13" name="__codelineno-101-13"></a><span class="p">}</span>
<a id="__codelineno-101-14" name="__codelineno-101-14"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">results</span><span class="p">.</span><span class="nx">Err</span><span class="p">();</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-15" name="__codelineno-101-15"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;error occurred during iteration of eager loaded relations for users&quot;</span><span class="p">)</span>
<a id="__codelineno-101-16" name="__codelineno-101-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>クエリを実行し、結果を取得します。</li>
<li>結果を <code>User</code> 型のスライスにバインドします。</li>
<li>結果セットをクローズし、エラーをチェックします。</li>
</ul>
<h4 id="7">7. フックの実行</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-102-1">1</a></span>
<span class="normal"><a href="#__codelineno-102-2">2</a></span>
<span class="normal"><a href="#__codelineno-102-3">3</a></span>
<span class="normal"><a href="#__codelineno-102-4">4</a></span>
<span class="normal"><a href="#__codelineno-102-5">5</a></span>
<span class="normal"><a href="#__codelineno-102-6">6</a></span>
<span class="normal"><a href="#__codelineno-102-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-102-1" name="__codelineno-102-1"></a><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">userAfterSelectHooks</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-102-2" name="__codelineno-102-2"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">resultSlice</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-102-3" name="__codelineno-102-3"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">obj</span><span class="p">.</span><span class="nx">doAfterSelectHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-102-4" name="__codelineno-102-4"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-102-5" name="__codelineno-102-5"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-102-6" name="__codelineno-102-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-102-7" name="__codelineno-102-7"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>User</code> オブジェクトに対して、<code>AfterSelect</code> フックが定義されている場合、それらを実行します。</li>
</ul>
<h4 id="8">8. 結果の関連付け</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-103-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-103-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-103-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-103-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-103-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-103-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-103-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-103-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-103-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-103-10">10</a></span>
<span class="normal"><a href="#__codelineno-103-11">11</a></span>
<span class="normal"><a href="#__codelineno-103-12">12</a></span>
<span class="normal"><a href="#__codelineno-103-13">13</a></span>
<span class="normal"><a href="#__codelineno-103-14">14</a></span>
<span class="normal"><a href="#__codelineno-103-15">15</a></span>
<span class="normal"><a href="#__codelineno-103-16">16</a></span>
<span class="normal"><a href="#__codelineno-103-17">17</a></span>
<span class="normal"><a href="#__codelineno-103-18">18</a></span>
<span class="normal"><a href="#__codelineno-103-19">19</a></span>
<span class="normal"><a href="#__codelineno-103-20">20</a></span>
<span class="normal"><a href="#__codelineno-103-21">21</a></span>
<span class="normal"><a href="#__codelineno-103-22">22</a></span>
<span class="normal"><a href="#__codelineno-103-23">23</a></span>
<span class="normal"><a href="#__codelineno-103-24">24</a></span>
<span class="normal"><a href="#__codelineno-103-25">25</a></span>
<span class="normal"><a href="#__codelineno-103-26">26</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-103-1" name="__codelineno-103-1"></a><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">resultSlice</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-103-2" name="__codelineno-103-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-103-3" name="__codelineno-103-3"></a><span class="p">}</span>
<a id="__codelineno-103-4" name="__codelineno-103-4"></a>
<a id="__codelineno-103-5" name="__codelineno-103-5"></a><span class="k">if</span><span class="w"> </span><span class="nx">singular</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-103-6" name="__codelineno-103-6"></a><span class="w">    </span><span class="nx">foreign</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">resultSlice</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-103-7" name="__codelineno-103-7"></a><span class="w">    </span><span class="nx">object</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">User</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">foreign</span>
<a id="__codelineno-103-8" name="__codelineno-103-8"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">foreign</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-103-9" name="__codelineno-103-9"></a><span class="w">        </span><span class="nx">foreign</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">userR</span><span class="p">{}</span>
<a id="__codelineno-103-10" name="__codelineno-103-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-103-11" name="__codelineno-103-11"></a><span class="w">    </span><span class="nx">foreign</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">Seichies</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">foreign</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">Seichies</span><span class="p">,</span><span class="w"> </span><span class="nx">object</span><span class="p">)</span>
<a id="__codelineno-103-12" name="__codelineno-103-12"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-103-13" name="__codelineno-103-13"></a><span class="p">}</span>
<a id="__codelineno-103-14" name="__codelineno-103-14"></a>
<a id="__codelineno-103-15" name="__codelineno-103-15"></a><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">local</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">slice</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-103-16" name="__codelineno-103-16"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">foreign</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">resultSlice</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-103-17" name="__codelineno-103-17"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">local</span><span class="p">.</span><span class="nx">UserID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">foreign</span><span class="p">.</span><span class="nx">UserID</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-103-18" name="__codelineno-103-18"></a><span class="w">            </span><span class="nx">local</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">User</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">foreign</span>
<a id="__codelineno-103-19" name="__codelineno-103-19"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">foreign</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-103-20" name="__codelineno-103-20"></a><span class="w">                </span><span class="nx">foreign</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">userR</span><span class="p">{}</span>
<a id="__codelineno-103-21" name="__codelineno-103-21"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-103-22" name="__codelineno-103-22"></a><span class="w">            </span><span class="nx">foreign</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">Seichies</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">foreign</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">Seichies</span><span class="p">,</span><span class="w"> </span><span class="nx">local</span><span class="p">)</span>
<a id="__codelineno-103-23" name="__codelineno-103-23"></a><span class="w">            </span><span class="k">break</span>
<a id="__codelineno-103-24" name="__codelineno-103-24"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-103-25" name="__codelineno-103-25"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-103-26" name="__codelineno-103-26"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>単一のオブジェクトの場合、対応するユーザーを設定します。</li>
<li>スライスの場合、各 <code>Seichy</code> オブジェクトに対して、対応する <code>User</code> を関連付けます。</li>
<li>双方向の関連付けを設定し、キャッシュします。</li>
</ul>
<h4 id="9">9. エラーがない場合、成功を返す</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-104-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-104-1" name="__codelineno-104-1"></a><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>全ての処理が成功した場合、<code>nil</code> を返して終了します。</li>
</ul>
<h3 id="_108">開発者向け利用例</h3>
<p>以下に、<code>LoadUser</code> 関数の具体的な利用例を示します。</p>
<h4 id="seichy_8">単一の <code>Seichy</code> オブジェクトの場合</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-105-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-105-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-105-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-105-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-105-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-105-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-105-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-105-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-105-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-105-10">10</a></span>
<span class="normal"><a href="#__codelineno-105-11">11</a></span>
<span class="normal"><a href="#__codelineno-105-12">12</a></span>
<span class="normal"><a href="#__codelineno-105-13">13</a></span>
<span class="normal"><a href="#__codelineno-105-14">14</a></span>
<span class="normal"><a href="#__codelineno-105-15">15</a></span>
<span class="normal"><a href="#__codelineno-105-16">16</a></span>
<span class="normal"><a href="#__codelineno-105-17">17</a></span>
<span class="normal"><a href="#__codelineno-105-18">18</a></span>
<span class="normal"><a href="#__codelineno-105-19">19</a></span>
<span class="normal"><a href="#__codelineno-105-20">20</a></span>
<span class="normal"><a href="#__codelineno-105-21">21</a></span>
<span class="normal"><a href="#__codelineno-105-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-105-1" name="__codelineno-105-1"></a><span class="c1">// データベースエグゼキューターの取得（例）</span>
<a id="__codelineno-105-2" name="__codelineno-105-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;postgres&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;your_connection_string&quot;</span><span class="p">)</span>
<a id="__codelineno-105-3" name="__codelineno-105-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-105-4" name="__codelineno-105-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-105-5" name="__codelineno-105-5"></a><span class="p">}</span>
<a id="__codelineno-105-6" name="__codelineno-105-6"></a>
<a id="__codelineno-105-7" name="__codelineno-105-7"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-105-8" name="__codelineno-105-8"></a>
<a id="__codelineno-105-9" name="__codelineno-105-9"></a><span class="c1">// 単一の Seichy オブジェクトを取得</span>
<a id="__codelineno-105-10" name="__codelineno-105-10"></a><span class="nx">seichy</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Seichies</span><span class="p">(</span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;seichy_id=?&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)).</span><span class="nx">One</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-105-11" name="__codelineno-105-11"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-105-12" name="__codelineno-105-12"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-105-13" name="__codelineno-105-13"></a><span class="p">}</span>
<a id="__codelineno-105-14" name="__codelineno-105-14"></a>
<a id="__codelineno-105-15" name="__codelineno-105-15"></a><span class="c1">// 関連する User をロード</span>
<a id="__codelineno-105-16" name="__codelineno-105-16"></a><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">seichyL</span><span class="p">{}.</span><span class="nx">LoadUser</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">seichy</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<a id="__codelineno-105-17" name="__codelineno-105-17"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-105-18" name="__codelineno-105-18"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-105-19" name="__codelineno-105-19"></a><span class="p">}</span>
<a id="__codelineno-105-20" name="__codelineno-105-20"></a>
<a id="__codelineno-105-21" name="__codelineno-105-21"></a><span class="c1">// ロードされた User データを使用</span>
<a id="__codelineno-105-22" name="__codelineno-105-22"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;User Name:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">seichy</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">User</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h4 id="seichy_9">複数の <code>Seichy</code> オブジェクトの場合</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-106-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-106-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-106-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-106-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-106-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-106-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-106-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-106-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-106-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-106-10">10</a></span>
<span class="normal"><a href="#__codelineno-106-11">11</a></span>
<span class="normal"><a href="#__codelineno-106-12">12</a></span>
<span class="normal"><a href="#__codelineno-106-13">13</a></span>
<span class="normal"><a href="#__codelineno-106-14">14</a></span>
<span class="normal"><a href="#__codelineno-106-15">15</a></span>
<span class="normal"><a href="#__codelineno-106-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-106-1" name="__codelineno-106-1"></a><span class="c1">// 複数の Seichy オブジェクトを取得</span>
<a id="__codelineno-106-2" name="__codelineno-106-2"></a><span class="nx">seichies</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Seichies</span><span class="p">().</span><span class="nx">All</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-106-3" name="__codelineno-106-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-106-4" name="__codelineno-106-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-106-5" name="__codelineno-106-5"></a><span class="p">}</span>
<a id="__codelineno-106-6" name="__codelineno-106-6"></a>
<a id="__codelineno-106-7" name="__codelineno-106-7"></a><span class="c1">// 関連する User を一括でロード</span>
<a id="__codelineno-106-8" name="__codelineno-106-8"></a><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">seichyL</span><span class="p">{}.</span><span class="nx">LoadUser</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nx">seichies</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<a id="__codelineno-106-9" name="__codelineno-106-9"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-106-10" name="__codelineno-106-10"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-106-11" name="__codelineno-106-11"></a><span class="p">}</span>
<a id="__codelineno-106-12" name="__codelineno-106-12"></a>
<a id="__codelineno-106-13" name="__codelineno-106-13"></a><span class="c1">// 各 Seichy オブジェクトの User データを利用</span>
<a id="__codelineno-106-14" name="__codelineno-106-14"></a><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">seichies</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-106-15" name="__codelineno-106-15"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Seichy ID: %d, User Name: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">SeichyID</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">User</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
<a id="__codelineno-106-16" name="__codelineno-106-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="loadplace"><code>LoadPlace</code> 関数の詳細な解説</h2>
<h3 id="_109">関数の概要</h3>
<p><code>LoadPlace</code> 関数は、<code>Seichy</code> 構造体（またはそのスライス）に関連する <code>Place</code> データを一括でロードし、キャッシュします。これにより、N対1のリレーションシップにおいて、関連する場所のデータを効率的に取得できます。</p>
<h3 id="_110">関数のシグネチャ</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-107-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-107-1" name="__codelineno-107-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">seichyL</span><span class="p">)</span><span class="w"> </span><span class="nx">LoadPlace</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">singular</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="nx">maybeSeichy</span><span class="w"> </span><span class="kd">interface</span><span class="p">{},</span><span class="w"> </span><span class="nx">mods</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">Applicator</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>引数や戻り値は <code>LoadUser</code> 関数と同様ですが、<code>Place</code> データをロードするためのものです。</li>
</ul>
<h3 id="_111">コードの詳細な解説</h3>
<p><code>LoadUser</code> 関数と同様の処理を行いますが、対象が <code>User</code> ではなく <code>Place</code> である点が異なります。</p>
<h4 id="1_1">1. 変数の宣言</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-108-1">1</a></span>
<span class="normal"><a href="#__codelineno-108-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-108-1" name="__codelineno-108-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">slice</span><span class="w"> </span><span class="p">[]</span><span class="o">*</span><span class="nx">Seichy</span>
<a id="__codelineno-108-2" name="__codelineno-108-2"></a><span class="kd">var</span><span class="w"> </span><span class="nx">object</span><span class="w"> </span><span class="o">*</span><span class="nx">Seichy</span>
</code></pre></div></td></tr></table></div>
<h4 id="2_1">2. オブジェクトの型アサーション</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-109-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-109-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-109-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-109-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-109-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-109-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-109-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-109-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-109-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-109-10">10</a></span>
<span class="normal"><a href="#__codelineno-109-11">11</a></span>
<span class="normal"><a href="#__codelineno-109-12">12</a></span>
<span class="normal"><a href="#__codelineno-109-13">13</a></span>
<span class="normal"><a href="#__codelineno-109-14">14</a></span>
<span class="normal"><a href="#__codelineno-109-15">15</a></span>
<span class="normal"><a href="#__codelineno-109-16">16</a></span>
<span class="normal"><a href="#__codelineno-109-17">17</a></span>
<span class="normal"><a href="#__codelineno-109-18">18</a></span>
<span class="normal"><a href="#__codelineno-109-19">19</a></span>
<span class="normal"><a href="#__codelineno-109-20">20</a></span>
<span class="normal"><a href="#__codelineno-109-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-109-1" name="__codelineno-109-1"></a><span class="k">if</span><span class="w"> </span><span class="nx">singular</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-109-2" name="__codelineno-109-2"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="kt">bool</span>
<a id="__codelineno-109-3" name="__codelineno-109-3"></a><span class="w">    </span><span class="nx">object</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">maybeSeichy</span><span class="p">.(</span><span class="o">*</span><span class="nx">Seichy</span><span class="p">)</span>
<a id="__codelineno-109-4" name="__codelineno-109-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-109-5" name="__codelineno-109-5"></a><span class="w">        </span><span class="nx">object</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">new</span><span class="p">(</span><span class="nx">Seichy</span><span class="p">)</span>
<a id="__codelineno-109-6" name="__codelineno-109-6"></a><span class="w">        </span><span class="nx">ok</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetFromEmbeddedStruct</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">object</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">maybeSeichy</span><span class="p">)</span>
<a id="__codelineno-109-7" name="__codelineno-109-7"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-109-8" name="__codelineno-109-8"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;failed to set %T from embedded struct %T&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">object</span><span class="p">,</span><span class="w"> </span><span class="nx">maybeSeichy</span><span class="p">))</span>
<a id="__codelineno-109-9" name="__codelineno-109-9"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-109-10" name="__codelineno-109-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-109-11" name="__codelineno-109-11"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-109-12" name="__codelineno-109-12"></a><span class="w">    </span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">maybeSeichy</span><span class="p">.(</span><span class="o">*</span><span class="p">[]</span><span class="o">*</span><span class="nx">Seichy</span><span class="p">)</span>
<a id="__codelineno-109-13" name="__codelineno-109-13"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-109-14" name="__codelineno-109-14"></a><span class="w">        </span><span class="nx">slice</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">*</span><span class="nx">s</span>
<a id="__codelineno-109-15" name="__codelineno-109-15"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-109-16" name="__codelineno-109-16"></a><span class="w">        </span><span class="nx">ok</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetFromEmbeddedStruct</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">slice</span><span class="p">,</span><span class="w"> </span><span class="nx">maybeSeichy</span><span class="p">)</span>
<a id="__codelineno-109-17" name="__codelineno-109-17"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-109-18" name="__codelineno-109-18"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;failed to set %T from embedded struct %T&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">slice</span><span class="p">,</span><span class="w"> </span><span class="nx">maybeSeichy</span><span class="p">))</span>
<a id="__codelineno-109-19" name="__codelineno-109-19"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-109-20" name="__codelineno-109-20"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-109-21" name="__codelineno-109-21"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="3-id_1">3. 関連する場所IDを収集</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-110-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-110-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-110-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-110-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-110-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-110-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-110-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-110-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-110-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-110-10">10</a></span>
<span class="normal"><a href="#__codelineno-110-11">11</a></span>
<span class="normal"><a href="#__codelineno-110-12">12</a></span>
<span class="normal"><a href="#__codelineno-110-13">13</a></span>
<span class="normal"><a href="#__codelineno-110-14">14</a></span>
<span class="normal"><a href="#__codelineno-110-15">15</a></span>
<span class="normal"><a href="#__codelineno-110-16">16</a></span>
<span class="normal"><a href="#__codelineno-110-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-110-1" name="__codelineno-110-1"></a><span class="nx">args</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kd">interface</span><span class="p">{}]</span><span class="kd">struct</span><span class="p">{})</span>
<a id="__codelineno-110-2" name="__codelineno-110-2"></a><span class="k">if</span><span class="w"> </span><span class="nx">singular</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-110-3" name="__codelineno-110-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">object</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-110-4" name="__codelineno-110-4"></a><span class="w">        </span><span class="nx">object</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">seichyR</span><span class="p">{}</span>
<a id="__codelineno-110-5" name="__codelineno-110-5"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-110-6" name="__codelineno-110-6"></a><span class="w">    </span><span class="nx">args</span><span class="p">[</span><span class="nx">object</span><span class="p">.</span><span class="nx">PlaceID</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}{}</span>
<a id="__codelineno-110-7" name="__codelineno-110-7"></a>
<a id="__codelineno-110-8" name="__codelineno-110-8"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-110-9" name="__codelineno-110-9"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">slice</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-110-10" name="__codelineno-110-10"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">obj</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-110-11" name="__codelineno-110-11"></a><span class="w">            </span><span class="nx">obj</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">seichyR</span><span class="p">{}</span>
<a id="__codelineno-110-12" name="__codelineno-110-12"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-110-13" name="__codelineno-110-13"></a>
<a id="__codelineno-110-14" name="__codelineno-110-14"></a><span class="w">        </span><span class="nx">args</span><span class="p">[</span><span class="nx">obj</span><span class="p">.</span><span class="nx">PlaceID</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}{}</span>
<a id="__codelineno-110-15" name="__codelineno-110-15"></a>
<a id="__codelineno-110-16" name="__codelineno-110-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-110-17" name="__codelineno-110-17"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>PlaceID</code> を収集します。</li>
</ul>
<h4 id="4-id_1">4. 場所IDがない場合の早期リターン</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-111-1">1</a></span>
<span class="normal"><a href="#__codelineno-111-2">2</a></span>
<span class="normal"><a href="#__codelineno-111-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-111-1" name="__codelineno-111-1"></a><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-111-2" name="__codelineno-111-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-111-3" name="__codelineno-111-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="5_1">5. クエリの作成</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-112-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-112-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-112-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-112-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-112-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-112-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-112-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-112-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-112-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-112-10">10</a></span>
<span class="normal"><a href="#__codelineno-112-11">11</a></span>
<span class="normal"><a href="#__codelineno-112-12">12</a></span>
<span class="normal"><a href="#__codelineno-112-13">13</a></span>
<span class="normal"><a href="#__codelineno-112-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-112-1" name="__codelineno-112-1"></a><span class="nx">argsSlice</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kd">interface</span><span class="p">{},</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">args</span><span class="p">))</span>
<a id="__codelineno-112-2" name="__codelineno-112-2"></a><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span>
<a id="__codelineno-112-3" name="__codelineno-112-3"></a><span class="k">for</span><span class="w"> </span><span class="nx">arg</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">args</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-112-4" name="__codelineno-112-4"></a><span class="w">    </span><span class="nx">argsSlice</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">arg</span>
<a id="__codelineno-112-5" name="__codelineno-112-5"></a><span class="w">    </span><span class="nx">i</span><span class="o">++</span>
<a id="__codelineno-112-6" name="__codelineno-112-6"></a><span class="p">}</span>
<a id="__codelineno-112-7" name="__codelineno-112-7"></a>
<a id="__codelineno-112-8" name="__codelineno-112-8"></a><span class="nx">query</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">NewQuery</span><span class="p">(</span>
<a id="__codelineno-112-9" name="__codelineno-112-9"></a><span class="w">    </span><span class="nx">qm</span><span class="p">.</span><span class="nx">From</span><span class="p">(</span><span class="s">`places`</span><span class="p">),</span>
<a id="__codelineno-112-10" name="__codelineno-112-10"></a><span class="w">    </span><span class="nx">qm</span><span class="p">.</span><span class="nx">WhereIn</span><span class="p">(</span><span class="s">`places.place_id in ?`</span><span class="p">,</span><span class="w"> </span><span class="nx">argsSlice</span><span class="o">...</span><span class="p">),</span>
<a id="__codelineno-112-11" name="__codelineno-112-11"></a><span class="p">)</span>
<a id="__codelineno-112-12" name="__codelineno-112-12"></a><span class="k">if</span><span class="w"> </span><span class="nx">mods</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-112-13" name="__codelineno-112-13"></a><span class="w">    </span><span class="nx">mods</span><span class="p">.</span><span class="nx">Apply</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span>
<a id="__codelineno-112-14" name="__codelineno-112-14"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>places</code> テーブルから対象の場所を取得するクエリを作成します。</li>
</ul>
<h4 id="6_1">6. クエリの実行と結果の取得</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-113-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-113-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-113-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-113-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-113-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-113-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-113-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-113-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-113-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-113-10">10</a></span>
<span class="normal"><a href="#__codelineno-113-11">11</a></span>
<span class="normal"><a href="#__codelineno-113-12">12</a></span>
<span class="normal"><a href="#__codelineno-113-13">13</a></span>
<span class="normal"><a href="#__codelineno-113-14">14</a></span>
<span class="normal"><a href="#__codelineno-113-15">15</a></span>
<span class="normal"><a href="#__codelineno-113-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-113-1" name="__codelineno-113-1"></a><span class="nx">results</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">query</span><span class="p">.</span><span class="nx">QueryContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="p">)</span>
<a id="__codelineno-113-2" name="__codelineno-113-2"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-113-3" name="__codelineno-113-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;failed to eager load Place&quot;</span><span class="p">)</span>
<a id="__codelineno-113-4" name="__codelineno-113-4"></a><span class="p">}</span>
<a id="__codelineno-113-5" name="__codelineno-113-5"></a>
<a id="__codelineno-113-6" name="__codelineno-113-6"></a><span class="kd">var</span><span class="w"> </span><span class="nx">resultSlice</span><span class="w"> </span><span class="p">[]</span><span class="o">*</span><span class="nx">Place</span>
<a id="__codelineno-113-7" name="__codelineno-113-7"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">Bind</span><span class="p">(</span><span class="nx">results</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">resultSlice</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-113-8" name="__codelineno-113-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;failed to bind eager loaded slice Place&quot;</span><span class="p">)</span>
<a id="__codelineno-113-9" name="__codelineno-113-9"></a><span class="p">}</span>
<a id="__codelineno-113-10" name="__codelineno-113-10"></a>
<a id="__codelineno-113-11" name="__codelineno-113-11"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">results</span><span class="p">.</span><span class="nx">Close</span><span class="p">();</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-113-12" name="__codelineno-113-12"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;failed to close results of eager load for places&quot;</span><span class="p">)</span>
<a id="__codelineno-113-13" name="__codelineno-113-13"></a><span class="p">}</span>
<a id="__codelineno-113-14" name="__codelineno-113-14"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">results</span><span class="p">.</span><span class="nx">Err</span><span class="p">();</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-113-15" name="__codelineno-113-15"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;error occurred during iteration of eager loaded relations for places&quot;</span><span class="p">)</span>
<a id="__codelineno-113-16" name="__codelineno-113-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="7_1">7. フックの実行</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-114-1">1</a></span>
<span class="normal"><a href="#__codelineno-114-2">2</a></span>
<span class="normal"><a href="#__codelineno-114-3">3</a></span>
<span class="normal"><a href="#__codelineno-114-4">4</a></span>
<span class="normal"><a href="#__codelineno-114-5">5</a></span>
<span class="normal"><a href="#__codelineno-114-6">6</a></span>
<span class="normal"><a href="#__codelineno-114-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-114-1" name="__codelineno-114-1"></a><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">placeAfterSelectHooks</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-114-2" name="__codelineno-114-2"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">resultSlice</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-114-3" name="__codelineno-114-3"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">obj</span><span class="p">.</span><span class="nx">doAfterSelectHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-114-4" name="__codelineno-114-4"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-114-5" name="__codelineno-114-5"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-114-6" name="__codelineno-114-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-114-7" name="__codelineno-114-7"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>Place</code> オブジェクトに対して、<code>AfterSelect</code> フックが定義されている場合、それらを実行します。</li>
</ul>
<h4 id="8_1">8. 結果の関連付け</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-115-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-115-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-115-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-115-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-115-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-115-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-115-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-115-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-115-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-115-10">10</a></span>
<span class="normal"><a href="#__codelineno-115-11">11</a></span>
<span class="normal"><a href="#__codelineno-115-12">12</a></span>
<span class="normal"><a href="#__codelineno-115-13">13</a></span>
<span class="normal"><a href="#__codelineno-115-14">14</a></span>
<span class="normal"><a href="#__codelineno-115-15">15</a></span>
<span class="normal"><a href="#__codelineno-115-16">16</a></span>
<span class="normal"><a href="#__codelineno-115-17">17</a></span>
<span class="normal"><a href="#__codelineno-115-18">18</a></span>
<span class="normal"><a href="#__codelineno-115-19">19</a></span>
<span class="normal"><a href="#__codelineno-115-20">20</a></span>
<span class="normal"><a href="#__codelineno-115-21">21</a></span>
<span class="normal"><a href="#__codelineno-115-22">22</a></span>
<span class="normal"><a href="#__codelineno-115-23">23</a></span>
<span class="normal"><a href="#__codelineno-115-24">24</a></span>
<span class="normal"><a href="#__codelineno-115-25">25</a></span>
<span class="normal"><a href="#__codelineno-115-26">26</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-115-1" name="__codelineno-115-1"></a><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">resultSlice</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-115-2" name="__codelineno-115-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-115-3" name="__codelineno-115-3"></a><span class="p">}</span>
<a id="__codelineno-115-4" name="__codelineno-115-4"></a>
<a id="__codelineno-115-5" name="__codelineno-115-5"></a><span class="k">if</span><span class="w"> </span><span class="nx">singular</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-115-6" name="__codelineno-115-6"></a><span class="w">    </span><span class="nx">foreign</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">resultSlice</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-115-7" name="__codelineno-115-7"></a><span class="w">    </span><span class="nx">object</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">Place</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">foreign</span>
<a id="__codelineno-115-8" name="__codelineno-115-8"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">foreign</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-115-9" name="__codelineno-115-9"></a><span class="w">        </span><span class="nx">foreign</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">placeR</span><span class="p">{}</span>
<a id="__codelineno-115-10" name="__codelineno-115-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-115-11" name="__codelineno-115-11"></a><span class="w">    </span><span class="nx">foreign</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">Seichies</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">foreign</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">Seichies</span><span class="p">,</span><span class="w"> </span><span class="nx">object</span><span class="p">)</span>
<a id="__codelineno-115-12" name="__codelineno-115-12"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-115-13" name="__codelineno-115-13"></a><span class="p">}</span>
<a id="__codelineno-115-14" name="__codelineno-115-14"></a>
<a id="__codelineno-115-15" name="__codelineno-115-15"></a><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">local</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">slice</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-115-16" name="__codelineno-115-16"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">foreign</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">resultSlice</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-115-17" name="__codelineno-115-17"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">local</span><span class="p">.</span><span class="nx">PlaceID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">foreign</span><span class="p">.</span><span class="nx">PlaceID</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-115-18" name="__codelineno-115-18"></a><span class="w">            </span><span class="nx">local</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">Place</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">foreign</span>
<a id="__codelineno-115-19" name="__codelineno-115-19"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">foreign</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-115-20" name="__codelineno-115-20"></a><span class="w">                </span><span class="nx">foreign</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">placeR</span><span class="p">{}</span>
<a id="__codelineno-115-21" name="__codelineno-115-21"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-115-22" name="__codelineno-115-22"></a><span class="w">            </span><span class="nx">foreign</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">Seichies</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">foreign</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">Seichies</span><span class="p">,</span><span class="w"> </span><span class="nx">local</span><span class="p">)</span>
<a id="__codelineno-115-23" name="__codelineno-115-23"></a><span class="w">            </span><span class="k">break</span>
<a id="__codelineno-115-24" name="__codelineno-115-24"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-115-25" name="__codelineno-115-25"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-115-26" name="__codelineno-115-26"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="9_1">9. エラーがない場合、成功を返す</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-116-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-116-1" name="__codelineno-116-1"></a><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
</code></pre></div></td></tr></table></div>
<h3 id="_112">開発者向け利用例</h3>
<h4 id="seichy_10">単一の <code>Seichy</code> オブジェクトの場合</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-117-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-117-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-117-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-117-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-117-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-117-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-117-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-117-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-117-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-117-10">10</a></span>
<span class="normal"><a href="#__codelineno-117-11">11</a></span>
<span class="normal"><a href="#__codelineno-117-12">12</a></span>
<span class="normal"><a href="#__codelineno-117-13">13</a></span>
<span class="normal"><a href="#__codelineno-117-14">14</a></span>
<span class="normal"><a href="#__codelineno-117-15">15</a></span>
<span class="normal"><a href="#__codelineno-117-16">16</a></span>
<span class="normal"><a href="#__codelineno-117-17">17</a></span>
<span class="normal"><a href="#__codelineno-117-18">18</a></span>
<span class="normal"><a href="#__codelineno-117-19">19</a></span>
<span class="normal"><a href="#__codelineno-117-20">20</a></span>
<span class="normal"><a href="#__codelineno-117-21">21</a></span>
<span class="normal"><a href="#__codelineno-117-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-117-1" name="__codelineno-117-1"></a><span class="c1">// データベースエグゼキューターの取得（例）</span>
<a id="__codelineno-117-2" name="__codelineno-117-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;postgres&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;your_connection_string&quot;</span><span class="p">)</span>
<a id="__codelineno-117-3" name="__codelineno-117-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-117-4" name="__codelineno-117-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-117-5" name="__codelineno-117-5"></a><span class="p">}</span>
<a id="__codelineno-117-6" name="__codelineno-117-6"></a>
<a id="__codelineno-117-7" name="__codelineno-117-7"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-117-8" name="__codelineno-117-8"></a>
<a id="__codelineno-117-9" name="__codelineno-117-9"></a><span class="c1">// 単一の Seichy オブジェクトを取得</span>
<a id="__codelineno-117-10" name="__codelineno-117-10"></a><span class="nx">seichy</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Seichies</span><span class="p">(</span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;seichy_id=?&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)).</span><span class="nx">One</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-117-11" name="__codelineno-117-11"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-117-12" name="__codelineno-117-12"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-117-13" name="__codelineno-117-13"></a><span class="p">}</span>
<a id="__codelineno-117-14" name="__codelineno-117-14"></a>
<a id="__codelineno-117-15" name="__codelineno-117-15"></a><span class="c1">// 関連する Place をロード</span>
<a id="__codelineno-117-16" name="__codelineno-117-16"></a><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">seichyL</span><span class="p">{}.</span><span class="nx">LoadPlace</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">seichy</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<a id="__codelineno-117-17" name="__codelineno-117-17"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-117-18" name="__codelineno-117-18"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-117-19" name="__codelineno-117-19"></a><span class="p">}</span>
<a id="__codelineno-117-20" name="__codelineno-117-20"></a>
<a id="__codelineno-117-21" name="__codelineno-117-21"></a><span class="c1">// ロードされた Place データを使用</span>
<a id="__codelineno-117-22" name="__codelineno-117-22"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Place Name:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">seichy</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">Place</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h4 id="seichy_11">複数の <code>Seichy</code> オブジェクトの場合</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-118-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-118-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-118-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-118-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-118-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-118-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-118-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-118-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-118-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-118-10">10</a></span>
<span class="normal"><a href="#__codelineno-118-11">11</a></span>
<span class="normal"><a href="#__codelineno-118-12">12</a></span>
<span class="normal"><a href="#__codelineno-118-13">13</a></span>
<span class="normal"><a href="#__codelineno-118-14">14</a></span>
<span class="normal"><a href="#__codelineno-118-15">15</a></span>
<span class="normal"><a href="#__codelineno-118-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-118-1" name="__codelineno-118-1"></a><span class="c1">// 複数の Seichy オブジェクトを取得</span>
<a id="__codelineno-118-2" name="__codelineno-118-2"></a><span class="nx">seichies</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Seichies</span><span class="p">().</span><span class="nx">All</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-118-3" name="__codelineno-118-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-118-4" name="__codelineno-118-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-118-5" name="__codelineno-118-5"></a><span class="p">}</span>
<a id="__codelineno-118-6" name="__codelineno-118-6"></a>
<a id="__codelineno-118-7" name="__codelineno-118-7"></a><span class="c1">// 関連する Place を一括でロード</span>
<a id="__codelineno-118-8" name="__codelineno-118-8"></a><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">seichyL</span><span class="p">{}.</span><span class="nx">LoadPlace</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nx">seichies</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<a id="__codelineno-118-9" name="__codelineno-118-9"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-118-10" name="__codelineno-118-10"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-118-11" name="__codelineno-118-11"></a><span class="p">}</span>
<a id="__codelineno-118-12" name="__codelineno-118-12"></a>
<a id="__codelineno-118-13" name="__codelineno-118-13"></a><span class="c1">// 各 Seichy オブジェクトの Place データを利用</span>
<a id="__codelineno-118-14" name="__codelineno-118-14"></a><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">seichies</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-118-15" name="__codelineno-118-15"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Seichy ID: %d, Place Name: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">SeichyID</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">Place</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
<a id="__codelineno-118-16" name="__codelineno-118-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="_113">注意事項</h2>
<ul>
<li><code>LoadUser</code> および <code>LoadPlace</code> 関数は、関連するデータを一括で取得し、オブジェクトのリレーションフィールドにキャッシュします。</li>
<li><code>singular</code> フラグを正しく設定することで、単一または複数のオブジェクトに対応できます。</li>
<li>エラー処理を適切に行い、データの不整合やヌルポインタ参照を防ぎます。</li>
</ul>
<p><code>LoadUser</code> と <code>LoadPlace</code> 関数を使用することで、<code>Seichy</code> オブジェクトに関連する <code>User</code> や <code>Place</code> データを効率的にロードできます。これらの関数は、データベースからのデータ取得を最適化し、N対1のリレーションシップを持つモデル間の関連付けを簡素化します。</p>
<hr />
<h2 id="loadcontent-setuser"><code>LoadContent</code> 関数と <code>SetUser</code> 関数の詳細な解説</h2>
<p><code>LoadContent</code> 関数および <code>SetUser</code> 関数について、コードの全ての部分を詳細に解説します。これらの関数は、データベースから関連するデータを効率的にロードおよび設定するためのものであり、N対1のリレーションシップを持つデータの取得と関連付けを行います。開発者がこれらの関数を理解し、適切に利用できるように、具体的なコード例も含めて説明します。</p>
<hr />
<h2 id="loadcontent"><code>LoadContent</code> 関数の詳細な解説</h2>
<h3 id="_114">関数の概要</h3>
<p><code>LoadContent</code> 関数は、<code>Seichy</code> 構造体（またはそのスライス）に関連する <code>Content</code> データを一括でロードし、キャッシュします。これにより、N対1のリレーションシップにおいて、関連するコンテンツデータを効率的に取得できます。</p>
<h3 id="_115">関数のシグネチャ</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-119-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-119-1" name="__codelineno-119-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">seichyL</span><span class="p">)</span><span class="w"> </span><span class="nx">LoadContent</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">singular</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="nx">maybeSeichy</span><span class="w"> </span><span class="kd">interface</span><span class="p">{},</span><span class="w"> </span><span class="nx">mods</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">Applicator</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>ctx context.Context</code>：コンテキスト情報を渡すためのもの。</li>
<li><code>e boil.ContextExecutor</code>：データベース操作を行うためのエグゼキューター。</li>
<li><code>singular bool</code>：単一の <code>Seichy</code> オブジェクトか、スライス（複数）のどちらを処理するかを指定。</li>
<li><code>maybeSeichy interface{}</code>：ロード対象の <code>Seichy</code> オブジェクトまたはそのスライス。</li>
<li><code>mods queries.Applicator</code>：クエリに適用する追加の修飾子。</li>
</ul>
<h3 id="_116">コードの詳細な解説</h3>
<h4 id="1_2">1. 変数の宣言</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-120-1">1</a></span>
<span class="normal"><a href="#__codelineno-120-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-120-1" name="__codelineno-120-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">slice</span><span class="w"> </span><span class="p">[]</span><span class="o">*</span><span class="nx">Seichy</span>
<a id="__codelineno-120-2" name="__codelineno-120-2"></a><span class="kd">var</span><span class="w"> </span><span class="nx">object</span><span class="w"> </span><span class="o">*</span><span class="nx">Seichy</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>関数内で使用する変数を宣言します。</li>
<li><code>slice</code>：<code>Seichy</code> のスライスを格納するための変数。</li>
<li><code>object</code>：単一の <code>Seichy</code> オブジェクトを格納するための変数。</li>
</ul>
<h4 id="2_2">2. オブジェクトの型アサーション</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-121-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-121-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-121-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-121-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-121-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-121-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-121-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-121-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-121-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-121-10">10</a></span>
<span class="normal"><a href="#__codelineno-121-11">11</a></span>
<span class="normal"><a href="#__codelineno-121-12">12</a></span>
<span class="normal"><a href="#__codelineno-121-13">13</a></span>
<span class="normal"><a href="#__codelineno-121-14">14</a></span>
<span class="normal"><a href="#__codelineno-121-15">15</a></span>
<span class="normal"><a href="#__codelineno-121-16">16</a></span>
<span class="normal"><a href="#__codelineno-121-17">17</a></span>
<span class="normal"><a href="#__codelineno-121-18">18</a></span>
<span class="normal"><a href="#__codelineno-121-19">19</a></span>
<span class="normal"><a href="#__codelineno-121-20">20</a></span>
<span class="normal"><a href="#__codelineno-121-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-121-1" name="__codelineno-121-1"></a><span class="k">if</span><span class="w"> </span><span class="nx">singular</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-121-2" name="__codelineno-121-2"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="kt">bool</span>
<a id="__codelineno-121-3" name="__codelineno-121-3"></a><span class="w">    </span><span class="nx">object</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">maybeSeichy</span><span class="p">.(</span><span class="o">*</span><span class="nx">Seichy</span><span class="p">)</span>
<a id="__codelineno-121-4" name="__codelineno-121-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-121-5" name="__codelineno-121-5"></a><span class="w">        </span><span class="nx">object</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">new</span><span class="p">(</span><span class="nx">Seichy</span><span class="p">)</span>
<a id="__codelineno-121-6" name="__codelineno-121-6"></a><span class="w">        </span><span class="nx">ok</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetFromEmbeddedStruct</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">object</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">maybeSeichy</span><span class="p">)</span>
<a id="__codelineno-121-7" name="__codelineno-121-7"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-121-8" name="__codelineno-121-8"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;failed to set %T from embedded struct %T&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">object</span><span class="p">,</span><span class="w"> </span><span class="nx">maybeSeichy</span><span class="p">))</span>
<a id="__codelineno-121-9" name="__codelineno-121-9"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-121-10" name="__codelineno-121-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-121-11" name="__codelineno-121-11"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-121-12" name="__codelineno-121-12"></a><span class="w">    </span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">maybeSeichy</span><span class="p">.(</span><span class="o">*</span><span class="p">[]</span><span class="o">*</span><span class="nx">Seichy</span><span class="p">)</span>
<a id="__codelineno-121-13" name="__codelineno-121-13"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-121-14" name="__codelineno-121-14"></a><span class="w">        </span><span class="nx">slice</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">*</span><span class="nx">s</span>
<a id="__codelineno-121-15" name="__codelineno-121-15"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-121-16" name="__codelineno-121-16"></a><span class="w">        </span><span class="nx">ok</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetFromEmbeddedStruct</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">slice</span><span class="p">,</span><span class="w"> </span><span class="nx">maybeSeichy</span><span class="p">)</span>
<a id="__codelineno-121-17" name="__codelineno-121-17"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-121-18" name="__codelineno-121-18"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;failed to set %T from embedded struct %T&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">slice</span><span class="p">,</span><span class="w"> </span><span class="nx">maybeSeichy</span><span class="p">))</span>
<a id="__codelineno-121-19" name="__codelineno-121-19"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-121-20" name="__codelineno-121-20"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-121-21" name="__codelineno-121-21"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>singular</code> フラグに基づいて、<code>maybeSeichy</code> を適切な型にアサートします。</li>
<li>単一の場合：<code>*Seichy</code> 型にアサート。</li>
<li>スライスの場合：<code>*[]*Seichy</code> 型にアサート。</li>
<li>型アサーションが失敗した場合、埋め込み構造体から値を設定します。</li>
<li>アサーションまたは設定に失敗した場合、エラーを返します。</li>
</ul>
<h4 id="3-id_2">3. 関連するコンテンツIDを収集</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-122-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-122-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-122-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-122-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-122-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-122-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-122-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-122-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-122-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-122-10">10</a></span>
<span class="normal"><a href="#__codelineno-122-11">11</a></span>
<span class="normal"><a href="#__codelineno-122-12">12</a></span>
<span class="normal"><a href="#__codelineno-122-13">13</a></span>
<span class="normal"><a href="#__codelineno-122-14">14</a></span>
<span class="normal"><a href="#__codelineno-122-15">15</a></span>
<span class="normal"><a href="#__codelineno-122-16">16</a></span>
<span class="normal"><a href="#__codelineno-122-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-122-1" name="__codelineno-122-1"></a><span class="nx">args</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kd">interface</span><span class="p">{}]</span><span class="kd">struct</span><span class="p">{})</span>
<a id="__codelineno-122-2" name="__codelineno-122-2"></a><span class="k">if</span><span class="w"> </span><span class="nx">singular</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-122-3" name="__codelineno-122-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">object</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-122-4" name="__codelineno-122-4"></a><span class="w">        </span><span class="nx">object</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">seichyR</span><span class="p">{}</span>
<a id="__codelineno-122-5" name="__codelineno-122-5"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-122-6" name="__codelineno-122-6"></a><span class="w">    </span><span class="nx">args</span><span class="p">[</span><span class="nx">object</span><span class="p">.</span><span class="nx">ContentID</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}{}</span>
<a id="__codelineno-122-7" name="__codelineno-122-7"></a>
<a id="__codelineno-122-8" name="__codelineno-122-8"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-122-9" name="__codelineno-122-9"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">slice</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-122-10" name="__codelineno-122-10"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">obj</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-122-11" name="__codelineno-122-11"></a><span class="w">            </span><span class="nx">obj</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">seichyR</span><span class="p">{}</span>
<a id="__codelineno-122-12" name="__codelineno-122-12"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-122-13" name="__codelineno-122-13"></a>
<a id="__codelineno-122-14" name="__codelineno-122-14"></a><span class="w">        </span><span class="nx">args</span><span class="p">[</span><span class="nx">obj</span><span class="p">.</span><span class="nx">ContentID</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}{}</span>
<a id="__codelineno-122-15" name="__codelineno-122-15"></a>
<a id="__codelineno-122-16" name="__codelineno-122-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-122-17" name="__codelineno-122-17"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>重複を避けるために、マップを使用してコンテンツIDを収集します。</li>
<li><code>object.R</code> または <code>obj.R</code> が <code>nil</code> の場合、新しいリレーションシップフィールドを初期化します。</li>
<li>単一または複数の <code>Seichy</code> オブジェクトから、それぞれの <code>ContentID</code> をマップに追加します。</li>
</ul>
<h4 id="4-id_2">4. コンテンツIDがない場合の早期リターン</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-123-1">1</a></span>
<span class="normal"><a href="#__codelineno-123-2">2</a></span>
<span class="normal"><a href="#__codelineno-123-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-123-1" name="__codelineno-123-1"></a><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-123-2" name="__codelineno-123-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-123-3" name="__codelineno-123-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>コンテンツIDが収集されていない場合、処理を終了します。</li>
</ul>
<h4 id="5_2">5. クエリの作成</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-124-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-124-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-124-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-124-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-124-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-124-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-124-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-124-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-124-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-124-10">10</a></span>
<span class="normal"><a href="#__codelineno-124-11">11</a></span>
<span class="normal"><a href="#__codelineno-124-12">12</a></span>
<span class="normal"><a href="#__codelineno-124-13">13</a></span>
<span class="normal"><a href="#__codelineno-124-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-124-1" name="__codelineno-124-1"></a><span class="nx">argsSlice</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kd">interface</span><span class="p">{},</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">args</span><span class="p">))</span>
<a id="__codelineno-124-2" name="__codelineno-124-2"></a><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span>
<a id="__codelineno-124-3" name="__codelineno-124-3"></a><span class="k">for</span><span class="w"> </span><span class="nx">arg</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">args</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-124-4" name="__codelineno-124-4"></a><span class="w">    </span><span class="nx">argsSlice</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">arg</span>
<a id="__codelineno-124-5" name="__codelineno-124-5"></a><span class="w">    </span><span class="nx">i</span><span class="o">++</span>
<a id="__codelineno-124-6" name="__codelineno-124-6"></a><span class="p">}</span>
<a id="__codelineno-124-7" name="__codelineno-124-7"></a>
<a id="__codelineno-124-8" name="__codelineno-124-8"></a><span class="nx">query</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">NewQuery</span><span class="p">(</span>
<a id="__codelineno-124-9" name="__codelineno-124-9"></a><span class="w">    </span><span class="nx">qm</span><span class="p">.</span><span class="nx">From</span><span class="p">(</span><span class="s">`contents`</span><span class="p">),</span>
<a id="__codelineno-124-10" name="__codelineno-124-10"></a><span class="w">    </span><span class="nx">qm</span><span class="p">.</span><span class="nx">WhereIn</span><span class="p">(</span><span class="s">`contents.content_id in ?`</span><span class="p">,</span><span class="w"> </span><span class="nx">argsSlice</span><span class="o">...</span><span class="p">),</span>
<a id="__codelineno-124-11" name="__codelineno-124-11"></a><span class="p">)</span>
<a id="__codelineno-124-12" name="__codelineno-124-12"></a><span class="k">if</span><span class="w"> </span><span class="nx">mods</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-124-13" name="__codelineno-124-13"></a><span class="w">    </span><span class="nx">mods</span><span class="p">.</span><span class="nx">Apply</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span>
<a id="__codelineno-124-14" name="__codelineno-124-14"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>マップからスライスにコンテンツIDを変換します。</li>
<li><code>contents</code> テーブルから対象のコンテンツを取得するクエリを作成します。</li>
<li>追加のクエリ修飾子がある場合、それを適用します。</li>
</ul>
<h4 id="6_2">6. クエリの実行と結果の取得</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-125-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-125-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-125-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-125-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-125-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-125-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-125-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-125-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-125-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-125-10">10</a></span>
<span class="normal"><a href="#__codelineno-125-11">11</a></span>
<span class="normal"><a href="#__codelineno-125-12">12</a></span>
<span class="normal"><a href="#__codelineno-125-13">13</a></span>
<span class="normal"><a href="#__codelineno-125-14">14</a></span>
<span class="normal"><a href="#__codelineno-125-15">15</a></span>
<span class="normal"><a href="#__codelineno-125-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-125-1" name="__codelineno-125-1"></a><span class="nx">results</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">query</span><span class="p">.</span><span class="nx">QueryContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="p">)</span>
<a id="__codelineno-125-2" name="__codelineno-125-2"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-125-3" name="__codelineno-125-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;failed to eager load Content&quot;</span><span class="p">)</span>
<a id="__codelineno-125-4" name="__codelineno-125-4"></a><span class="p">}</span>
<a id="__codelineno-125-5" name="__codelineno-125-5"></a>
<a id="__codelineno-125-6" name="__codelineno-125-6"></a><span class="kd">var</span><span class="w"> </span><span class="nx">resultSlice</span><span class="w"> </span><span class="p">[]</span><span class="o">*</span><span class="nx">Content</span>
<a id="__codelineno-125-7" name="__codelineno-125-7"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">Bind</span><span class="p">(</span><span class="nx">results</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">resultSlice</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-125-8" name="__codelineno-125-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;failed to bind eager loaded slice Content&quot;</span><span class="p">)</span>
<a id="__codelineno-125-9" name="__codelineno-125-9"></a><span class="p">}</span>
<a id="__codelineno-125-10" name="__codelineno-125-10"></a>
<a id="__codelineno-125-11" name="__codelineno-125-11"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">results</span><span class="p">.</span><span class="nx">Close</span><span class="p">();</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-125-12" name="__codelineno-125-12"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;failed to close results of eager load for contents&quot;</span><span class="p">)</span>
<a id="__codelineno-125-13" name="__codelineno-125-13"></a><span class="p">}</span>
<a id="__codelineno-125-14" name="__codelineno-125-14"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">results</span><span class="p">.</span><span class="nx">Err</span><span class="p">();</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-125-15" name="__codelineno-125-15"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;error occurred during iteration of eager loaded relations for contents&quot;</span><span class="p">)</span>
<a id="__codelineno-125-16" name="__codelineno-125-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>クエリを実行し、結果を取得します。</li>
<li>結果を <code>Content</code> 型のスライスにバインドします。</li>
<li>結果セットをクローズし、エラーをチェックします。</li>
</ul>
<h4 id="7_2">7. フックの実行</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-126-1">1</a></span>
<span class="normal"><a href="#__codelineno-126-2">2</a></span>
<span class="normal"><a href="#__codelineno-126-3">3</a></span>
<span class="normal"><a href="#__codelineno-126-4">4</a></span>
<span class="normal"><a href="#__codelineno-126-5">5</a></span>
<span class="normal"><a href="#__codelineno-126-6">6</a></span>
<span class="normal"><a href="#__codelineno-126-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-126-1" name="__codelineno-126-1"></a><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">contentAfterSelectHooks</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-126-2" name="__codelineno-126-2"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">resultSlice</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-126-3" name="__codelineno-126-3"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">obj</span><span class="p">.</span><span class="nx">doAfterSelectHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-126-4" name="__codelineno-126-4"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-126-5" name="__codelineno-126-5"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-126-6" name="__codelineno-126-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-126-7" name="__codelineno-126-7"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>Content</code> オブジェクトに対して、<code>AfterSelect</code> フックが定義されている場合、それらを実行します。</li>
</ul>
<h4 id="8_2">8. 結果の関連付け</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-127-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-127-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-127-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-127-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-127-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-127-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-127-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-127-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-127-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-127-10">10</a></span>
<span class="normal"><a href="#__codelineno-127-11">11</a></span>
<span class="normal"><a href="#__codelineno-127-12">12</a></span>
<span class="normal"><a href="#__codelineno-127-13">13</a></span>
<span class="normal"><a href="#__codelineno-127-14">14</a></span>
<span class="normal"><a href="#__codelineno-127-15">15</a></span>
<span class="normal"><a href="#__codelineno-127-16">16</a></span>
<span class="normal"><a href="#__codelineno-127-17">17</a></span>
<span class="normal"><a href="#__codelineno-127-18">18</a></span>
<span class="normal"><a href="#__codelineno-127-19">19</a></span>
<span class="normal"><a href="#__codelineno-127-20">20</a></span>
<span class="normal"><a href="#__codelineno-127-21">21</a></span>
<span class="normal"><a href="#__codelineno-127-22">22</a></span>
<span class="normal"><a href="#__codelineno-127-23">23</a></span>
<span class="normal"><a href="#__codelineno-127-24">24</a></span>
<span class="normal"><a href="#__codelineno-127-25">25</a></span>
<span class="normal"><a href="#__codelineno-127-26">26</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-127-1" name="__codelineno-127-1"></a><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">resultSlice</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-127-2" name="__codelineno-127-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-127-3" name="__codelineno-127-3"></a><span class="p">}</span>
<a id="__codelineno-127-4" name="__codelineno-127-4"></a>
<a id="__codelineno-127-5" name="__codelineno-127-5"></a><span class="k">if</span><span class="w"> </span><span class="nx">singular</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-127-6" name="__codelineno-127-6"></a><span class="w">    </span><span class="nx">foreign</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">resultSlice</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-127-7" name="__codelineno-127-7"></a><span class="w">    </span><span class="nx">object</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">Content</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">foreign</span>
<a id="__codelineno-127-8" name="__codelineno-127-8"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">foreign</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-127-9" name="__codelineno-127-9"></a><span class="w">        </span><span class="nx">foreign</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">contentR</span><span class="p">{}</span>
<a id="__codelineno-127-10" name="__codelineno-127-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-127-11" name="__codelineno-127-11"></a><span class="w">    </span><span class="nx">foreign</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">Seichies</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">foreign</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">Seichies</span><span class="p">,</span><span class="w"> </span><span class="nx">object</span><span class="p">)</span>
<a id="__codelineno-127-12" name="__codelineno-127-12"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-127-13" name="__codelineno-127-13"></a><span class="p">}</span>
<a id="__codelineno-127-14" name="__codelineno-127-14"></a>
<a id="__codelineno-127-15" name="__codelineno-127-15"></a><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">local</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">slice</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-127-16" name="__codelineno-127-16"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">foreign</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">resultSlice</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-127-17" name="__codelineno-127-17"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">local</span><span class="p">.</span><span class="nx">ContentID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">foreign</span><span class="p">.</span><span class="nx">ContentID</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-127-18" name="__codelineno-127-18"></a><span class="w">            </span><span class="nx">local</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">Content</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">foreign</span>
<a id="__codelineno-127-19" name="__codelineno-127-19"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">foreign</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-127-20" name="__codelineno-127-20"></a><span class="w">                </span><span class="nx">foreign</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">contentR</span><span class="p">{}</span>
<a id="__codelineno-127-21" name="__codelineno-127-21"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-127-22" name="__codelineno-127-22"></a><span class="w">            </span><span class="nx">foreign</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">Seichies</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">foreign</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">Seichies</span><span class="p">,</span><span class="w"> </span><span class="nx">local</span><span class="p">)</span>
<a id="__codelineno-127-23" name="__codelineno-127-23"></a><span class="w">            </span><span class="k">break</span>
<a id="__codelineno-127-24" name="__codelineno-127-24"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-127-25" name="__codelineno-127-25"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-127-26" name="__codelineno-127-26"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>単一のオブジェクトの場合、対応するコンテンツを設定します。</li>
<li>スライスの場合、各 <code>Seichy</code> オブジェクトに対して、対応する <code>Content</code> を関連付けます。</li>
<li>双方向の関連付けを設定し、キャッシュします。</li>
</ul>
<h4 id="9_2">9. エラーがない場合、成功を返す</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-128-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-128-1" name="__codelineno-128-1"></a><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>全ての処理が成功した場合、<code>nil</code> を返して終了します。</li>
</ul>
<h3 id="_117">開発者向け利用例</h3>
<p>以下に、<code>LoadContent</code> 関数の具体的な利用例を示します。</p>
<h4 id="seichy_12">単一の <code>Seichy</code> オブジェクトの場合</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-129-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-129-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-129-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-129-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-129-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-129-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-129-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-129-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-129-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-129-10">10</a></span>
<span class="normal"><a href="#__codelineno-129-11">11</a></span>
<span class="normal"><a href="#__codelineno-129-12">12</a></span>
<span class="normal"><a href="#__codelineno-129-13">13</a></span>
<span class="normal"><a href="#__codelineno-129-14">14</a></span>
<span class="normal"><a href="#__codelineno-129-15">15</a></span>
<span class="normal"><a href="#__codelineno-129-16">16</a></span>
<span class="normal"><a href="#__codelineno-129-17">17</a></span>
<span class="normal"><a href="#__codelineno-129-18">18</a></span>
<span class="normal"><a href="#__codelineno-129-19">19</a></span>
<span class="normal"><a href="#__codelineno-129-20">20</a></span>
<span class="normal"><a href="#__codelineno-129-21">21</a></span>
<span class="normal"><a href="#__codelineno-129-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-129-1" name="__codelineno-129-1"></a><span class="c1">// データベースエグゼキューターの取得（例）</span>
<a id="__codelineno-129-2" name="__codelineno-129-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;your_connection_string&quot;</span><span class="p">)</span>
<a id="__codelineno-129-3" name="__codelineno-129-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-129-4" name="__codelineno-129-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-129-5" name="__codelineno-129-5"></a><span class="p">}</span>
<a id="__codelineno-129-6" name="__codelineno-129-6"></a>
<a id="__codelineno-129-7" name="__codelineno-129-7"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-129-8" name="__codelineno-129-8"></a>
<a id="__codelineno-129-9" name="__codelineno-129-9"></a><span class="c1">// 単一の Seichy オブジェクトを取得</span>
<a id="__codelineno-129-10" name="__codelineno-129-10"></a><span class="nx">seichy</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Seichies</span><span class="p">(</span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;seichi_id=?&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)).</span><span class="nx">One</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-129-11" name="__codelineno-129-11"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-129-12" name="__codelineno-129-12"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-129-13" name="__codelineno-129-13"></a><span class="p">}</span>
<a id="__codelineno-129-14" name="__codelineno-129-14"></a>
<a id="__codelineno-129-15" name="__codelineno-129-15"></a><span class="c1">// 関連する Content をロード</span>
<a id="__codelineno-129-16" name="__codelineno-129-16"></a><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">seichyL</span><span class="p">{}.</span><span class="nx">LoadContent</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">seichy</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<a id="__codelineno-129-17" name="__codelineno-129-17"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-129-18" name="__codelineno-129-18"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-129-19" name="__codelineno-129-19"></a><span class="p">}</span>
<a id="__codelineno-129-20" name="__codelineno-129-20"></a>
<a id="__codelineno-129-21" name="__codelineno-129-21"></a><span class="c1">// ロードされた Content データを使用</span>
<a id="__codelineno-129-22" name="__codelineno-129-22"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Content Title:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">seichy</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">Content</span><span class="p">.</span><span class="nx">Title</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h4 id="seichy_13">複数の <code>Seichy</code> オブジェクトの場合</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-130-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-130-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-130-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-130-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-130-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-130-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-130-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-130-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-130-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-130-10">10</a></span>
<span class="normal"><a href="#__codelineno-130-11">11</a></span>
<span class="normal"><a href="#__codelineno-130-12">12</a></span>
<span class="normal"><a href="#__codelineno-130-13">13</a></span>
<span class="normal"><a href="#__codelineno-130-14">14</a></span>
<span class="normal"><a href="#__codelineno-130-15">15</a></span>
<span class="normal"><a href="#__codelineno-130-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-130-1" name="__codelineno-130-1"></a><span class="c1">// 複数の Seichy オブジェクトを取得</span>
<a id="__codelineno-130-2" name="__codelineno-130-2"></a><span class="nx">seichies</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Seichies</span><span class="p">().</span><span class="nx">All</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-130-3" name="__codelineno-130-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-130-4" name="__codelineno-130-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-130-5" name="__codelineno-130-5"></a><span class="p">}</span>
<a id="__codelineno-130-6" name="__codelineno-130-6"></a>
<a id="__codelineno-130-7" name="__codelineno-130-7"></a><span class="c1">// 関連する Content を一括でロード</span>
<a id="__codelineno-130-8" name="__codelineno-130-8"></a><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">seichyL</span><span class="p">{}.</span><span class="nx">LoadContent</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nx">seichies</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<a id="__codelineno-130-9" name="__codelineno-130-9"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-130-10" name="__codelineno-130-10"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-130-11" name="__codelineno-130-11"></a><span class="p">}</span>
<a id="__codelineno-130-12" name="__codelineno-130-12"></a>
<a id="__codelineno-130-13" name="__codelineno-130-13"></a><span class="c1">// 各 Seichy オブジェクトの Content データを利用</span>
<a id="__codelineno-130-14" name="__codelineno-130-14"></a><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">seichies</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-130-15" name="__codelineno-130-15"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Seichy ID: %d, Content Title: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">SeichiID</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">Content</span><span class="p">.</span><span class="nx">Title</span><span class="p">)</span>
<a id="__codelineno-130-16" name="__codelineno-130-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="setuser_1"><code>SetUser</code> 関数の詳細な解説</h2>
<h3 id="_118">関数の概要</h3>
<p><code>SetUser</code> 関数は、<code>Seichy</code> オブジェクトと関連する <code>User</code> オブジェクトとのリレーションシップを設定します。この関数を使用することで、<code>Seichy</code> オブジェクトに関連する <code>User</code> オブジェクトを設定し、その関係をデータベースおよびメモリ上で維持します。</p>
<h3 id="_119">関数のシグネチャ</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-131-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-131-1" name="__codelineno-131-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">Seichy</span><span class="p">)</span><span class="w"> </span><span class="nx">SetUser</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">insert</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="nx">related</span><span class="w"> </span><span class="o">*</span><span class="nx">User</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>o *Seichy</code>：リレーションシップを設定する対象の <code>Seichy</code> オブジェクト。</li>
<li><code>ctx context.Context</code>：コンテキスト情報。</li>
<li><code>exec boil.ContextExecutor</code>：データベース操作を行うためのエグゼキューター。</li>
<li><code>insert bool</code>：<code>User</code> オブジェクトをデータベースに挿入するかどうかを指定。</li>
<li><code>related *User</code>：関連付ける <code>User</code> オブジェクト。</li>
</ul>
<h3 id="_120">コードの詳細な解説</h3>
<h4 id="1_3">1. 変数の宣言</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-132-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-132-1" name="__codelineno-132-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>エラーを保持するための変数を宣言します。</li>
</ul>
<h4 id="2_3">2. 挿入フラグに基づく処理</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-133-1">1</a></span>
<span class="normal"><a href="#__codelineno-133-2">2</a></span>
<span class="normal"><a href="#__codelineno-133-3">3</a></span>
<span class="normal"><a href="#__codelineno-133-4">4</a></span>
<span class="normal"><a href="#__codelineno-133-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-133-1" name="__codelineno-133-1"></a><span class="k">if</span><span class="w"> </span><span class="nx">insert</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-133-2" name="__codelineno-133-2"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">related</span><span class="p">.</span><span class="nx">Insert</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">Infer</span><span class="p">());</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-133-3" name="__codelineno-133-3"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;failed to insert into foreign table&quot;</span><span class="p">)</span>
<a id="__codelineno-133-4" name="__codelineno-133-4"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-133-5" name="__codelineno-133-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>insert</code> フラグが <code>true</code> の場合、関連する <code>User</code> オブジェクトをデータベースに挿入します。</li>
<li><code>related.Insert</code> 関数を使用して挿入し、エラーが発生した場合はそのエラーを返します。</li>
</ul>
<h4 id="3-seichy">3. <code>Seichy</code> テーブルの更新</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-134-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-134-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-134-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-134-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-134-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-134-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-134-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-134-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-134-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-134-10">10</a></span>
<span class="normal"><a href="#__codelineno-134-11">11</a></span>
<span class="normal"><a href="#__codelineno-134-12">12</a></span>
<span class="normal"><a href="#__codelineno-134-13">13</a></span>
<span class="normal"><a href="#__codelineno-134-14">14</a></span>
<span class="normal"><a href="#__codelineno-134-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-134-1" name="__codelineno-134-1"></a><span class="nx">updateQuery</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span>
<a id="__codelineno-134-2" name="__codelineno-134-2"></a><span class="w">    </span><span class="s">&quot;UPDATE `seichies` SET %s WHERE %s&quot;</span><span class="p">,</span>
<a id="__codelineno-134-3" name="__codelineno-134-3"></a><span class="w">    </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">SetParamNames</span><span class="p">(</span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;user_id&quot;</span><span class="p">}),</span>
<a id="__codelineno-134-4" name="__codelineno-134-4"></a><span class="w">    </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">WhereClause</span><span class="p">(</span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">seichyPrimaryKeyColumns</span><span class="p">),</span>
<a id="__codelineno-134-5" name="__codelineno-134-5"></a><span class="p">)</span>
<a id="__codelineno-134-6" name="__codelineno-134-6"></a><span class="nx">values</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span><span class="nx">related</span><span class="p">.</span><span class="nx">UserID</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">SeichiID</span><span class="p">}</span>
<a id="__codelineno-134-7" name="__codelineno-134-7"></a>
<a id="__codelineno-134-8" name="__codelineno-134-8"></a><span class="k">if</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">IsDebug</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-134-9" name="__codelineno-134-9"></a><span class="w">    </span><span class="nx">writer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">DebugWriterFrom</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<a id="__codelineno-134-10" name="__codelineno-134-10"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">updateQuery</span><span class="p">)</span>
<a id="__codelineno-134-11" name="__codelineno-134-11"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">values</span><span class="p">)</span>
<a id="__codelineno-134-12" name="__codelineno-134-12"></a><span class="p">}</span>
<a id="__codelineno-134-13" name="__codelineno-134-13"></a><span class="k">if</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">exec</span><span class="p">.</span><span class="nx">ExecContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">updateQuery</span><span class="p">,</span><span class="w"> </span><span class="nx">values</span><span class="o">...</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-134-14" name="__codelineno-134-14"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;failed to update local table&quot;</span><span class="p">)</span>
<a id="__codelineno-134-15" name="__codelineno-134-15"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>Seichy</code> テーブルの <code>user_id</code> カラムを更新します。</li>
<li><code>strmangle</code> パッケージを使用して、動的なクエリ文字列を生成します。</li>
<li><code>values</code> スライスには、更新に使用する値を格納します。</li>
<li>デバッグモードが有効な場合、クエリと値を出力します。</li>
<li>クエリを実行し、エラーが発生した場合はそのエラーを返します。</li>
</ul>
<h4 id="4">4. ローカルオブジェクトのフィールド更新</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-135-1">1</a></span>
<span class="normal"><a href="#__codelineno-135-2">2</a></span>
<span class="normal"><a href="#__codelineno-135-3">3</a></span>
<span class="normal"><a href="#__codelineno-135-4">4</a></span>
<span class="normal"><a href="#__codelineno-135-5">5</a></span>
<span class="normal"><a href="#__codelineno-135-6">6</a></span>
<span class="normal"><a href="#__codelineno-135-7">7</a></span>
<span class="normal"><a href="#__codelineno-135-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-135-1" name="__codelineno-135-1"></a><span class="nx">o</span><span class="p">.</span><span class="nx">UserID</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">related</span><span class="p">.</span><span class="nx">UserID</span>
<a id="__codelineno-135-2" name="__codelineno-135-2"></a><span class="k">if</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-135-3" name="__codelineno-135-3"></a><span class="w">    </span><span class="nx">o</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">seichyR</span><span class="p">{</span>
<a id="__codelineno-135-4" name="__codelineno-135-4"></a><span class="w">        </span><span class="nx">User</span><span class="p">:</span><span class="w"> </span><span class="nx">related</span><span class="p">,</span>
<a id="__codelineno-135-5" name="__codelineno-135-5"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-135-6" name="__codelineno-135-6"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-135-7" name="__codelineno-135-7"></a><span class="w">    </span><span class="nx">o</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">User</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">related</span>
<a id="__codelineno-135-8" name="__codelineno-135-8"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>o.UserID</code> フィールドを更新します。</li>
<li>リレーションシップフィールド <code>o.R.User</code> を設定します。</li>
<li><code>o.R</code> が <code>nil</code> の場合、新しいリレーションシップ構造体を初期化します。</li>
</ul>
<h4 id="5_3">5. 関連オブジェクトのリレーションシップ設定</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-136-1">1</a></span>
<span class="normal"><a href="#__codelineno-136-2">2</a></span>
<span class="normal"><a href="#__codelineno-136-3">3</a></span>
<span class="normal"><a href="#__codelineno-136-4">4</a></span>
<span class="normal"><a href="#__codelineno-136-5">5</a></span>
<span class="normal"><a href="#__codelineno-136-6">6</a></span>
<span class="normal"><a href="#__codelineno-136-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-136-1" name="__codelineno-136-1"></a><span class="k">if</span><span class="w"> </span><span class="nx">related</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-136-2" name="__codelineno-136-2"></a><span class="w">    </span><span class="nx">related</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">userR</span><span class="p">{</span>
<a id="__codelineno-136-3" name="__codelineno-136-3"></a><span class="w">        </span><span class="nx">Seichies</span><span class="p">:</span><span class="w"> </span><span class="nx">SeichySlice</span><span class="p">{</span><span class="nx">o</span><span class="p">},</span>
<a id="__codelineno-136-4" name="__codelineno-136-4"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-136-5" name="__codelineno-136-5"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-136-6" name="__codelineno-136-6"></a><span class="w">    </span><span class="nx">related</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">Seichies</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">related</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">Seichies</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">)</span>
<a id="__codelineno-136-7" name="__codelineno-136-7"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>related</code> オブジェクトのリレーションシップフィールド <code>related.R.Seichies</code> に <code>o</code> を追加します。</li>
<li><code>related.R</code> が <code>nil</code> の場合、新しいリレーションシップ構造体を初期化します。</li>
</ul>
<h4 id="6_3">6. エラーがない場合、成功を返す</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-137-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-137-1" name="__codelineno-137-1"></a><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>全ての処理が成功した場合、<code>nil</code> を返して終了します。</li>
</ul>
<h3 id="_121">開発者向け利用例</h3>
<p>以下に、<code>SetUser</code> 関数の具体的な利用例を示します。</p>
<h4 id="user_2">新しい <code>User</code> を作成して関連付ける場合</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-138-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-138-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-138-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-138-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-138-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-138-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-138-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-138-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-138-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-138-10">10</a></span>
<span class="normal"><a href="#__codelineno-138-11">11</a></span>
<span class="normal"><a href="#__codelineno-138-12">12</a></span>
<span class="normal"><a href="#__codelineno-138-13">13</a></span>
<span class="normal"><a href="#__codelineno-138-14">14</a></span>
<span class="normal"><a href="#__codelineno-138-15">15</a></span>
<span class="normal"><a href="#__codelineno-138-16">16</a></span>
<span class="normal"><a href="#__codelineno-138-17">17</a></span>
<span class="normal"><a href="#__codelineno-138-18">18</a></span>
<span class="normal"><a href="#__codelineno-138-19">19</a></span>
<span class="normal"><a href="#__codelineno-138-20">20</a></span>
<span class="normal"><a href="#__codelineno-138-21">21</a></span>
<span class="normal"><a href="#__codelineno-138-22">22</a></span>
<span class="normal"><a href="#__codelineno-138-23">23</a></span>
<span class="normal"><a href="#__codelineno-138-24">24</a></span>
<span class="normal"><a href="#__codelineno-138-25">25</a></span>
<span class="normal"><a href="#__codelineno-138-26">26</a></span>
<span class="normal"><a href="#__codelineno-138-27">27</a></span>
<span class="normal"><a href="#__codelineno-138-28">28</a></span>
<span class="normal"><a href="#__codelineno-138-29">29</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-138-1" name="__codelineno-138-1"></a><span class="c1">// データベースエグゼキューターの取得（例）</span>
<a id="__codelineno-138-2" name="__codelineno-138-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;your_connection_string&quot;</span><span class="p">)</span>
<a id="__codelineno-138-3" name="__codelineno-138-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-138-4" name="__codelineno-138-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-138-5" name="__codelineno-138-5"></a><span class="p">}</span>
<a id="__codelineno-138-6" name="__codelineno-138-6"></a>
<a id="__codelineno-138-7" name="__codelineno-138-7"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-138-8" name="__codelineno-138-8"></a>
<a id="__codelineno-138-9" name="__codelineno-138-9"></a><span class="c1">// Seichy オブジェクトを取得</span>
<a id="__codelineno-138-10" name="__codelineno-138-10"></a><span class="nx">seichy</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Seichies</span><span class="p">(</span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;seichi_id=?&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)).</span><span class="nx">One</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-138-11" name="__codelineno-138-11"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-138-12" name="__codelineno-138-12"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-138-13" name="__codelineno-138-13"></a><span class="p">}</span>
<a id="__codelineno-138-14" name="__codelineno-138-14"></a>
<a id="__codelineno-138-15" name="__codelineno-138-15"></a><span class="c1">// 新しい User オブジェクトを作成</span>
<a id="__codelineno-138-16" name="__codelineno-138-16"></a><span class="nx">newUser</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">User</span><span class="p">{</span>
<a id="__codelineno-138-17" name="__codelineno-138-17"></a><span class="w">    </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;新しいユーザー&quot;</span><span class="p">,</span>
<a id="__codelineno-138-18" name="__codelineno-138-18"></a><span class="w">    </span><span class="c1">// 他のフィールドを設定</span>
<a id="__codelineno-138-19" name="__codelineno-138-19"></a><span class="p">}</span>
<a id="__codelineno-138-20" name="__codelineno-138-20"></a>
<a id="__codelineno-138-21" name="__codelineno-138-21"></a><span class="c1">// Seichy オブジェクトに User を設定し、User をデータベースに挿入</span>
<a id="__codelineno-138-22" name="__codelineno-138-22"></a><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">seichy</span><span class="p">.</span><span class="nx">SetUser</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">newUser</span><span class="p">)</span>
<a id="__codelineno-138-23" name="__codelineno-138-23"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-138-24" name="__codelineno-138-24"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-138-25" name="__codelineno-138-25"></a><span class="p">}</span>
<a id="__codelineno-138-26" name="__codelineno-138-26"></a>
<a id="__codelineno-138-27" name="__codelineno-138-27"></a><span class="c1">// 更新された Seichy と関連付けられた User を使用</span>
<a id="__codelineno-138-28" name="__codelineno-138-28"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Seichy ID:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">seichy</span><span class="p">.</span><span class="nx">SeichiID</span><span class="p">)</span>
<a id="__codelineno-138-29" name="__codelineno-138-29"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;User Name:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">seichy</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">User</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h4 id="user_3">既存の <code>User</code> を関連付ける場合</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-139-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-139-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-139-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-139-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-139-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-139-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-139-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-139-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-139-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-139-10">10</a></span>
<span class="normal"><a href="#__codelineno-139-11">11</a></span>
<span class="normal"><a href="#__codelineno-139-12">12</a></span>
<span class="normal"><a href="#__codelineno-139-13">13</a></span>
<span class="normal"><a href="#__codelineno-139-14">14</a></span>
<span class="normal"><a href="#__codelineno-139-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-139-1" name="__codelineno-139-1"></a><span class="c1">// 既存の User オブジェクトを取得</span>
<a id="__codelineno-139-2" name="__codelineno-139-2"></a><span class="nx">existingUser</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Users</span><span class="p">(</span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;user_id=?&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)).</span><span class="nx">One</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-139-3" name="__codelineno-139-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-139-4" name="__codelineno-139-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-139-5" name="__codelineno-139-5"></a><span class="p">}</span>
<a id="__codelineno-139-6" name="__codelineno-139-6"></a>
<a id="__codelineno-139-7" name="__codelineno-139-7"></a><span class="c1">// Seichy オブジェクトに既存の User を設定（データベースへの挿入は不要）</span>
<a id="__codelineno-139-8" name="__codelineno-139-8"></a><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">seichy</span><span class="p">.</span><span class="nx">SetUser</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nx">existingUser</span><span class="p">)</span>
<a id="__codelineno-139-9" name="__codelineno-139-9"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-139-10" name="__codelineno-139-10"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-139-11" name="__codelineno-139-11"></a><span class="p">}</span>
<a id="__codelineno-139-12" name="__codelineno-139-12"></a>
<a id="__codelineno-139-13" name="__codelineno-139-13"></a><span class="c1">// 更新された Seichy と関連付けられた User を使用</span>
<a id="__codelineno-139-14" name="__codelineno-139-14"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Seichy ID:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">seichy</span><span class="p">.</span><span class="nx">SeichiID</span><span class="p">)</span>
<a id="__codelineno-139-15" name="__codelineno-139-15"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;User Name:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">seichy</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">User</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="_122">注意事項</h2>
<ul>
<li><code>LoadContent</code> 関数は、関連するデータを一括で取得し、<code>Seichy</code> オブジェクトのリレーションフィールドにキャッシュします。</li>
<li><code>SetUser</code> 関数は、<code>Seichy</code> オブジェクトと <code>User</code> オブジェクトの関連付けを行い、必要に応じてデータベースの更新も行います。</li>
<li><code>singular</code> フラグや <code>insert</code> フラグを正しく設定することで、適切な処理を実行できます。</li>
<li>エラー処理を適切に行い、データの不整合や予期せぬ挙動を防ぎます。</li>
</ul>
<p><code>LoadContent</code> 関数と <code>SetUser</code> 関数を使用することで、<code>Seichy</code> オブジェクトに関連する <code>Content</code> データのロードや、<code>User</code> オブジェクトとの関連付けを効率的に行うことができます。</p>
<hr />
<h2 id="setplace-setcontent"><code>SetPlace</code> 関数、<code>SetContent</code> 関数、およびその他の関連関数の詳細な解説</h2>
<p>以下の関数について、コードの全ての部分を詳細に解説します。</p>
<ul>
<li><code>SetPlace</code> 関数</li>
<li><code>SetContent</code> 関数</li>
<li><code>Seichies</code> 関数</li>
<li><code>FindSeichy</code> 関数</li>
<li><code>Insert</code> 関数</li>
<li><code>Update</code> 関数</li>
</ul>
<p>これらの関数は、データベース操作やオブジェクトのリレーションシップ設定に関連しており、N対1のリレーションシップを持つデータの取得・設定・更新を行います。開発者がこれらの関数を理解し、適切に利用できるように、具体的なコード例も含めて説明します。</p>
<hr />
<h2 id="setplace"><code>SetPlace</code> 関数の詳細な解説</h2>
<h3 id="_123">関数の概要</h3>
<p><code>SetPlace</code> 関数は、<code>Seichy</code> オブジェクトと関連する <code>Place</code> オブジェクトとのリレーションシップを設定します。この関数を使用することで、<code>Seichy</code> オブジェクトに関連する <code>Place</code> オブジェクトを設定し、その関係をデータベースおよびメモリ上で維持します。</p>
<h3 id="_124">関数のシグネチャ</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-140-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-140-1" name="__codelineno-140-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">Seichy</span><span class="p">)</span><span class="w"> </span><span class="nx">SetPlace</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">insert</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="nx">related</span><span class="w"> </span><span class="o">*</span><span class="nx">Place</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>o *Seichy</code>：リレーションシップを設定する対象の <code>Seichy</code> オブジェクト。</li>
<li><code>ctx context.Context</code>：コンテキスト情報。</li>
<li><code>exec boil.ContextExecutor</code>：データベース操作を行うためのエグゼキューター。</li>
<li><code>insert bool</code>：<code>Place</code> オブジェクトをデータベースに挿入するかどうかを指定。</li>
<li><code>related *Place</code>：関連付ける <code>Place</code> オブジェクト。</li>
</ul>
<h3 id="_125">コードの詳細な解説</h3>
<h4 id="1_4">1. 変数の宣言</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-141-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-141-1" name="__codelineno-141-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>エラーを保持するための変数を宣言します。</li>
</ul>
<h4 id="2_4">2. 挿入フラグに基づく処理</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-142-1">1</a></span>
<span class="normal"><a href="#__codelineno-142-2">2</a></span>
<span class="normal"><a href="#__codelineno-142-3">3</a></span>
<span class="normal"><a href="#__codelineno-142-4">4</a></span>
<span class="normal"><a href="#__codelineno-142-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-142-1" name="__codelineno-142-1"></a><span class="k">if</span><span class="w"> </span><span class="nx">insert</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-142-2" name="__codelineno-142-2"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">related</span><span class="p">.</span><span class="nx">Insert</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">Infer</span><span class="p">());</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-142-3" name="__codelineno-142-3"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;failed to insert into foreign table&quot;</span><span class="p">)</span>
<a id="__codelineno-142-4" name="__codelineno-142-4"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-142-5" name="__codelineno-142-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>insert</code> フラグが <code>true</code> の場合、関連する <code>Place</code> オブジェクトをデータベースに挿入します。</li>
<li><code>related.Insert</code> 関数を使用して挿入し、エラーが発生した場合はそのエラーを返します。</li>
</ul>
<h4 id="3-seichy_1">3. <code>Seichy</code> テーブルの更新</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-143-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-143-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-143-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-143-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-143-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-143-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-143-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-143-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-143-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-143-10">10</a></span>
<span class="normal"><a href="#__codelineno-143-11">11</a></span>
<span class="normal"><a href="#__codelineno-143-12">12</a></span>
<span class="normal"><a href="#__codelineno-143-13">13</a></span>
<span class="normal"><a href="#__codelineno-143-14">14</a></span>
<span class="normal"><a href="#__codelineno-143-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-143-1" name="__codelineno-143-1"></a><span class="nx">updateQuery</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span>
<a id="__codelineno-143-2" name="__codelineno-143-2"></a><span class="w">    </span><span class="s">&quot;UPDATE `seichies` SET %s WHERE %s&quot;</span><span class="p">,</span>
<a id="__codelineno-143-3" name="__codelineno-143-3"></a><span class="w">    </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">SetParamNames</span><span class="p">(</span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;place_id&quot;</span><span class="p">}),</span>
<a id="__codelineno-143-4" name="__codelineno-143-4"></a><span class="w">    </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">WhereClause</span><span class="p">(</span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">seichyPrimaryKeyColumns</span><span class="p">),</span>
<a id="__codelineno-143-5" name="__codelineno-143-5"></a><span class="p">)</span>
<a id="__codelineno-143-6" name="__codelineno-143-6"></a><span class="nx">values</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span><span class="nx">related</span><span class="p">.</span><span class="nx">PlaceID</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">SeichiID</span><span class="p">}</span>
<a id="__codelineno-143-7" name="__codelineno-143-7"></a>
<a id="__codelineno-143-8" name="__codelineno-143-8"></a><span class="k">if</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">IsDebug</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-143-9" name="__codelineno-143-9"></a><span class="w">    </span><span class="nx">writer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">DebugWriterFrom</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<a id="__codelineno-143-10" name="__codelineno-143-10"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">updateQuery</span><span class="p">)</span>
<a id="__codelineno-143-11" name="__codelineno-143-11"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">values</span><span class="p">)</span>
<a id="__codelineno-143-12" name="__codelineno-143-12"></a><span class="p">}</span>
<a id="__codelineno-143-13" name="__codelineno-143-13"></a><span class="k">if</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">exec</span><span class="p">.</span><span class="nx">ExecContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">updateQuery</span><span class="p">,</span><span class="w"> </span><span class="nx">values</span><span class="o">...</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-143-14" name="__codelineno-143-14"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;failed to update local table&quot;</span><span class="p">)</span>
<a id="__codelineno-143-15" name="__codelineno-143-15"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>Seichy</code> テーブルの <code>place_id</code> カラムを更新します。</li>
<li><code>strmangle</code> パッケージを使用して、動的なクエリ文字列を生成します。</li>
<li><code>values</code> スライスには、更新に使用する値を格納します。</li>
<li>デバッグモードが有効な場合、クエリと値を出力します。</li>
<li>クエリを実行し、エラーが発生した場合はそのエラーを返します。</li>
</ul>
<h4 id="4_1">4. ローカルオブジェクトのフィールド更新</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-144-1">1</a></span>
<span class="normal"><a href="#__codelineno-144-2">2</a></span>
<span class="normal"><a href="#__codelineno-144-3">3</a></span>
<span class="normal"><a href="#__codelineno-144-4">4</a></span>
<span class="normal"><a href="#__codelineno-144-5">5</a></span>
<span class="normal"><a href="#__codelineno-144-6">6</a></span>
<span class="normal"><a href="#__codelineno-144-7">7</a></span>
<span class="normal"><a href="#__codelineno-144-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-144-1" name="__codelineno-144-1"></a><span class="nx">o</span><span class="p">.</span><span class="nx">PlaceID</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">related</span><span class="p">.</span><span class="nx">PlaceID</span>
<a id="__codelineno-144-2" name="__codelineno-144-2"></a><span class="k">if</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-144-3" name="__codelineno-144-3"></a><span class="w">    </span><span class="nx">o</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">seichyR</span><span class="p">{</span>
<a id="__codelineno-144-4" name="__codelineno-144-4"></a><span class="w">        </span><span class="nx">Place</span><span class="p">:</span><span class="w"> </span><span class="nx">related</span><span class="p">,</span>
<a id="__codelineno-144-5" name="__codelineno-144-5"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-144-6" name="__codelineno-144-6"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-144-7" name="__codelineno-144-7"></a><span class="w">    </span><span class="nx">o</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">Place</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">related</span>
<a id="__codelineno-144-8" name="__codelineno-144-8"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>o.PlaceID</code> フィールドを更新します。</li>
<li>リレーションシップフィールド <code>o.R.Place</code> を設定します。</li>
<li><code>o.R</code> が <code>nil</code> の場合、新しいリレーションシップ構造体を初期化します。</li>
</ul>
<h4 id="5_4">5. 関連オブジェクトのリレーションシップ設定</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-145-1">1</a></span>
<span class="normal"><a href="#__codelineno-145-2">2</a></span>
<span class="normal"><a href="#__codelineno-145-3">3</a></span>
<span class="normal"><a href="#__codelineno-145-4">4</a></span>
<span class="normal"><a href="#__codelineno-145-5">5</a></span>
<span class="normal"><a href="#__codelineno-145-6">6</a></span>
<span class="normal"><a href="#__codelineno-145-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-145-1" name="__codelineno-145-1"></a><span class="k">if</span><span class="w"> </span><span class="nx">related</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-145-2" name="__codelineno-145-2"></a><span class="w">    </span><span class="nx">related</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">placeR</span><span class="p">{</span>
<a id="__codelineno-145-3" name="__codelineno-145-3"></a><span class="w">        </span><span class="nx">Seichies</span><span class="p">:</span><span class="w"> </span><span class="nx">SeichySlice</span><span class="p">{</span><span class="nx">o</span><span class="p">},</span>
<a id="__codelineno-145-4" name="__codelineno-145-4"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-145-5" name="__codelineno-145-5"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-145-6" name="__codelineno-145-6"></a><span class="w">    </span><span class="nx">related</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">Seichies</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">related</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">Seichies</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">)</span>
<a id="__codelineno-145-7" name="__codelineno-145-7"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>related</code> オブジェクトのリレーションシップフィールド <code>related.R.Seichies</code> に <code>o</code> を追加します。</li>
<li><code>related.R</code> が <code>nil</code> の場合、新しいリレーションシップ構造体を初期化します。</li>
</ul>
<h4 id="6_4">6. エラーがない場合、成功を返す</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-146-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-146-1" name="__codelineno-146-1"></a><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>全ての処理が成功した場合、<code>nil</code> を返して終了します。</li>
</ul>
<h3 id="_126">開発者向け利用例</h3>
<p>以下に、<code>SetPlace</code> 関数の具体的な利用例を示します。</p>
<h4 id="place_1">新しい <code>Place</code> を作成して関連付ける場合</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-147-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-147-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-147-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-147-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-147-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-147-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-147-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-147-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-147-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-147-10">10</a></span>
<span class="normal"><a href="#__codelineno-147-11">11</a></span>
<span class="normal"><a href="#__codelineno-147-12">12</a></span>
<span class="normal"><a href="#__codelineno-147-13">13</a></span>
<span class="normal"><a href="#__codelineno-147-14">14</a></span>
<span class="normal"><a href="#__codelineno-147-15">15</a></span>
<span class="normal"><a href="#__codelineno-147-16">16</a></span>
<span class="normal"><a href="#__codelineno-147-17">17</a></span>
<span class="normal"><a href="#__codelineno-147-18">18</a></span>
<span class="normal"><a href="#__codelineno-147-19">19</a></span>
<span class="normal"><a href="#__codelineno-147-20">20</a></span>
<span class="normal"><a href="#__codelineno-147-21">21</a></span>
<span class="normal"><a href="#__codelineno-147-22">22</a></span>
<span class="normal"><a href="#__codelineno-147-23">23</a></span>
<span class="normal"><a href="#__codelineno-147-24">24</a></span>
<span class="normal"><a href="#__codelineno-147-25">25</a></span>
<span class="normal"><a href="#__codelineno-147-26">26</a></span>
<span class="normal"><a href="#__codelineno-147-27">27</a></span>
<span class="normal"><a href="#__codelineno-147-28">28</a></span>
<span class="normal"><a href="#__codelineno-147-29">29</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-147-1" name="__codelineno-147-1"></a><span class="c1">// データベースエグゼキューターの取得（例）</span>
<a id="__codelineno-147-2" name="__codelineno-147-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;your_connection_string&quot;</span><span class="p">)</span>
<a id="__codelineno-147-3" name="__codelineno-147-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-147-4" name="__codelineno-147-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-147-5" name="__codelineno-147-5"></a><span class="p">}</span>
<a id="__codelineno-147-6" name="__codelineno-147-6"></a>
<a id="__codelineno-147-7" name="__codelineno-147-7"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-147-8" name="__codelineno-147-8"></a>
<a id="__codelineno-147-9" name="__codelineno-147-9"></a><span class="c1">// Seichy オブジェクトを取得</span>
<a id="__codelineno-147-10" name="__codelineno-147-10"></a><span class="nx">seichy</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Seichies</span><span class="p">(</span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;seichi_id=?&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)).</span><span class="nx">One</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-147-11" name="__codelineno-147-11"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-147-12" name="__codelineno-147-12"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-147-13" name="__codelineno-147-13"></a><span class="p">}</span>
<a id="__codelineno-147-14" name="__codelineno-147-14"></a>
<a id="__codelineno-147-15" name="__codelineno-147-15"></a><span class="c1">// 新しい Place オブジェクトを作成</span>
<a id="__codelineno-147-16" name="__codelineno-147-16"></a><span class="nx">newPlace</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Place</span><span class="p">{</span>
<a id="__codelineno-147-17" name="__codelineno-147-17"></a><span class="w">    </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;新しい場所&quot;</span><span class="p">,</span>
<a id="__codelineno-147-18" name="__codelineno-147-18"></a><span class="w">    </span><span class="c1">// 他のフィールドを設定</span>
<a id="__codelineno-147-19" name="__codelineno-147-19"></a><span class="p">}</span>
<a id="__codelineno-147-20" name="__codelineno-147-20"></a>
<a id="__codelineno-147-21" name="__codelineno-147-21"></a><span class="c1">// Seichy オブジェクトに Place を設定し、Place をデータベースに挿入</span>
<a id="__codelineno-147-22" name="__codelineno-147-22"></a><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">seichy</span><span class="p">.</span><span class="nx">SetPlace</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">newPlace</span><span class="p">)</span>
<a id="__codelineno-147-23" name="__codelineno-147-23"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-147-24" name="__codelineno-147-24"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-147-25" name="__codelineno-147-25"></a><span class="p">}</span>
<a id="__codelineno-147-26" name="__codelineno-147-26"></a>
<a id="__codelineno-147-27" name="__codelineno-147-27"></a><span class="c1">// 更新された Seichy と関連付けられた Place を使用</span>
<a id="__codelineno-147-28" name="__codelineno-147-28"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Seichy ID:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">seichy</span><span class="p">.</span><span class="nx">SeichiID</span><span class="p">)</span>
<a id="__codelineno-147-29" name="__codelineno-147-29"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Place Name:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">seichy</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">Place</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h4 id="place_2">既存の <code>Place</code> を関連付ける場合</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-148-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-148-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-148-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-148-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-148-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-148-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-148-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-148-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-148-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-148-10">10</a></span>
<span class="normal"><a href="#__codelineno-148-11">11</a></span>
<span class="normal"><a href="#__codelineno-148-12">12</a></span>
<span class="normal"><a href="#__codelineno-148-13">13</a></span>
<span class="normal"><a href="#__codelineno-148-14">14</a></span>
<span class="normal"><a href="#__codelineno-148-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-148-1" name="__codelineno-148-1"></a><span class="c1">// 既存の Place オブジェクトを取得</span>
<a id="__codelineno-148-2" name="__codelineno-148-2"></a><span class="nx">existingPlace</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Places</span><span class="p">(</span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;place_id=?&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)).</span><span class="nx">One</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-148-3" name="__codelineno-148-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-148-4" name="__codelineno-148-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-148-5" name="__codelineno-148-5"></a><span class="p">}</span>
<a id="__codelineno-148-6" name="__codelineno-148-6"></a>
<a id="__codelineno-148-7" name="__codelineno-148-7"></a><span class="c1">// Seichy オブジェクトに既存の Place を設定（データベースへの挿入は不要）</span>
<a id="__codelineno-148-8" name="__codelineno-148-8"></a><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">seichy</span><span class="p">.</span><span class="nx">SetPlace</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nx">existingPlace</span><span class="p">)</span>
<a id="__codelineno-148-9" name="__codelineno-148-9"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-148-10" name="__codelineno-148-10"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-148-11" name="__codelineno-148-11"></a><span class="p">}</span>
<a id="__codelineno-148-12" name="__codelineno-148-12"></a>
<a id="__codelineno-148-13" name="__codelineno-148-13"></a><span class="c1">// 更新された Seichy と関連付けられた Place を使用</span>
<a id="__codelineno-148-14" name="__codelineno-148-14"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Seichy ID:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">seichy</span><span class="p">.</span><span class="nx">SeichiID</span><span class="p">)</span>
<a id="__codelineno-148-15" name="__codelineno-148-15"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Place Name:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">seichy</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">Place</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="setcontent"><code>SetContent</code> 関数の詳細な解説</h2>
<h3 id="_127">関数の概要</h3>
<p><code>SetContent</code> 関数は、<code>Seichy</code> オブジェクトと関連する <code>Content</code> オブジェクトとのリレーションシップを設定します。この関数を使用することで、<code>Seichy</code> オブジェクトに関連する <code>Content</code> オブジェクトを設定し、その関係をデータベースおよびメモリ上で維持します。</p>
<h3 id="_128">関数のシグネチャ</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-149-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-149-1" name="__codelineno-149-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">Seichy</span><span class="p">)</span><span class="w"> </span><span class="nx">SetContent</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">insert</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="nx">related</span><span class="w"> </span><span class="o">*</span><span class="nx">Content</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>引数や戻り値は <code>SetPlace</code> 関数と同様ですが、対象が <code>Place</code> ではなく <code>Content</code> である点が異なります。</li>
</ul>
<h3 id="_129">コードの詳細な解説</h3>
<p><code>SetPlace</code> 関数と同様の処理を行いますが、対象が <code>Place</code> ではなく <code>Content</code> である点が異なります。</p>
<h4 id="1_5">1. 変数の宣言</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-150-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-150-1" name="__codelineno-150-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span>
</code></pre></div></td></tr></table></div>
<h4 id="2_5">2. 挿入フラグに基づく処理</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-151-1">1</a></span>
<span class="normal"><a href="#__codelineno-151-2">2</a></span>
<span class="normal"><a href="#__codelineno-151-3">3</a></span>
<span class="normal"><a href="#__codelineno-151-4">4</a></span>
<span class="normal"><a href="#__codelineno-151-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-151-1" name="__codelineno-151-1"></a><span class="k">if</span><span class="w"> </span><span class="nx">insert</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-151-2" name="__codelineno-151-2"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">related</span><span class="p">.</span><span class="nx">Insert</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">Infer</span><span class="p">());</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-151-3" name="__codelineno-151-3"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;failed to insert into foreign table&quot;</span><span class="p">)</span>
<a id="__codelineno-151-4" name="__codelineno-151-4"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-151-5" name="__codelineno-151-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="3-seichy_2">3. <code>Seichy</code> テーブルの更新</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-152-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-152-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-152-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-152-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-152-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-152-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-152-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-152-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-152-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-152-10">10</a></span>
<span class="normal"><a href="#__codelineno-152-11">11</a></span>
<span class="normal"><a href="#__codelineno-152-12">12</a></span>
<span class="normal"><a href="#__codelineno-152-13">13</a></span>
<span class="normal"><a href="#__codelineno-152-14">14</a></span>
<span class="normal"><a href="#__codelineno-152-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-152-1" name="__codelineno-152-1"></a><span class="nx">updateQuery</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span>
<a id="__codelineno-152-2" name="__codelineno-152-2"></a><span class="w">    </span><span class="s">&quot;UPDATE `seichies` SET %s WHERE %s&quot;</span><span class="p">,</span>
<a id="__codelineno-152-3" name="__codelineno-152-3"></a><span class="w">    </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">SetParamNames</span><span class="p">(</span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;content_id&quot;</span><span class="p">}),</span>
<a id="__codelineno-152-4" name="__codelineno-152-4"></a><span class="w">    </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">WhereClause</span><span class="p">(</span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">seichyPrimaryKeyColumns</span><span class="p">),</span>
<a id="__codelineno-152-5" name="__codelineno-152-5"></a><span class="p">)</span>
<a id="__codelineno-152-6" name="__codelineno-152-6"></a><span class="nx">values</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span><span class="nx">related</span><span class="p">.</span><span class="nx">ContentID</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">SeichiID</span><span class="p">}</span>
<a id="__codelineno-152-7" name="__codelineno-152-7"></a>
<a id="__codelineno-152-8" name="__codelineno-152-8"></a><span class="k">if</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">IsDebug</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-152-9" name="__codelineno-152-9"></a><span class="w">    </span><span class="nx">writer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">DebugWriterFrom</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<a id="__codelineno-152-10" name="__codelineno-152-10"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">updateQuery</span><span class="p">)</span>
<a id="__codelineno-152-11" name="__codelineno-152-11"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">values</span><span class="p">)</span>
<a id="__codelineno-152-12" name="__codelineno-152-12"></a><span class="p">}</span>
<a id="__codelineno-152-13" name="__codelineno-152-13"></a><span class="k">if</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">exec</span><span class="p">.</span><span class="nx">ExecContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">updateQuery</span><span class="p">,</span><span class="w"> </span><span class="nx">values</span><span class="o">...</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-152-14" name="__codelineno-152-14"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;failed to update local table&quot;</span><span class="p">)</span>
<a id="__codelineno-152-15" name="__codelineno-152-15"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="4_2">4. ローカルオブジェクトのフィールド更新</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-153-1">1</a></span>
<span class="normal"><a href="#__codelineno-153-2">2</a></span>
<span class="normal"><a href="#__codelineno-153-3">3</a></span>
<span class="normal"><a href="#__codelineno-153-4">4</a></span>
<span class="normal"><a href="#__codelineno-153-5">5</a></span>
<span class="normal"><a href="#__codelineno-153-6">6</a></span>
<span class="normal"><a href="#__codelineno-153-7">7</a></span>
<span class="normal"><a href="#__codelineno-153-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-153-1" name="__codelineno-153-1"></a><span class="nx">o</span><span class="p">.</span><span class="nx">ContentID</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">related</span><span class="p">.</span><span class="nx">ContentID</span>
<a id="__codelineno-153-2" name="__codelineno-153-2"></a><span class="k">if</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-153-3" name="__codelineno-153-3"></a><span class="w">    </span><span class="nx">o</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">seichyR</span><span class="p">{</span>
<a id="__codelineno-153-4" name="__codelineno-153-4"></a><span class="w">        </span><span class="nx">Content</span><span class="p">:</span><span class="w"> </span><span class="nx">related</span><span class="p">,</span>
<a id="__codelineno-153-5" name="__codelineno-153-5"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-153-6" name="__codelineno-153-6"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-153-7" name="__codelineno-153-7"></a><span class="w">    </span><span class="nx">o</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">Content</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">related</span>
<a id="__codelineno-153-8" name="__codelineno-153-8"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="5_5">5. 関連オブジェクトのリレーションシップ設定</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-154-1">1</a></span>
<span class="normal"><a href="#__codelineno-154-2">2</a></span>
<span class="normal"><a href="#__codelineno-154-3">3</a></span>
<span class="normal"><a href="#__codelineno-154-4">4</a></span>
<span class="normal"><a href="#__codelineno-154-5">5</a></span>
<span class="normal"><a href="#__codelineno-154-6">6</a></span>
<span class="normal"><a href="#__codelineno-154-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-154-1" name="__codelineno-154-1"></a><span class="k">if</span><span class="w"> </span><span class="nx">related</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-154-2" name="__codelineno-154-2"></a><span class="w">    </span><span class="nx">related</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">contentR</span><span class="p">{</span>
<a id="__codelineno-154-3" name="__codelineno-154-3"></a><span class="w">        </span><span class="nx">Seichies</span><span class="p">:</span><span class="w"> </span><span class="nx">SeichySlice</span><span class="p">{</span><span class="nx">o</span><span class="p">},</span>
<a id="__codelineno-154-4" name="__codelineno-154-4"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-154-5" name="__codelineno-154-5"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-154-6" name="__codelineno-154-6"></a><span class="w">    </span><span class="nx">related</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">Seichies</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">related</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">Seichies</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">)</span>
<a id="__codelineno-154-7" name="__codelineno-154-7"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="6_5">6. エラーがない場合、成功を返す</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-155-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-155-1" name="__codelineno-155-1"></a><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
</code></pre></div></td></tr></table></div>
<h3 id="_130">開発者向け利用例</h3>
<h4 id="content_1">新しい <code>Content</code> を作成して関連付ける場合</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-156-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-156-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-156-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-156-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-156-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-156-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-156-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-156-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-156-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-156-10">10</a></span>
<span class="normal"><a href="#__codelineno-156-11">11</a></span>
<span class="normal"><a href="#__codelineno-156-12">12</a></span>
<span class="normal"><a href="#__codelineno-156-13">13</a></span>
<span class="normal"><a href="#__codelineno-156-14">14</a></span>
<span class="normal"><a href="#__codelineno-156-15">15</a></span>
<span class="normal"><a href="#__codelineno-156-16">16</a></span>
<span class="normal"><a href="#__codelineno-156-17">17</a></span>
<span class="normal"><a href="#__codelineno-156-18">18</a></span>
<span class="normal"><a href="#__codelineno-156-19">19</a></span>
<span class="normal"><a href="#__codelineno-156-20">20</a></span>
<span class="normal"><a href="#__codelineno-156-21">21</a></span>
<span class="normal"><a href="#__codelineno-156-22">22</a></span>
<span class="normal"><a href="#__codelineno-156-23">23</a></span>
<span class="normal"><a href="#__codelineno-156-24">24</a></span>
<span class="normal"><a href="#__codelineno-156-25">25</a></span>
<span class="normal"><a href="#__codelineno-156-26">26</a></span>
<span class="normal"><a href="#__codelineno-156-27">27</a></span>
<span class="normal"><a href="#__codelineno-156-28">28</a></span>
<span class="normal"><a href="#__codelineno-156-29">29</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-156-1" name="__codelineno-156-1"></a><span class="c1">// データベースエグゼキューターの取得（例）</span>
<a id="__codelineno-156-2" name="__codelineno-156-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;your_connection_string&quot;</span><span class="p">)</span>
<a id="__codelineno-156-3" name="__codelineno-156-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-156-4" name="__codelineno-156-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-156-5" name="__codelineno-156-5"></a><span class="p">}</span>
<a id="__codelineno-156-6" name="__codelineno-156-6"></a>
<a id="__codelineno-156-7" name="__codelineno-156-7"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-156-8" name="__codelineno-156-8"></a>
<a id="__codelineno-156-9" name="__codelineno-156-9"></a><span class="c1">// Seichy オブジェクトを取得</span>
<a id="__codelineno-156-10" name="__codelineno-156-10"></a><span class="nx">seichy</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Seichies</span><span class="p">(</span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;seichi_id=?&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)).</span><span class="nx">One</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-156-11" name="__codelineno-156-11"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-156-12" name="__codelineno-156-12"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-156-13" name="__codelineno-156-13"></a><span class="p">}</span>
<a id="__codelineno-156-14" name="__codelineno-156-14"></a>
<a id="__codelineno-156-15" name="__codelineno-156-15"></a><span class="c1">// 新しい Content オブジェクトを作成</span>
<a id="__codelineno-156-16" name="__codelineno-156-16"></a><span class="nx">newContent</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Content</span><span class="p">{</span>
<a id="__codelineno-156-17" name="__codelineno-156-17"></a><span class="w">    </span><span class="nx">Title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;新しいコンテンツ&quot;</span><span class="p">,</span>
<a id="__codelineno-156-18" name="__codelineno-156-18"></a><span class="w">    </span><span class="c1">// 他のフィールドを設定</span>
<a id="__codelineno-156-19" name="__codelineno-156-19"></a><span class="p">}</span>
<a id="__codelineno-156-20" name="__codelineno-156-20"></a>
<a id="__codelineno-156-21" name="__codelineno-156-21"></a><span class="c1">// Seichy オブジェクトに Content を設定し、Content をデータベースに挿入</span>
<a id="__codelineno-156-22" name="__codelineno-156-22"></a><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">seichy</span><span class="p">.</span><span class="nx">SetContent</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">newContent</span><span class="p">)</span>
<a id="__codelineno-156-23" name="__codelineno-156-23"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-156-24" name="__codelineno-156-24"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-156-25" name="__codelineno-156-25"></a><span class="p">}</span>
<a id="__codelineno-156-26" name="__codelineno-156-26"></a>
<a id="__codelineno-156-27" name="__codelineno-156-27"></a><span class="c1">// 更新された Seichy と関連付けられた Content を使用</span>
<a id="__codelineno-156-28" name="__codelineno-156-28"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Seichy ID:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">seichy</span><span class="p">.</span><span class="nx">SeichiID</span><span class="p">)</span>
<a id="__codelineno-156-29" name="__codelineno-156-29"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Content Title:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">seichy</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">Content</span><span class="p">.</span><span class="nx">Title</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h4 id="content_2">既存の <code>Content</code> を関連付ける場合</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-157-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-157-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-157-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-157-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-157-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-157-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-157-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-157-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-157-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-157-10">10</a></span>
<span class="normal"><a href="#__codelineno-157-11">11</a></span>
<span class="normal"><a href="#__codelineno-157-12">12</a></span>
<span class="normal"><a href="#__codelineno-157-13">13</a></span>
<span class="normal"><a href="#__codelineno-157-14">14</a></span>
<span class="normal"><a href="#__codelineno-157-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-157-1" name="__codelineno-157-1"></a><span class="c1">// 既存の Content オブジェクトを取得</span>
<a id="__codelineno-157-2" name="__codelineno-157-2"></a><span class="nx">existingContent</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Contents</span><span class="p">(</span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;content_id=?&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)).</span><span class="nx">One</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-157-3" name="__codelineno-157-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-157-4" name="__codelineno-157-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-157-5" name="__codelineno-157-5"></a><span class="p">}</span>
<a id="__codelineno-157-6" name="__codelineno-157-6"></a>
<a id="__codelineno-157-7" name="__codelineno-157-7"></a><span class="c1">// Seichy オブジェクトに既存の Content を設定（データベースへの挿入は不要）</span>
<a id="__codelineno-157-8" name="__codelineno-157-8"></a><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">seichy</span><span class="p">.</span><span class="nx">SetContent</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nx">existingContent</span><span class="p">)</span>
<a id="__codelineno-157-9" name="__codelineno-157-9"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-157-10" name="__codelineno-157-10"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-157-11" name="__codelineno-157-11"></a><span class="p">}</span>
<a id="__codelineno-157-12" name="__codelineno-157-12"></a>
<a id="__codelineno-157-13" name="__codelineno-157-13"></a><span class="c1">// 更新された Seichy と関連付けられた Content を使用</span>
<a id="__codelineno-157-14" name="__codelineno-157-14"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Seichy ID:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">seichy</span><span class="p">.</span><span class="nx">SeichiID</span><span class="p">)</span>
<a id="__codelineno-157-15" name="__codelineno-157-15"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Content Title:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">seichy</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">Content</span><span class="p">.</span><span class="nx">Title</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="seichies"><code>Seichies</code> 関数の詳細な解説</h2>
<h3 id="_131">関数の概要</h3>
<p><code>Seichies</code> 関数は、<code>seichies</code> テーブルからレコードを取得するためのクエリを作成します。この関数を使用することで、<code>Seichy</code> オブジェクトのスライスを取得するためのクエリを簡単に構築できます。</p>
<h3 id="_132">関数のシグネチャ</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-158-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-158-1" name="__codelineno-158-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">Seichies</span><span class="p">(</span><span class="nx">mods</span><span class="w"> </span><span class="o">...</span><span class="nx">qm</span><span class="p">.</span><span class="nx">QueryMod</span><span class="p">)</span><span class="w"> </span><span class="nx">seichyQuery</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>mods ...qm.QueryMod</code>：クエリに適用するモディファイア（修飾子）。</li>
<li>戻り値：<code>seichyQuery</code> 型のクエリオブジェクト。</li>
</ul>
<h3 id="_133">コードの詳細な解説</h3>
<h4 id="1_6">1. クエリモディファイアの追加</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-159-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-159-1" name="__codelineno-159-1"></a><span class="nx">mods</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">mods</span><span class="p">,</span><span class="w"> </span><span class="nx">qm</span><span class="p">.</span><span class="nx">From</span><span class="p">(</span><span class="s">&quot;`seichies`&quot;</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>受け取ったモディファイアに、<code>FROM 'seichies'</code> を追加します。</li>
</ul>
<h4 id="2_6">2. 新しいクエリの作成</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-160-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-160-1" name="__codelineno-160-1"></a><span class="nx">q</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">NewQuery</span><span class="p">(</span><span class="nx">mods</span><span class="o">...</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>モディファイアを適用した新しいクエリを作成します。</li>
</ul>
<h4 id="3-select">3. SELECT 文の設定</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-161-1">1</a></span>
<span class="normal"><a href="#__codelineno-161-2">2</a></span>
<span class="normal"><a href="#__codelineno-161-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-161-1" name="__codelineno-161-1"></a><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">queries</span><span class="p">.</span><span class="nx">GetSelect</span><span class="p">(</span><span class="nx">q</span><span class="p">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-161-2" name="__codelineno-161-2"></a><span class="w">    </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetSelect</span><span class="p">(</span><span class="nx">q</span><span class="p">,</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;`seichies`.*&quot;</span><span class="p">})</span>
<a id="__codelineno-161-3" name="__codelineno-161-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>クエリに <code>SELECT</code> 文が設定されていない場合、<code>seichies</code> テーブルの全てのカラムを選択するように設定します。</li>
</ul>
<h4 id="4_3">4. クエリオブジェクトの返却</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-162-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-162-1" name="__codelineno-162-1"></a><span class="k">return</span><span class="w"> </span><span class="nx">seichyQuery</span><span class="p">{</span><span class="nx">q</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>作成したクエリを <code>seichyQuery</code> 型として返します。</li>
</ul>
<h3 id="_134">開発者向け利用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-163-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-163-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-163-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-163-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-163-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-163-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-163-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-163-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-163-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-163-10">10</a></span>
<span class="normal"><a href="#__codelineno-163-11">11</a></span>
<span class="normal"><a href="#__codelineno-163-12">12</a></span>
<span class="normal"><a href="#__codelineno-163-13">13</a></span>
<span class="normal"><a href="#__codelineno-163-14">14</a></span>
<span class="normal"><a href="#__codelineno-163-15">15</a></span>
<span class="normal"><a href="#__codelineno-163-16">16</a></span>
<span class="normal"><a href="#__codelineno-163-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-163-1" name="__codelineno-163-1"></a><span class="c1">// 全ての Seichy レコードを取得</span>
<a id="__codelineno-163-2" name="__codelineno-163-2"></a><span class="nx">seichies</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Seichies</span><span class="p">().</span><span class="nx">All</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-163-3" name="__codelineno-163-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-163-4" name="__codelineno-163-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-163-5" name="__codelineno-163-5"></a><span class="p">}</span>
<a id="__codelineno-163-6" name="__codelineno-163-6"></a>
<a id="__codelineno-163-7" name="__codelineno-163-7"></a><span class="c1">// 特定の条件で Seichy レコードを取得</span>
<a id="__codelineno-163-8" name="__codelineno-163-8"></a><span class="nx">seichies</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Seichies</span><span class="p">(</span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;user_id = ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)).</span><span class="nx">All</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-163-9" name="__codelineno-163-9"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-163-10" name="__codelineno-163-10"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-163-11" name="__codelineno-163-11"></a><span class="p">}</span>
<a id="__codelineno-163-12" name="__codelineno-163-12"></a>
<a id="__codelineno-163-13" name="__codelineno-163-13"></a><span class="c1">// 取得した Seichy レコードを使用</span>
<a id="__codelineno-163-14" name="__codelineno-163-14"></a><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">seichies</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-163-15" name="__codelineno-163-15"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Seichy ID:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">SeichiID</span><span class="p">)</span>
<a id="__codelineno-163-16" name="__codelineno-163-16"></a><span class="w">    </span><span class="c1">// 他の操作</span>
<a id="__codelineno-163-17" name="__codelineno-163-17"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="findseichy"><code>FindSeichy</code> 関数の詳細な解説</h2>
<h3 id="_135">関数の概要</h3>
<p><code>FindSeichy</code> 関数は、指定された主キー（<code>seichi_id</code>）に基づいて、<code>seichies</code> テーブルから単一のレコードを取得します。必要に応じて、特定のカラムのみを選択することも可能です。</p>
<h3 id="_136">関数のシグネチャ</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-164-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-164-1" name="__codelineno-164-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">FindSeichy</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">seichiID</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="nx">selectCols</span><span class="w"> </span><span class="o">...</span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">Seichy</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>seichiID int</code>：検索対象の <code>seichi_id</code>。</li>
<li><code>selectCols ...string</code>：選択するカラム名の可変長引数。指定しない場合は全てのカラムを選択。</li>
<li>戻り値：<code>*Seichy</code> オブジェクトとエラー。</li>
</ul>
<h3 id="_137">コードの詳細な解説</h3>
<h4 id="1_7">1. オブジェクトの初期化</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-165-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-165-1" name="__codelineno-165-1"></a><span class="nx">seichyObj</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Seichy</span><span class="p">{}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>結果を格納するための <code>Seichy</code> オブジェクトを作成します。</li>
</ul>
<h4 id="2-select">2. SELECT 文の設定</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-166-1">1</a></span>
<span class="normal"><a href="#__codelineno-166-2">2</a></span>
<span class="normal"><a href="#__codelineno-166-3">3</a></span>
<span class="normal"><a href="#__codelineno-166-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-166-1" name="__codelineno-166-1"></a><span class="nx">sel</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;*&quot;</span>
<a id="__codelineno-166-2" name="__codelineno-166-2"></a><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">selectCols</span><span class="p">)</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-166-3" name="__codelineno-166-3"></a><span class="w">    </span><span class="nx">sel</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">Join</span><span class="p">(</span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">IdentQuoteSlice</span><span class="p">(</span><span class="nx">dialect</span><span class="p">.</span><span class="nx">LQ</span><span class="p">,</span><span class="w"> </span><span class="nx">dialect</span><span class="p">.</span><span class="nx">RQ</span><span class="p">,</span><span class="w"> </span><span class="nx">selectCols</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;,&quot;</span><span class="p">)</span>
<a id="__codelineno-166-4" name="__codelineno-166-4"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>selectCols</code> が指定されている場合、それらのカラムのみを選択するようにクエリを構築します。</li>
<li><code>strmangle.IdentQuoteSlice</code> を使用して、カラム名を適切にクオートします。</li>
</ul>
<h4 id="3">3. クエリの構築</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-167-1">1</a></span>
<span class="normal"><a href="#__codelineno-167-2">2</a></span>
<span class="normal"><a href="#__codelineno-167-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-167-1" name="__codelineno-167-1"></a><span class="nx">query</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span>
<a id="__codelineno-167-2" name="__codelineno-167-2"></a><span class="w">    </span><span class="s">&quot;select %s from `seichies` where `seichi_id`=?&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">sel</span><span class="p">,</span>
<a id="__codelineno-167-3" name="__codelineno-167-3"></a><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>主キーによる検索を行うクエリを作成します。</li>
</ul>
<h4 id="4_4">4. クエリの実行と結果の取得</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-168-1">1</a></span>
<span class="normal"><a href="#__codelineno-168-2">2</a></span>
<span class="normal"><a href="#__codelineno-168-3">3</a></span>
<span class="normal"><a href="#__codelineno-168-4">4</a></span>
<span class="normal"><a href="#__codelineno-168-5">5</a></span>
<span class="normal"><a href="#__codelineno-168-6">6</a></span>
<span class="normal"><a href="#__codelineno-168-7">7</a></span>
<span class="normal"><a href="#__codelineno-168-8">8</a></span>
<span class="normal"><a href="#__codelineno-168-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-168-1" name="__codelineno-168-1"></a><span class="nx">q</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">Raw</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span><span class="w"> </span><span class="nx">seichiID</span><span class="p">)</span>
<a id="__codelineno-168-2" name="__codelineno-168-2"></a>
<a id="__codelineno-168-3" name="__codelineno-168-3"></a><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">q</span><span class="p">.</span><span class="nx">Bind</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="nx">seichyObj</span><span class="p">)</span>
<a id="__codelineno-168-4" name="__codelineno-168-4"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-168-5" name="__codelineno-168-5"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Is</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">ErrNoRows</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-168-6" name="__codelineno-168-6"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">ErrNoRows</span>
<a id="__codelineno-168-7" name="__codelineno-168-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-168-8" name="__codelineno-168-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to select from seichies&quot;</span><span class="p">)</span>
<a id="__codelineno-168-9" name="__codelineno-168-9"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>クエリを実行し、結果を <code>seichyObj</code> にバインドします。</li>
<li>レコードが存在しない場合、<code>sql.ErrNoRows</code> を返します。</li>
</ul>
<h4 id="5_6">5. フックの実行</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-169-1">1</a></span>
<span class="normal"><a href="#__codelineno-169-2">2</a></span>
<span class="normal"><a href="#__codelineno-169-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-169-1" name="__codelineno-169-1"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">seichyObj</span><span class="p">.</span><span class="nx">doAfterSelectHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-169-2" name="__codelineno-169-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">seichyObj</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-169-3" name="__codelineno-169-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>Seichy</code> オブジェクトに対して、<code>AfterSelect</code> フックが定義されている場合、それらを実行します。</li>
</ul>
<h4 id="6_6">6. オブジェクトの返却</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-170-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-170-1" name="__codelineno-170-1"></a><span class="k">return</span><span class="w"> </span><span class="nx">seichyObj</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>取得した <code>Seichy</code> オブジェクトを返します。</li>
</ul>
<h3 id="_138">開発者向け利用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-171-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-171-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-171-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-171-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-171-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-171-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-171-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-171-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-171-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-171-10">10</a></span>
<span class="normal"><a href="#__codelineno-171-11">11</a></span>
<span class="normal"><a href="#__codelineno-171-12">12</a></span>
<span class="normal"><a href="#__codelineno-171-13">13</a></span>
<span class="normal"><a href="#__codelineno-171-14">14</a></span>
<span class="normal"><a href="#__codelineno-171-15">15</a></span>
<span class="normal"><a href="#__codelineno-171-16">16</a></span>
<span class="normal"><a href="#__codelineno-171-17">17</a></span>
<span class="normal"><a href="#__codelineno-171-18">18</a></span>
<span class="normal"><a href="#__codelineno-171-19">19</a></span>
<span class="normal"><a href="#__codelineno-171-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-171-1" name="__codelineno-171-1"></a><span class="c1">// 特定の Seichy レコードを取得</span>
<a id="__codelineno-171-2" name="__codelineno-171-2"></a><span class="nx">seichy</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">FindSeichy</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-171-3" name="__codelineno-171-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-171-4" name="__codelineno-171-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Is</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">ErrNoRows</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-171-5" name="__codelineno-171-5"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;レコードが見つかりませんでした。&quot;</span><span class="p">)</span>
<a id="__codelineno-171-6" name="__codelineno-171-6"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-171-7" name="__codelineno-171-7"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-171-8" name="__codelineno-171-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-171-9" name="__codelineno-171-9"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-171-10" name="__codelineno-171-10"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Seichy ID:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">seichy</span><span class="p">.</span><span class="nx">SeichiID</span><span class="p">)</span>
<a id="__codelineno-171-11" name="__codelineno-171-11"></a><span class="w">    </span><span class="c1">// 他の操作</span>
<a id="__codelineno-171-12" name="__codelineno-171-12"></a><span class="p">}</span>
<a id="__codelineno-171-13" name="__codelineno-171-13"></a>
<a id="__codelineno-171-14" name="__codelineno-171-14"></a><span class="c1">// 特定のカラムのみを取得</span>
<a id="__codelineno-171-15" name="__codelineno-171-15"></a><span class="nx">seichy</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">FindSeichy</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;seichi_id&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user_id&quot;</span><span class="p">)</span>
<a id="__codelineno-171-16" name="__codelineno-171-16"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-171-17" name="__codelineno-171-17"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-171-18" name="__codelineno-171-18"></a><span class="p">}</span>
<a id="__codelineno-171-19" name="__codelineno-171-19"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Seichy ID:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">seichy</span><span class="p">.</span><span class="nx">SeichiID</span><span class="p">)</span>
<a id="__codelineno-171-20" name="__codelineno-171-20"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;User ID:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">seichy</span><span class="p">.</span><span class="nx">UserID</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="insert_1"><code>Insert</code> 関数の詳細な解説</h2>
<h3 id="_139">関数の概要</h3>
<p><code>Insert</code> 関数は、<code>Seichy</code> オブジェクトをデータベースに挿入します。適切なカラムのセットやデフォルト値の適用、フックの実行などを行います。</p>
<h3 id="_140">関数のシグネチャ</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-172-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-172-1" name="__codelineno-172-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">Seichy</span><span class="p">)</span><span class="w"> </span><span class="nx">Insert</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">columns</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">Columns</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>o *Seichy</code>：挿入する <code>Seichy</code> オブジェクト。</li>
<li><code>columns boil.Columns</code>：挿入時に使用するカラムの設定。<code>boil.Infer()</code> を使用すると非ゼロ値のフィールドが挿入されます。</li>
</ul>
<h3 id="_141">コードの詳細な解説</h3>
<h4 id="1_8">1. オブジェクトの存在確認</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-173-1">1</a></span>
<span class="normal"><a href="#__codelineno-173-2">2</a></span>
<span class="normal"><a href="#__codelineno-173-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-173-1" name="__codelineno-173-1"></a><span class="k">if</span><span class="w"> </span><span class="nx">o</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-173-2" name="__codelineno-173-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;models: no seichies provided for insertion&quot;</span><span class="p">)</span>
<a id="__codelineno-173-3" name="__codelineno-173-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>Seichy</code> オブジェクトが <code>nil</code> でないことを確認します。</li>
</ul>
<h4 id="2_7">2. タイムスタンプの設定</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-174-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-174-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-174-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-174-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-174-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-174-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-174-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-174-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-174-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-174-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-174-1" name="__codelineno-174-1"></a><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">boil</span><span class="p">.</span><span class="nx">TimestampsAreSkipped</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-174-2" name="__codelineno-174-2"></a><span class="w">    </span><span class="nx">currTime</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">In</span><span class="p">(</span><span class="nx">boil</span><span class="p">.</span><span class="nx">GetLocation</span><span class="p">())</span>
<a id="__codelineno-174-3" name="__codelineno-174-3"></a>
<a id="__codelineno-174-4" name="__codelineno-174-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">MustTime</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">CreatedAt</span><span class="p">).</span><span class="nx">IsZero</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-174-5" name="__codelineno-174-5"></a><span class="w">        </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetScanner</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">o</span><span class="p">.</span><span class="nx">CreatedAt</span><span class="p">,</span><span class="w"> </span><span class="nx">currTime</span><span class="p">)</span>
<a id="__codelineno-174-6" name="__codelineno-174-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-174-7" name="__codelineno-174-7"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">MustTime</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">UpdatedAt</span><span class="p">).</span><span class="nx">IsZero</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-174-8" name="__codelineno-174-8"></a><span class="w">        </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetScanner</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">o</span><span class="p">.</span><span class="nx">UpdatedAt</span><span class="p">,</span><span class="w"> </span><span class="nx">currTime</span><span class="p">)</span>
<a id="__codelineno-174-9" name="__codelineno-174-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-174-10" name="__codelineno-174-10"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>CreatedAt</code> と <code>UpdatedAt</code> フィールドに現在時刻を設定します。</li>
</ul>
<h4 id="3-beforeinsert">3. <code>BeforeInsert</code> フックの実行</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-175-1">1</a></span>
<span class="normal"><a href="#__codelineno-175-2">2</a></span>
<span class="normal"><a href="#__codelineno-175-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-175-1" name="__codelineno-175-1"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">doBeforeInsertHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-175-2" name="__codelineno-175-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-175-3" name="__codelineno-175-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>Seichy</code> オブジェクトに対して、<code>BeforeInsert</code> フックが定義されている場合、それらを実行します。</li>
</ul>
<h4 id="4_5">4. 非ゼロのデフォルト値セットの取得</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-176-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-176-1" name="__codelineno-176-1"></a><span class="nx">nzDefaults</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">NonZeroDefaultSet</span><span class="p">(</span><span class="nx">seichyColumnsWithDefault</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>非ゼロのデフォルト値を持つカラムのセットを取得します。</li>
</ul>
<h4 id="5_7">5. キャッシュキーの作成とキャッシュの確認</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-177-1">1</a></span>
<span class="normal"><a href="#__codelineno-177-2">2</a></span>
<span class="normal"><a href="#__codelineno-177-3">3</a></span>
<span class="normal"><a href="#__codelineno-177-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-177-1" name="__codelineno-177-1"></a><span class="nx">key</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">makeCacheKey</span><span class="p">(</span><span class="nx">columns</span><span class="p">,</span><span class="w"> </span><span class="nx">nzDefaults</span><span class="p">)</span>
<a id="__codelineno-177-2" name="__codelineno-177-2"></a><span class="nx">seichyInsertCacheMut</span><span class="p">.</span><span class="nx">RLock</span><span class="p">()</span>
<a id="__codelineno-177-3" name="__codelineno-177-3"></a><span class="nx">cache</span><span class="p">,</span><span class="w"> </span><span class="nx">cached</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">seichyInsertCache</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
<a id="__codelineno-177-4" name="__codelineno-177-4"></a><span class="nx">seichyInsertCacheMut</span><span class="p">.</span><span class="nx">RUnlock</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>クエリのキャッシュ機構を使用して、同じカラムセットのクエリを効率的に再利用します。</li>
</ul>
<h4 id="6_7">6. クエリとマッピングの準備</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-178-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-178-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-178-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-178-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-178-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-178-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-178-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-178-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-178-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-178-10">10</a></span>
<span class="normal"><a href="#__codelineno-178-11">11</a></span>
<span class="normal"><a href="#__codelineno-178-12">12</a></span>
<span class="normal"><a href="#__codelineno-178-13">13</a></span>
<span class="normal"><a href="#__codelineno-178-14">14</a></span>
<span class="normal"><a href="#__codelineno-178-15">15</a></span>
<span class="normal"><a href="#__codelineno-178-16">16</a></span>
<span class="normal"><a href="#__codelineno-178-17">17</a></span>
<span class="normal"><a href="#__codelineno-178-18">18</a></span>
<span class="normal"><a href="#__codelineno-178-19">19</a></span>
<span class="normal"><a href="#__codelineno-178-20">20</a></span>
<span class="normal"><a href="#__codelineno-178-21">21</a></span>
<span class="normal"><a href="#__codelineno-178-22">22</a></span>
<span class="normal"><a href="#__codelineno-178-23">23</a></span>
<span class="normal"><a href="#__codelineno-178-24">24</a></span>
<span class="normal"><a href="#__codelineno-178-25">25</a></span>
<span class="normal"><a href="#__codelineno-178-26">26</a></span>
<span class="normal"><a href="#__codelineno-178-27">27</a></span>
<span class="normal"><a href="#__codelineno-178-28">28</a></span>
<span class="normal"><a href="#__codelineno-178-29">29</a></span>
<span class="normal"><a href="#__codelineno-178-30">30</a></span>
<span class="normal"><a href="#__codelineno-178-31">31</a></span>
<span class="normal"><a href="#__codelineno-178-32">32</a></span>
<span class="normal"><a href="#__codelineno-178-33">33</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-178-1" name="__codelineno-178-1"></a><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">cached</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-178-2" name="__codelineno-178-2"></a><span class="w">    </span><span class="c1">// ホワイトリストとリターンカラムの設定</span>
<a id="__codelineno-178-3" name="__codelineno-178-3"></a><span class="w">    </span><span class="nx">wl</span><span class="p">,</span><span class="w"> </span><span class="nx">returnColumns</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">columns</span><span class="p">.</span><span class="nx">InsertColumnSet</span><span class="p">(</span>
<a id="__codelineno-178-4" name="__codelineno-178-4"></a><span class="w">        </span><span class="nx">seichyAllColumns</span><span class="p">,</span>
<a id="__codelineno-178-5" name="__codelineno-178-5"></a><span class="w">        </span><span class="nx">seichyColumnsWithDefault</span><span class="p">,</span>
<a id="__codelineno-178-6" name="__codelineno-178-6"></a><span class="w">        </span><span class="nx">seichyColumnsWithoutDefault</span><span class="p">,</span>
<a id="__codelineno-178-7" name="__codelineno-178-7"></a><span class="w">        </span><span class="nx">nzDefaults</span><span class="p">,</span>
<a id="__codelineno-178-8" name="__codelineno-178-8"></a><span class="w">    </span><span class="p">)</span>
<a id="__codelineno-178-9" name="__codelineno-178-9"></a>
<a id="__codelineno-178-10" name="__codelineno-178-10"></a><span class="w">    </span><span class="c1">// バリューマッピングとリターンマッピングの作成</span>
<a id="__codelineno-178-11" name="__codelineno-178-11"></a><span class="w">    </span><span class="nx">cache</span><span class="p">.</span><span class="nx">valueMapping</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">BindMapping</span><span class="p">(</span><span class="nx">seichyType</span><span class="p">,</span><span class="w"> </span><span class="nx">seichyMapping</span><span class="p">,</span><span class="w"> </span><span class="nx">wl</span><span class="p">)</span>
<a id="__codelineno-178-12" name="__codelineno-178-12"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-178-13" name="__codelineno-178-13"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-178-14" name="__codelineno-178-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-178-15" name="__codelineno-178-15"></a><span class="w">    </span><span class="nx">cache</span><span class="p">.</span><span class="nx">retMapping</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">BindMapping</span><span class="p">(</span><span class="nx">seichyType</span><span class="p">,</span><span class="w"> </span><span class="nx">seichyMapping</span><span class="p">,</span><span class="w"> </span><span class="nx">returnColumns</span><span class="p">)</span>
<a id="__codelineno-178-16" name="__codelineno-178-16"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-178-17" name="__codelineno-178-17"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-178-18" name="__codelineno-178-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-178-19" name="__codelineno-178-19"></a>
<a id="__codelineno-178-20" name="__codelineno-178-20"></a><span class="w">    </span><span class="c1">// クエリ文字列の作成</span>
<a id="__codelineno-178-21" name="__codelineno-178-21"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">wl</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-178-22" name="__codelineno-178-22"></a><span class="w">        </span><span class="nx">cache</span><span class="p">.</span><span class="nx">query</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;INSERT INTO `seichies` (`%s`) %%sVALUES (%s)%%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">Join</span><span class="p">(</span><span class="nx">wl</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;`,`&quot;</span><span class="p">),</span><span class="w"> </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">Placeholders</span><span class="p">(</span><span class="nx">dialect</span><span class="p">.</span><span class="nx">UseIndexPlaceholders</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">wl</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-178-23" name="__codelineno-178-23"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-178-24" name="__codelineno-178-24"></a><span class="w">        </span><span class="nx">cache</span><span class="p">.</span><span class="nx">query</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;INSERT INTO `seichies` () VALUES ()%s%s&quot;</span>
<a id="__codelineno-178-25" name="__codelineno-178-25"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-178-26" name="__codelineno-178-26"></a>
<a id="__codelineno-178-27" name="__codelineno-178-27"></a><span class="w">    </span><span class="c1">// 戻り値のクエリの作成</span>
<a id="__codelineno-178-28" name="__codelineno-178-28"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">cache</span><span class="p">.</span><span class="nx">retMapping</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-178-29" name="__codelineno-178-29"></a><span class="w">        </span><span class="nx">cache</span><span class="p">.</span><span class="nx">retQuery</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;SELECT `%s` FROM `seichies` WHERE %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">Join</span><span class="p">(</span><span class="nx">returnColumns</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;`,`&quot;</span><span class="p">),</span><span class="w"> </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">WhereClause</span><span class="p">(</span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">seichyPrimaryKeyColumns</span><span class="p">))</span>
<a id="__codelineno-178-30" name="__codelineno-178-30"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-178-31" name="__codelineno-178-31"></a>
<a id="__codelineno-178-32" name="__codelineno-178-32"></a><span class="w">    </span><span class="nx">cache</span><span class="p">.</span><span class="nx">query</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="nx">cache</span><span class="p">.</span><span class="nx">query</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-178-33" name="__codelineno-178-33"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>キャッシュが存在しない場合、クエリとマッピングを初期化します。</li>
</ul>
<h4 id="7_3">7. 値の取得とクエリの実行</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-179-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-179-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-179-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-179-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-179-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-179-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-179-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-179-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-179-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-179-10">10</a></span>
<span class="normal"><a href="#__codelineno-179-11">11</a></span>
<span class="normal"><a href="#__codelineno-179-12">12</a></span>
<span class="normal"><a href="#__codelineno-179-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-179-1" name="__codelineno-179-1"></a><span class="nx">value</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">Indirect</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="nx">o</span><span class="p">))</span>
<a id="__codelineno-179-2" name="__codelineno-179-2"></a><span class="nx">vals</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">ValuesFromMapping</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">valueMapping</span><span class="p">)</span>
<a id="__codelineno-179-3" name="__codelineno-179-3"></a>
<a id="__codelineno-179-4" name="__codelineno-179-4"></a><span class="k">if</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">IsDebug</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-179-5" name="__codelineno-179-5"></a><span class="w">    </span><span class="nx">writer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">DebugWriterFrom</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<a id="__codelineno-179-6" name="__codelineno-179-6"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">query</span><span class="p">)</span>
<a id="__codelineno-179-7" name="__codelineno-179-7"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">vals</span><span class="p">)</span>
<a id="__codelineno-179-8" name="__codelineno-179-8"></a><span class="p">}</span>
<a id="__codelineno-179-9" name="__codelineno-179-9"></a><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">exec</span><span class="p">.</span><span class="nx">ExecContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">query</span><span class="p">,</span><span class="w"> </span><span class="nx">vals</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-179-10" name="__codelineno-179-10"></a>
<a id="__codelineno-179-11" name="__codelineno-179-11"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-179-12" name="__codelineno-179-12"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to insert into seichies&quot;</span><span class="p">)</span>
<a id="__codelineno-179-13" name="__codelineno-179-13"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>オブジェクトから値を抽出し、クエリを実行します。</li>
</ul>
<h4 id="8-id">8. 最後の挿入IDの取得とオブジェクトへの反映</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-180-1">1</a></span>
<span class="normal"><a href="#__codelineno-180-2">2</a></span>
<span class="normal"><a href="#__codelineno-180-3">3</a></span>
<span class="normal"><a href="#__codelineno-180-4">4</a></span>
<span class="normal"><a href="#__codelineno-180-5">5</a></span>
<span class="normal"><a href="#__codelineno-180-6">6</a></span>
<span class="normal"><a href="#__codelineno-180-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-180-1" name="__codelineno-180-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">lastID</span><span class="w"> </span><span class="kt">int64</span>
<a id="__codelineno-180-2" name="__codelineno-180-2"></a><span class="nx">lastID</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">LastInsertId</span><span class="p">()</span>
<a id="__codelineno-180-3" name="__codelineno-180-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-180-4" name="__codelineno-180-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">ErrSyncFail</span>
<a id="__codelineno-180-5" name="__codelineno-180-5"></a><span class="p">}</span>
<a id="__codelineno-180-6" name="__codelineno-180-6"></a>
<a id="__codelineno-180-7" name="__codelineno-180-7"></a><span class="nx">o</span><span class="p">.</span><span class="nx">SeichiID</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="nx">lastID</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>LastInsertId</code> を使用して、新しく挿入されたレコードのIDを取得し、<code>o.SeichiID</code> に設定します。</li>
</ul>
<h4 id="9_3">9. デフォルト値の取得（必要な場合）</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-181-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-181-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-181-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-181-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-181-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-181-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-181-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-181-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-181-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-181-10">10</a></span>
<span class="normal"><a href="#__codelineno-181-11">11</a></span>
<span class="normal"><a href="#__codelineno-181-12">12</a></span>
<span class="normal"><a href="#__codelineno-181-13">13</a></span>
<span class="normal"><a href="#__codelineno-181-14">14</a></span>
<span class="normal"><a href="#__codelineno-181-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-181-1" name="__codelineno-181-1"></a><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">cache</span><span class="p">.</span><span class="nx">retMapping</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-181-2" name="__codelineno-181-2"></a><span class="w">    </span><span class="nx">identifierCols</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span>
<a id="__codelineno-181-3" name="__codelineno-181-3"></a><span class="w">        </span><span class="nx">o</span><span class="p">.</span><span class="nx">SeichiID</span><span class="p">,</span>
<a id="__codelineno-181-4" name="__codelineno-181-4"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-181-5" name="__codelineno-181-5"></a>
<a id="__codelineno-181-6" name="__codelineno-181-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">IsDebug</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-181-7" name="__codelineno-181-7"></a><span class="w">        </span><span class="nx">writer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">DebugWriterFrom</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<a id="__codelineno-181-8" name="__codelineno-181-8"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">retQuery</span><span class="p">)</span>
<a id="__codelineno-181-9" name="__codelineno-181-9"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">identifierCols</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-181-10" name="__codelineno-181-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-181-11" name="__codelineno-181-11"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">exec</span><span class="p">.</span><span class="nx">QueryRowContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">retQuery</span><span class="p">,</span><span class="w"> </span><span class="nx">identifierCols</span><span class="o">...</span><span class="p">).</span><span class="nx">Scan</span><span class="p">(</span><span class="nx">queries</span><span class="p">.</span><span class="nx">PtrsFromMapping</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">retMapping</span><span class="p">)</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-181-12" name="__codelineno-181-12"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-181-13" name="__codelineno-181-13"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to populate default values for seichies&quot;</span><span class="p">)</span>
<a id="__codelineno-181-14" name="__codelineno-181-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-181-15" name="__codelineno-181-15"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>必要に応じて、デフォルト値を取得し、オブジェクトに反映します。</li>
</ul>
<h4 id="10">10. キャッシュの保存</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-182-1">1</a></span>
<span class="normal"><a href="#__codelineno-182-2">2</a></span>
<span class="normal"><a href="#__codelineno-182-3">3</a></span>
<span class="normal"><a href="#__codelineno-182-4">4</a></span>
<span class="normal"><a href="#__codelineno-182-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-182-1" name="__codelineno-182-1"></a><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">cached</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-182-2" name="__codelineno-182-2"></a><span class="w">    </span><span class="nx">seichyInsertCacheMut</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
<a id="__codelineno-182-3" name="__codelineno-182-3"></a><span class="w">    </span><span class="nx">seichyInsertCache</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">cache</span>
<a id="__codelineno-182-4" name="__codelineno-182-4"></a><span class="w">    </span><span class="nx">seichyInsertCacheMut</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>
<a id="__codelineno-182-5" name="__codelineno-182-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>キャッシュが存在しない場合、新しく作成したキャッシュを保存します。</li>
</ul>
<h4 id="11-afterinsert">11. <code>AfterInsert</code> フックの実行</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-183-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-183-1" name="__codelineno-183-1"></a><span class="k">return</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">doAfterInsertHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>Seichy</code> オブジェクトに対して、<code>AfterInsert</code> フックが定義されている場合、それらを実行します。</li>
</ul>
<h3 id="_142">開発者向け利用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-184-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-184-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-184-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-184-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-184-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-184-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-184-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-184-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-184-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-184-10">10</a></span>
<span class="normal"><a href="#__codelineno-184-11">11</a></span>
<span class="normal"><a href="#__codelineno-184-12">12</a></span>
<span class="normal"><a href="#__codelineno-184-13">13</a></span>
<span class="normal"><a href="#__codelineno-184-14">14</a></span>
<span class="normal"><a href="#__codelineno-184-15">15</a></span>
<span class="normal"><a href="#__codelineno-184-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-184-1" name="__codelineno-184-1"></a><span class="c1">// 新しい Seichy オブジェクトを作成</span>
<a id="__codelineno-184-2" name="__codelineno-184-2"></a><span class="nx">newSeichy</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Seichy</span><span class="p">{</span>
<a id="__codelineno-184-3" name="__codelineno-184-3"></a><span class="w">    </span><span class="nx">UserID</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-184-4" name="__codelineno-184-4"></a><span class="w">    </span><span class="nx">PlaceID</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-184-5" name="__codelineno-184-5"></a><span class="w">    </span><span class="nx">ContentID</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<a id="__codelineno-184-6" name="__codelineno-184-6"></a><span class="w">    </span><span class="c1">// 他のフィールドを設定</span>
<a id="__codelineno-184-7" name="__codelineno-184-7"></a><span class="p">}</span>
<a id="__codelineno-184-8" name="__codelineno-184-8"></a>
<a id="__codelineno-184-9" name="__codelineno-184-9"></a><span class="c1">// Seichy オブジェクトをデータベースに挿入</span>
<a id="__codelineno-184-10" name="__codelineno-184-10"></a><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">newSeichy</span><span class="p">.</span><span class="nx">Insert</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">Infer</span><span class="p">())</span>
<a id="__codelineno-184-11" name="__codelineno-184-11"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-184-12" name="__codelineno-184-12"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-184-13" name="__codelineno-184-13"></a><span class="p">}</span>
<a id="__codelineno-184-14" name="__codelineno-184-14"></a>
<a id="__codelineno-184-15" name="__codelineno-184-15"></a><span class="c1">// 挿入された Seichy オブジェクトの情報を使用</span>
<a id="__codelineno-184-16" name="__codelineno-184-16"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;挿入された Seichy ID:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">newSeichy</span><span class="p">.</span><span class="nx">SeichiID</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="update_1"><code>Update</code> 関数の詳細な解説</h2>
<h3 id="_143">関数の概要</h3>
<p><code>Update</code> 関数は、既存の <code>Seichy</code> オブジェクトをデータベースで更新します。必要なカラムを指定して更新し、タイムスタンプの更新やフックの実行などを行います。</p>
<h3 id="_144">関数のシグネチャ</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-185-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-185-1" name="__codelineno-185-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">Seichy</span><span class="p">)</span><span class="w"> </span><span class="nx">Update</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">columns</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">Columns</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">int64</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>columns boil.Columns</code>：更新時に使用するカラムの設定。<code>boil.Infer()</code> を使用すると非ゼロ値のフィールドが更新されます。</li>
<li>戻り値：更新された行数とエラー。</li>
</ul>
<h3 id="_145">コードの詳細な解説</h3>
<h4 id="1_9">1. タイムスタンプの更新</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-186-1">1</a></span>
<span class="normal"><a href="#__codelineno-186-2">2</a></span>
<span class="normal"><a href="#__codelineno-186-3">3</a></span>
<span class="normal"><a href="#__codelineno-186-4">4</a></span>
<span class="normal"><a href="#__codelineno-186-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-186-1" name="__codelineno-186-1"></a><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">boil</span><span class="p">.</span><span class="nx">TimestampsAreSkipped</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-186-2" name="__codelineno-186-2"></a><span class="w">    </span><span class="nx">currTime</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">In</span><span class="p">(</span><span class="nx">boil</span><span class="p">.</span><span class="nx">GetLocation</span><span class="p">())</span>
<a id="__codelineno-186-3" name="__codelineno-186-3"></a>
<a id="__codelineno-186-4" name="__codelineno-186-4"></a><span class="w">    </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetScanner</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">o</span><span class="p">.</span><span class="nx">UpdatedAt</span><span class="p">,</span><span class="w"> </span><span class="nx">currTime</span><span class="p">)</span>
<a id="__codelineno-186-5" name="__codelineno-186-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>UpdatedAt</code> フィールドに現在時刻を設定します。</li>
</ul>
<h4 id="2-beforeupdate">2. <code>BeforeUpdate</code> フックの実行</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-187-1">1</a></span>
<span class="normal"><a href="#__codelineno-187-2">2</a></span>
<span class="normal"><a href="#__codelineno-187-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-187-1" name="__codelineno-187-1"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">doBeforeUpdateHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-187-2" name="__codelineno-187-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-187-3" name="__codelineno-187-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>Seichy</code> オブジェクトに対して、<code>BeforeUpdate</code> フックが定義されている場合、それらを実行します。</li>
</ul>
<h4 id="3_1">3. キャッシュキーの作成とキャッシュの確認</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-188-1">1</a></span>
<span class="normal"><a href="#__codelineno-188-2">2</a></span>
<span class="normal"><a href="#__codelineno-188-3">3</a></span>
<span class="normal"><a href="#__codelineno-188-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-188-1" name="__codelineno-188-1"></a><span class="nx">key</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">makeCacheKey</span><span class="p">(</span><span class="nx">columns</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<a id="__codelineno-188-2" name="__codelineno-188-2"></a><span class="nx">seichyUpdateCacheMut</span><span class="p">.</span><span class="nx">RLock</span><span class="p">()</span>
<a id="__codelineno-188-3" name="__codelineno-188-3"></a><span class="nx">cache</span><span class="p">,</span><span class="w"> </span><span class="nx">cached</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">seichyUpdateCache</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
<a id="__codelineno-188-4" name="__codelineno-188-4"></a><span class="nx">seichyUpdateCacheMut</span><span class="p">.</span><span class="nx">RUnlock</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>クエリのキャッシュ機構を使用して、同じカラムセットのクエリを効率的に再利用します。</li>
</ul>
<h4 id="4_6">4. クエリとマッピングの準備</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-189-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-189-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-189-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-189-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-189-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-189-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-189-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-189-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-189-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-189-10">10</a></span>
<span class="normal"><a href="#__codelineno-189-11">11</a></span>
<span class="normal"><a href="#__codelineno-189-12">12</a></span>
<span class="normal"><a href="#__codelineno-189-13">13</a></span>
<span class="normal"><a href="#__codelineno-189-14">14</a></span>
<span class="normal"><a href="#__codelineno-189-15">15</a></span>
<span class="normal"><a href="#__codelineno-189-16">16</a></span>
<span class="normal"><a href="#__codelineno-189-17">17</a></span>
<span class="normal"><a href="#__codelineno-189-18">18</a></span>
<span class="normal"><a href="#__codelineno-189-19">19</a></span>
<span class="normal"><a href="#__codelineno-189-20">20</a></span>
<span class="normal"><a href="#__codelineno-189-21">21</a></span>
<span class="normal"><a href="#__codelineno-189-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-189-1" name="__codelineno-189-1"></a><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">cached</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-189-2" name="__codelineno-189-2"></a><span class="w">    </span><span class="nx">wl</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">columns</span><span class="p">.</span><span class="nx">UpdateColumnSet</span><span class="p">(</span>
<a id="__codelineno-189-3" name="__codelineno-189-3"></a><span class="w">        </span><span class="nx">seichyAllColumns</span><span class="p">,</span>
<a id="__codelineno-189-4" name="__codelineno-189-4"></a><span class="w">        </span><span class="nx">seichyPrimaryKeyColumns</span><span class="p">,</span>
<a id="__codelineno-189-5" name="__codelineno-189-5"></a><span class="w">    </span><span class="p">)</span>
<a id="__codelineno-189-6" name="__codelineno-189-6"></a>
<a id="__codelineno-189-7" name="__codelineno-189-7"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">columns</span><span class="p">.</span><span class="nx">IsWhitelist</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-189-8" name="__codelineno-189-8"></a><span class="w">        </span><span class="nx">wl</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">SetComplement</span><span class="p">(</span><span class="nx">wl</span><span class="p">,</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;created_at&quot;</span><span class="p">})</span>
<a id="__codelineno-189-9" name="__codelineno-189-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-189-10" name="__codelineno-189-10"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">wl</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-189-11" name="__codelineno-189-11"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;models: unable to update seichies, could not build whitelist&quot;</span><span class="p">)</span>
<a id="__codelineno-189-12" name="__codelineno-189-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-189-13" name="__codelineno-189-13"></a>
<a id="__codelineno-189-14" name="__codelineno-189-14"></a><span class="w">    </span><span class="nx">cache</span><span class="p">.</span><span class="nx">query</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;UPDATE `seichies` SET %s WHERE %s&quot;</span><span class="p">,</span>
<a id="__codelineno-189-15" name="__codelineno-189-15"></a><span class="w">        </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">SetParamNames</span><span class="p">(</span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">wl</span><span class="p">),</span>
<a id="__codelineno-189-16" name="__codelineno-189-16"></a><span class="w">        </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">WhereClause</span><span class="p">(</span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">seichyPrimaryKeyColumns</span><span class="p">),</span>
<a id="__codelineno-189-17" name="__codelineno-189-17"></a><span class="w">    </span><span class="p">)</span>
<a id="__codelineno-189-18" name="__codelineno-189-18"></a><span class="w">    </span><span class="nx">cache</span><span class="p">.</span><span class="nx">valueMapping</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">BindMapping</span><span class="p">(</span><span class="nx">seichyType</span><span class="p">,</span><span class="w"> </span><span class="nx">seichyMapping</span><span class="p">,</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">wl</span><span class="p">,</span><span class="w"> </span><span class="nx">seichyPrimaryKeyColumns</span><span class="o">...</span><span class="p">))</span>
<a id="__codelineno-189-19" name="__codelineno-189-19"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-189-20" name="__codelineno-189-20"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-189-21" name="__codelineno-189-21"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-189-22" name="__codelineno-189-22"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>キャッシュが存在しない場合、更新に使用するカラムセットとクエリを準備します。</li>
</ul>
<h4 id="5_8">5. 値の取得とクエリの実行</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-190-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-190-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-190-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-190-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-190-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-190-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-190-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-190-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-190-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-190-10">10</a></span>
<span class="normal"><a href="#__codelineno-190-11">11</a></span>
<span class="normal"><a href="#__codelineno-190-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-190-1" name="__codelineno-190-1"></a><span class="nx">values</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">ValuesFromMapping</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">Indirect</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="nx">o</span><span class="p">)),</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">valueMapping</span><span class="p">)</span>
<a id="__codelineno-190-2" name="__codelineno-190-2"></a>
<a id="__codelineno-190-3" name="__codelineno-190-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">IsDebug</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-190-4" name="__codelineno-190-4"></a><span class="w">    </span><span class="nx">writer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">DebugWriterFrom</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<a id="__codelineno-190-5" name="__codelineno-190-5"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">query</span><span class="p">)</span>
<a id="__codelineno-190-6" name="__codelineno-190-6"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">values</span><span class="p">)</span>
<a id="__codelineno-190-7" name="__codelineno-190-7"></a><span class="p">}</span>
<a id="__codelineno-190-8" name="__codelineno-190-8"></a><span class="kd">var</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Result</span>
<a id="__codelineno-190-9" name="__codelineno-190-9"></a><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">exec</span><span class="p">.</span><span class="nx">ExecContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">query</span><span class="p">,</span><span class="w"> </span><span class="nx">values</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-190-10" name="__codelineno-190-10"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-190-11" name="__codelineno-190-11"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to update seichies row&quot;</span><span class="p">)</span>
<a id="__codelineno-190-12" name="__codelineno-190-12"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>オブジェクトから値を抽出し、クエリを実行します。</li>
</ul>
<h4 id="6_8">6. 更新された行数の取得</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-191-1">1</a></span>
<span class="normal"><a href="#__codelineno-191-2">2</a></span>
<span class="normal"><a href="#__codelineno-191-3">3</a></span>
<span class="normal"><a href="#__codelineno-191-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-191-1" name="__codelineno-191-1"></a><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">RowsAffected</span><span class="p">()</span>
<a id="__codelineno-191-2" name="__codelineno-191-2"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-191-3" name="__codelineno-191-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: failed to get rows affected by update for seichies&quot;</span><span class="p">)</span>
<a id="__codelineno-191-4" name="__codelineno-191-4"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>RowsAffected</code> を使用して、更新された行数を取得します。</li>
</ul>
<h4 id="7_4">7. キャッシュの保存</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-192-1">1</a></span>
<span class="normal"><a href="#__codelineno-192-2">2</a></span>
<span class="normal"><a href="#__codelineno-192-3">3</a></span>
<span class="normal"><a href="#__codelineno-192-4">4</a></span>
<span class="normal"><a href="#__codelineno-192-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-192-1" name="__codelineno-192-1"></a><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">cached</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-192-2" name="__codelineno-192-2"></a><span class="w">    </span><span class="nx">seichyUpdateCacheMut</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
<a id="__codelineno-192-3" name="__codelineno-192-3"></a><span class="w">    </span><span class="nx">seichyUpdateCache</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">cache</span>
<a id="__codelineno-192-4" name="__codelineno-192-4"></a><span class="w">    </span><span class="nx">seichyUpdateCacheMut</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>
<a id="__codelineno-192-5" name="__codelineno-192-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>キャッシュが存在しない場合、新しく作成したキャッシュを保存します。</li>
</ul>
<h4 id="8-afterupdate">8. <code>AfterUpdate</code> フックの実行</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-193-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-193-1" name="__codelineno-193-1"></a><span class="k">return</span><span class="w"> </span><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">doAfterUpdateHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>AfterUpdate</code> フックを実行し、更新された行数とエラーを返します。</li>
</ul>
<h3 id="_146">開発者向け利用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-194-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-194-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-194-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-194-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-194-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-194-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-194-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-194-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-194-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-194-10">10</a></span>
<span class="normal"><a href="#__codelineno-194-11">11</a></span>
<span class="normal"><a href="#__codelineno-194-12">12</a></span>
<span class="normal"><a href="#__codelineno-194-13">13</a></span>
<span class="normal"><a href="#__codelineno-194-14">14</a></span>
<span class="normal"><a href="#__codelineno-194-15">15</a></span>
<span class="normal"><a href="#__codelineno-194-16">16</a></span>
<span class="normal"><a href="#__codelineno-194-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-194-1" name="__codelineno-194-1"></a><span class="c1">// Seichy オブジェクトを取得</span>
<a id="__codelineno-194-2" name="__codelineno-194-2"></a><span class="nx">seichy</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">FindSeichy</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-194-3" name="__codelineno-194-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-194-4" name="__codelineno-194-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-194-5" name="__codelineno-194-5"></a><span class="p">}</span>
<a id="__codelineno-194-6" name="__codelineno-194-6"></a>
<a id="__codelineno-194-7" name="__codelineno-194-7"></a><span class="c1">// フィールドを更新</span>
<a id="__codelineno-194-8" name="__codelineno-194-8"></a><span class="nx">seichy</span><span class="p">.</span><span class="nx">UserID</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">2</span>
<a id="__codelineno-194-9" name="__codelineno-194-9"></a><span class="nx">seichy</span><span class="p">.</span><span class="nx">PlaceID</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">3</span>
<a id="__codelineno-194-10" name="__codelineno-194-10"></a>
<a id="__codelineno-194-11" name="__codelineno-194-11"></a><span class="c1">// Seichy オブジェクトをデータベースで更新</span>
<a id="__codelineno-194-12" name="__codelineno-194-12"></a><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">seichy</span><span class="p">.</span><span class="nx">Update</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">Infer</span><span class="p">())</span>
<a id="__codelineno-194-13" name="__codelineno-194-13"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-194-14" name="__codelineno-194-14"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-194-15" name="__codelineno-194-15"></a><span class="p">}</span>
<a id="__codelineno-194-16" name="__codelineno-194-16"></a>
<a id="__codelineno-194-17" name="__codelineno-194-17"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;更新された行数: %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">rowsAff</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h2 id="_147">注意事項</h2>
<ul>
<li><code>Insert</code> 関数と <code>Update</code> 関数は、データベースとの同期を行い、オブジェクトの状態を反映します。</li>
<li>関数を使用する際には、適切なカラムセット（ホワイトリストやブラックリスト）を指定し、デフォルト値や非ゼロ値の扱いに注意してください。</li>
<li>フック（<code>BeforeInsert</code>、<code>AfterInsert</code>、<code>BeforeUpdate</code>、<code>AfterUpdate</code> など）を定義することで、挿入や更新の前後にカスタム処理を追加できます。</li>
<li>エラー処理を適切に行い、データの不整合や予期せぬ挙動を防ぎます。</li>
</ul>
<p>SetPlace<code>、</code>SetContent<code>、</code>Seichies<code>、</code>FindSeichy<code>、</code>Insert<code>、</code>Update<code>関数の詳細な解説を行いました。これらの関数を使用することで、</code>Seichy` オブジェクトに関連するデータの取得、関連付け、挿入、更新を効率的に行うことができます。</p>
<hr />
<h3 id="updateall_2"><code>UpdateAll</code> 関数の解説</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-195-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-195-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-195-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-195-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-195-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-195-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-195-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-195-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-195-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-195-10">10</a></span>
<span class="normal"><a href="#__codelineno-195-11">11</a></span>
<span class="normal"><a href="#__codelineno-195-12">12</a></span>
<span class="normal"><a href="#__codelineno-195-13">13</a></span>
<span class="normal"><a href="#__codelineno-195-14">14</a></span>
<span class="normal"><a href="#__codelineno-195-15">15</a></span>
<span class="normal"><a href="#__codelineno-195-16">16</a></span>
<span class="normal"><a href="#__codelineno-195-17">17</a></span>
<span class="normal"><a href="#__codelineno-195-18">18</a></span>
<span class="normal"><a href="#__codelineno-195-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-195-1" name="__codelineno-195-1"></a><span class="c1">// UpdateAll は指定された列の値で全ての行を更新します。</span>
<a id="__codelineno-195-2" name="__codelineno-195-2"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">q</span><span class="w"> </span><span class="nx">seichyQuery</span><span class="p">)</span><span class="w"> </span><span class="nx">UpdateAll</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">cols</span><span class="w"> </span><span class="nx">M</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">int64</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-195-3" name="__codelineno-195-3"></a><span class="w">    </span><span class="c1">// クエリに更新内容を設定</span>
<a id="__codelineno-195-4" name="__codelineno-195-4"></a><span class="w">    </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetUpdate</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">,</span><span class="w"> </span><span class="nx">cols</span><span class="p">)</span>
<a id="__codelineno-195-5" name="__codelineno-195-5"></a>
<a id="__codelineno-195-6" name="__codelineno-195-6"></a><span class="w">    </span><span class="c1">// クエリを実行</span>
<a id="__codelineno-195-7" name="__codelineno-195-7"></a><span class="w">    </span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">.</span><span class="nx">ExecContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">)</span>
<a id="__codelineno-195-8" name="__codelineno-195-8"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-195-9" name="__codelineno-195-9"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to update all for seichies&quot;</span><span class="p">)</span>
<a id="__codelineno-195-10" name="__codelineno-195-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-195-11" name="__codelineno-195-11"></a>
<a id="__codelineno-195-12" name="__codelineno-195-12"></a><span class="w">    </span><span class="c1">// 影響を受けた行数を取得</span>
<a id="__codelineno-195-13" name="__codelineno-195-13"></a><span class="w">    </span><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">RowsAffected</span><span class="p">()</span>
<a id="__codelineno-195-14" name="__codelineno-195-14"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-195-15" name="__codelineno-195-15"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to retrieve rows affected for seichies&quot;</span><span class="p">)</span>
<a id="__codelineno-195-16" name="__codelineno-195-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-195-17" name="__codelineno-195-17"></a>
<a id="__codelineno-195-18" name="__codelineno-195-18"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-195-19" name="__codelineno-195-19"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="_148">詳細な説明</h4>
<ul>
<li><strong>目的</strong>: <code>UpdateAll</code> 関数は、クエリにマッチする全ての行を指定された列の値で更新します。</li>
<li><strong>パラメータ</strong>:</li>
<li><code>ctx context.Context</code>: コンテキスト。キャンセルやタイムアウトの制御に使用。</li>
<li><code>exec boil.ContextExecutor</code>: データベースへの実行インターフェース。トランザクションや接続を指定。</li>
<li><code>cols M</code>: 更新する列名とその値のマップ。</li>
<li><strong>処理の流れ</strong>:</li>
<li><code>queries.SetUpdate</code> を使用して、クエリに更新内容を設定。</li>
<li><code>q.Query.ExecContext</code> を使用してクエリを実行。</li>
<li><code>result.RowsAffected</code> で影響を受けた行数を取得。</li>
<li><strong>戻り値</strong>:</li>
<li><code>int64</code>: 更新された行数。</li>
<li><code>error</code>: エラー情報。</li>
</ul>
<h4 id="_149">利用例</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-196-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-196-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-196-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-196-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-196-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-196-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-196-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-196-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-196-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-196-10">10</a></span>
<span class="normal"><a href="#__codelineno-196-11">11</a></span>
<span class="normal"><a href="#__codelineno-196-12">12</a></span>
<span class="normal"><a href="#__codelineno-196-13">13</a></span>
<span class="normal"><a href="#__codelineno-196-14">14</a></span>
<span class="normal"><a href="#__codelineno-196-15">15</a></span>
<span class="normal"><a href="#__codelineno-196-16">16</a></span>
<span class="normal"><a href="#__codelineno-196-17">17</a></span>
<span class="normal"><a href="#__codelineno-196-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-196-1" name="__codelineno-196-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-196-2" name="__codelineno-196-2"></a><span class="nx">exec</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">db</span><span class="w"> </span><span class="c1">// *sql.DB または *sql.Tx</span>
<a id="__codelineno-196-3" name="__codelineno-196-3"></a>
<a id="__codelineno-196-4" name="__codelineno-196-4"></a><span class="c1">// 更新したい列と値をマップで指定</span>
<a id="__codelineno-196-5" name="__codelineno-196-5"></a><span class="nx">cols</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">M</span><span class="p">{</span>
<a id="__codelineno-196-6" name="__codelineno-196-6"></a><span class="w">    </span><span class="s">&quot;column_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;new_value&quot;</span><span class="p">,</span>
<a id="__codelineno-196-7" name="__codelineno-196-7"></a><span class="p">}</span>
<a id="__codelineno-196-8" name="__codelineno-196-8"></a>
<a id="__codelineno-196-9" name="__codelineno-196-9"></a><span class="c1">// クエリを作成（例: 条件として &quot;status = &#39;active&#39;&quot; の行を更新）</span>
<a id="__codelineno-196-10" name="__codelineno-196-10"></a><span class="nx">q</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Seichies</span><span class="p">(</span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;status=?&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;active&quot;</span><span class="p">))</span>
<a id="__codelineno-196-11" name="__codelineno-196-11"></a>
<a id="__codelineno-196-12" name="__codelineno-196-12"></a><span class="c1">// 全てのマッチする行を更新</span>
<a id="__codelineno-196-13" name="__codelineno-196-13"></a><span class="nx">rowsAffected</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">q</span><span class="p">.</span><span class="nx">UpdateAll</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="nx">cols</span><span class="p">)</span>
<a id="__codelineno-196-14" name="__codelineno-196-14"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-196-15" name="__codelineno-196-15"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-196-16" name="__codelineno-196-16"></a><span class="p">}</span>
<a id="__codelineno-196-17" name="__codelineno-196-17"></a>
<a id="__codelineno-196-18" name="__codelineno-196-18"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;更新された行数: %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">rowsAffected</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<h3 id="updateall_3"><code>UpdateAll</code> メソッド（スライス用）の解説</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-197-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-197-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-197-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-197-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-197-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-197-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-197-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-197-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-197-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-197-10">10</a></span>
<span class="normal"><a href="#__codelineno-197-11">11</a></span>
<span class="normal"><a href="#__codelineno-197-12">12</a></span>
<span class="normal"><a href="#__codelineno-197-13">13</a></span>
<span class="normal"><a href="#__codelineno-197-14">14</a></span>
<span class="normal"><a href="#__codelineno-197-15">15</a></span>
<span class="normal"><a href="#__codelineno-197-16">16</a></span>
<span class="normal"><a href="#__codelineno-197-17">17</a></span>
<span class="normal"><a href="#__codelineno-197-18">18</a></span>
<span class="normal"><a href="#__codelineno-197-19">19</a></span>
<span class="normal"><a href="#__codelineno-197-20">20</a></span>
<span class="normal"><a href="#__codelineno-197-21">21</a></span>
<span class="normal"><a href="#__codelineno-197-22">22</a></span>
<span class="normal"><a href="#__codelineno-197-23">23</a></span>
<span class="normal"><a href="#__codelineno-197-24">24</a></span>
<span class="normal"><a href="#__codelineno-197-25">25</a></span>
<span class="normal"><a href="#__codelineno-197-26">26</a></span>
<span class="normal"><a href="#__codelineno-197-27">27</a></span>
<span class="normal"><a href="#__codelineno-197-28">28</a></span>
<span class="normal"><a href="#__codelineno-197-29">29</a></span>
<span class="normal"><a href="#__codelineno-197-30">30</a></span>
<span class="normal"><a href="#__codelineno-197-31">31</a></span>
<span class="normal"><a href="#__codelineno-197-32">32</a></span>
<span class="normal"><a href="#__codelineno-197-33">33</a></span>
<span class="normal"><a href="#__codelineno-197-34">34</a></span>
<span class="normal"><a href="#__codelineno-197-35">35</a></span>
<span class="normal"><a href="#__codelineno-197-36">36</a></span>
<span class="normal"><a href="#__codelineno-197-37">37</a></span>
<span class="normal"><a href="#__codelineno-197-38">38</a></span>
<span class="normal"><a href="#__codelineno-197-39">39</a></span>
<span class="normal"><a href="#__codelineno-197-40">40</a></span>
<span class="normal"><a href="#__codelineno-197-41">41</a></span>
<span class="normal"><a href="#__codelineno-197-42">42</a></span>
<span class="normal"><a href="#__codelineno-197-43">43</a></span>
<span class="normal"><a href="#__codelineno-197-44">44</a></span>
<span class="normal"><a href="#__codelineno-197-45">45</a></span>
<span class="normal"><a href="#__codelineno-197-46">46</a></span>
<span class="normal"><a href="#__codelineno-197-47">47</a></span>
<span class="normal"><a href="#__codelineno-197-48">48</a></span>
<span class="normal"><a href="#__codelineno-197-49">49</a></span>
<span class="normal"><a href="#__codelineno-197-50">50</a></span>
<span class="normal"><a href="#__codelineno-197-51">51</a></span>
<span class="normal"><a href="#__codelineno-197-52">52</a></span>
<span class="normal"><a href="#__codelineno-197-53">53</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-197-1" name="__codelineno-197-1"></a><span class="c1">// UpdateAll はスライス内の全てのオブジェクトを指定された列の値で更新します。</span>
<a id="__codelineno-197-2" name="__codelineno-197-2"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="nx">SeichySlice</span><span class="p">)</span><span class="w"> </span><span class="nx">UpdateAll</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">cols</span><span class="w"> </span><span class="nx">M</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">int64</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-197-3" name="__codelineno-197-3"></a><span class="w">    </span><span class="nx">ln</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">int64</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">o</span><span class="p">))</span>
<a id="__codelineno-197-4" name="__codelineno-197-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">ln</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-197-5" name="__codelineno-197-5"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-197-6" name="__codelineno-197-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-197-7" name="__codelineno-197-7"></a>
<a id="__codelineno-197-8" name="__codelineno-197-8"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">cols</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-197-9" name="__codelineno-197-9"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;models: update all requires at least one column argument&quot;</span><span class="p">)</span>
<a id="__codelineno-197-10" name="__codelineno-197-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-197-11" name="__codelineno-197-11"></a>
<a id="__codelineno-197-12" name="__codelineno-197-12"></a><span class="w">    </span><span class="c1">// 更新する列名と値を配列に格納</span>
<a id="__codelineno-197-13" name="__codelineno-197-13"></a><span class="w">    </span><span class="nx">colNames</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">cols</span><span class="p">))</span>
<a id="__codelineno-197-14" name="__codelineno-197-14"></a><span class="w">    </span><span class="nx">args</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kd">interface</span><span class="p">{},</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">cols</span><span class="p">))</span>
<a id="__codelineno-197-15" name="__codelineno-197-15"></a>
<a id="__codelineno-197-16" name="__codelineno-197-16"></a><span class="w">    </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span>
<a id="__codelineno-197-17" name="__codelineno-197-17"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">cols</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-197-18" name="__codelineno-197-18"></a><span class="w">        </span><span class="nx">colNames</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">name</span>
<a id="__codelineno-197-19" name="__codelineno-197-19"></a><span class="w">        </span><span class="nx">args</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">value</span>
<a id="__codelineno-197-20" name="__codelineno-197-20"></a><span class="w">        </span><span class="nx">i</span><span class="o">++</span>
<a id="__codelineno-197-21" name="__codelineno-197-21"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-197-22" name="__codelineno-197-22"></a>
<a id="__codelineno-197-23" name="__codelineno-197-23"></a><span class="w">    </span><span class="c1">// 主キーの値を引数に追加</span>
<a id="__codelineno-197-24" name="__codelineno-197-24"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">o</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-197-25" name="__codelineno-197-25"></a><span class="w">        </span><span class="nx">pkeyArgs</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">ValuesFromMapping</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">Indirect</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="nx">obj</span><span class="p">)),</span><span class="w"> </span><span class="nx">seichyPrimaryKeyMapping</span><span class="p">)</span>
<a id="__codelineno-197-26" name="__codelineno-197-26"></a><span class="w">        </span><span class="nx">args</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span><span class="w"> </span><span class="nx">pkeyArgs</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-197-27" name="__codelineno-197-27"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-197-28" name="__codelineno-197-28"></a>
<a id="__codelineno-197-29" name="__codelineno-197-29"></a><span class="w">    </span><span class="c1">// SQL文を作成</span>
<a id="__codelineno-197-30" name="__codelineno-197-30"></a><span class="w">    </span><span class="nx">sql</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;UPDATE `seichies` SET %s WHERE %s&quot;</span><span class="p">,</span>
<a id="__codelineno-197-31" name="__codelineno-197-31"></a><span class="w">        </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">SetParamNames</span><span class="p">(</span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">colNames</span><span class="p">),</span>
<a id="__codelineno-197-32" name="__codelineno-197-32"></a><span class="w">        </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">WhereClauseRepeated</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">dialect</span><span class="p">.</span><span class="nx">LQ</span><span class="p">),</span><span class="w"> </span><span class="nb">string</span><span class="p">(</span><span class="nx">dialect</span><span class="p">.</span><span class="nx">RQ</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">seichyPrimaryKeyColumns</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">o</span><span class="p">)))</span>
<a id="__codelineno-197-33" name="__codelineno-197-33"></a>
<a id="__codelineno-197-34" name="__codelineno-197-34"></a><span class="w">    </span><span class="c1">// デバッグログの出力</span>
<a id="__codelineno-197-35" name="__codelineno-197-35"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">IsDebug</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-197-36" name="__codelineno-197-36"></a><span class="w">        </span><span class="nx">writer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">DebugWriterFrom</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<a id="__codelineno-197-37" name="__codelineno-197-37"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">)</span>
<a id="__codelineno-197-38" name="__codelineno-197-38"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-197-39" name="__codelineno-197-39"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-197-40" name="__codelineno-197-40"></a>
<a id="__codelineno-197-41" name="__codelineno-197-41"></a><span class="w">    </span><span class="c1">// クエリを実行</span>
<a id="__codelineno-197-42" name="__codelineno-197-42"></a><span class="w">    </span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">exec</span><span class="p">.</span><span class="nx">ExecContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-197-43" name="__codelineno-197-43"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-197-44" name="__codelineno-197-44"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to update all in seichy slice&quot;</span><span class="p">)</span>
<a id="__codelineno-197-45" name="__codelineno-197-45"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-197-46" name="__codelineno-197-46"></a>
<a id="__codelineno-197-47" name="__codelineno-197-47"></a><span class="w">    </span><span class="c1">// 影響を受けた行数を取得</span>
<a id="__codelineno-197-48" name="__codelineno-197-48"></a><span class="w">    </span><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">RowsAffected</span><span class="p">()</span>
<a id="__codelineno-197-49" name="__codelineno-197-49"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-197-50" name="__codelineno-197-50"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to retrieve rows affected all in update all seichy&quot;</span><span class="p">)</span>
<a id="__codelineno-197-51" name="__codelineno-197-51"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-197-52" name="__codelineno-197-52"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-197-53" name="__codelineno-197-53"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="_150">詳細な説明</h4>
<ul>
<li><strong>目的</strong>: <code>Seichy</code> 型のスライス全体に対して、一括で指定された列の値を更新します。</li>
<li><strong>パラメータ</strong>:</li>
<li><code>ctx context.Context</code>: コンテキスト。</li>
<li><code>exec boil.ContextExecutor</code>: データベースの実行インターフェース。</li>
<li><code>cols M</code>: 更新する列とその値のマップ。</li>
<li><strong>処理の流れ</strong>:</li>
<li>スライスが空の場合、何もせずに終了。</li>
<li>更新する列が指定されていない場合、エラーを返す。</li>
<li>更新する列名と値を準備。</li>
<li>スライス内の各オブジェクトから主キーの値を取得し、引数に追加。</li>
<li>更新用の SQL 文を動的に作成。</li>
<li>クエリを実行し、影響を受けた行数を返す。</li>
<li><strong>戻り値</strong>:</li>
<li><code>int64</code>: 更新された行数。</li>
<li><code>error</code>: エラー情報。</li>
</ul>
<h4 id="_151">利用例</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-198-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-198-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-198-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-198-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-198-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-198-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-198-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-198-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-198-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-198-10">10</a></span>
<span class="normal"><a href="#__codelineno-198-11">11</a></span>
<span class="normal"><a href="#__codelineno-198-12">12</a></span>
<span class="normal"><a href="#__codelineno-198-13">13</a></span>
<span class="normal"><a href="#__codelineno-198-14">14</a></span>
<span class="normal"><a href="#__codelineno-198-15">15</a></span>
<span class="normal"><a href="#__codelineno-198-16">16</a></span>
<span class="normal"><a href="#__codelineno-198-17">17</a></span>
<span class="normal"><a href="#__codelineno-198-18">18</a></span>
<span class="normal"><a href="#__codelineno-198-19">19</a></span>
<span class="normal"><a href="#__codelineno-198-20">20</a></span>
<span class="normal"><a href="#__codelineno-198-21">21</a></span>
<span class="normal"><a href="#__codelineno-198-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-198-1" name="__codelineno-198-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-198-2" name="__codelineno-198-2"></a><span class="nx">exec</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">db</span>
<a id="__codelineno-198-3" name="__codelineno-198-3"></a>
<a id="__codelineno-198-4" name="__codelineno-198-4"></a><span class="c1">// 更新したい Seichy オブジェクトのスライス</span>
<a id="__codelineno-198-5" name="__codelineno-198-5"></a><span class="nx">seichySlice</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">SeichySlice</span><span class="p">{</span>
<a id="__codelineno-198-6" name="__codelineno-198-6"></a><span class="w">    </span><span class="o">&amp;</span><span class="nx">Seichy</span><span class="p">{</span><span class="nx">SeichiID</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">},</span>
<a id="__codelineno-198-7" name="__codelineno-198-7"></a><span class="w">    </span><span class="o">&amp;</span><span class="nx">Seichy</span><span class="p">{</span><span class="nx">SeichiID</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">},</span>
<a id="__codelineno-198-8" name="__codelineno-198-8"></a><span class="w">    </span><span class="o">&amp;</span><span class="nx">Seichy</span><span class="p">{</span><span class="nx">SeichiID</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">},</span>
<a id="__codelineno-198-9" name="__codelineno-198-9"></a><span class="p">}</span>
<a id="__codelineno-198-10" name="__codelineno-198-10"></a>
<a id="__codelineno-198-11" name="__codelineno-198-11"></a><span class="c1">// 更新する列と値</span>
<a id="__codelineno-198-12" name="__codelineno-198-12"></a><span class="nx">cols</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">M</span><span class="p">{</span>
<a id="__codelineno-198-13" name="__codelineno-198-13"></a><span class="w">    </span><span class="s">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;inactive&quot;</span><span class="p">,</span>
<a id="__codelineno-198-14" name="__codelineno-198-14"></a><span class="p">}</span>
<a id="__codelineno-198-15" name="__codelineno-198-15"></a>
<a id="__codelineno-198-16" name="__codelineno-198-16"></a><span class="c1">// スライス内の全てのオブジェクトを更新</span>
<a id="__codelineno-198-17" name="__codelineno-198-17"></a><span class="nx">rowsAffected</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">seichySlice</span><span class="p">.</span><span class="nx">UpdateAll</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="nx">cols</span><span class="p">)</span>
<a id="__codelineno-198-18" name="__codelineno-198-18"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-198-19" name="__codelineno-198-19"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-198-20" name="__codelineno-198-20"></a><span class="p">}</span>
<a id="__codelineno-198-21" name="__codelineno-198-21"></a>
<a id="__codelineno-198-22" name="__codelineno-198-22"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;更新された行数: %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">rowsAffected</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<h3 id="upsert_1"><code>Upsert</code> 関数の解説</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-199-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-199-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-199-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-199-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-199-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-199-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-199-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-199-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-199-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-199-10">10</a></span>
<span class="normal"><a href="#__codelineno-199-11">11</a></span>
<span class="normal"><a href="#__codelineno-199-12">12</a></span>
<span class="normal"><a href="#__codelineno-199-13">13</a></span>
<span class="normal"><a href="#__codelineno-199-14">14</a></span>
<span class="normal"><a href="#__codelineno-199-15">15</a></span>
<span class="normal"><a href="#__codelineno-199-16">16</a></span>
<span class="normal"><a href="#__codelineno-199-17">17</a></span>
<span class="normal"><a href="#__codelineno-199-18">18</a></span>
<span class="normal"><a href="#__codelineno-199-19">19</a></span>
<span class="normal"><a href="#__codelineno-199-20">20</a></span>
<span class="normal"><a href="#__codelineno-199-21">21</a></span>
<span class="normal"><a href="#__codelineno-199-22">22</a></span>
<span class="normal"><a href="#__codelineno-199-23">23</a></span>
<span class="normal"><a href="#__codelineno-199-24">24</a></span>
<span class="normal"><a href="#__codelineno-199-25">25</a></span>
<span class="normal"><a href="#__codelineno-199-26">26</a></span>
<span class="normal"><a href="#__codelineno-199-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-199-1" name="__codelineno-199-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">mySQLSeichyUniqueColumns</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span>
<a id="__codelineno-199-2" name="__codelineno-199-2"></a><span class="w">    </span><span class="s">&quot;seichi_id&quot;</span><span class="p">,</span>
<a id="__codelineno-199-3" name="__codelineno-199-3"></a><span class="p">}</span>
<a id="__codelineno-199-4" name="__codelineno-199-4"></a>
<a id="__codelineno-199-5" name="__codelineno-199-5"></a><span class="c1">// Upsert はエグゼキュータを使用して挿入を試み、衝突があった場合は更新または無視を行います。</span>
<a id="__codelineno-199-6" name="__codelineno-199-6"></a><span class="c1">// updateColumns と insertColumns の使用方法については、boil.Columns のドキュメントを参照してください。</span>
<a id="__codelineno-199-7" name="__codelineno-199-7"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">Seichy</span><span class="p">)</span><span class="w"> </span><span class="nx">Upsert</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">updateColumns</span><span class="p">,</span><span class="w"> </span><span class="nx">insertColumns</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">Columns</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-199-8" name="__codelineno-199-8"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">o</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-199-9" name="__codelineno-199-9"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;models: no seichies provided for upsert&quot;</span><span class="p">)</span>
<a id="__codelineno-199-10" name="__codelineno-199-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-199-11" name="__codelineno-199-11"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">boil</span><span class="p">.</span><span class="nx">TimestampsAreSkipped</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-199-12" name="__codelineno-199-12"></a><span class="w">        </span><span class="nx">currTime</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">In</span><span class="p">(</span><span class="nx">boil</span><span class="p">.</span><span class="nx">GetLocation</span><span class="p">())</span>
<a id="__codelineno-199-13" name="__codelineno-199-13"></a>
<a id="__codelineno-199-14" name="__codelineno-199-14"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">MustTime</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">CreatedAt</span><span class="p">).</span><span class="nx">IsZero</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-199-15" name="__codelineno-199-15"></a><span class="w">            </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetScanner</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">o</span><span class="p">.</span><span class="nx">CreatedAt</span><span class="p">,</span><span class="w"> </span><span class="nx">currTime</span><span class="p">)</span>
<a id="__codelineno-199-16" name="__codelineno-199-16"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-199-17" name="__codelineno-199-17"></a><span class="w">        </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetScanner</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">o</span><span class="p">.</span><span class="nx">UpdatedAt</span><span class="p">,</span><span class="w"> </span><span class="nx">currTime</span><span class="p">)</span>
<a id="__codelineno-199-18" name="__codelineno-199-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-199-19" name="__codelineno-199-19"></a>
<a id="__codelineno-199-20" name="__codelineno-199-20"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">doBeforeUpsertHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-199-21" name="__codelineno-199-21"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-199-22" name="__codelineno-199-22"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-199-23" name="__codelineno-199-23"></a>
<a id="__codelineno-199-24" name="__codelineno-199-24"></a><span class="w">    </span><span class="c1">// 以下、Upsert 処理の実装（省略）</span>
<a id="__codelineno-199-25" name="__codelineno-199-25"></a>
<a id="__codelineno-199-26" name="__codelineno-199-26"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">doAfterUpsertHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">)</span>
<a id="__codelineno-199-27" name="__codelineno-199-27"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="_152">詳細な説明</h4>
<ul>
<li><strong>目的</strong>: <code>Upsert</code> 関数は、データの挿入を試み、主キーや一意制約に違反する場合は更新または無視を行います。データベース内に既に存在する場合は更新し、存在しない場合は挿入します。</li>
<li><strong>パラメータ</strong>:</li>
<li><code>ctx context.Context</code>: コンテキスト。</li>
<li><code>exec boil.ContextExecutor</code>: データベースの実行インターフェース。</li>
<li><code>updateColumns boil.Columns</code>: 更新時に使用する列を指定。</li>
<li><code>insertColumns boil.Columns</code>: 挿入時に使用する列を指定。</li>
<li><strong>処理の流れ</strong>:</li>
<li>オブジェクトが <code>nil</code> でないか確認。</li>
<li>タイムスタンプを現在時刻で更新（スキップされていない場合）。</li>
<li><code>doBeforeUpsertHooks</code> を実行（アップサート前のフック処理）。</li>
<li>Upsert の処理を実行（具体的な SQL クエリの組み立てと実行）。</li>
<li><code>doAfterUpsertHooks</code> を実行（アップサート後のフック処理）。</li>
<li><strong>戻り値</strong>:</li>
<li><code>error</code>: エラー情報。</li>
</ul>
<h4 id="_153">利用例</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-200-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-200-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-200-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-200-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-200-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-200-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-200-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-200-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-200-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-200-10">10</a></span>
<span class="normal"><a href="#__codelineno-200-11">11</a></span>
<span class="normal"><a href="#__codelineno-200-12">12</a></span>
<span class="normal"><a href="#__codelineno-200-13">13</a></span>
<span class="normal"><a href="#__codelineno-200-14">14</a></span>
<span class="normal"><a href="#__codelineno-200-15">15</a></span>
<span class="normal"><a href="#__codelineno-200-16">16</a></span>
<span class="normal"><a href="#__codelineno-200-17">17</a></span>
<span class="normal"><a href="#__codelineno-200-18">18</a></span>
<span class="normal"><a href="#__codelineno-200-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-200-1" name="__codelineno-200-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-200-2" name="__codelineno-200-2"></a><span class="nx">exec</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">db</span>
<a id="__codelineno-200-3" name="__codelineno-200-3"></a>
<a id="__codelineno-200-4" name="__codelineno-200-4"></a><span class="nx">seichy</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Seichy</span><span class="p">{</span>
<a id="__codelineno-200-5" name="__codelineno-200-5"></a><span class="w">    </span><span class="nx">SeichiID</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-200-6" name="__codelineno-200-6"></a><span class="w">    </span><span class="nx">Name</span><span class="p">:</span><span class="w">     </span><span class="s">&quot;Sample&quot;</span><span class="p">,</span>
<a id="__codelineno-200-7" name="__codelineno-200-7"></a><span class="w">    </span><span class="nx">Status</span><span class="p">:</span><span class="w">   </span><span class="s">&quot;active&quot;</span><span class="p">,</span>
<a id="__codelineno-200-8" name="__codelineno-200-8"></a><span class="p">}</span>
<a id="__codelineno-200-9" name="__codelineno-200-9"></a>
<a id="__codelineno-200-10" name="__codelineno-200-10"></a><span class="c1">// 挿入時と更新時に使用する列を指定</span>
<a id="__codelineno-200-11" name="__codelineno-200-11"></a><span class="nx">insertColumns</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">Infer</span><span class="p">()</span>
<a id="__codelineno-200-12" name="__codelineno-200-12"></a><span class="nx">updateColumns</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">Whitelist</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;status&quot;</span><span class="p">)</span>
<a id="__codelineno-200-13" name="__codelineno-200-13"></a>
<a id="__codelineno-200-14" name="__codelineno-200-14"></a><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">seichy</span><span class="p">.</span><span class="nx">Upsert</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="nx">updateColumns</span><span class="p">,</span><span class="w"> </span><span class="nx">insertColumns</span><span class="p">)</span>
<a id="__codelineno-200-15" name="__codelineno-200-15"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-200-16" name="__codelineno-200-16"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-200-17" name="__codelineno-200-17"></a><span class="p">}</span>
<a id="__codelineno-200-18" name="__codelineno-200-18"></a>
<a id="__codelineno-200-19" name="__codelineno-200-19"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Upsert 完了&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<h3 id="delete_1"><code>Delete</code> 関数の解説</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-201-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-201-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-201-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-201-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-201-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-201-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-201-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-201-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-201-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-201-10">10</a></span>
<span class="normal"><a href="#__codelineno-201-11">11</a></span>
<span class="normal"><a href="#__codelineno-201-12">12</a></span>
<span class="normal"><a href="#__codelineno-201-13">13</a></span>
<span class="normal"><a href="#__codelineno-201-14">14</a></span>
<span class="normal"><a href="#__codelineno-201-15">15</a></span>
<span class="normal"><a href="#__codelineno-201-16">16</a></span>
<span class="normal"><a href="#__codelineno-201-17">17</a></span>
<span class="normal"><a href="#__codelineno-201-18">18</a></span>
<span class="normal"><a href="#__codelineno-201-19">19</a></span>
<span class="normal"><a href="#__codelineno-201-20">20</a></span>
<span class="normal"><a href="#__codelineno-201-21">21</a></span>
<span class="normal"><a href="#__codelineno-201-22">22</a></span>
<span class="normal"><a href="#__codelineno-201-23">23</a></span>
<span class="normal"><a href="#__codelineno-201-24">24</a></span>
<span class="normal"><a href="#__codelineno-201-25">25</a></span>
<span class="normal"><a href="#__codelineno-201-26">26</a></span>
<span class="normal"><a href="#__codelineno-201-27">27</a></span>
<span class="normal"><a href="#__codelineno-201-28">28</a></span>
<span class="normal"><a href="#__codelineno-201-29">29</a></span>
<span class="normal"><a href="#__codelineno-201-30">30</a></span>
<span class="normal"><a href="#__codelineno-201-31">31</a></span>
<span class="normal"><a href="#__codelineno-201-32">32</a></span>
<span class="normal"><a href="#__codelineno-201-33">33</a></span>
<span class="normal"><a href="#__codelineno-201-34">34</a></span>
<span class="normal"><a href="#__codelineno-201-35">35</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-201-1" name="__codelineno-201-1"></a><span class="c1">// Delete はエグゼキュータを使用して単一の Seichy レコードを削除します。</span>
<a id="__codelineno-201-2" name="__codelineno-201-2"></a><span class="c1">// Delete はレコードを削除するために主キー列にマッチします。</span>
<a id="__codelineno-201-3" name="__codelineno-201-3"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">Seichy</span><span class="p">)</span><span class="w"> </span><span class="nx">Delete</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">int64</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-201-4" name="__codelineno-201-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">o</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-201-5" name="__codelineno-201-5"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;models: no Seichy provided for delete&quot;</span><span class="p">)</span>
<a id="__codelineno-201-6" name="__codelineno-201-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-201-7" name="__codelineno-201-7"></a>
<a id="__codelineno-201-8" name="__codelineno-201-8"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">doBeforeDeleteHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-201-9" name="__codelineno-201-9"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-201-10" name="__codelineno-201-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-201-11" name="__codelineno-201-11"></a>
<a id="__codelineno-201-12" name="__codelineno-201-12"></a><span class="w">    </span><span class="nx">args</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">ValuesFromMapping</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">Indirect</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="nx">o</span><span class="p">)),</span><span class="w"> </span><span class="nx">seichyPrimaryKeyMapping</span><span class="p">)</span>
<a id="__codelineno-201-13" name="__codelineno-201-13"></a><span class="w">    </span><span class="nx">sql</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;DELETE FROM `seichies` WHERE `seichi_id`=?&quot;</span>
<a id="__codelineno-201-14" name="__codelineno-201-14"></a>
<a id="__codelineno-201-15" name="__codelineno-201-15"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">IsDebug</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-201-16" name="__codelineno-201-16"></a><span class="w">        </span><span class="nx">writer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">DebugWriterFrom</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<a id="__codelineno-201-17" name="__codelineno-201-17"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">)</span>
<a id="__codelineno-201-18" name="__codelineno-201-18"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-201-19" name="__codelineno-201-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-201-20" name="__codelineno-201-20"></a><span class="w">    </span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">exec</span><span class="p">.</span><span class="nx">ExecContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-201-21" name="__codelineno-201-21"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-201-22" name="__codelineno-201-22"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to delete from seichies&quot;</span><span class="p">)</span>
<a id="__codelineno-201-23" name="__codelineno-201-23"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-201-24" name="__codelineno-201-24"></a>
<a id="__codelineno-201-25" name="__codelineno-201-25"></a><span class="w">    </span><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">RowsAffected</span><span class="p">()</span>
<a id="__codelineno-201-26" name="__codelineno-201-26"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-201-27" name="__codelineno-201-27"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: failed to get rows affected by delete for seichies&quot;</span><span class="p">)</span>
<a id="__codelineno-201-28" name="__codelineno-201-28"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-201-29" name="__codelineno-201-29"></a>
<a id="__codelineno-201-30" name="__codelineno-201-30"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">doAfterDeleteHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-201-31" name="__codelineno-201-31"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-201-32" name="__codelineno-201-32"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-201-33" name="__codelineno-201-33"></a>
<a id="__codelineno-201-34" name="__codelineno-201-34"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-201-35" name="__codelineno-201-35"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="_154">詳細な説明</h4>
<ul>
<li><strong>目的</strong>: 単一の <code>Seichy</code> レコードを削除します。削除対象は主キーに基づいて決定されます。</li>
<li><strong>パラメータ</strong>:</li>
<li><code>ctx context.Context</code>: コンテキスト。</li>
<li><code>exec boil.ContextExecutor</code>: データベースの実行インターフェース。</li>
<li><strong>処理の流れ</strong>:</li>
<li>オブジェクトが <code>nil</code> でないか確認。</li>
<li><code>doBeforeDeleteHooks</code> を実行（削除前のフック処理）。</li>
<li>主キーの値を取得し、削除用の SQL 文を作成。</li>
<li>クエリを実行し、影響を受けた行数を取得。</li>
<li><code>doAfterDeleteHooks</code> を実行（削除後のフック処理）。</li>
<li><strong>戻り値</strong>:</li>
<li><code>int64</code>: 削除された行数。</li>
<li><code>error</code>: エラー情報。</li>
</ul>
<h4 id="_155">利用例</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-202-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-202-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-202-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-202-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-202-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-202-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-202-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-202-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-202-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-202-10">10</a></span>
<span class="normal"><a href="#__codelineno-202-11">11</a></span>
<span class="normal"><a href="#__codelineno-202-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-202-1" name="__codelineno-202-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-202-2" name="__codelineno-202-2"></a><span class="nx">exec</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">db</span>
<a id="__codelineno-202-3" name="__codelineno-202-3"></a>
<a id="__codelineno-202-4" name="__codelineno-202-4"></a><span class="nx">seichy</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Seichy</span><span class="p">{</span><span class="nx">SeichiID</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">}</span>
<a id="__codelineno-202-5" name="__codelineno-202-5"></a>
<a id="__codelineno-202-6" name="__codelineno-202-6"></a><span class="c1">// レコードを削除</span>
<a id="__codelineno-202-7" name="__codelineno-202-7"></a><span class="nx">rowsAffected</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">seichy</span><span class="p">.</span><span class="nx">Delete</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">)</span>
<a id="__codelineno-202-8" name="__codelineno-202-8"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-202-9" name="__codelineno-202-9"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-202-10" name="__codelineno-202-10"></a><span class="p">}</span>
<a id="__codelineno-202-11" name="__codelineno-202-11"></a>
<a id="__codelineno-202-12" name="__codelineno-202-12"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;削除された行数: %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">rowsAffected</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<h3 id="deleteall_2"><code>DeleteAll</code> 関数（クエリ用）の解説</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-203-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-203-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-203-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-203-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-203-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-203-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-203-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-203-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-203-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-203-10">10</a></span>
<span class="normal"><a href="#__codelineno-203-11">11</a></span>
<span class="normal"><a href="#__codelineno-203-12">12</a></span>
<span class="normal"><a href="#__codelineno-203-13">13</a></span>
<span class="normal"><a href="#__codelineno-203-14">14</a></span>
<span class="normal"><a href="#__codelineno-203-15">15</a></span>
<span class="normal"><a href="#__codelineno-203-16">16</a></span>
<span class="normal"><a href="#__codelineno-203-17">17</a></span>
<span class="normal"><a href="#__codelineno-203-18">18</a></span>
<span class="normal"><a href="#__codelineno-203-19">19</a></span>
<span class="normal"><a href="#__codelineno-203-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-203-1" name="__codelineno-203-1"></a><span class="c1">// DeleteAll はマッチする全ての行を削除します。</span>
<a id="__codelineno-203-2" name="__codelineno-203-2"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">q</span><span class="w"> </span><span class="nx">seichyQuery</span><span class="p">)</span><span class="w"> </span><span class="nx">DeleteAll</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">int64</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-203-3" name="__codelineno-203-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-203-4" name="__codelineno-203-4"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;models: no seichyQuery provided for delete all&quot;</span><span class="p">)</span>
<a id="__codelineno-203-5" name="__codelineno-203-5"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-203-6" name="__codelineno-203-6"></a>
<a id="__codelineno-203-7" name="__codelineno-203-7"></a><span class="w">    </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetDelete</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">)</span>
<a id="__codelineno-203-8" name="__codelineno-203-8"></a>
<a id="__codelineno-203-9" name="__codelineno-203-9"></a><span class="w">    </span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">.</span><span class="nx">ExecContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">)</span>
<a id="__codelineno-203-10" name="__codelineno-203-10"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-203-11" name="__codelineno-203-11"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to delete all from seichies&quot;</span><span class="p">)</span>
<a id="__codelineno-203-12" name="__codelineno-203-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-203-13" name="__codelineno-203-13"></a>
<a id="__codelineno-203-14" name="__codelineno-203-14"></a><span class="w">    </span><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">RowsAffected</span><span class="p">()</span>
<a id="__codelineno-203-15" name="__codelineno-203-15"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-203-16" name="__codelineno-203-16"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: failed to get rows affected by deleteall for seichies&quot;</span><span class="p">)</span>
<a id="__codelineno-203-17" name="__codelineno-203-17"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-203-18" name="__codelineno-203-18"></a>
<a id="__codelineno-203-19" name="__codelineno-203-19"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-203-20" name="__codelineno-203-20"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="_156">詳細な説明</h4>
<ul>
<li><strong>目的</strong>: クエリにマッチする全ての行を削除します。</li>
<li><strong>パラメータ</strong>:</li>
<li><code>ctx context.Context</code>: コンテキスト。</li>
<li><code>exec boil.ContextExecutor</code>: データベースの実行インターフェース。</li>
<li><strong>処理の流れ</strong>:</li>
<li>クエリが <code>nil</code> でないか確認。</li>
<li><code>queries.SetDelete</code> を使用して削除クエリを設定。</li>
<li>クエリを実行し、影響を受けた行数を取得。</li>
<li><strong>戻り値</strong>:</li>
<li><code>int64</code>: 削除された行数。</li>
<li><code>error</code>: エラー情報。</li>
</ul>
<h4 id="_157">利用例</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-204-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-204-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-204-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-204-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-204-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-204-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-204-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-204-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-204-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-204-10">10</a></span>
<span class="normal"><a href="#__codelineno-204-11">11</a></span>
<span class="normal"><a href="#__codelineno-204-12">12</a></span>
<span class="normal"><a href="#__codelineno-204-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-204-1" name="__codelineno-204-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-204-2" name="__codelineno-204-2"></a><span class="nx">exec</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">db</span>
<a id="__codelineno-204-3" name="__codelineno-204-3"></a>
<a id="__codelineno-204-4" name="__codelineno-204-4"></a><span class="c1">// 削除したい条件を指定（例: &quot;status = &#39;inactive&#39;&quot; の行を全て削除）</span>
<a id="__codelineno-204-5" name="__codelineno-204-5"></a><span class="nx">q</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Seichies</span><span class="p">(</span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;status=?&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;inactive&quot;</span><span class="p">))</span>
<a id="__codelineno-204-6" name="__codelineno-204-6"></a>
<a id="__codelineno-204-7" name="__codelineno-204-7"></a><span class="c1">// マッチする全ての行を削除</span>
<a id="__codelineno-204-8" name="__codelineno-204-8"></a><span class="nx">rowsAffected</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">q</span><span class="p">.</span><span class="nx">DeleteAll</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">)</span>
<a id="__codelineno-204-9" name="__codelineno-204-9"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-204-10" name="__codelineno-204-10"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-204-11" name="__codelineno-204-11"></a><span class="p">}</span>
<a id="__codelineno-204-12" name="__codelineno-204-12"></a>
<a id="__codelineno-204-13" name="__codelineno-204-13"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;削除された行数: %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">rowsAffected</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<h3 id="deleteall_3"><code>DeleteAll</code> メソッド（スライス用）の解説</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-205-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-205-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-205-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-205-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-205-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-205-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-205-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-205-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-205-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-205-10">10</a></span>
<span class="normal"><a href="#__codelineno-205-11">11</a></span>
<span class="normal"><a href="#__codelineno-205-12">12</a></span>
<span class="normal"><a href="#__codelineno-205-13">13</a></span>
<span class="normal"><a href="#__codelineno-205-14">14</a></span>
<span class="normal"><a href="#__codelineno-205-15">15</a></span>
<span class="normal"><a href="#__codelineno-205-16">16</a></span>
<span class="normal"><a href="#__codelineno-205-17">17</a></span>
<span class="normal"><a href="#__codelineno-205-18">18</a></span>
<span class="normal"><a href="#__codelineno-205-19">19</a></span>
<span class="normal"><a href="#__codelineno-205-20">20</a></span>
<span class="normal"><a href="#__codelineno-205-21">21</a></span>
<span class="normal"><a href="#__codelineno-205-22">22</a></span>
<span class="normal"><a href="#__codelineno-205-23">23</a></span>
<span class="normal"><a href="#__codelineno-205-24">24</a></span>
<span class="normal"><a href="#__codelineno-205-25">25</a></span>
<span class="normal"><a href="#__codelineno-205-26">26</a></span>
<span class="normal"><a href="#__codelineno-205-27">27</a></span>
<span class="normal"><a href="#__codelineno-205-28">28</a></span>
<span class="normal"><a href="#__codelineno-205-29">29</a></span>
<span class="normal"><a href="#__codelineno-205-30">30</a></span>
<span class="normal"><a href="#__codelineno-205-31">31</a></span>
<span class="normal"><a href="#__codelineno-205-32">32</a></span>
<span class="normal"><a href="#__codelineno-205-33">33</a></span>
<span class="normal"><a href="#__codelineno-205-34">34</a></span>
<span class="normal"><a href="#__codelineno-205-35">35</a></span>
<span class="normal"><a href="#__codelineno-205-36">36</a></span>
<span class="normal"><a href="#__codelineno-205-37">37</a></span>
<span class="normal"><a href="#__codelineno-205-38">38</a></span>
<span class="normal"><a href="#__codelineno-205-39">39</a></span>
<span class="normal"><a href="#__codelineno-205-40">40</a></span>
<span class="normal"><a href="#__codelineno-205-41">41</a></span>
<span class="normal"><a href="#__codelineno-205-42">42</a></span>
<span class="normal"><a href="#__codelineno-205-43">43</a></span>
<span class="normal"><a href="#__codelineno-205-44">44</a></span>
<span class="normal"><a href="#__codelineno-205-45">45</a></span>
<span class="normal"><a href="#__codelineno-205-46">46</a></span>
<span class="normal"><a href="#__codelineno-205-47">47</a></span>
<span class="normal"><a href="#__codelineno-205-48">48</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-205-1" name="__codelineno-205-1"></a><span class="c1">// DeleteAll はスライス内の全ての行を削除します。</span>
<a id="__codelineno-205-2" name="__codelineno-205-2"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="nx">SeichySlice</span><span class="p">)</span><span class="w"> </span><span class="nx">DeleteAll</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">int64</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-205-3" name="__codelineno-205-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-205-4" name="__codelineno-205-4"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-205-5" name="__codelineno-205-5"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-205-6" name="__codelineno-205-6"></a>
<a id="__codelineno-205-7" name="__codelineno-205-7"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">seichyBeforeDeleteHooks</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-205-8" name="__codelineno-205-8"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">o</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-205-9" name="__codelineno-205-9"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">obj</span><span class="p">.</span><span class="nx">doBeforeDeleteHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-205-10" name="__codelineno-205-10"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-205-11" name="__codelineno-205-11"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-205-12" name="__codelineno-205-12"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-205-13" name="__codelineno-205-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-205-14" name="__codelineno-205-14"></a>
<a id="__codelineno-205-15" name="__codelineno-205-15"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">args</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}</span>
<a id="__codelineno-205-16" name="__codelineno-205-16"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">o</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-205-17" name="__codelineno-205-17"></a><span class="w">        </span><span class="nx">pkeyArgs</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">ValuesFromMapping</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">Indirect</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="nx">obj</span><span class="p">)),</span><span class="w"> </span><span class="nx">seichyPrimaryKeyMapping</span><span class="p">)</span>
<a id="__codelineno-205-18" name="__codelineno-205-18"></a><span class="w">        </span><span class="nx">args</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span><span class="w"> </span><span class="nx">pkeyArgs</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-205-19" name="__codelineno-205-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-205-20" name="__codelineno-205-20"></a>
<a id="__codelineno-205-21" name="__codelineno-205-21"></a><span class="w">    </span><span class="nx">sql</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;DELETE FROM `seichies` WHERE &quot;</span><span class="w"> </span><span class="o">+</span>
<a id="__codelineno-205-22" name="__codelineno-205-22"></a><span class="w">        </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">WhereClauseRepeated</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">dialect</span><span class="p">.</span><span class="nx">LQ</span><span class="p">),</span><span class="w"> </span><span class="nb">string</span><span class="p">(</span><span class="nx">dialect</span><span class="p">.</span><span class="nx">RQ</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">seichyPrimaryKeyColumns</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">o</span><span class="p">))</span>
<a id="__codelineno-205-23" name="__codelineno-205-23"></a>
<a id="__codelineno-205-24" name="__codelineno-205-24"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">IsDebug</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-205-25" name="__codelineno-205-25"></a><span class="w">        </span><span class="nx">writer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">DebugWriterFrom</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<a id="__codelineno-205-26" name="__codelineno-205-26"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">)</span>
<a id="__codelineno-205-27" name="__codelineno-205-27"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">)</span>
<a id="__codelineno-205-28" name="__codelineno-205-28"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-205-29" name="__codelineno-205-29"></a><span class="w">    </span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">exec</span><span class="p">.</span><span class="nx">ExecContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-205-30" name="__codelineno-205-30"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-205-31" name="__codelineno-205-31"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to delete all from seichy slice&quot;</span><span class="p">)</span>
<a id="__codelineno-205-32" name="__codelineno-205-32"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-205-33" name="__codelineno-205-33"></a>
<a id="__codelineno-205-34" name="__codelineno-205-34"></a><span class="w">    </span><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">RowsAffected</span><span class="p">()</span>
<a id="__codelineno-205-35" name="__codelineno-205-35"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-205-36" name="__codelineno-205-36"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: failed to get rows affected by deleteall for seichies&quot;</span><span class="p">)</span>
<a id="__codelineno-205-37" name="__codelineno-205-37"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-205-38" name="__codelineno-205-38"></a>
<a id="__codelineno-205-39" name="__codelineno-205-39"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">seichyAfterDeleteHooks</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-205-40" name="__codelineno-205-40"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">o</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-205-41" name="__codelineno-205-41"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">obj</span><span class="p">.</span><span class="nx">doAfterDeleteHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-205-42" name="__codelineno-205-42"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-205-43" name="__codelineno-205-43"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-205-44" name="__codelineno-205-44"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-205-45" name="__codelineno-205-45"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-205-46" name="__codelineno-205-46"></a>
<a id="__codelineno-205-47" name="__codelineno-205-47"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-205-48" name="__codelineno-205-48"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="_158">詳細な説明</h4>
<ul>
<li><strong>目的</strong>: <code>Seichy</code> 型のスライス内の全てのオブジェクトを削除します。</li>
<li><strong>パラメータ</strong>:</li>
<li><code>ctx context.Context</code>: コンテキスト。</li>
<li><code>exec boil.ContextExecutor</code>: データベースの実行インターフェース。</li>
<li><strong>処理の流れ</strong>:</li>
<li>スライスが空の場合、何もせずに終了。</li>
<li>削除前のフックが設定されている場合、各オブジェクトに対してフックを実行。</li>
<li>スライス内の各オブジェクトから主キーの値を収集。</li>
<li>削除用の SQL 文を作成。</li>
<li>クエリを実行し、影響を受けた行数を取得。</li>
<li>削除後のフックが設定されている場合、各オブジェクトに対してフックを実行。</li>
<li><strong>戻り値</strong>:</li>
<li><code>int64</code>: 削除された行数。</li>
<li><code>error</code>: エラー情報。</li>
</ul>
<h4 id="_159">利用例</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-206-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-206-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-206-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-206-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-206-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-206-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-206-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-206-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-206-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-206-10">10</a></span>
<span class="normal"><a href="#__codelineno-206-11">11</a></span>
<span class="normal"><a href="#__codelineno-206-12">12</a></span>
<span class="normal"><a href="#__codelineno-206-13">13</a></span>
<span class="normal"><a href="#__codelineno-206-14">14</a></span>
<span class="normal"><a href="#__codelineno-206-15">15</a></span>
<span class="normal"><a href="#__codelineno-206-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-206-1" name="__codelineno-206-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-206-2" name="__codelineno-206-2"></a><span class="nx">exec</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">db</span>
<a id="__codelineno-206-3" name="__codelineno-206-3"></a>
<a id="__codelineno-206-4" name="__codelineno-206-4"></a><span class="nx">seichySlice</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">SeichySlice</span><span class="p">{</span>
<a id="__codelineno-206-5" name="__codelineno-206-5"></a><span class="w">    </span><span class="o">&amp;</span><span class="nx">Seichy</span><span class="p">{</span><span class="nx">SeichiID</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">},</span>
<a id="__codelineno-206-6" name="__codelineno-206-6"></a><span class="w">    </span><span class="o">&amp;</span><span class="nx">Seichy</span><span class="p">{</span><span class="nx">SeichiID</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">},</span>
<a id="__codelineno-206-7" name="__codelineno-206-7"></a><span class="w">    </span><span class="o">&amp;</span><span class="nx">Seichy</span><span class="p">{</span><span class="nx">SeichiID</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">},</span>
<a id="__codelineno-206-8" name="__codelineno-206-8"></a><span class="p">}</span>
<a id="__codelineno-206-9" name="__codelineno-206-9"></a>
<a id="__codelineno-206-10" name="__codelineno-206-10"></a><span class="c1">// スライス内の全てのオブジェクトを削除</span>
<a id="__codelineno-206-11" name="__codelineno-206-11"></a><span class="nx">rowsAffected</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">seichySlice</span><span class="p">.</span><span class="nx">DeleteAll</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">)</span>
<a id="__codelineno-206-12" name="__codelineno-206-12"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-206-13" name="__codelineno-206-13"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-206-14" name="__codelineno-206-14"></a><span class="p">}</span>
<a id="__codelineno-206-15" name="__codelineno-206-15"></a>
<a id="__codelineno-206-16" name="__codelineno-206-16"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;削除された行数: %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">rowsAffected</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<h3 id="_160">補足</h3>
<ul>
<li><strong>フック関数</strong>: <code>doBeforeUpsertHooks</code>, <code>doAfterUpsertHooks</code>, <code>doBeforeDeleteHooks</code>, <code>doAfterDeleteHooks</code> などのフック関数は、アップサートや削除の前後に特定の処理を行いたい場合に使用されます。実装によっては、ログ記録やバリデーションなどを行うことができます。</li>
<li><strong>コンテキストの使用</strong>: <code>context.Context</code> は、リクエストのキャンセルやタイムアウトを制御するために重要です。データベース操作を行う際には、常に適切なコンテキストを渡すことが推奨されます。</li>
<li><strong>エラーハンドリング</strong>: 返される <code>error</code> を常にチェックし、必要に応じて適切な処理（ログ出力、再試行、ユーザーへのフィードバックなど）を行ってください。</li>
</ul>
<h3 id="_161">注意点</h3>
<ul>
<li>データベースへの操作を行う際には、SQL インジェクションなどのセキュリティリスクを防ぐため、プレースホルダやパラメータバインディングを正しく使用してください。</li>
<li>トランザクションが必要な場合は、<code>*sql.Tx</code> を使用して操作をグループ化し、コミットまたはロールバックを適切に管理してください。</li>
</ul>
<hr />
<h3 id="reload_1"><code>Reload</code> 関数の解説</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-207-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-207-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-207-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-207-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-207-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-207-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-207-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-207-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-207-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-207-10">10</a></span>
<span class="normal"><a href="#__codelineno-207-11">11</a></span>
<span class="normal"><a href="#__codelineno-207-12">12</a></span>
<span class="normal"><a href="#__codelineno-207-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-207-1" name="__codelineno-207-1"></a><span class="c1">// Reload は主キーを使用してデータベースからオブジェクトを再取得します。</span>
<a id="__codelineno-207-2" name="__codelineno-207-2"></a><span class="c1">// エグゼキュータを使用します。</span>
<a id="__codelineno-207-3" name="__codelineno-207-3"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">Seichy</span><span class="p">)</span><span class="w"> </span><span class="nx">Reload</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-207-4" name="__codelineno-207-4"></a><span class="w">    </span><span class="c1">// 主キーを使用して最新のデータを取得</span>
<a id="__codelineno-207-5" name="__codelineno-207-5"></a><span class="w">    </span><span class="nx">ret</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">FindSeichy</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">SeichiID</span><span class="p">)</span>
<a id="__codelineno-207-6" name="__codelineno-207-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-207-7" name="__codelineno-207-7"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-207-8" name="__codelineno-207-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-207-9" name="__codelineno-207-9"></a>
<a id="__codelineno-207-10" name="__codelineno-207-10"></a><span class="w">    </span><span class="c1">// 取得したデータを現在のオブジェクトに上書き</span>
<a id="__codelineno-207-11" name="__codelineno-207-11"></a><span class="w">    </span><span class="o">*</span><span class="nx">o</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">*</span><span class="nx">ret</span>
<a id="__codelineno-207-12" name="__codelineno-207-12"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-207-13" name="__codelineno-207-13"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="_162">詳細な説明</h4>
<ul>
<li><strong>目的</strong>: <code>Reload</code> メソッドは、現在の <code>Seichy</code> オブジェクトの主キーを使用して、データベースから最新の情報を再取得し、オブジェクトを更新します。</li>
<li><strong>パラメータ</strong>:</li>
<li><code>ctx context.Context</code>: コンテキスト。キャンセルやタイムアウトの管理に使用。</li>
<li><code>exec boil.ContextExecutor</code>: データベースとの接続やトランザクションを実行するためのインターフェース。</li>
<li><strong>処理の流れ</strong>:</li>
<li><code>FindSeichy</code> 関数を使用して、<code>SeichiID</code> に基づきデータベースから最新の <code>Seichy</code> オブジェクトを取得。</li>
<li>取得が成功した場合、現在のオブジェクト <code>o</code> を取得したデータで上書き。</li>
<li>エラーが発生した場合は、そのエラーを返す。</li>
<li><strong>戻り値</strong>:</li>
<li><code>error</code>: エラー情報。成功した場合は <code>nil</code>。</li>
</ul>
<h4 id="_163">利用例</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-208-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-208-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-208-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-208-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-208-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-208-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-208-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-208-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-208-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-208-10">10</a></span>
<span class="normal"><a href="#__codelineno-208-11">11</a></span>
<span class="normal"><a href="#__codelineno-208-12">12</a></span>
<span class="normal"><a href="#__codelineno-208-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-208-1" name="__codelineno-208-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-208-2" name="__codelineno-208-2"></a><span class="nx">exec</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">db</span><span class="w"> </span><span class="c1">// *sql.DB または *sql.Tx</span>
<a id="__codelineno-208-3" name="__codelineno-208-3"></a>
<a id="__codelineno-208-4" name="__codelineno-208-4"></a><span class="c1">// 既存の Seichy オブジェクト</span>
<a id="__codelineno-208-5" name="__codelineno-208-5"></a><span class="nx">seichy</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Seichy</span><span class="p">{</span><span class="nx">SeichiID</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">}</span>
<a id="__codelineno-208-6" name="__codelineno-208-6"></a>
<a id="__codelineno-208-7" name="__codelineno-208-7"></a><span class="c1">// データベースから最新の情報を再取得</span>
<a id="__codelineno-208-8" name="__codelineno-208-8"></a><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">seichy</span><span class="p">.</span><span class="nx">Reload</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">)</span>
<a id="__codelineno-208-9" name="__codelineno-208-9"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-208-10" name="__codelineno-208-10"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-208-11" name="__codelineno-208-11"></a><span class="p">}</span>
<a id="__codelineno-208-12" name="__codelineno-208-12"></a>
<a id="__codelineno-208-13" name="__codelineno-208-13"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;最新のデータ: %+v\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">seichy</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<h3 id="reloadall_1"><code>ReloadAll</code> 関数の解説</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-209-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-209-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-209-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-209-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-209-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-209-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-209-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-209-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-209-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-209-10">10</a></span>
<span class="normal"><a href="#__codelineno-209-11">11</a></span>
<span class="normal"><a href="#__codelineno-209-12">12</a></span>
<span class="normal"><a href="#__codelineno-209-13">13</a></span>
<span class="normal"><a href="#__codelineno-209-14">14</a></span>
<span class="normal"><a href="#__codelineno-209-15">15</a></span>
<span class="normal"><a href="#__codelineno-209-16">16</a></span>
<span class="normal"><a href="#__codelineno-209-17">17</a></span>
<span class="normal"><a href="#__codelineno-209-18">18</a></span>
<span class="normal"><a href="#__codelineno-209-19">19</a></span>
<span class="normal"><a href="#__codelineno-209-20">20</a></span>
<span class="normal"><a href="#__codelineno-209-21">21</a></span>
<span class="normal"><a href="#__codelineno-209-22">22</a></span>
<span class="normal"><a href="#__codelineno-209-23">23</a></span>
<span class="normal"><a href="#__codelineno-209-24">24</a></span>
<span class="normal"><a href="#__codelineno-209-25">25</a></span>
<span class="normal"><a href="#__codelineno-209-26">26</a></span>
<span class="normal"><a href="#__codelineno-209-27">27</a></span>
<span class="normal"><a href="#__codelineno-209-28">28</a></span>
<span class="normal"><a href="#__codelineno-209-29">29</a></span>
<span class="normal"><a href="#__codelineno-209-30">30</a></span>
<span class="normal"><a href="#__codelineno-209-31">31</a></span>
<span class="normal"><a href="#__codelineno-209-32">32</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-209-1" name="__codelineno-209-1"></a><span class="c1">// ReloadAll は主キーが一致するすべての行を再取得し、</span>
<a id="__codelineno-209-2" name="__codelineno-209-2"></a><span class="c1">// 元のオブジェクトスライスを最新のスライスで上書きします。</span>
<a id="__codelineno-209-3" name="__codelineno-209-3"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">SeichySlice</span><span class="p">)</span><span class="w"> </span><span class="nx">ReloadAll</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-209-4" name="__codelineno-209-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">o</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="o">*</span><span class="nx">o</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-209-5" name="__codelineno-209-5"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-209-6" name="__codelineno-209-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-209-7" name="__codelineno-209-7"></a>
<a id="__codelineno-209-8" name="__codelineno-209-8"></a><span class="w">    </span><span class="nx">slice</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">SeichySlice</span><span class="p">{}</span>
<a id="__codelineno-209-9" name="__codelineno-209-9"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">args</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}</span>
<a id="__codelineno-209-10" name="__codelineno-209-10"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="o">*</span><span class="nx">o</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-209-11" name="__codelineno-209-11"></a><span class="w">        </span><span class="c1">// 各オブジェクトの主キーを取得</span>
<a id="__codelineno-209-12" name="__codelineno-209-12"></a><span class="w">        </span><span class="nx">pkeyArgs</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">ValuesFromMapping</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">Indirect</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="nx">obj</span><span class="p">)),</span><span class="w"> </span><span class="nx">seichyPrimaryKeyMapping</span><span class="p">)</span>
<a id="__codelineno-209-13" name="__codelineno-209-13"></a><span class="w">        </span><span class="nx">args</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span><span class="w"> </span><span class="nx">pkeyArgs</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-209-14" name="__codelineno-209-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-209-15" name="__codelineno-209-15"></a>
<a id="__codelineno-209-16" name="__codelineno-209-16"></a><span class="w">    </span><span class="c1">// 主キーに基づきデータベースから最新のデータを取得する SQL 文を作成</span>
<a id="__codelineno-209-17" name="__codelineno-209-17"></a><span class="w">    </span><span class="nx">sql</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;SELECT `seichies`.* FROM `seichies` WHERE &quot;</span><span class="w"> </span><span class="o">+</span>
<a id="__codelineno-209-18" name="__codelineno-209-18"></a><span class="w">        </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">WhereClauseRepeated</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">dialect</span><span class="p">.</span><span class="nx">LQ</span><span class="p">),</span><span class="w"> </span><span class="nb">string</span><span class="p">(</span><span class="nx">dialect</span><span class="p">.</span><span class="nx">RQ</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">seichyPrimaryKeyColumns</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="o">*</span><span class="nx">o</span><span class="p">))</span>
<a id="__codelineno-209-19" name="__codelineno-209-19"></a>
<a id="__codelineno-209-20" name="__codelineno-209-20"></a><span class="w">    </span><span class="nx">q</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">Raw</span><span class="p">(</span><span class="nx">sql</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-209-21" name="__codelineno-209-21"></a>
<a id="__codelineno-209-22" name="__codelineno-209-22"></a><span class="w">    </span><span class="c1">// クエリを実行して結果をスライスにバインド</span>
<a id="__codelineno-209-23" name="__codelineno-209-23"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">q</span><span class="p">.</span><span class="nx">Bind</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">slice</span><span class="p">)</span>
<a id="__codelineno-209-24" name="__codelineno-209-24"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-209-25" name="__codelineno-209-25"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to reload all in SeichySlice&quot;</span><span class="p">)</span>
<a id="__codelineno-209-26" name="__codelineno-209-26"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-209-27" name="__codelineno-209-27"></a>
<a id="__codelineno-209-28" name="__codelineno-209-28"></a><span class="w">    </span><span class="c1">// 元のスライスを最新のスライスで上書き</span>
<a id="__codelineno-209-29" name="__codelineno-209-29"></a><span class="w">    </span><span class="o">*</span><span class="nx">o</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">slice</span>
<a id="__codelineno-209-30" name="__codelineno-209-30"></a>
<a id="__codelineno-209-31" name="__codelineno-209-31"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-209-32" name="__codelineno-209-32"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="_164">詳細な説明</h4>
<ul>
<li><strong>目的</strong>: <code>ReloadAll</code> メソッドは、<code>Seichy</code> 型のスライスに含まれる各オブジェクトの主キーを使用して、データベースから最新の情報を再取得し、スライス全体を更新します。</li>
<li><strong>パラメータ</strong>:</li>
<li><code>ctx context.Context</code>: コンテキスト。</li>
<li><code>exec boil.ContextExecutor</code>: データベースとの接続やトランザクションを実行するためのインターフェース。</li>
<li><strong>処理の流れ</strong>:</li>
<li>スライスが <code>nil</code> または空の場合、何もせずに終了。</li>
<li>各オブジェクトから主キーの値を収集。</li>
<li>主キーに基づいてデータベースから最新のデータを取得するための SQL クエリを作成。</li>
<li>クエリを実行し、結果を新しいスライスにバインド。</li>
<li>元のスライスを新しいスライスで上書き。</li>
<li><strong>戻り値</strong>:</li>
<li><code>error</code>: エラー情報。成功した場合は <code>nil</code>。</li>
</ul>
<h4 id="_165">利用例</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-210-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-210-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-210-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-210-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-210-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-210-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-210-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-210-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-210-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-210-10">10</a></span>
<span class="normal"><a href="#__codelineno-210-11">11</a></span>
<span class="normal"><a href="#__codelineno-210-12">12</a></span>
<span class="normal"><a href="#__codelineno-210-13">13</a></span>
<span class="normal"><a href="#__codelineno-210-14">14</a></span>
<span class="normal"><a href="#__codelineno-210-15">15</a></span>
<span class="normal"><a href="#__codelineno-210-16">16</a></span>
<span class="normal"><a href="#__codelineno-210-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-210-1" name="__codelineno-210-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-210-2" name="__codelineno-210-2"></a><span class="nx">exec</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">db</span>
<a id="__codelineno-210-3" name="__codelineno-210-3"></a>
<a id="__codelineno-210-4" name="__codelineno-210-4"></a><span class="c1">// 既存の Seichy オブジェクトのスライス</span>
<a id="__codelineno-210-5" name="__codelineno-210-5"></a><span class="nx">seichySlice</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">SeichySlice</span><span class="p">{</span>
<a id="__codelineno-210-6" name="__codelineno-210-6"></a><span class="w">    </span><span class="o">&amp;</span><span class="nx">Seichy</span><span class="p">{</span><span class="nx">SeichiID</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">},</span>
<a id="__codelineno-210-7" name="__codelineno-210-7"></a><span class="w">    </span><span class="o">&amp;</span><span class="nx">Seichy</span><span class="p">{</span><span class="nx">SeichiID</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">},</span>
<a id="__codelineno-210-8" name="__codelineno-210-8"></a><span class="w">    </span><span class="o">&amp;</span><span class="nx">Seichy</span><span class="p">{</span><span class="nx">SeichiID</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">},</span>
<a id="__codelineno-210-9" name="__codelineno-210-9"></a><span class="p">}</span>
<a id="__codelineno-210-10" name="__codelineno-210-10"></a>
<a id="__codelineno-210-11" name="__codelineno-210-11"></a><span class="c1">// データベースから最新の情報を再取得</span>
<a id="__codelineno-210-12" name="__codelineno-210-12"></a><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">seichySlice</span><span class="p">.</span><span class="nx">ReloadAll</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">)</span>
<a id="__codelineno-210-13" name="__codelineno-210-13"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-210-14" name="__codelineno-210-14"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-210-15" name="__codelineno-210-15"></a><span class="p">}</span>
<a id="__codelineno-210-16" name="__codelineno-210-16"></a>
<a id="__codelineno-210-17" name="__codelineno-210-17"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;最新のデータスライス: %+v\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">seichySlice</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<h3 id="seichyexists"><code>SeichyExists</code> 関数の解説</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-211-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-211-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-211-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-211-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-211-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-211-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-211-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-211-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-211-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-211-10">10</a></span>
<span class="normal"><a href="#__codelineno-211-11">11</a></span>
<span class="normal"><a href="#__codelineno-211-12">12</a></span>
<span class="normal"><a href="#__codelineno-211-13">13</a></span>
<span class="normal"><a href="#__codelineno-211-14">14</a></span>
<span class="normal"><a href="#__codelineno-211-15">15</a></span>
<span class="normal"><a href="#__codelineno-211-16">16</a></span>
<span class="normal"><a href="#__codelineno-211-17">17</a></span>
<span class="normal"><a href="#__codelineno-211-18">18</a></span>
<span class="normal"><a href="#__codelineno-211-19">19</a></span>
<span class="normal"><a href="#__codelineno-211-20">20</a></span>
<span class="normal"><a href="#__codelineno-211-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-211-1" name="__codelineno-211-1"></a><span class="c1">// SeichyExists は指定された SeichiID の Seichy 行が存在するかチェックします。</span>
<a id="__codelineno-211-2" name="__codelineno-211-2"></a><span class="kd">func</span><span class="w"> </span><span class="nx">SeichyExists</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">seichiID</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-211-3" name="__codelineno-211-3"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="kt">bool</span>
<a id="__codelineno-211-4" name="__codelineno-211-4"></a><span class="w">    </span><span class="nx">sql</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;select exists(select 1 from `seichies` where `seichi_id`=? limit 1)&quot;</span>
<a id="__codelineno-211-5" name="__codelineno-211-5"></a>
<a id="__codelineno-211-6" name="__codelineno-211-6"></a><span class="w">    </span><span class="c1">// デバッグモードの場合、クエリを出力</span>
<a id="__codelineno-211-7" name="__codelineno-211-7"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">IsDebug</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-211-8" name="__codelineno-211-8"></a><span class="w">        </span><span class="nx">writer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">DebugWriterFrom</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<a id="__codelineno-211-9" name="__codelineno-211-9"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">)</span>
<a id="__codelineno-211-10" name="__codelineno-211-10"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">seichiID</span><span class="p">)</span>
<a id="__codelineno-211-11" name="__codelineno-211-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-211-12" name="__codelineno-211-12"></a><span class="w">    </span><span class="nx">row</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">exec</span><span class="p">.</span><span class="nx">QueryRowContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">,</span><span class="w"> </span><span class="nx">seichiID</span><span class="p">)</span>
<a id="__codelineno-211-13" name="__codelineno-211-13"></a>
<a id="__codelineno-211-14" name="__codelineno-211-14"></a><span class="w">    </span><span class="c1">// 結果をスキャンして存在フラグを取得</span>
<a id="__codelineno-211-15" name="__codelineno-211-15"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">row</span><span class="p">.</span><span class="nx">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">exists</span><span class="p">)</span>
<a id="__codelineno-211-16" name="__codelineno-211-16"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-211-17" name="__codelineno-211-17"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to check if seichies exists&quot;</span><span class="p">)</span>
<a id="__codelineno-211-18" name="__codelineno-211-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-211-19" name="__codelineno-211-19"></a>
<a id="__codelineno-211-20" name="__codelineno-211-20"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">exists</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-211-21" name="__codelineno-211-21"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="_166">詳細な説明</h4>
<ul>
<li><strong>目的</strong>: 指定した <code>SeichiID</code> のレコードがデータベースに存在するかどうかを確認します。</li>
<li><strong>パラメータ</strong>:</li>
<li><code>ctx context.Context</code>: コンテキスト。</li>
<li><code>exec boil.ContextExecutor</code>: データベースとの接続やトランザクションを実行するためのインターフェース。</li>
<li><code>seichiID int</code>: 存在をチェックしたい <code>SeichiID</code>。</li>
<li><strong>処理の流れ</strong>:</li>
<li><code>EXISTS</code> を使用した SQL クエリを作成し、指定した <code>SeichiID</code> が存在するか確認。</li>
<li>クエリを実行し、結果を <code>exists</code> 変数にスキャン。</li>
<li>エラーが発生した場合は、エラーを返す。</li>
<li>存在する場合は <code>true</code>、存在しない場合は <code>false</code> を返す。</li>
<li><strong>戻り値</strong>:</li>
<li><code>bool</code>: 存在するかどうかのフラグ。</li>
<li><code>error</code>: エラー情報。成功した場合は <code>nil</code>。</li>
</ul>
<h4 id="_167">利用例</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-212-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-212-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-212-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-212-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-212-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-212-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-212-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-212-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-212-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-212-10">10</a></span>
<span class="normal"><a href="#__codelineno-212-11">11</a></span>
<span class="normal"><a href="#__codelineno-212-12">12</a></span>
<span class="normal"><a href="#__codelineno-212-13">13</a></span>
<span class="normal"><a href="#__codelineno-212-14">14</a></span>
<span class="normal"><a href="#__codelineno-212-15">15</a></span>
<span class="normal"><a href="#__codelineno-212-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-212-1" name="__codelineno-212-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-212-2" name="__codelineno-212-2"></a><span class="nx">exec</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">db</span>
<a id="__codelineno-212-3" name="__codelineno-212-3"></a>
<a id="__codelineno-212-4" name="__codelineno-212-4"></a><span class="nx">seichiID</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">1</span>
<a id="__codelineno-212-5" name="__codelineno-212-5"></a>
<a id="__codelineno-212-6" name="__codelineno-212-6"></a><span class="c1">// 指定した SeichiID が存在するかチェック</span>
<a id="__codelineno-212-7" name="__codelineno-212-7"></a><span class="nx">exists</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">SeichyExists</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="nx">seichiID</span><span class="p">)</span>
<a id="__codelineno-212-8" name="__codelineno-212-8"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-212-9" name="__codelineno-212-9"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-212-10" name="__codelineno-212-10"></a><span class="p">}</span>
<a id="__codelineno-212-11" name="__codelineno-212-11"></a>
<a id="__codelineno-212-12" name="__codelineno-212-12"></a><span class="k">if</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-212-13" name="__codelineno-212-13"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;SeichiID %d は存在します。\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">seichiID</span><span class="p">)</span>
<a id="__codelineno-212-14" name="__codelineno-212-14"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-212-15" name="__codelineno-212-15"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;SeichiID %d は存在しません。\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">seichiID</span><span class="p">)</span>
<a id="__codelineno-212-16" name="__codelineno-212-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<hr />
<h3 id="exists_3"><code>Exists</code> メソッドの解説</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-213-1">1</a></span>
<span class="normal"><a href="#__codelineno-213-2">2</a></span>
<span class="normal"><a href="#__codelineno-213-3">3</a></span>
<span class="normal"><a href="#__codelineno-213-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-213-1" name="__codelineno-213-1"></a><span class="c1">// Exists は現在の Seichy オブジェクトの行が存在するかチェックします。</span>
<a id="__codelineno-213-2" name="__codelineno-213-2"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">Seichy</span><span class="p">)</span><span class="w"> </span><span class="nx">Exists</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-213-3" name="__codelineno-213-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">SeichyExists</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">SeichiID</span><span class="p">)</span>
<a id="__codelineno-213-4" name="__codelineno-213-4"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="_168">詳細な説明</h4>
<ul>
<li><strong>目的</strong>: 現在の <code>Seichy</code> オブジェクトがデータベースに存在するかどうかを確認します。</li>
<li><strong>パラメータ</strong>:</li>
<li><code>ctx context.Context</code>: コンテキスト。</li>
<li><code>exec boil.ContextExecutor</code>: データベースとの接続やトランザクションを実行するためのインターフェース。</li>
<li><strong>処理の流れ</strong>:</li>
<li><code>SeichyExists</code> 関数を呼び出し、現在の <code>Seichy</code> オブジェクトの <code>SeichiID</code> が存在するか確認。</li>
<li>結果をそのまま返す。</li>
<li><strong>戻り値</strong>:</li>
<li><code>bool</code>: 存在するかどうかのフラグ。</li>
<li><code>error</code>: エラー情報。成功した場合は <code>nil</code>。</li>
</ul>
<h4 id="_169">利用例</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-214-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-214-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-214-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-214-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-214-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-214-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-214-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-214-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-214-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-214-10">10</a></span>
<span class="normal"><a href="#__codelineno-214-11">11</a></span>
<span class="normal"><a href="#__codelineno-214-12">12</a></span>
<span class="normal"><a href="#__codelineno-214-13">13</a></span>
<span class="normal"><a href="#__codelineno-214-14">14</a></span>
<span class="normal"><a href="#__codelineno-214-15">15</a></span>
<span class="normal"><a href="#__codelineno-214-16">16</a></span>
<span class="normal"><a href="#__codelineno-214-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-214-1" name="__codelineno-214-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-214-2" name="__codelineno-214-2"></a><span class="nx">exec</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">db</span>
<a id="__codelineno-214-3" name="__codelineno-214-3"></a>
<a id="__codelineno-214-4" name="__codelineno-214-4"></a><span class="c1">// 既存の Seichy オブジェクト</span>
<a id="__codelineno-214-5" name="__codelineno-214-5"></a><span class="nx">seichy</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Seichy</span><span class="p">{</span><span class="nx">SeichiID</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">}</span>
<a id="__codelineno-214-6" name="__codelineno-214-6"></a>
<a id="__codelineno-214-7" name="__codelineno-214-7"></a><span class="c1">// レコードが存在するかチェック</span>
<a id="__codelineno-214-8" name="__codelineno-214-8"></a><span class="nx">exists</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">seichy</span><span class="p">.</span><span class="nx">Exists</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">)</span>
<a id="__codelineno-214-9" name="__codelineno-214-9"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-214-10" name="__codelineno-214-10"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-214-11" name="__codelineno-214-11"></a><span class="p">}</span>
<a id="__codelineno-214-12" name="__codelineno-214-12"></a>
<a id="__codelineno-214-13" name="__codelineno-214-13"></a><span class="k">if</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-214-14" name="__codelineno-214-14"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;SeichiID %d は存在します。\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">seichy</span><span class="p">.</span><span class="nx">SeichiID</span><span class="p">)</span>
<a id="__codelineno-214-15" name="__codelineno-214-15"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-214-16" name="__codelineno-214-16"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;SeichiID %d は存在しません。\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">seichy</span><span class="p">.</span><span class="nx">SeichiID</span><span class="p">)</span>
<a id="__codelineno-214-17" name="__codelineno-214-17"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<hr />
<h3 id="_170">補足</h3>
<ul>
<li><strong>エラーハンドリング</strong>: データベース操作中にエラーが発生する可能性があります。各関数の戻り値の <code>error</code> を適切にチェックし、必要な対処（ログの記録、ユーザーへの通知、リトライなど）を行ってください。</li>
<li><strong>コンテキストの重要性</strong>: <code>context.Context</code> を使用することで、リクエストのキャンセルやタイムアウトを制御できます。データベース操作時には、常に適切なコンテキストを渡すことが推奨されます。</li>
<li><strong>デバッグモード</strong>: <code>boil.IsDebug(ctx)</code> を使用してデバッグモードを判定し、必要に応じて SQL クエリやパラメータをログに出力しています。デバッグ時にのみ詳細な情報を出力することで、本番環境での余分なログ出力を防ぎます。</li>
</ul>
<h3 id="_171">注意点</h3>
<ul>
<li><strong>データ整合性</strong>: データベースから取得した最新の情報でオブジェクトを上書きする際、他のゴルーチンやプロセスでの変更に注意してください。特にマルチスレッド環境では適切な同期が必要となる場合があります。</li>
<li><strong>SQL インジェクション対策</strong>: プレースホルダ（<code>?</code>）と引数を適切に使用していますが、手動で SQL クエリを組み立てる際には特に注意が必要です。ユーザー入力を直接クエリに含めないようにしてください。</li>
<li><strong>トランザクションの使用</strong>: 一連のデータベース操作が原子的に行われるべき場合、<code>*sql.Tx</code> を使用してトランザクションを管理してください。</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/GradProjectHub/GradProject" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.annotate"], "search": "../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
    
  </body>
</html>