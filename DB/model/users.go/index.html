
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../points.go/">
      
      
        <link rel="next" href="../../../Git/Fetch%E3%81%A8Pull/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.44">
    
    
      
        <title>Userモデルの詳細解説と利用例 - My Docs</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.0253249f.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="cyan" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#user" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="My Docs" class="md-header__button md-logo" aria-label="My Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            My Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Userモデルの詳細解説と利用例
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="My Docs" class="md-nav__button md-logo" aria-label="My Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    My Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Welcome to MkDocs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E3%83%9E%E3%83%BC%E3%82%AB%E3%83%BC%E7%94%BB%E5%83%8F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    画像の保存
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    DB
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            DB
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" checked>
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Model
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            Model
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../point_logs.go/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PointLog構造体の詳細な解説と利用例
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../points.go/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pointモデルの詳細解説と利用例
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Userモデルの詳細解説と利用例
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Userモデルの詳細解説と利用例
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      はじめに
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      パッケージ宣言とインポート
    </span>
  </a>
  
    <nav class="md-nav" aria-label="パッケージ宣言とインポート">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#user_1" class="md-nav__link">
    <span class="md-ellipsis">
      User構造体の定義
    </span>
  </a>
  
    <nav class="md-nav" aria-label="User構造体の定義">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      カラム名の定義
    </span>
  </a>
  
    <nav class="md-nav" aria-label="カラム名の定義">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      テーブル付きのカラム名
    </span>
  </a>
  
    <nav class="md-nav" aria-label="テーブル付きのカラム名">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#where" class="md-nav__link">
    <span class="md-ellipsis">
      WHEREヘルパーの生成
    </span>
  </a>
  
    <nav class="md-nav" aria-label="WHEREヘルパーの生成">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      リレーションシップの定義
    </span>
  </a>
  
    <nav class="md-nav" aria-label="リレーションシップの定義">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#userr" class="md-nav__link">
    <span class="md-ellipsis">
      リレーションを保持する構造体 userR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="リレーションを保持する構造体 userR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      リレーション用のメソッド
    </span>
  </a>
  
    <nav class="md-nav" aria-label="リレーション用のメソッド">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#load-userl" class="md-nav__link">
    <span class="md-ellipsis">
      Loadメソッドを提供する構造体 userL
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Loadメソッドを提供する構造体 userL">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      変数と初期化
    </span>
  </a>
  
    <nav class="md-nav" aria-label="変数と初期化">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      型エイリアスとクエリ構造体
    </span>
  </a>
  
    <nav class="md-nav" aria-label="型エイリアスとクエリ構造体">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      キャッシュ関連の変数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="キャッシュ関連の変数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      その他の変数と依存性の強制
    </span>
  </a>
  
    <nav class="md-nav" aria-label="その他の変数と依存性の強制">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    <span class="md-ellipsis">
      フック関連の変数とメソッド
    </span>
  </a>
  
    <nav class="md-nav" aria-label="フック関連の変数とメソッド">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    <span class="md-ellipsis">
      フックメソッドの実装例
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
    <nav class="md-nav" aria-label="利用例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    <span class="md-ellipsis">
      ユーザーの挿入
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ユーザーの挿入">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    <span class="md-ellipsis">
      ユーザーの取得
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ユーザーの取得">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    <span class="md-ellipsis">
      ユーザーの更新
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ユーザーの更新">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_34" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_35" class="md-nav__link">
    <span class="md-ellipsis">
      ユーザーの削除
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ユーザーの削除">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_36" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adduserhook" class="md-nav__link">
    <span class="md-ellipsis">
      AddUserHook関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AddUserHook関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_37" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_38" class="md-nav__link">
    <span class="md-ellipsis">
      フックポイント一覧
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_39" class="md-nav__link">
    <span class="md-ellipsis">
      使用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#one" class="md-nav__link">
    <span class="md-ellipsis">
      One関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="One関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_40" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_41" class="md-nav__link">
    <span class="md-ellipsis">
      使用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#all" class="md-nav__link">
    <span class="md-ellipsis">
      All関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="All関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_42" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_43" class="md-nav__link">
    <span class="md-ellipsis">
      使用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#count" class="md-nav__link">
    <span class="md-ellipsis">
      Count関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Count関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_44" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_45" class="md-nav__link">
    <span class="md-ellipsis">
      使用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exists" class="md-nav__link">
    <span class="md-ellipsis">
      Exists関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exists関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_46" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_47" class="md-nav__link">
    <span class="md-ellipsis">
      使用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_48" class="md-nav__link">
    <span class="md-ellipsis">
      リレーションシップ関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="リレーションシップ関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#point" class="md-nav__link">
    <span class="md-ellipsis">
      Point関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Point関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_49" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_50" class="md-nav__link">
    <span class="md-ellipsis">
      使用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checkinlogs" class="md-nav__link">
    <span class="md-ellipsis">
      CheckinLogs関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CheckinLogs関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_51" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_52" class="md-nav__link">
    <span class="md-ellipsis">
      使用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pointlogs" class="md-nav__link">
    <span class="md-ellipsis">
      PointLogs関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PointLogs関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_53" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#seichies" class="md-nav__link">
    <span class="md-ellipsis">
      Seichies関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Seichies関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_54" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#loadpoint" class="md-nav__link">
    <span class="md-ellipsis">
      LoadPoint関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LoadPoint関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_55" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_56" class="md-nav__link">
    <span class="md-ellipsis">
      使用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_57" class="md-nav__link">
    <span class="md-ellipsis">
      注意点
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#loadcheckinlogsloadpointlogs" class="md-nav__link">
    <span class="md-ellipsis">
      LoadCheckinLogsおよびLoadPointLogs関数の詳解と使用例
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#loadcheckinlogs" class="md-nav__link">
    <span class="md-ellipsis">
      LoadCheckinLogs関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LoadCheckinLogs関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_58" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
    <nav class="md-nav" aria-label="説明">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_59" class="md-nav__link">
    <span class="md-ellipsis">
      関数の引数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_60" class="md-nav__link">
    <span class="md-ellipsis">
      関数の流れ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_61" class="md-nav__link">
    <span class="md-ellipsis">
      使用例
    </span>
  </a>
  
    <nav class="md-nav" aria-label="使用例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_62" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#loadpointlogs" class="md-nav__link">
    <span class="md-ellipsis">
      LoadPointLogs関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LoadPointLogs関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_63" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
    <nav class="md-nav" aria-label="説明">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_64" class="md-nav__link">
    <span class="md-ellipsis">
      関数の流れ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_65" class="md-nav__link">
    <span class="md-ellipsis">
      使用例
    </span>
  </a>
  
    <nav class="md-nav" aria-label="使用例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_66" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_67" class="md-nav__link">
    <span class="md-ellipsis">
      注意事項
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#loadcheckinlogsloadpointlogs_1" class="md-nav__link">
    <span class="md-ellipsis">
      LoadCheckinLogs、LoadPointLogs関数まとめ
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#loadseichies" class="md-nav__link">
    <span class="md-ellipsis">
      LoadSeichies 関数の詳細な解説と利用例
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_68" class="md-nav__link">
    <span class="md-ellipsis">
      関数のシグネチャ
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_69" class="md-nav__link">
    <span class="md-ellipsis">
      コードの詳細な解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="コードの詳細な解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      1. 変数の初期化
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      2. 単一オブジェクトか複数オブジェクトかの判定
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-args" class="md-nav__link">
    <span class="md-ellipsis">
      3. args の準備
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-args" class="md-nav__link">
    <span class="md-ellipsis">
      4. args の内容確認
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    <span class="md-ellipsis">
      5. クエリの作成
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6" class="md-nav__link">
    <span class="md-ellipsis">
      6. クエリの実行と結果の取得
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7" class="md-nav__link">
    <span class="md-ellipsis">
      7. フックの処理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8" class="md-nav__link">
    <span class="md-ellipsis">
      8. 結果のマッピング
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9" class="md-nav__link">
    <span class="md-ellipsis">
      9. 終了処理
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_70" class="md-nav__link">
    <span class="md-ellipsis">
      開発者向け利用例
    </span>
  </a>
  
    <nav class="md-nav" aria-label="開発者向け利用例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_71" class="md-nav__link">
    <span class="md-ellipsis">
      単一のユーザーの場合
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_72" class="md-nav__link">
    <span class="md-ellipsis">
      複数のユーザーの場合
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_73" class="md-nav__link">
    <span class="md-ellipsis">
      クエリモディファイアを使用したカスタマイズ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#loadseichies_1" class="md-nav__link">
    <span class="md-ellipsis">
      LoadSeichies` 関数まとめ
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setpoint" class="md-nav__link">
    <span class="md-ellipsis">
      SetPoint 関数と関連関数の詳細な解説と利用例
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-setpoint" class="md-nav__link">
    <span class="md-ellipsis">
      1. SetPoint 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. SetPoint 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_74" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_75" class="md-nav__link">
    <span class="md-ellipsis">
      コードの詳細な解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_76" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-addcheckinlogs" class="md-nav__link">
    <span class="md-ellipsis">
      2. AddCheckinLogs 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. AddCheckinLogs 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_77" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_78" class="md-nav__link">
    <span class="md-ellipsis">
      コードの詳細な解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_79" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-addpointlogs" class="md-nav__link">
    <span class="md-ellipsis">
      3. AddPointLogs 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. AddPointLogs 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_80" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_81" class="md-nav__link">
    <span class="md-ellipsis">
      コードの詳細な解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_82" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-addseichies" class="md-nav__link">
    <span class="md-ellipsis">
      4. AddSeichies 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. AddSeichies 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_83" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_84" class="md-nav__link">
    <span class="md-ellipsis">
      コードの詳細な解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_85" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-users" class="md-nav__link">
    <span class="md-ellipsis">
      5. Users 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Users 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_86" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_87" class="md-nav__link">
    <span class="md-ellipsis">
      コードの詳細な解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_88" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-finduser" class="md-nav__link">
    <span class="md-ellipsis">
      6. FindUser 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. FindUser 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_89" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_90" class="md-nav__link">
    <span class="md-ellipsis">
      コードの詳細な解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_91" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#insert" class="md-nav__link">
    <span class="md-ellipsis">
      Insert 関数と関連関数の詳細な解説と利用例
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-insert" class="md-nav__link">
    <span class="md-ellipsis">
      1. Insert 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Insert 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_92" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_93" class="md-nav__link">
    <span class="md-ellipsis">
      コードの詳細な解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_94" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-update" class="md-nav__link">
    <span class="md-ellipsis">
      2. Update 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Update 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_95" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_96" class="md-nav__link">
    <span class="md-ellipsis">
      コードの詳細な解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_97" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-updateall" class="md-nav__link">
    <span class="md-ellipsis">
      3. UpdateAll 関数（クエリ構造体のメソッド）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. UpdateAll 関数（クエリ構造体のメソッド）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_98" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_99" class="md-nav__link">
    <span class="md-ellipsis">
      コードの詳細な解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_100" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-updateall" class="md-nav__link">
    <span class="md-ellipsis">
      4. UpdateAll 関数（スライスメソッド）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. UpdateAll 関数（スライスメソッド）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_101" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_102" class="md-nav__link">
    <span class="md-ellipsis">
      コードの詳細な解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_103" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-mysqluseruniquecolumns" class="md-nav__link">
    <span class="md-ellipsis">
      5. mySQLUserUniqueColumns 変数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. mySQLUserUniqueColumns 変数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_104" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_105" class="md-nav__link">
    <span class="md-ellipsis">
      注意事項
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#upsert" class="md-nav__link">
    <span class="md-ellipsis">
      Upsertメソッドの解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Upsertメソッドの解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_106" class="md-nav__link">
    <span class="md-ellipsis">
      概要
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_107" class="md-nav__link">
    <span class="md-ellipsis">
      関数シグネチャ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_108" class="md-nav__link">
    <span class="md-ellipsis">
      処理の流れ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_109" class="md-nav__link">
    <span class="md-ellipsis">
      注意点
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_110" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#delete" class="md-nav__link">
    <span class="md-ellipsis">
      Deleteメソッドの解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Deleteメソッドの解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_111" class="md-nav__link">
    <span class="md-ellipsis">
      概要
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_112" class="md-nav__link">
    <span class="md-ellipsis">
      関数シグネチャ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_113" class="md-nav__link">
    <span class="md-ellipsis">
      処理の流れ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_114" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deleteall" class="md-nav__link">
    <span class="md-ellipsis">
      DeleteAllメソッドの解説（クエリからの削除）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DeleteAllメソッドの解説（クエリからの削除）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_115" class="md-nav__link">
    <span class="md-ellipsis">
      概要
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_116" class="md-nav__link">
    <span class="md-ellipsis">
      関数シグネチャ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_117" class="md-nav__link">
    <span class="md-ellipsis">
      処理の流れ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_118" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deleteall_1" class="md-nav__link">
    <span class="md-ellipsis">
      DeleteAllメソッドの解説（スライスからの削除）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DeleteAllメソッドの解説（スライスからの削除）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_119" class="md-nav__link">
    <span class="md-ellipsis">
      概要
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_120" class="md-nav__link">
    <span class="md-ellipsis">
      関数シグネチャ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_121" class="md-nav__link">
    <span class="md-ellipsis">
      処理の流れ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_122" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reload" class="md-nav__link">
    <span class="md-ellipsis">
      Reloadメソッドの解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Reloadメソッドの解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_123" class="md-nav__link">
    <span class="md-ellipsis">
      概要
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_124" class="md-nav__link">
    <span class="md-ellipsis">
      関数シグネチャ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_125" class="md-nav__link">
    <span class="md-ellipsis">
      処理の流れ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_126" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reloadall" class="md-nav__link">
    <span class="md-ellipsis">
      ReloadAllメソッドの解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ReloadAllメソッドの解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_127" class="md-nav__link">
    <span class="md-ellipsis">
      概要
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_128" class="md-nav__link">
    <span class="md-ellipsis">
      関数シグネチャ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_129" class="md-nav__link">
    <span class="md-ellipsis">
      処理の流れ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_130" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#userexists" class="md-nav__link">
    <span class="md-ellipsis">
      UserExists関数の解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="UserExists関数の解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_131" class="md-nav__link">
    <span class="md-ellipsis">
      概要
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_132" class="md-nav__link">
    <span class="md-ellipsis">
      関数シグネチャ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_133" class="md-nav__link">
    <span class="md-ellipsis">
      処理の流れ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_134" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exists_1" class="md-nav__link">
    <span class="md-ellipsis">
      Existsメソッドの解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Existsメソッドの解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_135" class="md-nav__link">
    <span class="md-ellipsis">
      概要
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_136" class="md-nav__link">
    <span class="md-ellipsis">
      関数シグネチャ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_137" class="md-nav__link">
    <span class="md-ellipsis">
      処理の流れ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_138" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_139" class="md-nav__link">
    <span class="md-ellipsis">
      参考資料
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Git
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Git
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Git/Fetch%E3%81%A8Pull/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fetchとpullはどう違うのか
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Git/origin%28%E3%83%AA%E3%83%A2%E3%83%BC%E3%83%88%29%E3%83%96%E3%83%A9%E3%83%B3%E3%83%81%E5%89%8A%E9%99%A4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Origin(リモート)ブランチ削除
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Google Maps
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Google Maps
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Google%20Maps/Maps%20JavaScript%20API/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Maps JavaScript API
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      はじめに
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      パッケージ宣言とインポート
    </span>
  </a>
  
    <nav class="md-nav" aria-label="パッケージ宣言とインポート">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#user_1" class="md-nav__link">
    <span class="md-ellipsis">
      User構造体の定義
    </span>
  </a>
  
    <nav class="md-nav" aria-label="User構造体の定義">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      カラム名の定義
    </span>
  </a>
  
    <nav class="md-nav" aria-label="カラム名の定義">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      テーブル付きのカラム名
    </span>
  </a>
  
    <nav class="md-nav" aria-label="テーブル付きのカラム名">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#where" class="md-nav__link">
    <span class="md-ellipsis">
      WHEREヘルパーの生成
    </span>
  </a>
  
    <nav class="md-nav" aria-label="WHEREヘルパーの生成">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      リレーションシップの定義
    </span>
  </a>
  
    <nav class="md-nav" aria-label="リレーションシップの定義">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#userr" class="md-nav__link">
    <span class="md-ellipsis">
      リレーションを保持する構造体 userR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="リレーションを保持する構造体 userR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      リレーション用のメソッド
    </span>
  </a>
  
    <nav class="md-nav" aria-label="リレーション用のメソッド">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#load-userl" class="md-nav__link">
    <span class="md-ellipsis">
      Loadメソッドを提供する構造体 userL
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Loadメソッドを提供する構造体 userL">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      変数と初期化
    </span>
  </a>
  
    <nav class="md-nav" aria-label="変数と初期化">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      型エイリアスとクエリ構造体
    </span>
  </a>
  
    <nav class="md-nav" aria-label="型エイリアスとクエリ構造体">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      キャッシュ関連の変数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="キャッシュ関連の変数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      その他の変数と依存性の強制
    </span>
  </a>
  
    <nav class="md-nav" aria-label="その他の変数と依存性の強制">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    <span class="md-ellipsis">
      フック関連の変数とメソッド
    </span>
  </a>
  
    <nav class="md-nav" aria-label="フック関連の変数とメソッド">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    <span class="md-ellipsis">
      フックメソッドの実装例
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
    <nav class="md-nav" aria-label="利用例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    <span class="md-ellipsis">
      ユーザーの挿入
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ユーザーの挿入">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    <span class="md-ellipsis">
      ユーザーの取得
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ユーザーの取得">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    <span class="md-ellipsis">
      ユーザーの更新
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ユーザーの更新">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_34" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_35" class="md-nav__link">
    <span class="md-ellipsis">
      ユーザーの削除
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ユーザーの削除">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_36" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adduserhook" class="md-nav__link">
    <span class="md-ellipsis">
      AddUserHook関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AddUserHook関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_37" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_38" class="md-nav__link">
    <span class="md-ellipsis">
      フックポイント一覧
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_39" class="md-nav__link">
    <span class="md-ellipsis">
      使用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#one" class="md-nav__link">
    <span class="md-ellipsis">
      One関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="One関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_40" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_41" class="md-nav__link">
    <span class="md-ellipsis">
      使用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#all" class="md-nav__link">
    <span class="md-ellipsis">
      All関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="All関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_42" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_43" class="md-nav__link">
    <span class="md-ellipsis">
      使用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#count" class="md-nav__link">
    <span class="md-ellipsis">
      Count関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Count関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_44" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_45" class="md-nav__link">
    <span class="md-ellipsis">
      使用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exists" class="md-nav__link">
    <span class="md-ellipsis">
      Exists関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Exists関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_46" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_47" class="md-nav__link">
    <span class="md-ellipsis">
      使用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_48" class="md-nav__link">
    <span class="md-ellipsis">
      リレーションシップ関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="リレーションシップ関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#point" class="md-nav__link">
    <span class="md-ellipsis">
      Point関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Point関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_49" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_50" class="md-nav__link">
    <span class="md-ellipsis">
      使用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checkinlogs" class="md-nav__link">
    <span class="md-ellipsis">
      CheckinLogs関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CheckinLogs関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_51" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_52" class="md-nav__link">
    <span class="md-ellipsis">
      使用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pointlogs" class="md-nav__link">
    <span class="md-ellipsis">
      PointLogs関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PointLogs関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_53" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#seichies" class="md-nav__link">
    <span class="md-ellipsis">
      Seichies関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Seichies関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_54" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#loadpoint" class="md-nav__link">
    <span class="md-ellipsis">
      LoadPoint関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LoadPoint関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_55" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_56" class="md-nav__link">
    <span class="md-ellipsis">
      使用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_57" class="md-nav__link">
    <span class="md-ellipsis">
      注意点
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#loadcheckinlogsloadpointlogs" class="md-nav__link">
    <span class="md-ellipsis">
      LoadCheckinLogsおよびLoadPointLogs関数の詳解と使用例
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#loadcheckinlogs" class="md-nav__link">
    <span class="md-ellipsis">
      LoadCheckinLogs関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LoadCheckinLogs関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_58" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
    <nav class="md-nav" aria-label="説明">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_59" class="md-nav__link">
    <span class="md-ellipsis">
      関数の引数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_60" class="md-nav__link">
    <span class="md-ellipsis">
      関数の流れ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_61" class="md-nav__link">
    <span class="md-ellipsis">
      使用例
    </span>
  </a>
  
    <nav class="md-nav" aria-label="使用例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_62" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#loadpointlogs" class="md-nav__link">
    <span class="md-ellipsis">
      LoadPointLogs関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LoadPointLogs関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_63" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
    <nav class="md-nav" aria-label="説明">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_64" class="md-nav__link">
    <span class="md-ellipsis">
      関数の流れ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_65" class="md-nav__link">
    <span class="md-ellipsis">
      使用例
    </span>
  </a>
  
    <nav class="md-nav" aria-label="使用例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_66" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_67" class="md-nav__link">
    <span class="md-ellipsis">
      注意事項
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#loadcheckinlogsloadpointlogs_1" class="md-nav__link">
    <span class="md-ellipsis">
      LoadCheckinLogs、LoadPointLogs関数まとめ
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#loadseichies" class="md-nav__link">
    <span class="md-ellipsis">
      LoadSeichies 関数の詳細な解説と利用例
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_68" class="md-nav__link">
    <span class="md-ellipsis">
      関数のシグネチャ
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_69" class="md-nav__link">
    <span class="md-ellipsis">
      コードの詳細な解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="コードの詳細な解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      1. 変数の初期化
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      2. 単一オブジェクトか複数オブジェクトかの判定
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-args" class="md-nav__link">
    <span class="md-ellipsis">
      3. args の準備
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-args" class="md-nav__link">
    <span class="md-ellipsis">
      4. args の内容確認
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    <span class="md-ellipsis">
      5. クエリの作成
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6" class="md-nav__link">
    <span class="md-ellipsis">
      6. クエリの実行と結果の取得
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7" class="md-nav__link">
    <span class="md-ellipsis">
      7. フックの処理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8" class="md-nav__link">
    <span class="md-ellipsis">
      8. 結果のマッピング
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9" class="md-nav__link">
    <span class="md-ellipsis">
      9. 終了処理
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_70" class="md-nav__link">
    <span class="md-ellipsis">
      開発者向け利用例
    </span>
  </a>
  
    <nav class="md-nav" aria-label="開発者向け利用例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_71" class="md-nav__link">
    <span class="md-ellipsis">
      単一のユーザーの場合
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_72" class="md-nav__link">
    <span class="md-ellipsis">
      複数のユーザーの場合
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_73" class="md-nav__link">
    <span class="md-ellipsis">
      クエリモディファイアを使用したカスタマイズ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#loadseichies_1" class="md-nav__link">
    <span class="md-ellipsis">
      LoadSeichies` 関数まとめ
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setpoint" class="md-nav__link">
    <span class="md-ellipsis">
      SetPoint 関数と関連関数の詳細な解説と利用例
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-setpoint" class="md-nav__link">
    <span class="md-ellipsis">
      1. SetPoint 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. SetPoint 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_74" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_75" class="md-nav__link">
    <span class="md-ellipsis">
      コードの詳細な解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_76" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-addcheckinlogs" class="md-nav__link">
    <span class="md-ellipsis">
      2. AddCheckinLogs 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. AddCheckinLogs 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_77" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_78" class="md-nav__link">
    <span class="md-ellipsis">
      コードの詳細な解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_79" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-addpointlogs" class="md-nav__link">
    <span class="md-ellipsis">
      3. AddPointLogs 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. AddPointLogs 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_80" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_81" class="md-nav__link">
    <span class="md-ellipsis">
      コードの詳細な解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_82" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-addseichies" class="md-nav__link">
    <span class="md-ellipsis">
      4. AddSeichies 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. AddSeichies 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_83" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_84" class="md-nav__link">
    <span class="md-ellipsis">
      コードの詳細な解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_85" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-users" class="md-nav__link">
    <span class="md-ellipsis">
      5. Users 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Users 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_86" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_87" class="md-nav__link">
    <span class="md-ellipsis">
      コードの詳細な解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_88" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-finduser" class="md-nav__link">
    <span class="md-ellipsis">
      6. FindUser 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. FindUser 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_89" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_90" class="md-nav__link">
    <span class="md-ellipsis">
      コードの詳細な解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_91" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#insert" class="md-nav__link">
    <span class="md-ellipsis">
      Insert 関数と関連関数の詳細な解説と利用例
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-insert" class="md-nav__link">
    <span class="md-ellipsis">
      1. Insert 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Insert 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_92" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_93" class="md-nav__link">
    <span class="md-ellipsis">
      コードの詳細な解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_94" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-update" class="md-nav__link">
    <span class="md-ellipsis">
      2. Update 関数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Update 関数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_95" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_96" class="md-nav__link">
    <span class="md-ellipsis">
      コードの詳細な解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_97" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-updateall" class="md-nav__link">
    <span class="md-ellipsis">
      3. UpdateAll 関数（クエリ構造体のメソッド）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. UpdateAll 関数（クエリ構造体のメソッド）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_98" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_99" class="md-nav__link">
    <span class="md-ellipsis">
      コードの詳細な解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_100" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-updateall" class="md-nav__link">
    <span class="md-ellipsis">
      4. UpdateAll 関数（スライスメソッド）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. UpdateAll 関数（スライスメソッド）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_101" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_102" class="md-nav__link">
    <span class="md-ellipsis">
      コードの詳細な解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_103" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-mysqluseruniquecolumns" class="md-nav__link">
    <span class="md-ellipsis">
      5. mySQLUserUniqueColumns 変数
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. mySQLUserUniqueColumns 変数">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_104" class="md-nav__link">
    <span class="md-ellipsis">
      説明
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_105" class="md-nav__link">
    <span class="md-ellipsis">
      注意事項
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#upsert" class="md-nav__link">
    <span class="md-ellipsis">
      Upsertメソッドの解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Upsertメソッドの解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_106" class="md-nav__link">
    <span class="md-ellipsis">
      概要
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_107" class="md-nav__link">
    <span class="md-ellipsis">
      関数シグネチャ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_108" class="md-nav__link">
    <span class="md-ellipsis">
      処理の流れ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_109" class="md-nav__link">
    <span class="md-ellipsis">
      注意点
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_110" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#delete" class="md-nav__link">
    <span class="md-ellipsis">
      Deleteメソッドの解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Deleteメソッドの解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_111" class="md-nav__link">
    <span class="md-ellipsis">
      概要
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_112" class="md-nav__link">
    <span class="md-ellipsis">
      関数シグネチャ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_113" class="md-nav__link">
    <span class="md-ellipsis">
      処理の流れ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_114" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deleteall" class="md-nav__link">
    <span class="md-ellipsis">
      DeleteAllメソッドの解説（クエリからの削除）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DeleteAllメソッドの解説（クエリからの削除）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_115" class="md-nav__link">
    <span class="md-ellipsis">
      概要
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_116" class="md-nav__link">
    <span class="md-ellipsis">
      関数シグネチャ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_117" class="md-nav__link">
    <span class="md-ellipsis">
      処理の流れ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_118" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deleteall_1" class="md-nav__link">
    <span class="md-ellipsis">
      DeleteAllメソッドの解説（スライスからの削除）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DeleteAllメソッドの解説（スライスからの削除）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_119" class="md-nav__link">
    <span class="md-ellipsis">
      概要
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_120" class="md-nav__link">
    <span class="md-ellipsis">
      関数シグネチャ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_121" class="md-nav__link">
    <span class="md-ellipsis">
      処理の流れ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_122" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reload" class="md-nav__link">
    <span class="md-ellipsis">
      Reloadメソッドの解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Reloadメソッドの解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_123" class="md-nav__link">
    <span class="md-ellipsis">
      概要
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_124" class="md-nav__link">
    <span class="md-ellipsis">
      関数シグネチャ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_125" class="md-nav__link">
    <span class="md-ellipsis">
      処理の流れ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_126" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reloadall" class="md-nav__link">
    <span class="md-ellipsis">
      ReloadAllメソッドの解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ReloadAllメソッドの解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_127" class="md-nav__link">
    <span class="md-ellipsis">
      概要
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_128" class="md-nav__link">
    <span class="md-ellipsis">
      関数シグネチャ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_129" class="md-nav__link">
    <span class="md-ellipsis">
      処理の流れ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_130" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#userexists" class="md-nav__link">
    <span class="md-ellipsis">
      UserExists関数の解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="UserExists関数の解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_131" class="md-nav__link">
    <span class="md-ellipsis">
      概要
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_132" class="md-nav__link">
    <span class="md-ellipsis">
      関数シグネチャ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_133" class="md-nav__link">
    <span class="md-ellipsis">
      処理の流れ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_134" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exists_1" class="md-nav__link">
    <span class="md-ellipsis">
      Existsメソッドの解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Existsメソッドの解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_135" class="md-nav__link">
    <span class="md-ellipsis">
      概要
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_136" class="md-nav__link">
    <span class="md-ellipsis">
      関数シグネチャ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_137" class="md-nav__link">
    <span class="md-ellipsis">
      処理の流れ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_138" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_139" class="md-nav__link">
    <span class="md-ellipsis">
      参考資料
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="user">Userモデルの詳細解説と利用例</h1>
<p>このドキュメントでは、提供されたGo言語のコードについて、全てのコード部分を詳細に解説します。開発者が理解しやすいように、利用例も交えながら説明します。</p>
<h2 id="_1">はじめに</h2>
<p>このコードは、ORM（Object-Relational Mapping）ツールであるSQLBoilerを使用して自動生成されたもので、データベースの<code>users</code>テーブルを表す<code>User</code>モデルを定義しています。このモデルは、データベースとGo言語の間でデータをやり取りするためのさまざまなメソッドやフック（hooks）を含んでいます。</p>
<hr />
<h2 id="_2">パッケージ宣言とインポート</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-0-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-0-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-0-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">models</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="w">    </span><span class="c1">// 標準パッケージ</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="w">    </span><span class="s">&quot;context&quot;</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="w">    </span><span class="s">&quot;database/sql&quot;</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="w">    </span><span class="s">&quot;reflect&quot;</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="w">    </span><span class="s">&quot;strconv&quot;</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="w">    </span><span class="s">&quot;strings&quot;</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="w">    </span><span class="s">&quot;sync&quot;</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="w">    </span><span class="s">&quot;time&quot;</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="w">    </span><span class="c1">// 外部パッケージ</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="w">    </span><span class="s">&quot;github.com/friendsofgo/errors&quot;</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="w">    </span><span class="s">&quot;github.com/volatiletech/null/v8&quot;</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="w">    </span><span class="s">&quot;github.com/volatiletech/sqlboiler/v4/boil&quot;</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="w">    </span><span class="s">&quot;github.com/volatiletech/sqlboiler/v4/queries&quot;</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="w">    </span><span class="s">&quot;github.com/volatiletech/sqlboiler/v4/queries/qm&quot;</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="w">    </span><span class="s">&quot;github.com/volatiletech/sqlboiler/v4/queries/qmhelper&quot;</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="w">    </span><span class="s">&quot;github.com/volatiletech/strmangle&quot;</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h3 id="_3">解説</h3>
<ul>
<li><strong>package models</strong>: このファイルが属するパッケージを<code>models</code>として宣言しています。これは、アプリケーション内でデータベースモデルを含むパッケージとして機能します。</li>
<li><strong>インポートセクション</strong>: 必要な標準パッケージや外部パッケージをインポートしています。</li>
<li><code>context</code>, <code>database/sql</code>, <code>fmt</code>などの標準ライブラリ。</li>
<li><code>github.com/volatiletech/sqlboiler/v4/*</code>などのSQLBoiler関連のパッケージ。</li>
<li><code>github.com/volatiletech/null/v8</code>: Null許容な型を扱うためのパッケージ。</li>
</ul>
<hr />
<h2 id="user_1">User構造体の定義</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="kd">type</span><span class="w"> </span><span class="nx">User</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="w">    </span><span class="nx">UserID</span><span class="w">     </span><span class="kt">uint</span><span class="w">      </span><span class="s">`boil:&quot;user_id&quot; json:&quot;user_id&quot; toml:&quot;user_id&quot; yaml:&quot;user_id&quot;`</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="w">    </span><span class="nx">FirebaseID</span><span class="w"> </span><span class="kt">string</span><span class="w">    </span><span class="s">`boil:&quot;firebase_id&quot; json:&quot;firebase_id&quot; toml:&quot;firebase_id&quot; yaml:&quot;firebase_id&quot;`</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="w">    </span><span class="nx">IsAdmin</span><span class="w">    </span><span class="kt">bool</span><span class="w">      </span><span class="s">`boil:&quot;is_admin&quot; json:&quot;is_admin&quot; toml:&quot;is_admin&quot; yaml:&quot;is_admin&quot;`</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="w">    </span><span class="nx">CreatedAt</span><span class="w">  </span><span class="nx">null</span><span class="p">.</span><span class="nx">Time</span><span class="w"> </span><span class="s">`boil:&quot;created_at&quot; json:&quot;created_at,omitempty&quot; toml:&quot;created_at&quot; yaml:&quot;created_at,omitempty&quot;`</span>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="w">    </span><span class="nx">UpdatedAt</span><span class="w">  </span><span class="nx">null</span><span class="p">.</span><span class="nx">Time</span><span class="w"> </span><span class="s">`boil:&quot;updated_at&quot; json:&quot;updated_at,omitempty&quot; toml:&quot;updated_at&quot; yaml:&quot;updated_at,omitempty&quot;`</span>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="w">    </span><span class="nx">R</span><span class="w"> </span><span class="o">*</span><span class="nx">userR</span><span class="w"> </span><span class="s">`boil:&quot;-&quot; json:&quot;-&quot; toml:&quot;-&quot; yaml:&quot;-&quot;`</span>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="w">    </span><span class="nx">L</span><span class="w"> </span><span class="nx">userL</span><span class="w">  </span><span class="s">`boil:&quot;-&quot; json:&quot;-&quot; toml:&quot;-&quot; yaml:&quot;-&quot;`</span>
<a id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_4">解説</h3>
<ul>
<li><strong>User構造体</strong>: データベースの<code>users</code>テーブルを表現するモデル。各フィールドがテーブルのカラムに対応しています。</li>
<li><strong>フィールドとタグ</strong>:</li>
<li><code>UserID</code>: ユーザーのユニークなID。型は<code>uint</code>。</li>
<li><code>FirebaseID</code>: FirebaseでのユーザーID。型は<code>string</code>。</li>
<li><code>IsAdmin</code>: 管理者権限を持つかどうか。型は<code>bool</code>。</li>
<li><code>CreatedAt</code>: レコードの作成日時。型は<code>null.Time</code>で、Null値を許容。</li>
<li><code>UpdatedAt</code>: レコードの更新日時。型は<code>null.Time</code>で、Null値を許容。</li>
<li><strong>構造体タグ</strong>:</li>
<li><code>boil</code>タグ: SQLBoilerが利用するデータベースのカラム名を指定。</li>
<li><code>json</code>タグ: JSONシリアライズ/デシリアライズ時のキー名を指定。</li>
<li><code>toml</code>、<code>yaml</code>タグ: TOML、YAMLシリアライズ/デシリアライズ時のキー名を指定。</li>
<li><code>omitempty</code>: フィールドがゼロ値の場合、シリアライズ時に出力しない。</li>
<li><strong>リレーションフィールド</strong>:</li>
<li><code>R *userR</code>: リレーションを格納するフィールド。遅延ロードされた関連オブジェクトが格納される。</li>
<li><code>L userL</code>: リレーションのロードメソッドを提供するための埋め込み構造体。</li>
</ul>
<hr />
<h2 id="_5">カラム名の定義</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-2-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-2-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-2-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-2-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-2-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-2-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-2-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-2-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-2-10">10</a></span>
<span class="normal"><a href="#__codelineno-2-11">11</a></span>
<span class="normal"><a href="#__codelineno-2-12">12</a></span>
<span class="normal"><a href="#__codelineno-2-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">UserColumns</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="w">    </span><span class="nx">UserID</span><span class="w">     </span><span class="kt">string</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="w">    </span><span class="nx">FirebaseID</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="w">    </span><span class="nx">IsAdmin</span><span class="w">    </span><span class="kt">string</span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="w">    </span><span class="nx">CreatedAt</span><span class="w">  </span><span class="kt">string</span>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="w">    </span><span class="nx">UpdatedAt</span><span class="w">  </span><span class="kt">string</span>
<a id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="p">}{</span>
<a id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="w">    </span><span class="nx">UserID</span><span class="p">:</span><span class="w">     </span><span class="s">&quot;user_id&quot;</span><span class="p">,</span>
<a id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="w">    </span><span class="nx">FirebaseID</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;firebase_id&quot;</span><span class="p">,</span>
<a id="__codelineno-2-10" name="__codelineno-2-10"></a><span class="w">    </span><span class="nx">IsAdmin</span><span class="p">:</span><span class="w">    </span><span class="s">&quot;is_admin&quot;</span><span class="p">,</span>
<a id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="w">    </span><span class="nx">CreatedAt</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;created_at&quot;</span><span class="p">,</span>
<a id="__codelineno-2-12" name="__codelineno-2-12"></a><span class="w">    </span><span class="nx">UpdatedAt</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;updated_at&quot;</span><span class="p">,</span>
<a id="__codelineno-2-13" name="__codelineno-2-13"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_6">解説</h3>
<p><code>UserColumns</code>は、データベースのカラム名を保持する定数の集合です。これにより、コード内でカラム名を直接文字列として書くのではなく、定数として参照できます。</p>
<hr />
<h2 id="_7">テーブル付きのカラム名</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-3-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-3-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-3-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-3-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-3-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-3-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-3-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-3-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-3-10">10</a></span>
<span class="normal"><a href="#__codelineno-3-11">11</a></span>
<span class="normal"><a href="#__codelineno-3-12">12</a></span>
<span class="normal"><a href="#__codelineno-3-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">UserTableColumns</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="w">    </span><span class="nx">UserID</span><span class="w">     </span><span class="kt">string</span>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="w">    </span><span class="nx">FirebaseID</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="w">    </span><span class="nx">IsAdmin</span><span class="w">    </span><span class="kt">string</span>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="w">    </span><span class="nx">CreatedAt</span><span class="w">  </span><span class="kt">string</span>
<a id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="w">    </span><span class="nx">UpdatedAt</span><span class="w">  </span><span class="kt">string</span>
<a id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="p">}{</span>
<a id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="w">    </span><span class="nx">UserID</span><span class="p">:</span><span class="w">     </span><span class="s">&quot;users.user_id&quot;</span><span class="p">,</span>
<a id="__codelineno-3-9" name="__codelineno-3-9"></a><span class="w">    </span><span class="nx">FirebaseID</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;users.firebase_id&quot;</span><span class="p">,</span>
<a id="__codelineno-3-10" name="__codelineno-3-10"></a><span class="w">    </span><span class="nx">IsAdmin</span><span class="p">:</span><span class="w">    </span><span class="s">&quot;users.is_admin&quot;</span><span class="p">,</span>
<a id="__codelineno-3-11" name="__codelineno-3-11"></a><span class="w">    </span><span class="nx">CreatedAt</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;users.created_at&quot;</span><span class="p">,</span>
<a id="__codelineno-3-12" name="__codelineno-3-12"></a><span class="w">    </span><span class="nx">UpdatedAt</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;users.updated_at&quot;</span><span class="p">,</span>
<a id="__codelineno-3-13" name="__codelineno-3-13"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_8">解説</h3>
<p><code>UserTableColumns</code>は、テーブル名付きのカラム名を保持しています。これは、クエリでテーブルを明示的に指定する場合に便利です。</p>
<hr />
<h2 id="where">WHEREヘルパーの生成</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-4-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-4-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-4-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-4-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-4-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-4-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-4-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-4-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-4-10">10</a></span>
<span class="normal"><a href="#__codelineno-4-11">11</a></span>
<span class="normal"><a href="#__codelineno-4-12">12</a></span>
<span class="normal"><a href="#__codelineno-4-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">UserWhere</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="w">    </span><span class="nx">UserID</span><span class="w">     </span><span class="nx">whereHelperuint</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="w">    </span><span class="nx">FirebaseID</span><span class="w"> </span><span class="nx">whereHelperstring</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="w">    </span><span class="nx">IsAdmin</span><span class="w">    </span><span class="nx">whereHelperbool</span>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="w">    </span><span class="nx">CreatedAt</span><span class="w">  </span><span class="nx">whereHelpernull_Time</span>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a><span class="w">    </span><span class="nx">UpdatedAt</span><span class="w">  </span><span class="nx">whereHelpernull_Time</span>
<a id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="p">}{</span>
<a id="__codelineno-4-8" name="__codelineno-4-8"></a><span class="w">    </span><span class="nx">UserID</span><span class="p">:</span><span class="w">     </span><span class="nx">whereHelperuint</span><span class="p">{</span><span class="nx">field</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;`users`.`user_id`&quot;</span><span class="p">},</span>
<a id="__codelineno-4-9" name="__codelineno-4-9"></a><span class="w">    </span><span class="nx">FirebaseID</span><span class="p">:</span><span class="w"> </span><span class="nx">whereHelperstring</span><span class="p">{</span><span class="nx">field</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;`users`.`firebase_id`&quot;</span><span class="p">},</span>
<a id="__codelineno-4-10" name="__codelineno-4-10"></a><span class="w">    </span><span class="nx">IsAdmin</span><span class="p">:</span><span class="w">    </span><span class="nx">whereHelperbool</span><span class="p">{</span><span class="nx">field</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;`users`.`is_admin`&quot;</span><span class="p">},</span>
<a id="__codelineno-4-11" name="__codelineno-4-11"></a><span class="w">    </span><span class="nx">CreatedAt</span><span class="p">:</span><span class="w">  </span><span class="nx">whereHelpernull_Time</span><span class="p">{</span><span class="nx">field</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;`users`.`created_at`&quot;</span><span class="p">},</span>
<a id="__codelineno-4-12" name="__codelineno-4-12"></a><span class="w">    </span><span class="nx">UpdatedAt</span><span class="p">:</span><span class="w">  </span><span class="nx">whereHelpernull_Time</span><span class="p">{</span><span class="nx">field</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;`users`.`updated_at`&quot;</span><span class="p">},</span>
<a id="__codelineno-4-13" name="__codelineno-4-13"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_9">解説</h3>
<p><code>UserWhere</code>は、クエリを構築する際のWHERE句を簡潔に書くためのヘルパーです。各フィールドは対応するデータ型のヘルパー構造体を持ち、フィールド名を保持しています。</p>
<hr />
<h2 id="_10">リレーションシップの定義</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span>
<span class="normal"><a href="#__codelineno-5-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">UserRels</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="w">    </span><span class="nx">Point</span><span class="w">       </span><span class="kt">string</span>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="w">    </span><span class="nx">CheckinLogs</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="w">    </span><span class="nx">PointLogs</span><span class="w">   </span><span class="kt">string</span>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="w">    </span><span class="nx">Seichies</span><span class="w">    </span><span class="kt">string</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="p">}{</span>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="w">    </span><span class="nx">Point</span><span class="p">:</span><span class="w">       </span><span class="s">&quot;Point&quot;</span><span class="p">,</span>
<a id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="w">    </span><span class="nx">CheckinLogs</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;CheckinLogs&quot;</span><span class="p">,</span>
<a id="__codelineno-5-9" name="__codelineno-5-9"></a><span class="w">    </span><span class="nx">PointLogs</span><span class="p">:</span><span class="w">   </span><span class="s">&quot;PointLogs&quot;</span><span class="p">,</span>
<a id="__codelineno-5-10" name="__codelineno-5-10"></a><span class="w">    </span><span class="nx">Seichies</span><span class="p">:</span><span class="w">    </span><span class="s">&quot;Seichies&quot;</span><span class="p">,</span>
<a id="__codelineno-5-11" name="__codelineno-5-11"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_11">解説</h3>
<p><code>UserRels</code>は、<code>User</code>モデルが持つリレーションシップの名前を定義しています。これらは、関連する他のモデルとの関係を表します。</p>
<hr />
<h2 id="userr">リレーションを保持する構造体 <code>userR</code></h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">1</a></span>
<span class="normal"><a href="#__codelineno-6-2">2</a></span>
<span class="normal"><a href="#__codelineno-6-3">3</a></span>
<span class="normal"><a href="#__codelineno-6-4">4</a></span>
<span class="normal"><a href="#__codelineno-6-5">5</a></span>
<span class="normal"><a href="#__codelineno-6-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="kd">type</span><span class="w"> </span><span class="nx">userR</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="w">    </span><span class="nx">Point</span><span class="w">       </span><span class="o">*</span><span class="nx">Point</span><span class="w">          </span><span class="s">`boil:&quot;Point&quot; json:&quot;Point&quot; toml:&quot;Point&quot; yaml:&quot;Point&quot;`</span>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="w">    </span><span class="nx">CheckinLogs</span><span class="w"> </span><span class="nx">CheckinLogSlice</span><span class="w"> </span><span class="s">`boil:&quot;CheckinLogs&quot; json:&quot;CheckinLogs&quot; toml:&quot;CheckinLogs&quot; yaml:&quot;CheckinLogs&quot;`</span>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="w">    </span><span class="nx">PointLogs</span><span class="w">   </span><span class="nx">PointLogSlice</span><span class="w">   </span><span class="s">`boil:&quot;PointLogs&quot; json:&quot;PointLogs&quot; toml:&quot;PointLogs&quot; yaml:&quot;PointLogs&quot;`</span>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="w">    </span><span class="nx">Seichies</span><span class="w">    </span><span class="nx">SeichySlice</span><span class="w">     </span><span class="s">`boil:&quot;Seichies&quot; json:&quot;Seichies&quot; toml:&quot;Seichies&quot; yaml:&quot;Seichies&quot;`</span>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_12">解説</h3>
<ul>
<li><strong>userR構造体</strong>: <code>User</code>モデルのリレーションを格納するための構造体。</li>
<li><strong>フィールド</strong>:</li>
<li><code>Point</code>: ユーザーに関連する<code>Point</code>モデルへのポインタ。</li>
<li><code>CheckinLogs</code>: ユーザーに関連する<code>CheckinLog</code>のスライス。</li>
<li><code>PointLogs</code>: ユーザーに関連する<code>PointLog</code>のスライス。</li>
<li><code>Seichies</code>: ユーザーに関連する<code>Seichy</code>のスライス。</li>
</ul>
<hr />
<h2 id="_13">リレーション用のメソッド</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-7-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-7-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-7-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-7-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-7-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-7-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-7-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-7-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-7-10">10</a></span>
<span class="normal"><a href="#__codelineno-7-11">11</a></span>
<span class="normal"><a href="#__codelineno-7-12">12</a></span>
<span class="normal"><a href="#__codelineno-7-13">13</a></span>
<span class="normal"><a href="#__codelineno-7-14">14</a></span>
<span class="normal"><a href="#__codelineno-7-15">15</a></span>
<span class="normal"><a href="#__codelineno-7-16">16</a></span>
<span class="normal"><a href="#__codelineno-7-17">17</a></span>
<span class="normal"><a href="#__codelineno-7-18">18</a></span>
<span class="normal"><a href="#__codelineno-7-19">19</a></span>
<span class="normal"><a href="#__codelineno-7-20">20</a></span>
<span class="normal"><a href="#__codelineno-7-21">21</a></span>
<span class="normal"><a href="#__codelineno-7-22">22</a></span>
<span class="normal"><a href="#__codelineno-7-23">23</a></span>
<span class="normal"><a href="#__codelineno-7-24">24</a></span>
<span class="normal"><a href="#__codelineno-7-25">25</a></span>
<span class="normal"><a href="#__codelineno-7-26">26</a></span>
<span class="normal"><a href="#__codelineno-7-27">27</a></span>
<span class="normal"><a href="#__codelineno-7-28">28</a></span>
<span class="normal"><a href="#__codelineno-7-29">29</a></span>
<span class="normal"><a href="#__codelineno-7-30">30</a></span>
<span class="normal"><a href="#__codelineno-7-31">31</a></span>
<span class="normal"><a href="#__codelineno-7-32">32</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="c1">// NewStruct creates a new relationship struct</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">userR</span><span class="p">)</span><span class="w"> </span><span class="nx">NewStruct</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="nx">userR</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">userR</span><span class="p">{}</span>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="p">}</span>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">userR</span><span class="p">)</span><span class="w"> </span><span class="nx">GetPoint</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="nx">Point</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-8" name="__codelineno-7-8"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-7-9" name="__codelineno-7-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-7-10" name="__codelineno-7-10"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Point</span>
<a id="__codelineno-7-11" name="__codelineno-7-11"></a><span class="p">}</span>
<a id="__codelineno-7-12" name="__codelineno-7-12"></a>
<a id="__codelineno-7-13" name="__codelineno-7-13"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">userR</span><span class="p">)</span><span class="w"> </span><span class="nx">GetCheckinLogs</span><span class="p">()</span><span class="w"> </span><span class="nx">CheckinLogSlice</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-14" name="__codelineno-7-14"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-15" name="__codelineno-7-15"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-7-16" name="__codelineno-7-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-7-17" name="__codelineno-7-17"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">CheckinLogs</span>
<a id="__codelineno-7-18" name="__codelineno-7-18"></a><span class="p">}</span>
<a id="__codelineno-7-19" name="__codelineno-7-19"></a>
<a id="__codelineno-7-20" name="__codelineno-7-20"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">userR</span><span class="p">)</span><span class="w"> </span><span class="nx">GetPointLogs</span><span class="p">()</span><span class="w"> </span><span class="nx">PointLogSlice</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-21" name="__codelineno-7-21"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-22" name="__codelineno-7-22"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-7-23" name="__codelineno-7-23"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-7-24" name="__codelineno-7-24"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">PointLogs</span>
<a id="__codelineno-7-25" name="__codelineno-7-25"></a><span class="p">}</span>
<a id="__codelineno-7-26" name="__codelineno-7-26"></a>
<a id="__codelineno-7-27" name="__codelineno-7-27"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">userR</span><span class="p">)</span><span class="w"> </span><span class="nx">GetSeichies</span><span class="p">()</span><span class="w"> </span><span class="nx">SeichySlice</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-28" name="__codelineno-7-28"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-29" name="__codelineno-7-29"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-7-30" name="__codelineno-7-30"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-7-31" name="__codelineno-7-31"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Seichies</span>
<a id="__codelineno-7-32" name="__codelineno-7-32"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_14">解説</h3>
<ul>
<li><strong>NewStructメソッド</strong>: 新しい<code>userR</code>インスタンスを生成します。</li>
<li><strong>Getメソッド</strong>: リレーションフィールドを取得するためのゲッターメソッド。<code>nil</code>チェックを行い、安全に値を返します。</li>
</ul>
<hr />
<h2 id="load-userl">Loadメソッドを提供する構造体 <code>userL</code></h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="kd">type</span><span class="w"> </span><span class="nx">userL</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_15">解説</h3>
<ul>
<li><code>userL</code>構造体は空ですが、リレーションをロードするためのメソッドが埋め込みで提供されます。これはSQLBoilerが自動生成するもので、コード上では実装が省略されています。</li>
</ul>
<hr />
<h2 id="_16">変数と初期化</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span>
<span class="normal"><a href="#__codelineno-9-2">2</a></span>
<span class="normal"><a href="#__codelineno-9-3">3</a></span>
<span class="normal"><a href="#__codelineno-9-4">4</a></span>
<span class="normal"><a href="#__codelineno-9-5">5</a></span>
<span class="normal"><a href="#__codelineno-9-6">6</a></span>
<span class="normal"><a href="#__codelineno-9-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="kd">var</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="w">    </span><span class="nx">userAllColumns</span><span class="w">            </span><span class="p">=</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;user_id&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;firebase_id&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;is_admin&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;created_at&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;updated_at&quot;</span><span class="p">}</span>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="w">    </span><span class="nx">userColumnsWithoutDefault</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;firebase_id&quot;</span><span class="p">}</span>
<a id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="w">    </span><span class="nx">userColumnsWithDefault</span><span class="w">    </span><span class="p">=</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;user_id&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;is_admin&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;created_at&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;updated_at&quot;</span><span class="p">}</span>
<a id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="w">    </span><span class="nx">userPrimaryKeyColumns</span><span class="w">     </span><span class="p">=</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;user_id&quot;</span><span class="p">}</span>
<a id="__codelineno-9-6" name="__codelineno-9-6"></a><span class="w">    </span><span class="nx">userGeneratedColumns</span><span class="w">      </span><span class="p">=</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{}</span>
<a id="__codelineno-9-7" name="__codelineno-9-7"></a><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h3 id="_17">解説</h3>
<ul>
<li><strong>userAllColumns</strong>: <code>User</code>モデルの全てのカラム名をリスト化。</li>
<li><strong>userColumnsWithoutDefault</strong>: デフォルト値を持たないカラム名のリスト。挿入時に明示的に値を指定する必要があります。</li>
<li><strong>userColumnsWithDefault</strong>: デフォルト値が設定されているカラム名のリスト。挿入時に値を指定しなくてもデフォルト値が適用されます。</li>
<li><strong>userPrimaryKeyColumns</strong>: 主キーとなるカラム名のリスト。</li>
<li><strong>userGeneratedColumns</strong>: データベース側で生成されるカラム名のリスト。今回は空です。</li>
</ul>
<hr />
<h2 id="_18">型エイリアスとクエリ構造体</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-10-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-10-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-10-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-10-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-10-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-10-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-10-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-10-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-10-10">10</a></span>
<span class="normal"><a href="#__codelineno-10-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="kd">type</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="w">    </span><span class="c1">// UserSlice is an alias for a slice of pointers to User.</span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="w">    </span><span class="c1">// This should almost always be used instead of []User.</span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="w">    </span><span class="nx">UserSlice</span><span class="w"> </span><span class="p">[]</span><span class="o">*</span><span class="nx">User</span>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="w">    </span><span class="c1">// UserHook is the signature for custom User hook methods</span>
<a id="__codelineno-10-6" name="__codelineno-10-6"></a><span class="w">    </span><span class="nx">UserHook</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">User</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>
<a id="__codelineno-10-7" name="__codelineno-10-7"></a>
<a id="__codelineno-10-8" name="__codelineno-10-8"></a><span class="w">    </span><span class="nx">userQuery</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-9" name="__codelineno-10-9"></a><span class="w">        </span><span class="o">*</span><span class="nx">queries</span><span class="p">.</span><span class="nx">Query</span>
<a id="__codelineno-10-10" name="__codelineno-10-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-10-11" name="__codelineno-10-11"></a><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h3 id="_19">解説</h3>
<ul>
<li><strong>UserSlice</strong>: <code>*User</code>のスライスのエイリアス。<code>[]User</code>ではなく<code>UserSlice</code>を使用することが推奨されます。</li>
<li><strong>UserHook</strong>: カスタムフックメソッドのシグネチャを定義する関数型。</li>
<li><strong>userQuery</strong>: クエリを作成するための構造体で、<code>queries.Query</code>を埋め込んでいます。</li>
</ul>
<hr />
<h2 id="_20">キャッシュ関連の変数</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-11-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-11-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-11-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-11-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-11-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-11-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-11-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-11-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-11-10">10</a></span>
<span class="normal"><a href="#__codelineno-11-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="kd">var</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="w">    </span><span class="nx">userType</span><span class="w">                 </span><span class="p">=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">TypeOf</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">User</span><span class="p">{})</span>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="w">    </span><span class="nx">userMapping</span><span class="w">              </span><span class="p">=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">MakeStructMapping</span><span class="p">(</span><span class="nx">userType</span><span class="p">)</span>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="w">    </span><span class="nx">userPrimaryKeyMapping</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">BindMapping</span><span class="p">(</span><span class="nx">userType</span><span class="p">,</span><span class="w"> </span><span class="nx">userMapping</span><span class="p">,</span><span class="w"> </span><span class="nx">userPrimaryKeyColumns</span><span class="p">)</span>
<a id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="w">    </span><span class="nx">userInsertCacheMut</span><span class="w">       </span><span class="nx">sync</span><span class="p">.</span><span class="nx">RWMutex</span>
<a id="__codelineno-11-6" name="__codelineno-11-6"></a><span class="w">    </span><span class="nx">userInsertCache</span><span class="w">          </span><span class="p">=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">insertCache</span><span class="p">)</span>
<a id="__codelineno-11-7" name="__codelineno-11-7"></a><span class="w">    </span><span class="nx">userUpdateCacheMut</span><span class="w">       </span><span class="nx">sync</span><span class="p">.</span><span class="nx">RWMutex</span>
<a id="__codelineno-11-8" name="__codelineno-11-8"></a><span class="w">    </span><span class="nx">userUpdateCache</span><span class="w">          </span><span class="p">=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">updateCache</span><span class="p">)</span>
<a id="__codelineno-11-9" name="__codelineno-11-9"></a><span class="w">    </span><span class="nx">userUpsertCacheMut</span><span class="w">       </span><span class="nx">sync</span><span class="p">.</span><span class="nx">RWMutex</span>
<a id="__codelineno-11-10" name="__codelineno-11-10"></a><span class="w">    </span><span class="nx">userUpsertCache</span><span class="w">          </span><span class="p">=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">insertCache</span><span class="p">)</span>
<a id="__codelineno-11-11" name="__codelineno-11-11"></a><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h3 id="_21">解説</h3>
<ul>
<li><strong>リフレクションとマッピング</strong>:</li>
<li><code>userType</code>: <code>User</code>構造体の型情報を保持。</li>
<li><code>userMapping</code>: <code>User</code>構造体のフィールドマッピングを生成。</li>
<li><code>userPrimaryKeyMapping</code>: 主キーのマッピングを生成。</li>
<li><strong>キャッシュとミューテックス</strong>:</li>
<li>データベース操作（挿入、更新、アップサート）の際に、パフォーマンスを向上させるためのキャッシュと、それを保護するためのミューテックス。</li>
</ul>
<hr />
<h2 id="_22">その他の変数と依存性の強制</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span>
<span class="normal"><a href="#__codelineno-12-2">2</a></span>
<span class="normal"><a href="#__codelineno-12-3">3</a></span>
<span class="normal"><a href="#__codelineno-12-4">4</a></span>
<span class="normal"><a href="#__codelineno-12-5">5</a></span>
<span class="normal"><a href="#__codelineno-12-6">6</a></span>
<span class="normal"><a href="#__codelineno-12-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="kd">var</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="w">    </span><span class="c1">// Force time package dependency for automated UpdatedAt/CreatedAt.</span>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="w">    </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span>
<a id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="w">    </span><span class="c1">// Force qmhelper dependency for where clause generation (which doesn&#39;t</span>
<a id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="w">    </span><span class="c1">// always happen)</span>
<a id="__codelineno-12-6" name="__codelineno-12-6"></a><span class="w">    </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">qmhelper</span><span class="p">.</span><span class="nx">Where</span>
<a id="__codelineno-12-7" name="__codelineno-12-7"></a><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h3 id="_23">解説</h3>
<p>未使用のパッケージがビルドから最適化で除外されないように、ダミーで変数に代入しています。これにより、自動的な<code>UpdatedAt</code>/<code>CreatedAt</code>のタイムスタンプ更新や、<code>qmhelper</code>パッケージの依存性を強制します。</p>
<hr />
<h2 id="_24">フック関連の変数とメソッド</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-13-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-13-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-13-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-13-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-13-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-13-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-13-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-13-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-13-10">10</a></span>
<span class="normal"><a href="#__codelineno-13-11">11</a></span>
<span class="normal"><a href="#__codelineno-13-12">12</a></span>
<span class="normal"><a href="#__codelineno-13-13">13</a></span>
<span class="normal"><a href="#__codelineno-13-14">14</a></span>
<span class="normal"><a href="#__codelineno-13-15">15</a></span>
<span class="normal"><a href="#__codelineno-13-16">16</a></span>
<span class="normal"><a href="#__codelineno-13-17">17</a></span>
<span class="normal"><a href="#__codelineno-13-18">18</a></span>
<span class="normal"><a href="#__codelineno-13-19">19</a></span>
<span class="normal"><a href="#__codelineno-13-20">20</a></span>
<span class="normal"><a href="#__codelineno-13-21">21</a></span>
<span class="normal"><a href="#__codelineno-13-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">userAfterSelectMu</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="kd">var</span><span class="w"> </span><span class="nx">userAfterSelectHooks</span><span class="w"> </span><span class="p">[]</span><span class="nx">UserHook</span>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="kd">var</span><span class="w"> </span><span class="nx">userBeforeInsertMu</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="kd">var</span><span class="w"> </span><span class="nx">userBeforeInsertHooks</span><span class="w"> </span><span class="p">[]</span><span class="nx">UserHook</span>
<a id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="kd">var</span><span class="w"> </span><span class="nx">userAfterInsertMu</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span>
<a id="__codelineno-13-7" name="__codelineno-13-7"></a><span class="kd">var</span><span class="w"> </span><span class="nx">userAfterInsertHooks</span><span class="w"> </span><span class="p">[]</span><span class="nx">UserHook</span>
<a id="__codelineno-13-8" name="__codelineno-13-8"></a>
<a id="__codelineno-13-9" name="__codelineno-13-9"></a><span class="kd">var</span><span class="w"> </span><span class="nx">userBeforeUpdateMu</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span>
<a id="__codelineno-13-10" name="__codelineno-13-10"></a><span class="kd">var</span><span class="w"> </span><span class="nx">userBeforeUpdateHooks</span><span class="w"> </span><span class="p">[]</span><span class="nx">UserHook</span>
<a id="__codelineno-13-11" name="__codelineno-13-11"></a><span class="kd">var</span><span class="w"> </span><span class="nx">userAfterUpdateMu</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span>
<a id="__codelineno-13-12" name="__codelineno-13-12"></a><span class="kd">var</span><span class="w"> </span><span class="nx">userAfterUpdateHooks</span><span class="w"> </span><span class="p">[]</span><span class="nx">UserHook</span>
<a id="__codelineno-13-13" name="__codelineno-13-13"></a>
<a id="__codelineno-13-14" name="__codelineno-13-14"></a><span class="kd">var</span><span class="w"> </span><span class="nx">userBeforeDeleteMu</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span>
<a id="__codelineno-13-15" name="__codelineno-13-15"></a><span class="kd">var</span><span class="w"> </span><span class="nx">userBeforeDeleteHooks</span><span class="w"> </span><span class="p">[]</span><span class="nx">UserHook</span>
<a id="__codelineno-13-16" name="__codelineno-13-16"></a><span class="kd">var</span><span class="w"> </span><span class="nx">userAfterDeleteMu</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span>
<a id="__codelineno-13-17" name="__codelineno-13-17"></a><span class="kd">var</span><span class="w"> </span><span class="nx">userAfterDeleteHooks</span><span class="w"> </span><span class="p">[]</span><span class="nx">UserHook</span>
<a id="__codelineno-13-18" name="__codelineno-13-18"></a>
<a id="__codelineno-13-19" name="__codelineno-13-19"></a><span class="kd">var</span><span class="w"> </span><span class="nx">userBeforeUpsertMu</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span>
<a id="__codelineno-13-20" name="__codelineno-13-20"></a><span class="kd">var</span><span class="w"> </span><span class="nx">userBeforeUpsertHooks</span><span class="w"> </span><span class="p">[]</span><span class="nx">UserHook</span>
<a id="__codelineno-13-21" name="__codelineno-13-21"></a><span class="kd">var</span><span class="w"> </span><span class="nx">userAfterUpsertMu</span><span class="w"> </span><span class="nx">sync</span><span class="p">.</span><span class="nx">Mutex</span>
<a id="__codelineno-13-22" name="__codelineno-13-22"></a><span class="kd">var</span><span class="w"> </span><span class="nx">userAfterUpsertHooks</span><span class="w"> </span><span class="p">[]</span><span class="nx">UserHook</span>
</code></pre></div></td></tr></table></div>
<h3 id="_25">解説</h3>
<p>各種データベース操作（Select、Insert、Update、Delete、Upsert）の前後に実行されるフックメソッドを管理するためのミューテックスとスライスを定義しています。</p>
<hr />
<h3 id="_26">フックメソッドの実装例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-14-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-14-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-14-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-14-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-14-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-14-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-14-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-14-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-14-10">10</a></span>
<span class="normal"><a href="#__codelineno-14-11">11</a></span>
<span class="normal"><a href="#__codelineno-14-12">12</a></span>
<span class="normal"><a href="#__codelineno-14-13">13</a></span>
<span class="normal"><a href="#__codelineno-14-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="c1">// doAfterSelectHooks executes all &quot;after Select&quot; hooks.</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">User</span><span class="p">)</span><span class="w"> </span><span class="nx">doAfterSelectHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">HooksAreSkipped</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-14-6" name="__codelineno-14-6"></a>
<a id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">hook</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">userAfterSelectHooks</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-8" name="__codelineno-14-8"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">hook</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-9" name="__codelineno-14-9"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-14-10" name="__codelineno-14-10"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-14-11" name="__codelineno-14-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-14-12" name="__codelineno-14-12"></a>
<a id="__codelineno-14-13" name="__codelineno-14-13"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-14-14" name="__codelineno-14-14"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_27">解説</h3>
<ul>
<li><strong>doAfterSelectHooksメソッド</strong>: <code>Select</code>操作の後に実行されるフックメソッドを順に呼び出します。</li>
<li><strong>フックスキップの確認</strong>: <code>boil.HooksAreSkipped(ctx)</code>で、コンテキストでフックがスキップされていないか確認します。</li>
<li><strong>フックの実行</strong>: 登録された全てのフックを順に実行し、エラーがあれば即座に返します。</li>
</ul>
<hr />
<h2 id="_28">利用例</h2>
<h3 id="_29">ユーザーの挿入</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-15-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-15-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-15-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-15-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-15-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-15-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-15-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-15-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-15-10">10</a></span>
<span class="normal"><a href="#__codelineno-15-11">11</a></span>
<span class="normal"><a href="#__codelineno-15-12">12</a></span>
<span class="normal"><a href="#__codelineno-15-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">createUser</span><span class="p">(</span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">firebaseID</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">isAdmin</span><span class="w"> </span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="w">    </span><span class="nx">user</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">User</span><span class="p">{</span>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="w">        </span><span class="nx">FirebaseID</span><span class="p">:</span><span class="w"> </span><span class="nx">firebaseID</span><span class="p">,</span>
<a id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="w">        </span><span class="nx">IsAdmin</span><span class="p">:</span><span class="w">    </span><span class="nx">isAdmin</span><span class="p">,</span>
<a id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-15-6" name="__codelineno-15-6"></a>
<a id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">Insert</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span><span class="w"> </span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">Infer</span><span class="p">())</span>
<a id="__codelineno-15-8" name="__codelineno-15-8"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-9" name="__codelineno-15-9"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;ユーザーの挿入に失敗しました: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-15-10" name="__codelineno-15-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-15-11" name="__codelineno-15-11"></a>
<a id="__codelineno-15-12" name="__codelineno-15-12"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-15-13" name="__codelineno-15-13"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="_30">解説</h4>
<ul>
<li><strong>createUser関数</strong>: 新しいユーザーをデータベースに挿入します。</li>
<li><strong>ユーザーオブジェクトの作成</strong>: <code>FirebaseID</code>と<code>IsAdmin</code>を設定して、<code>User</code>オブジェクトを作成。</li>
<li><strong>ユーザーの挿入</strong>: <code>Insert</code>メソッドを呼び出してデータベースに保存します。<code>boil.Infer()</code>を使用して、自動的にカラムを推論します。</li>
</ul>
<h3 id="_31">ユーザーの取得</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-16-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-16-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-16-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-16-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-16-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-16-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-16-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-16-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-16-10">10</a></span>
<span class="normal"><a href="#__codelineno-16-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">getUserByID</span><span class="p">(</span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">userID</span><span class="w"> </span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">User</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="w">    </span><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">FindUser</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span><span class="w"> </span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="nx">userID</span><span class="p">)</span>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Cause</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">ErrNoRows</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;ユーザーが見つかりません&quot;</span><span class="p">)</span>
<a id="__codelineno-16-6" name="__codelineno-16-6"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-16-7" name="__codelineno-16-7"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;ユーザーの検索に失敗しました: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-16-8" name="__codelineno-16-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-16-9" name="__codelineno-16-9"></a>
<a id="__codelineno-16-10" name="__codelineno-16-10"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-16-11" name="__codelineno-16-11"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="_32">解説</h4>
<ul>
<li><strong>getUserByID関数</strong>: <code>user_id</code>を使用してユーザーをデータベースから取得します。</li>
<li><strong>ユーザーの検索</strong>: <code>FindUser</code>関数を使用してユーザーを検索します。</li>
<li><strong>エラーハンドリング</strong>: ユーザーが見つからない場合や、他のエラーが発生した場合に適切にエラーメッセージを返します。</li>
</ul>
<h3 id="_33">ユーザーの更新</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-17-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-17-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-17-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-17-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-17-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-17-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-17-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-17-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-17-10">10</a></span>
<span class="normal"><a href="#__codelineno-17-11">11</a></span>
<span class="normal"><a href="#__codelineno-17-12">12</a></span>
<span class="normal"><a href="#__codelineno-17-13">13</a></span>
<span class="normal"><a href="#__codelineno-17-14">14</a></span>
<span class="normal"><a href="#__codelineno-17-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">updateUserIsAdmin</span><span class="p">(</span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">userID</span><span class="w"> </span><span class="kt">uint</span><span class="p">,</span><span class="w"> </span><span class="nx">isAdmin</span><span class="w"> </span><span class="kt">bool</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="w">    </span><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">getUserByID</span><span class="p">(</span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="nx">userID</span><span class="p">)</span>
<a id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-17-6" name="__codelineno-17-6"></a>
<a id="__codelineno-17-7" name="__codelineno-17-7"></a><span class="w">    </span><span class="nx">user</span><span class="p">.</span><span class="nx">IsAdmin</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">isAdmin</span>
<a id="__codelineno-17-8" name="__codelineno-17-8"></a>
<a id="__codelineno-17-9" name="__codelineno-17-9"></a><span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">Update</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span><span class="w"> </span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">Infer</span><span class="p">())</span>
<a id="__codelineno-17-10" name="__codelineno-17-10"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-11" name="__codelineno-17-11"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;ユーザーの更新に失敗しました: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-17-12" name="__codelineno-17-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-17-13" name="__codelineno-17-13"></a>
<a id="__codelineno-17-14" name="__codelineno-17-14"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-17-15" name="__codelineno-17-15"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="_34">解説</h4>
<ul>
<li><strong>updateUserIsAdmin関数</strong>: 指定したユーザーの<code>IsAdmin</code>フラグを更新します。</li>
<li><strong>ユーザーの取得</strong>: <code>getUserByID</code>関数を使用してユーザーを取得。</li>
<li><strong>フィールドの更新</strong>: <code>IsAdmin</code>フィールドの値を更新。</li>
<li><strong>ユーザーの更新</strong>: <code>Update</code>メソッドを使用して変更をデータベースに保存。</li>
</ul>
<h3 id="_35">ユーザーの削除</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-18-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-18-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-18-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-18-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-18-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-18-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-18-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-18-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-18-10">10</a></span>
<span class="normal"><a href="#__codelineno-18-11">11</a></span>
<span class="normal"><a href="#__codelineno-18-12">12</a></span>
<span class="normal"><a href="#__codelineno-18-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">deleteUser</span><span class="p">(</span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">userID</span><span class="w"> </span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="w">    </span><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">getUserByID</span><span class="p">(</span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="nx">userID</span><span class="p">)</span>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-18-6" name="__codelineno-18-6"></a>
<a id="__codelineno-18-7" name="__codelineno-18-7"></a><span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">Delete</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span><span class="w"> </span><span class="nx">exec</span><span class="p">)</span>
<a id="__codelineno-18-8" name="__codelineno-18-8"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-9" name="__codelineno-18-9"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;ユーザーの削除に失敗しました: %w&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-18-10" name="__codelineno-18-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-18-11" name="__codelineno-18-11"></a>
<a id="__codelineno-18-12" name="__codelineno-18-12"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-18-13" name="__codelineno-18-13"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="_36">解説</h4>
<ul>
<li><strong>deleteUser関数</strong>: 指定したユーザーをデータベースから削除します。</li>
<li><strong>ユーザーの取得</strong>: 削除前にユーザーを取得して存在を確認。</li>
<li><strong>ユーザーの削除</strong>: <code>Delete</code>メソッドを使用してデータベースから削除。</li>
</ul>
<hr />
<h2 id="adduserhook">AddUserHook関数</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-19-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-19-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-19-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-19-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-19-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-19-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-19-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-19-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-19-10">10</a></span>
<span class="normal"><a href="#__codelineno-19-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="c1">// AddUserHookは、すべての将来の操作に対してフック関数を登録します。</span>
<a id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="kd">func</span><span class="w"> </span><span class="nx">AddUserHook</span><span class="p">(</span><span class="nx">hookPoint</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">HookPoint</span><span class="p">,</span><span class="w"> </span><span class="nx">userHook</span><span class="w"> </span><span class="nx">UserHook</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="nx">hookPoint</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-4" name="__codelineno-19-4"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">AfterSelectHook</span><span class="p">:</span>
<a id="__codelineno-19-5" name="__codelineno-19-5"></a><span class="w">        </span><span class="nx">userAfterSelectMu</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
<a id="__codelineno-19-6" name="__codelineno-19-6"></a><span class="w">        </span><span class="nx">userAfterSelectHooks</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">userAfterSelectHooks</span><span class="p">,</span><span class="w"> </span><span class="nx">userHook</span><span class="p">)</span>
<a id="__codelineno-19-7" name="__codelineno-19-7"></a><span class="w">        </span><span class="nx">userAfterSelectMu</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>
<a id="__codelineno-19-8" name="__codelineno-19-8"></a><span class="w">    </span><span class="c1">// 他のフックポイントの場合も同様</span>
<a id="__codelineno-19-9" name="__codelineno-19-9"></a><span class="w">    </span><span class="c1">// ...</span>
<a id="__codelineno-19-10" name="__codelineno-19-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-19-11" name="__codelineno-19-11"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_37">説明</h3>
<p><code>AddUserHook</code>関数は、特定のタイミング（フックポイント）で呼び出されるユーザー定義のフック関数を登録します。登録されたフックは、データベース操作時に自動的に呼び出されます。</p>
<h3 id="_38">フックポイント一覧</h3>
<ul>
<li><code>boil.AfterSelectHook</code>: データベースからのSELECT後</li>
<li><code>boil.BeforeInsertHook</code>: データベースへのINSERT前</li>
<li><code>boil.AfterInsertHook</code>: データベースへのINSERT後</li>
<li><code>boil.BeforeUpdateHook</code>: データベースのUPDATE前</li>
<li><code>boil.AfterUpdateHook</code>: データベースのUPDATE後</li>
<li><code>boil.BeforeDeleteHook</code>: データベースのDELETE前</li>
<li><code>boil.AfterDeleteHook</code>: データベースのDELETE後</li>
<li><code>boil.BeforeUpsertHook</code>: UPSERT（更新または挿入）前</li>
<li><code>boil.AfterUpsertHook</code>: UPSERT後</li>
</ul>
<h3 id="_39">使用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-20-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-20-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-20-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-20-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-20-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-20-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-20-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-20-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-20-10">10</a></span>
<span class="normal"><a href="#__codelineno-20-11">11</a></span>
<span class="normal"><a href="#__codelineno-20-12">12</a></span>
<span class="normal"><a href="#__codelineno-20-13">13</a></span>
<span class="normal"><a href="#__codelineno-20-14">14</a></span>
<span class="normal"><a href="#__codelineno-20-15">15</a></span>
<span class="normal"><a href="#__codelineno-20-16">16</a></span>
<span class="normal"><a href="#__codelineno-20-17">17</a></span>
<span class="normal"><a href="#__codelineno-20-18">18</a></span>
<span class="normal"><a href="#__codelineno-20-19">19</a></span>
<span class="normal"><a href="#__codelineno-20-20">20</a></span>
<span class="normal"><a href="#__codelineno-20-21">21</a></span>
<span class="normal"><a href="#__codelineno-20-22">22</a></span>
<span class="normal"><a href="#__codelineno-20-23">23</a></span>
<span class="normal"><a href="#__codelineno-20-24">24</a></span>
<span class="normal"><a href="#__codelineno-20-25">25</a></span>
<span class="normal"><a href="#__codelineno-20-26">26</a></span>
<span class="normal"><a href="#__codelineno-20-27">27</a></span>
<span class="normal"><a href="#__codelineno-20-28">28</a></span>
<span class="normal"><a href="#__codelineno-20-29">29</a></span>
<span class="normal"><a href="#__codelineno-20-30">30</a></span>
<span class="normal"><a href="#__codelineno-20-31">31</a></span>
<span class="normal"><a href="#__codelineno-20-32">32</a></span>
<span class="normal"><a href="#__codelineno-20-33">33</a></span>
<span class="normal"><a href="#__codelineno-20-34">34</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="w">    </span><span class="s">&quot;context&quot;</span>
<a id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-20-4" name="__codelineno-20-4"></a><span class="w">    </span><span class="s">&quot;log&quot;</span>
<a id="__codelineno-20-5" name="__codelineno-20-5"></a>
<a id="__codelineno-20-6" name="__codelineno-20-6"></a><span class="w">    </span><span class="s">&quot;github.com/volatiletech/sqlboiler/v4/boil&quot;</span>
<a id="__codelineno-20-7" name="__codelineno-20-7"></a><span class="p">)</span>
<a id="__codelineno-20-8" name="__codelineno-20-8"></a>
<a id="__codelineno-20-9" name="__codelineno-20-9"></a><span class="c1">// ユーザーのINSERT前に実行されるフック関数を定義</span>
<a id="__codelineno-20-10" name="__codelineno-20-10"></a><span class="kd">func</span><span class="w"> </span><span class="nx">beforeInsertUserHook</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">*</span><span class="nx">User</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-11" name="__codelineno-20-11"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;ユーザーの挿入前処理&quot;</span><span class="p">)</span>
<a id="__codelineno-20-12" name="__codelineno-20-12"></a><span class="w">    </span><span class="c1">// 例えば、挿入前にデータを検証する</span>
<a id="__codelineno-20-13" name="__codelineno-20-13"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">Name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-14" name="__codelineno-20-14"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Errorf</span><span class="p">(</span><span class="s">&quot;ユーザー名が空です&quot;</span><span class="p">)</span>
<a id="__codelineno-20-15" name="__codelineno-20-15"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-20-16" name="__codelineno-20-16"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-20-17" name="__codelineno-20-17"></a><span class="p">}</span>
<a id="__codelineno-20-18" name="__codelineno-20-18"></a>
<a id="__codelineno-20-19" name="__codelineno-20-19"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-20" name="__codelineno-20-20"></a><span class="w">    </span><span class="c1">// フックを登録</span>
<a id="__codelineno-20-21" name="__codelineno-20-21"></a><span class="w">    </span><span class="nx">AddUserHook</span><span class="p">(</span><span class="nx">boil</span><span class="p">.</span><span class="nx">BeforeInsertHook</span><span class="p">,</span><span class="w"> </span><span class="nx">beforeInsertUserHook</span><span class="p">)</span>
<a id="__codelineno-20-22" name="__codelineno-20-22"></a>
<a id="__codelineno-20-23" name="__codelineno-20-23"></a><span class="w">    </span><span class="c1">// ユーザーを新規作成</span>
<a id="__codelineno-20-24" name="__codelineno-20-24"></a><span class="w">    </span><span class="nx">user</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">User</span><span class="p">{</span>
<a id="__codelineno-20-25" name="__codelineno-20-25"></a><span class="w">        </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;山田太郎&quot;</span><span class="p">,</span>
<a id="__codelineno-20-26" name="__codelineno-20-26"></a><span class="w">        </span><span class="c1">// その他のフィールド</span>
<a id="__codelineno-20-27" name="__codelineno-20-27"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-20-28" name="__codelineno-20-28"></a>
<a id="__codelineno-20-29" name="__codelineno-20-29"></a><span class="w">    </span><span class="c1">// データベースに挿入</span>
<a id="__codelineno-20-30" name="__codelineno-20-30"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">Insert</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">(),</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">Infer</span><span class="p">())</span>
<a id="__codelineno-20-31" name="__codelineno-20-31"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-32" name="__codelineno-20-32"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-20-33" name="__codelineno-20-33"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-20-34" name="__codelineno-20-34"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="one">One関数</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-21-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-21-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-21-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-21-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-21-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-21-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-21-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-21-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-21-10">10</a></span>
<span class="normal"><a href="#__codelineno-21-11">11</a></span>
<span class="normal"><a href="#__codelineno-21-12">12</a></span>
<span class="normal"><a href="#__codelineno-21-13">13</a></span>
<span class="normal"><a href="#__codelineno-21-14">14</a></span>
<span class="normal"><a href="#__codelineno-21-15">15</a></span>
<span class="normal"><a href="#__codelineno-21-16">16</a></span>
<span class="normal"><a href="#__codelineno-21-17">17</a></span>
<span class="normal"><a href="#__codelineno-21-18">18</a></span>
<span class="normal"><a href="#__codelineno-21-19">19</a></span>
<span class="normal"><a href="#__codelineno-21-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="c1">// Oneは、クエリから単一のユーザーレコードを返します。</span>
<a id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">q</span><span class="w"> </span><span class="nx">userQuery</span><span class="p">)</span><span class="w"> </span><span class="nx">One</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">User</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="w">    </span><span class="nx">o</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">User</span><span class="p">{}</span>
<a id="__codelineno-21-4" name="__codelineno-21-4"></a>
<a id="__codelineno-21-5" name="__codelineno-21-5"></a><span class="w">    </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetLimit</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-21-6" name="__codelineno-21-6"></a>
<a id="__codelineno-21-7" name="__codelineno-21-7"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">q</span><span class="p">.</span><span class="nx">Bind</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">)</span>
<a id="__codelineno-21-8" name="__codelineno-21-8"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-9" name="__codelineno-21-9"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Is</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">ErrNoRows</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-10" name="__codelineno-21-10"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">ErrNoRows</span>
<a id="__codelineno-21-11" name="__codelineno-21-11"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-21-12" name="__codelineno-21-12"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: usersのOneクエリの実行に失敗しました&quot;</span><span class="p">)</span>
<a id="__codelineno-21-13" name="__codelineno-21-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-14" name="__codelineno-21-14"></a>
<a id="__codelineno-21-15" name="__codelineno-21-15"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">doAfterSelectHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-16" name="__codelineno-21-16"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">o</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-21-17" name="__codelineno-21-17"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-18" name="__codelineno-21-18"></a>
<a id="__codelineno-21-19" name="__codelineno-21-19"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">o</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-21-20" name="__codelineno-21-20"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_40">説明</h3>
<p><code>One</code>関数は、ユーザークエリから単一のレコードを取得します。クエリに一致するレコードがない場合は、<code>sql.ErrNoRows</code>を返します。</p>
<h3 id="_41">使用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-22-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-22-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-22-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-22-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-22-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-22-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-22-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-22-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-22-10">10</a></span>
<span class="normal"><a href="#__codelineno-22-11">11</a></span>
<span class="normal"><a href="#__codelineno-22-12">12</a></span>
<span class="normal"><a href="#__codelineno-22-13">13</a></span>
<span class="normal"><a href="#__codelineno-22-14">14</a></span>
<span class="normal"><a href="#__codelineno-22-15">15</a></span>
<span class="normal"><a href="#__codelineno-22-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="w">    </span><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-22-3" name="__codelineno-22-3"></a>
<a id="__codelineno-22-4" name="__codelineno-22-4"></a><span class="w">    </span><span class="c1">// ユーザーIDが1のユーザーを取得</span>
<a id="__codelineno-22-5" name="__codelineno-22-5"></a><span class="w">    </span><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Users</span><span class="p">(</span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;id=?&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)).</span><span class="nx">One</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-22-6" name="__codelineno-22-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-7" name="__codelineno-22-7"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Is</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">ErrNoRows</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-8" name="__codelineno-22-8"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;ユーザーが見つかりません&quot;</span><span class="p">)</span>
<a id="__codelineno-22-9" name="__codelineno-22-9"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-10" name="__codelineno-22-10"></a><span class="w">            </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-22-11" name="__codelineno-22-11"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-22-12" name="__codelineno-22-12"></a><span class="w">        </span><span class="k">return</span>
<a id="__codelineno-22-13" name="__codelineno-22-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-22-14" name="__codelineno-22-14"></a>
<a id="__codelineno-22-15" name="__codelineno-22-15"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;ユーザー名: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
<a id="__codelineno-22-16" name="__codelineno-22-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="all">All関数</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-23-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-23-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-23-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-23-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-23-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-23-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-23-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-23-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-23-10">10</a></span>
<span class="normal"><a href="#__codelineno-23-11">11</a></span>
<span class="normal"><a href="#__codelineno-23-12">12</a></span>
<span class="normal"><a href="#__codelineno-23-13">13</a></span>
<span class="normal"><a href="#__codelineno-23-14">14</a></span>
<span class="normal"><a href="#__codelineno-23-15">15</a></span>
<span class="normal"><a href="#__codelineno-23-16">16</a></span>
<span class="normal"><a href="#__codelineno-23-17">17</a></span>
<span class="normal"><a href="#__codelineno-23-18">18</a></span>
<span class="normal"><a href="#__codelineno-23-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="c1">// Allは、クエリからすべてのユーザーレコードを返します。</span>
<a id="__codelineno-23-2" name="__codelineno-23-2"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">q</span><span class="w"> </span><span class="nx">userQuery</span><span class="p">)</span><span class="w"> </span><span class="nx">All</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">UserSlice</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">o</span><span class="w"> </span><span class="p">[]</span><span class="o">*</span><span class="nx">User</span>
<a id="__codelineno-23-4" name="__codelineno-23-4"></a>
<a id="__codelineno-23-5" name="__codelineno-23-5"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">q</span><span class="p">.</span><span class="nx">Bind</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">o</span><span class="p">)</span>
<a id="__codelineno-23-6" name="__codelineno-23-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-7" name="__codelineno-23-7"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: Userスライスへのすべてのクエリ結果の割り当てに失敗しました&quot;</span><span class="p">)</span>
<a id="__codelineno-23-8" name="__codelineno-23-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-23-9" name="__codelineno-23-9"></a>
<a id="__codelineno-23-10" name="__codelineno-23-10"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">userAfterSelectHooks</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-11" name="__codelineno-23-11"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">o</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-12" name="__codelineno-23-12"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">obj</span><span class="p">.</span><span class="nx">doAfterSelectHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-13" name="__codelineno-23-13"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nx">o</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-23-14" name="__codelineno-23-14"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-23-15" name="__codelineno-23-15"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-23-16" name="__codelineno-23-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-23-17" name="__codelineno-23-17"></a>
<a id="__codelineno-23-18" name="__codelineno-23-18"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">o</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-23-19" name="__codelineno-23-19"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_42">説明</h3>
<p><code>All</code>関数は、クエリに一致するすべてのユーザーレコードを取得します。</p>
<h3 id="_43">使用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-24-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-24-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-24-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-24-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-24-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-24-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-24-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-24-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-24-10">10</a></span>
<span class="normal"><a href="#__codelineno-24-11">11</a></span>
<span class="normal"><a href="#__codelineno-24-12">12</a></span>
<span class="normal"><a href="#__codelineno-24-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-24-2" name="__codelineno-24-2"></a><span class="w">    </span><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-24-3" name="__codelineno-24-3"></a>
<a id="__codelineno-24-4" name="__codelineno-24-4"></a><span class="w">    </span><span class="c1">// 全ユーザーを取得</span>
<a id="__codelineno-24-5" name="__codelineno-24-5"></a><span class="w">    </span><span class="nx">users</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Users</span><span class="p">().</span><span class="nx">All</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-24-6" name="__codelineno-24-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-24-7" name="__codelineno-24-7"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-24-8" name="__codelineno-24-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-24-9" name="__codelineno-24-9"></a>
<a id="__codelineno-24-10" name="__codelineno-24-10"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">users</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-24-11" name="__codelineno-24-11"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;ユーザーID: %d, ユーザー名: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">ID</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
<a id="__codelineno-24-12" name="__codelineno-24-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-24-13" name="__codelineno-24-13"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="count">Count関数</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-25-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-25-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-25-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-25-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-25-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-25-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-25-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-25-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-25-10">10</a></span>
<span class="normal"><a href="#__codelineno-25-11">11</a></span>
<span class="normal"><a href="#__codelineno-25-12">12</a></span>
<span class="normal"><a href="#__codelineno-25-13">13</a></span>
<span class="normal"><a href="#__codelineno-25-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="c1">// Countは、クエリ内のすべてのユーザーレコードの数を返します。</span>
<a id="__codelineno-25-2" name="__codelineno-25-2"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">q</span><span class="w"> </span><span class="nx">userQuery</span><span class="p">)</span><span class="w"> </span><span class="nx">Count</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">int64</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-3" name="__codelineno-25-3"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="kt">int64</span>
<a id="__codelineno-25-4" name="__codelineno-25-4"></a>
<a id="__codelineno-25-5" name="__codelineno-25-5"></a><span class="w">    </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetSelect</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<a id="__codelineno-25-6" name="__codelineno-25-6"></a><span class="w">    </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetCount</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">)</span>
<a id="__codelineno-25-7" name="__codelineno-25-7"></a>
<a id="__codelineno-25-8" name="__codelineno-25-8"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">.</span><span class="nx">QueryRowContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">).</span><span class="nx">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">count</span><span class="p">)</span>
<a id="__codelineno-25-9" name="__codelineno-25-9"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-10" name="__codelineno-25-10"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: users行のカウントに失敗しました&quot;</span><span class="p">)</span>
<a id="__codelineno-25-11" name="__codelineno-25-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-25-12" name="__codelineno-25-12"></a>
<a id="__codelineno-25-13" name="__codelineno-25-13"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">count</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-25-14" name="__codelineno-25-14"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_44">説明</h3>
<p><code>Count</code>関数は、クエリに一致するユーザーレコードの総数を取得します。</p>
<h3 id="_45">使用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-26-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-26-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-26-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-26-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-26-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-26-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-26-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-26-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-26-10">10</a></span>
<span class="normal"><a href="#__codelineno-26-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-26-2" name="__codelineno-26-2"></a><span class="w">    </span><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-26-3" name="__codelineno-26-3"></a>
<a id="__codelineno-26-4" name="__codelineno-26-4"></a><span class="w">    </span><span class="c1">// ユーザー名が&quot;山田太郎&quot;のユーザー数を取得</span>
<a id="__codelineno-26-5" name="__codelineno-26-5"></a><span class="w">    </span><span class="nx">count</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Users</span><span class="p">(</span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;name=?&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;山田太郎&quot;</span><span class="p">)).</span><span class="nx">Count</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-26-6" name="__codelineno-26-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-26-7" name="__codelineno-26-7"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-26-8" name="__codelineno-26-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-26-9" name="__codelineno-26-9"></a>
<a id="__codelineno-26-10" name="__codelineno-26-10"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;該当ユーザー数: %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">count</span><span class="p">)</span>
<a id="__codelineno-26-11" name="__codelineno-26-11"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="exists">Exists関数</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-27-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-27-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-27-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-27-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-27-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-27-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-27-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-27-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-27-10">10</a></span>
<span class="normal"><a href="#__codelineno-27-11">11</a></span>
<span class="normal"><a href="#__codelineno-27-12">12</a></span>
<span class="normal"><a href="#__codelineno-27-13">13</a></span>
<span class="normal"><a href="#__codelineno-27-14">14</a></span>
<span class="normal"><a href="#__codelineno-27-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="c1">// Existsは、テーブル内に行が存在するかをチェックします。</span>
<a id="__codelineno-27-2" name="__codelineno-27-2"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">q</span><span class="w"> </span><span class="nx">userQuery</span><span class="p">)</span><span class="w"> </span><span class="nx">Exists</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-27-3" name="__codelineno-27-3"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="kt">int64</span>
<a id="__codelineno-27-4" name="__codelineno-27-4"></a>
<a id="__codelineno-27-5" name="__codelineno-27-5"></a><span class="w">    </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetSelect</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<a id="__codelineno-27-6" name="__codelineno-27-6"></a><span class="w">    </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetCount</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">)</span>
<a id="__codelineno-27-7" name="__codelineno-27-7"></a><span class="w">    </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetLimit</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-27-8" name="__codelineno-27-8"></a>
<a id="__codelineno-27-9" name="__codelineno-27-9"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">.</span><span class="nx">QueryRowContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">).</span><span class="nx">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">count</span><span class="p">)</span>
<a id="__codelineno-27-10" name="__codelineno-27-10"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-27-11" name="__codelineno-27-11"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: usersの存在確認に失敗しました&quot;</span><span class="p">)</span>
<a id="__codelineno-27-12" name="__codelineno-27-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-27-13" name="__codelineno-27-13"></a>
<a id="__codelineno-27-14" name="__codelineno-27-14"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-27-15" name="__codelineno-27-15"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_46">説明</h3>
<p><code>Exists</code>関数は、クエリに一致するレコードがテーブル内に存在するかどうかを確認します。</p>
<h3 id="_47">使用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-28-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-28-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-28-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-28-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-28-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-28-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-28-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-28-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-28-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-28-10">10</a></span>
<span class="normal"><a href="#__codelineno-28-11">11</a></span>
<span class="normal"><a href="#__codelineno-28-12">12</a></span>
<span class="normal"><a href="#__codelineno-28-13">13</a></span>
<span class="normal"><a href="#__codelineno-28-14">14</a></span>
<span class="normal"><a href="#__codelineno-28-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-28-2" name="__codelineno-28-2"></a><span class="w">    </span><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-28-3" name="__codelineno-28-3"></a>
<a id="__codelineno-28-4" name="__codelineno-28-4"></a><span class="w">    </span><span class="c1">// ユーザー名が&quot;山田太郎&quot;のユーザーが存在するか確認</span>
<a id="__codelineno-28-5" name="__codelineno-28-5"></a><span class="w">    </span><span class="nx">exists</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Users</span><span class="p">(</span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;name=?&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;山田太郎&quot;</span><span class="p">)).</span><span class="nx">Exists</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-28-6" name="__codelineno-28-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-28-7" name="__codelineno-28-7"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-28-8" name="__codelineno-28-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-28-9" name="__codelineno-28-9"></a>
<a id="__codelineno-28-10" name="__codelineno-28-10"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-28-11" name="__codelineno-28-11"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;ユーザーは存在します&quot;</span><span class="p">)</span>
<a id="__codelineno-28-12" name="__codelineno-28-12"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-28-13" name="__codelineno-28-13"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;ユーザーは存在しません&quot;</span><span class="p">)</span>
<a id="__codelineno-28-14" name="__codelineno-28-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-28-15" name="__codelineno-28-15"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="_48">リレーションシップ関数</h2>
<h3 id="point">Point関数</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-29-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-29-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-29-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-29-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-29-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-29-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-29-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-29-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-29-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-29-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="c1">// Pointは外部キーによって指し示されたポイントを返します。</span>
<a id="__codelineno-29-2" name="__codelineno-29-2"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">User</span><span class="p">)</span><span class="w"> </span><span class="nx">Point</span><span class="p">(</span><span class="nx">mods</span><span class="w"> </span><span class="o">...</span><span class="nx">qm</span><span class="p">.</span><span class="nx">QueryMod</span><span class="p">)</span><span class="w"> </span><span class="nx">pointQuery</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-3" name="__codelineno-29-3"></a><span class="w">    </span><span class="nx">queryMods</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="nx">qm</span><span class="p">.</span><span class="nx">QueryMod</span><span class="p">{</span>
<a id="__codelineno-29-4" name="__codelineno-29-4"></a><span class="w">        </span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;`user_id` = ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">UserID</span><span class="p">),</span>
<a id="__codelineno-29-5" name="__codelineno-29-5"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-29-6" name="__codelineno-29-6"></a>
<a id="__codelineno-29-7" name="__codelineno-29-7"></a><span class="w">    </span><span class="nx">queryMods</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">queryMods</span><span class="p">,</span><span class="w"> </span><span class="nx">mods</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-29-8" name="__codelineno-29-8"></a>
<a id="__codelineno-29-9" name="__codelineno-29-9"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">Points</span><span class="p">(</span><span class="nx">queryMods</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-29-10" name="__codelineno-29-10"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="_49">説明</h4>
<p><code>Point</code>関数は、ユーザーに関連付けられた<code>Point</code>レコードを取得するためのクエリを作成します。</p>
<h4 id="_50">使用例</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-30-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-30-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-30-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-30-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-30-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-30-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-30-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-30-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-30-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-30-10">10</a></span>
<span class="normal"><a href="#__codelineno-30-11">11</a></span>
<span class="normal"><a href="#__codelineno-30-12">12</a></span>
<span class="normal"><a href="#__codelineno-30-13">13</a></span>
<span class="normal"><a href="#__codelineno-30-14">14</a></span>
<span class="normal"><a href="#__codelineno-30-15">15</a></span>
<span class="normal"><a href="#__codelineno-30-16">16</a></span>
<span class="normal"><a href="#__codelineno-30-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-30-2" name="__codelineno-30-2"></a><span class="w">    </span><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-30-3" name="__codelineno-30-3"></a>
<a id="__codelineno-30-4" name="__codelineno-30-4"></a><span class="w">    </span><span class="c1">// ユーザーを取得</span>
<a id="__codelineno-30-5" name="__codelineno-30-5"></a><span class="w">    </span><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Users</span><span class="p">(</span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;id=?&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)).</span><span class="nx">One</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-30-6" name="__codelineno-30-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-30-7" name="__codelineno-30-7"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-30-8" name="__codelineno-30-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-30-9" name="__codelineno-30-9"></a>
<a id="__codelineno-30-10" name="__codelineno-30-10"></a><span class="w">    </span><span class="c1">// ユーザーに関連するポイントを取得</span>
<a id="__codelineno-30-11" name="__codelineno-30-11"></a><span class="w">    </span><span class="nx">point</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">Point</span><span class="p">().</span><span class="nx">One</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-30-12" name="__codelineno-30-12"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-30-13" name="__codelineno-30-13"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-30-14" name="__codelineno-30-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-30-15" name="__codelineno-30-15"></a>
<a id="__codelineno-30-16" name="__codelineno-30-16"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;ユーザーのポイント: %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">point</span><span class="p">.</span><span class="nx">Amount</span><span class="p">)</span>
<a id="__codelineno-30-17" name="__codelineno-30-17"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="checkinlogs">CheckinLogs関数</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-31-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-31-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-31-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-31-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-31-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-31-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-31-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-31-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-31-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-31-10">10</a></span>
<span class="normal"><a href="#__codelineno-31-11">11</a></span>
<span class="normal"><a href="#__codelineno-31-12">12</a></span>
<span class="normal"><a href="#__codelineno-31-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="c1">// CheckinLogsは、エグゼキュータでcheckin_logのCheckinLogsをすべて取得します。</span>
<a id="__codelineno-31-2" name="__codelineno-31-2"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">User</span><span class="p">)</span><span class="w"> </span><span class="nx">CheckinLogs</span><span class="p">(</span><span class="nx">mods</span><span class="w"> </span><span class="o">...</span><span class="nx">qm</span><span class="p">.</span><span class="nx">QueryMod</span><span class="p">)</span><span class="w"> </span><span class="nx">checkinLogQuery</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-31-3" name="__codelineno-31-3"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">queryMods</span><span class="w"> </span><span class="p">[]</span><span class="nx">qm</span><span class="p">.</span><span class="nx">QueryMod</span>
<a id="__codelineno-31-4" name="__codelineno-31-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">mods</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-31-5" name="__codelineno-31-5"></a><span class="w">        </span><span class="nx">queryMods</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">queryMods</span><span class="p">,</span><span class="w"> </span><span class="nx">mods</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-31-6" name="__codelineno-31-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-31-7" name="__codelineno-31-7"></a>
<a id="__codelineno-31-8" name="__codelineno-31-8"></a><span class="w">    </span><span class="nx">queryMods</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">queryMods</span><span class="p">,</span>
<a id="__codelineno-31-9" name="__codelineno-31-9"></a><span class="w">        </span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;`checkin_logs`.`user_id`=?&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">UserID</span><span class="p">),</span>
<a id="__codelineno-31-10" name="__codelineno-31-10"></a><span class="w">    </span><span class="p">)</span>
<a id="__codelineno-31-11" name="__codelineno-31-11"></a>
<a id="__codelineno-31-12" name="__codelineno-31-12"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">CheckinLogs</span><span class="p">(</span><span class="nx">queryMods</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-31-13" name="__codelineno-31-13"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="_51">説明</h4>
<p><code>CheckinLogs</code>関数は、ユーザーに関連付けられた<code>CheckinLog</code>レコードを取得するためのクエリを作成します。</p>
<h4 id="_52">使用例</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-32-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-32-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-32-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-32-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-32-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-32-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-32-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-32-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-32-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-32-10">10</a></span>
<span class="normal"><a href="#__codelineno-32-11">11</a></span>
<span class="normal"><a href="#__codelineno-32-12">12</a></span>
<span class="normal"><a href="#__codelineno-32-13">13</a></span>
<span class="normal"><a href="#__codelineno-32-14">14</a></span>
<span class="normal"><a href="#__codelineno-32-15">15</a></span>
<span class="normal"><a href="#__codelineno-32-16">16</a></span>
<span class="normal"><a href="#__codelineno-32-17">17</a></span>
<span class="normal"><a href="#__codelineno-32-18">18</a></span>
<span class="normal"><a href="#__codelineno-32-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-2" name="__codelineno-32-2"></a><span class="w">    </span><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-32-3" name="__codelineno-32-3"></a>
<a id="__codelineno-32-4" name="__codelineno-32-4"></a><span class="w">    </span><span class="c1">// ユーザーを取得</span>
<a id="__codelineno-32-5" name="__codelineno-32-5"></a><span class="w">    </span><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Users</span><span class="p">(</span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;id=?&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)).</span><span class="nx">One</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-32-6" name="__codelineno-32-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-7" name="__codelineno-32-7"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-32-8" name="__codelineno-32-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-32-9" name="__codelineno-32-9"></a>
<a id="__codelineno-32-10" name="__codelineno-32-10"></a><span class="w">    </span><span class="c1">// ユーザーのチェックインログを取得</span>
<a id="__codelineno-32-11" name="__codelineno-32-11"></a><span class="w">    </span><span class="nx">checkinLogs</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">CheckinLogs</span><span class="p">().</span><span class="nx">All</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-32-12" name="__codelineno-32-12"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-13" name="__codelineno-32-13"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-32-14" name="__codelineno-32-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-32-15" name="__codelineno-32-15"></a>
<a id="__codelineno-32-16" name="__codelineno-32-16"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">log</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">checkinLogs</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-17" name="__codelineno-32-17"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;日付: %s, メッセージ: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">log</span><span class="p">.</span><span class="nx">Date</span><span class="p">,</span><span class="w"> </span><span class="nx">log</span><span class="p">.</span><span class="nx">Message</span><span class="p">)</span>
<a id="__codelineno-32-18" name="__codelineno-32-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-32-19" name="__codelineno-32-19"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="pointlogs">PointLogs関数</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-33-1">1</a></span>
<span class="normal"><a href="#__codelineno-33-2">2</a></span>
<span class="normal"><a href="#__codelineno-33-3">3</a></span>
<span class="normal"><a href="#__codelineno-33-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="c1">// PointLogsは、エグゼキュータでpoint_logのPointLogsをすべて取得します。</span>
<a id="__codelineno-33-2" name="__codelineno-33-2"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">User</span><span class="p">)</span><span class="w"> </span><span class="nx">PointLogs</span><span class="p">(</span><span class="nx">mods</span><span class="w"> </span><span class="o">...</span><span class="nx">qm</span><span class="p">.</span><span class="nx">QueryMod</span><span class="p">)</span><span class="w"> </span><span class="nx">pointLogQuery</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-3" name="__codelineno-33-3"></a><span class="w">    </span><span class="c1">// 省略（同様の構造）</span>
<a id="__codelineno-33-4" name="__codelineno-33-4"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="_53">説明</h4>
<p><code>PointLogs</code>関数は、ユーザーに関連付けられた<code>PointLog</code>レコードを取得するためのクエリを作成します。</p>
<h3 id="seichies">Seichies関数</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-34-1">1</a></span>
<span class="normal"><a href="#__codelineno-34-2">2</a></span>
<span class="normal"><a href="#__codelineno-34-3">3</a></span>
<span class="normal"><a href="#__codelineno-34-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1"></a><span class="c1">// Seichiesは、エグゼキュータでseichy&#39;s Seichiesをすべて取得します。</span>
<a id="__codelineno-34-2" name="__codelineno-34-2"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">User</span><span class="p">)</span><span class="w"> </span><span class="nx">Seichies</span><span class="p">(</span><span class="nx">mods</span><span class="w"> </span><span class="o">...</span><span class="nx">qm</span><span class="p">.</span><span class="nx">QueryMod</span><span class="p">)</span><span class="w"> </span><span class="nx">seichyQuery</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-34-3" name="__codelineno-34-3"></a><span class="w">    </span><span class="c1">// 省略（同様の構造）</span>
<a id="__codelineno-34-4" name="__codelineno-34-4"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="_54">説明</h4>
<p><code>Seichies</code>関数は、ユーザーに関連付けられた<code>Seichy</code>レコードを取得するためのクエリを作成します。</p>
<h2 id="loadpoint">LoadPoint関数</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-35-1">1</a></span>
<span class="normal"><a href="#__codelineno-35-2">2</a></span>
<span class="normal"><a href="#__codelineno-35-3">3</a></span>
<span class="normal"><a href="#__codelineno-35-4">4</a></span>
<span class="normal"><a href="#__codelineno-35-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="c1">// LoadPointは、値のイーガーロードを行い、</span>
<a id="__codelineno-35-2" name="__codelineno-35-2"></a><span class="c1">// オブジェクトの読み込まれた構造体にキャッシュします。これは1対1のリレーションです。</span>
<a id="__codelineno-35-3" name="__codelineno-35-3"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">userL</span><span class="p">)</span><span class="w"> </span><span class="nx">LoadPoint</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">singular</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="nx">maybeUser</span><span class="w"> </span><span class="kd">interface</span><span class="p">{},</span><span class="w"> </span><span class="nx">mods</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">Applicator</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-4" name="__codelineno-35-4"></a><span class="w">    </span><span class="c1">// 関数の内容</span>
<a id="__codelineno-35-5" name="__codelineno-35-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_55">説明</h3>
<p><code>LoadPoint</code>関数は、ユーザー構造体に関連する<code>Point</code>データを事前にロード（イーガーロード）し、パフォーマンスを向上させます。これにより、後で関連データをアクセスする際に追加のデータベースクエリを発行する必要がなくなります。</p>
<h3 id="_56">使用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-36-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-36-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-36-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-36-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-36-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-36-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-36-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-36-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-36-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-36-10">10</a></span>
<span class="normal"><a href="#__codelineno-36-11">11</a></span>
<span class="normal"><a href="#__codelineno-36-12">12</a></span>
<span class="normal"><a href="#__codelineno-36-13">13</a></span>
<span class="normal"><a href="#__codelineno-36-14">14</a></span>
<span class="normal"><a href="#__codelineno-36-15">15</a></span>
<span class="normal"><a href="#__codelineno-36-16">16</a></span>
<span class="normal"><a href="#__codelineno-36-17">17</a></span>
<span class="normal"><a href="#__codelineno-36-18">18</a></span>
<span class="normal"><a href="#__codelineno-36-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-2" name="__codelineno-36-2"></a><span class="w">    </span><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-36-3" name="__codelineno-36-3"></a>
<a id="__codelineno-36-4" name="__codelineno-36-4"></a><span class="w">    </span><span class="c1">// ユーザーを取得</span>
<a id="__codelineno-36-5" name="__codelineno-36-5"></a><span class="w">    </span><span class="nx">users</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Users</span><span class="p">().</span><span class="nx">All</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-36-6" name="__codelineno-36-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-7" name="__codelineno-36-7"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-36-8" name="__codelineno-36-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-36-9" name="__codelineno-36-9"></a>
<a id="__codelineno-36-10" name="__codelineno-36-10"></a><span class="w">    </span><span class="c1">// ポイントをイーガーロード</span>
<a id="__codelineno-36-11" name="__codelineno-36-11"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">userL</span><span class="p">.</span><span class="nx">LoadPoint</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nx">users</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-12" name="__codelineno-36-12"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-36-13" name="__codelineno-36-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-36-14" name="__codelineno-36-14"></a>
<a id="__codelineno-36-15" name="__codelineno-36-15"></a><span class="w">    </span><span class="c1">// ポイント情報を表示</span>
<a id="__codelineno-36-16" name="__codelineno-36-16"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">users</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-17" name="__codelineno-36-17"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;ユーザー名: %s, ポイント: %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">Point</span><span class="p">.</span><span class="nx">Amount</span><span class="p">)</span>
<a id="__codelineno-36-18" name="__codelineno-36-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-36-19" name="__codelineno-36-19"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="_57">注意点</h2>
<ul>
<li><strong>コンテキストの使用</strong>: データベース操作には<code>context.Context</code>を使用しており、キャンセルやタイムアウトを制御できます。</li>
<li><strong>エラー処理</strong>: エラーは適切にハンドリングし、必要に応じてログ出力やユーザーへの通知を行ってください。</li>
<li><strong>並行処理</strong>: フックの登録やデータのロードでは、並行処理に対応するためにミューテックスが使用されています。</li>
</ul>
<hr />
<h2 id="loadcheckinlogsloadpointlogs">LoadCheckinLogsおよびLoadPointLogs関数の詳解と使用例</h2>
<p>このセクションでは、ユーザーモデルに関連するイーガーローディング関数である<code>LoadCheckinLogs</code>と<code>LoadPointLogs</code>について詳しく説明します。これらの関数は、一対多（1-M）や多対多（N-M）のリレーションシップにおいて関連データを効率的にロードする際に役立ちます。</p>
<p>これらの関数を使用すると、データベースへのクエリ数を減らし、パフォーマンスの向上に繋がります。</p>
<h2 id="loadcheckinlogs">LoadCheckinLogs関数</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-37-1">  1</a></span>
<span class="normal"><a href="#__codelineno-37-2">  2</a></span>
<span class="normal"><a href="#__codelineno-37-3">  3</a></span>
<span class="normal"><a href="#__codelineno-37-4">  4</a></span>
<span class="normal"><a href="#__codelineno-37-5">  5</a></span>
<span class="normal"><a href="#__codelineno-37-6">  6</a></span>
<span class="normal"><a href="#__codelineno-37-7">  7</a></span>
<span class="normal"><a href="#__codelineno-37-8">  8</a></span>
<span class="normal"><a href="#__codelineno-37-9">  9</a></span>
<span class="normal"><a href="#__codelineno-37-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-37-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-37-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-37-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-37-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-37-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-37-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-37-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-37-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-37-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-37-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-37-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-37-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-37-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-37-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-37-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-37-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-37-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-37-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-37-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-37-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-37-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-37-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-37-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-37-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-37-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-37-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-37-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-37-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-37-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-37-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-37-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-37-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-37-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-37-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-37-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-37-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-37-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-37-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-37-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-37-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-37-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-37-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-37-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-37-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-37-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-37-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-37-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-37-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-37-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-37-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-37-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-37-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-37-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-37-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-37-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-37-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-37-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-37-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-37-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-37-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-37-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-37-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-37-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-37-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-37-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-37-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-37-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-37-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-37-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-37-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-37-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-37-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-37-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-37-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-37-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-37-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-37-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-37-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-37-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-37-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-37-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-37-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-37-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-37-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-37-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-37-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-37-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-37-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-37-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-37-100">100</a></span>
<span class="normal"><a href="#__codelineno-37-101">101</a></span>
<span class="normal"><a href="#__codelineno-37-102">102</a></span>
<span class="normal"><a href="#__codelineno-37-103">103</a></span>
<span class="normal"><a href="#__codelineno-37-104">104</a></span>
<span class="normal"><a href="#__codelineno-37-105">105</a></span>
<span class="normal"><a href="#__codelineno-37-106">106</a></span>
<span class="normal"><a href="#__codelineno-37-107">107</a></span>
<span class="normal"><a href="#__codelineno-37-108">108</a></span>
<span class="normal"><a href="#__codelineno-37-109">109</a></span>
<span class="normal"><a href="#__codelineno-37-110">110</a></span>
<span class="normal"><a href="#__codelineno-37-111">111</a></span>
<span class="normal"><a href="#__codelineno-37-112">112</a></span>
<span class="normal"><a href="#__codelineno-37-113">113</a></span>
<span class="normal"><a href="#__codelineno-37-114">114</a></span>
<span class="normal"><a href="#__codelineno-37-115">115</a></span>
<span class="normal"><a href="#__codelineno-37-116">116</a></span>
<span class="normal"><a href="#__codelineno-37-117">117</a></span>
<span class="normal"><a href="#__codelineno-37-118">118</a></span>
<span class="normal"><a href="#__codelineno-37-119">119</a></span>
<span class="normal"><a href="#__codelineno-37-120">120</a></span>
<span class="normal"><a href="#__codelineno-37-121">121</a></span>
<span class="normal"><a href="#__codelineno-37-122">122</a></span>
<span class="normal"><a href="#__codelineno-37-123">123</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1"></a><span class="c1">// LoadCheckinLogsは、値のイーガーロードを行い、</span>
<a id="__codelineno-37-2" name="__codelineno-37-2"></a><span class="c1">// オブジェクトの読み込まれた構造体にキャッシュします。</span>
<a id="__codelineno-37-3" name="__codelineno-37-3"></a><span class="c1">// これは1-MやN-Mのリレーションシップの場合に使用します。</span>
<a id="__codelineno-37-4" name="__codelineno-37-4"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">userL</span><span class="p">)</span><span class="w"> </span><span class="nx">LoadCheckinLogs</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">singular</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="nx">maybeUser</span><span class="w"> </span><span class="kd">interface</span><span class="p">{},</span><span class="w"> </span><span class="nx">mods</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">Applicator</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-5" name="__codelineno-37-5"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">slice</span><span class="w"> </span><span class="p">[]</span><span class="o">*</span><span class="nx">User</span>
<a id="__codelineno-37-6" name="__codelineno-37-6"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">object</span><span class="w"> </span><span class="o">*</span><span class="nx">User</span>
<a id="__codelineno-37-7" name="__codelineno-37-7"></a>
<a id="__codelineno-37-8" name="__codelineno-37-8"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">singular</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-9" name="__codelineno-37-9"></a><span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="kt">bool</span>
<a id="__codelineno-37-10" name="__codelineno-37-10"></a><span class="w">        </span><span class="nx">object</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">maybeUser</span><span class="p">.(</span><span class="o">*</span><span class="nx">User</span><span class="p">)</span>
<a id="__codelineno-37-11" name="__codelineno-37-11"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-12" name="__codelineno-37-12"></a><span class="w">            </span><span class="nx">object</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">new</span><span class="p">(</span><span class="nx">User</span><span class="p">)</span>
<a id="__codelineno-37-13" name="__codelineno-37-13"></a><span class="w">            </span><span class="nx">ok</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetFromEmbeddedStruct</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">object</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">maybeUser</span><span class="p">)</span>
<a id="__codelineno-37-14" name="__codelineno-37-14"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-15" name="__codelineno-37-15"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;埋め込み構造体%Tから%Tへの設定に失敗しました&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">object</span><span class="p">,</span><span class="w"> </span><span class="nx">maybeUser</span><span class="p">))</span>
<a id="__codelineno-37-16" name="__codelineno-37-16"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-37-17" name="__codelineno-37-17"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-37-18" name="__codelineno-37-18"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-19" name="__codelineno-37-19"></a><span class="w">        </span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">maybeUser</span><span class="p">.(</span><span class="o">*</span><span class="p">[]</span><span class="o">*</span><span class="nx">User</span><span class="p">)</span>
<a id="__codelineno-37-20" name="__codelineno-37-20"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-21" name="__codelineno-37-21"></a><span class="w">            </span><span class="nx">slice</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">*</span><span class="nx">s</span>
<a id="__codelineno-37-22" name="__codelineno-37-22"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-23" name="__codelineno-37-23"></a><span class="w">            </span><span class="nx">ok</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetFromEmbeddedStruct</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">slice</span><span class="p">,</span><span class="w"> </span><span class="nx">maybeUser</span><span class="p">)</span>
<a id="__codelineno-37-24" name="__codelineno-37-24"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-25" name="__codelineno-37-25"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;埋め込み構造体%Tから%Tへの設定に失敗しました&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">slice</span><span class="p">,</span><span class="w"> </span><span class="nx">maybeUser</span><span class="p">))</span>
<a id="__codelineno-37-26" name="__codelineno-37-26"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-37-27" name="__codelineno-37-27"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-37-28" name="__codelineno-37-28"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-37-29" name="__codelineno-37-29"></a>
<a id="__codelineno-37-30" name="__codelineno-37-30"></a><span class="w">    </span><span class="c1">// ユーザーIDのマップを作成</span>
<a id="__codelineno-37-31" name="__codelineno-37-31"></a><span class="w">    </span><span class="nx">args</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kd">interface</span><span class="p">{}]</span><span class="kd">struct</span><span class="p">{})</span>
<a id="__codelineno-37-32" name="__codelineno-37-32"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">singular</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-33" name="__codelineno-37-33"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">object</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-34" name="__codelineno-37-34"></a><span class="w">            </span><span class="nx">object</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">userR</span><span class="p">{}</span>
<a id="__codelineno-37-35" name="__codelineno-37-35"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-37-36" name="__codelineno-37-36"></a><span class="w">        </span><span class="nx">args</span><span class="p">[</span><span class="nx">object</span><span class="p">.</span><span class="nx">UserID</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}{}</span>
<a id="__codelineno-37-37" name="__codelineno-37-37"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-38" name="__codelineno-37-38"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">slice</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-39" name="__codelineno-37-39"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">obj</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-40" name="__codelineno-37-40"></a><span class="w">                </span><span class="nx">obj</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">userR</span><span class="p">{}</span>
<a id="__codelineno-37-41" name="__codelineno-37-41"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-37-42" name="__codelineno-37-42"></a><span class="w">            </span><span class="nx">args</span><span class="p">[</span><span class="nx">obj</span><span class="p">.</span><span class="nx">UserID</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}{}</span>
<a id="__codelineno-37-43" name="__codelineno-37-43"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-37-44" name="__codelineno-37-44"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-37-45" name="__codelineno-37-45"></a>
<a id="__codelineno-37-46" name="__codelineno-37-46"></a><span class="w">    </span><span class="c1">// ロードすべきユーザーが存在しない場合は終了</span>
<a id="__codelineno-37-47" name="__codelineno-37-47"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-48" name="__codelineno-37-48"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-37-49" name="__codelineno-37-49"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-37-50" name="__codelineno-37-50"></a>
<a id="__codelineno-37-51" name="__codelineno-37-51"></a><span class="w">    </span><span class="c1">// ユーザーIDをスライスに変換</span>
<a id="__codelineno-37-52" name="__codelineno-37-52"></a><span class="w">    </span><span class="nx">argsSlice</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kd">interface</span><span class="p">{},</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">args</span><span class="p">))</span>
<a id="__codelineno-37-53" name="__codelineno-37-53"></a><span class="w">    </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span>
<a id="__codelineno-37-54" name="__codelineno-37-54"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">arg</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">args</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-55" name="__codelineno-37-55"></a><span class="w">        </span><span class="nx">argsSlice</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">arg</span>
<a id="__codelineno-37-56" name="__codelineno-37-56"></a><span class="w">        </span><span class="nx">i</span><span class="o">++</span>
<a id="__codelineno-37-57" name="__codelineno-37-57"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-37-58" name="__codelineno-37-58"></a>
<a id="__codelineno-37-59" name="__codelineno-37-59"></a><span class="w">    </span><span class="c1">// クエリを作成</span>
<a id="__codelineno-37-60" name="__codelineno-37-60"></a><span class="w">    </span><span class="nx">query</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">NewQuery</span><span class="p">(</span>
<a id="__codelineno-37-61" name="__codelineno-37-61"></a><span class="w">        </span><span class="nx">qm</span><span class="p">.</span><span class="nx">From</span><span class="p">(</span><span class="s">`checkin_logs`</span><span class="p">),</span>
<a id="__codelineno-37-62" name="__codelineno-37-62"></a><span class="w">        </span><span class="nx">qm</span><span class="p">.</span><span class="nx">WhereIn</span><span class="p">(</span><span class="s">`checkin_logs.user_id in ?`</span><span class="p">,</span><span class="w"> </span><span class="nx">argsSlice</span><span class="o">...</span><span class="p">),</span>
<a id="__codelineno-37-63" name="__codelineno-37-63"></a><span class="w">    </span><span class="p">)</span>
<a id="__codelineno-37-64" name="__codelineno-37-64"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">mods</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-65" name="__codelineno-37-65"></a><span class="w">        </span><span class="nx">mods</span><span class="p">.</span><span class="nx">Apply</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span>
<a id="__codelineno-37-66" name="__codelineno-37-66"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-37-67" name="__codelineno-37-67"></a>
<a id="__codelineno-37-68" name="__codelineno-37-68"></a><span class="w">    </span><span class="c1">// クエリを実行し結果を取得</span>
<a id="__codelineno-37-69" name="__codelineno-37-69"></a><span class="w">    </span><span class="nx">results</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">query</span><span class="p">.</span><span class="nx">QueryContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="p">)</span>
<a id="__codelineno-37-70" name="__codelineno-37-70"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-71" name="__codelineno-37-71"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;checkin_logsのイーガーロードに失敗しました&quot;</span><span class="p">)</span>
<a id="__codelineno-37-72" name="__codelineno-37-72"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-37-73" name="__codelineno-37-73"></a>
<a id="__codelineno-37-74" name="__codelineno-37-74"></a><span class="w">    </span><span class="c1">// 結果をバインド</span>
<a id="__codelineno-37-75" name="__codelineno-37-75"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">resultSlice</span><span class="w"> </span><span class="p">[]</span><span class="o">*</span><span class="nx">CheckinLog</span>
<a id="__codelineno-37-76" name="__codelineno-37-76"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">Bind</span><span class="p">(</span><span class="nx">results</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">resultSlice</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-77" name="__codelineno-37-77"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;イーガーロードされたcheckin_logsのスライスへのバインドに失敗しました&quot;</span><span class="p">)</span>
<a id="__codelineno-37-78" name="__codelineno-37-78"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-37-79" name="__codelineno-37-79"></a>
<a id="__codelineno-37-80" name="__codelineno-37-80"></a><span class="w">    </span><span class="c1">// クローズ処理</span>
<a id="__codelineno-37-81" name="__codelineno-37-81"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">results</span><span class="p">.</span><span class="nx">Close</span><span class="p">();</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-82" name="__codelineno-37-82"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;checkin_logsのイーガーロード中の結果のクローズに失敗しました&quot;</span><span class="p">)</span>
<a id="__codelineno-37-83" name="__codelineno-37-83"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-37-84" name="__codelineno-37-84"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">results</span><span class="p">.</span><span class="nx">Err</span><span class="p">();</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-85" name="__codelineno-37-85"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;checkin_logsのイーガーロード中にエラーが発生しました&quot;</span><span class="p">)</span>
<a id="__codelineno-37-86" name="__codelineno-37-86"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-37-87" name="__codelineno-37-87"></a>
<a id="__codelineno-37-88" name="__codelineno-37-88"></a><span class="w">    </span><span class="c1">// フックの処理</span>
<a id="__codelineno-37-89" name="__codelineno-37-89"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">checkinLogAfterSelectHooks</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-90" name="__codelineno-37-90"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">resultSlice</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-91" name="__codelineno-37-91"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">obj</span><span class="p">.</span><span class="nx">doAfterSelectHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-92" name="__codelineno-37-92"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-37-93" name="__codelineno-37-93"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-37-94" name="__codelineno-37-94"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-37-95" name="__codelineno-37-95"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-37-96" name="__codelineno-37-96"></a>
<a id="__codelineno-37-97" name="__codelineno-37-97"></a><span class="w">    </span><span class="c1">// 結果をユーザーオブジェクトに関連付ける</span>
<a id="__codelineno-37-98" name="__codelineno-37-98"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">singular</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-99" name="__codelineno-37-99"></a><span class="w">        </span><span class="nx">object</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">CheckinLogs</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">resultSlice</span>
<a id="__codelineno-37-100" name="__codelineno-37-100"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">foreign</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">resultSlice</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-101" name="__codelineno-37-101"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">foreign</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-102" name="__codelineno-37-102"></a><span class="w">                </span><span class="nx">foreign</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">checkinLogR</span><span class="p">{}</span>
<a id="__codelineno-37-103" name="__codelineno-37-103"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-37-104" name="__codelineno-37-104"></a><span class="w">            </span><span class="nx">foreign</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">User</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">object</span>
<a id="__codelineno-37-105" name="__codelineno-37-105"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-37-106" name="__codelineno-37-106"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-37-107" name="__codelineno-37-107"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-37-108" name="__codelineno-37-108"></a>
<a id="__codelineno-37-109" name="__codelineno-37-109"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">foreign</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">resultSlice</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-110" name="__codelineno-37-110"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">local</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">slice</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-111" name="__codelineno-37-111"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">local</span><span class="p">.</span><span class="nx">UserID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">foreign</span><span class="p">.</span><span class="nx">UserID</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-112" name="__codelineno-37-112"></a><span class="w">                </span><span class="nx">local</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">CheckinLogs</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">local</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">CheckinLogs</span><span class="p">,</span><span class="w"> </span><span class="nx">foreign</span><span class="p">)</span>
<a id="__codelineno-37-113" name="__codelineno-37-113"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="nx">foreign</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-114" name="__codelineno-37-114"></a><span class="w">                    </span><span class="nx">foreign</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">checkinLogR</span><span class="p">{}</span>
<a id="__codelineno-37-115" name="__codelineno-37-115"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-37-116" name="__codelineno-37-116"></a><span class="w">                </span><span class="nx">foreign</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">User</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">local</span>
<a id="__codelineno-37-117" name="__codelineno-37-117"></a><span class="w">                </span><span class="k">break</span>
<a id="__codelineno-37-118" name="__codelineno-37-118"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-37-119" name="__codelineno-37-119"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-37-120" name="__codelineno-37-120"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-37-121" name="__codelineno-37-121"></a>
<a id="__codelineno-37-122" name="__codelineno-37-122"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-37-123" name="__codelineno-37-123"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_58">説明</h3>
<p><code>LoadCheckinLogs</code>関数は、ユーザーに関連する<code>CheckinLog</code>（チェックインログ）をイーガーロードするための関数です。これにより、ユーザーオブジェクトを取得すると同時に、そのユーザーに関連するチェックインログを一度のデータベースクエリで取得できます。</p>
<h4 id="_59">関数の引数</h4>
<ul>
<li><code>ctx context.Context</code>: コンテキストオブジェクト。</li>
<li><code>e boil.ContextExecutor</code>: データベースのエグゼキュータ。</li>
<li><code>singular bool</code>: <code>true</code>の場合単一のユーザー、<code>false</code>の場合複数のユーザー。</li>
<li><code>maybeUser interface{}</code>: ユーザーオブジェクトまたはユーザーオブジェクトのスライス。</li>
<li><code>mods queries.Applicator</code>: クエリモディファイア（クエリを修正するためのもの）。</li>
</ul>
<h4 id="_60">関数の流れ</h4>
<ol>
<li><strong>ユーザーオブジェクトの型判定と取得</strong>:</li>
<li><code>singular</code>の値に応じて、<code>maybeUser</code>から単一のユーザーオブジェクトまたはユーザーオブジェクトのスライスを取得します。</li>
<li>
<p>型アサーションを使用して正しい型を取得できない場合は、エラーメッセージを返します。</p>
</li>
<li>
<p><strong>ユーザーIDの収集</strong>:</p>
</li>
<li>
<p>ロードするべきユーザーのIDを<code>args</code>マップに収集します。</p>
</li>
<li>
<p><strong>ユーザーIDのスライス化</strong>:</p>
</li>
<li>
<p>クエリで使用するために、ユーザーIDをスライスに変換します。</p>
</li>
<li>
<p><strong>クエリの作成と実行</strong>:</p>
</li>
<li><code>checkin_logs</code>テーブルから、<code>user_id</code>が収集したユーザーIDに含まれるものを選択するクエリを作成します。</li>
<li><code>mods</code>が指定されている場合、クエリに適用します。</li>
<li>
<p>クエリを実行して結果を取得します。</p>
</li>
<li>
<p><strong>結果のバインド</strong>:</p>
</li>
<li>
<p>結果を<code>CheckinLog</code>型のスライスにバインドします。</p>
</li>
<li>
<p><strong>クリーンアップとエラーチェック</strong>:</p>
</li>
<li>
<p>結果のクローズ処理とエラーチェックを行います。</p>
</li>
<li>
<p><strong>フックの実行</strong>:</p>
</li>
<li>
<p><code>checkinLogAfterSelectHooks</code>が存在する場合、各<code>CheckinLog</code>オブジェクトに対してフックを実行します。</p>
</li>
<li>
<p><strong>結果の関連付け</strong>:</p>
</li>
<li>単一のユーザーの場合は、そのユーザーの<code>R.CheckinLogs</code>フィールドに結果のスライスを設定します。</li>
<li>複数のユーザーの場合は、各<code>CheckinLog</code>の<code>UserID</code>を参照して、対応するユーザーの<code>R.CheckinLogs</code>に追加します。</li>
<li>逆リレーションシップ（<code>CheckinLog</code>から<code>User</code>への参照）も設定します。</li>
</ol>
<h3 id="_61">使用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-38-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-38-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-38-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-38-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-38-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-38-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-38-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-38-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-38-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-38-10">10</a></span>
<span class="normal"><a href="#__codelineno-38-11">11</a></span>
<span class="normal"><a href="#__codelineno-38-12">12</a></span>
<span class="normal"><a href="#__codelineno-38-13">13</a></span>
<span class="normal"><a href="#__codelineno-38-14">14</a></span>
<span class="normal"><a href="#__codelineno-38-15">15</a></span>
<span class="normal"><a href="#__codelineno-38-16">16</a></span>
<span class="normal"><a href="#__codelineno-38-17">17</a></span>
<span class="normal"><a href="#__codelineno-38-18">18</a></span>
<span class="normal"><a href="#__codelineno-38-19">19</a></span>
<span class="normal"><a href="#__codelineno-38-20">20</a></span>
<span class="normal"><a href="#__codelineno-38-21">21</a></span>
<span class="normal"><a href="#__codelineno-38-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-38-2" name="__codelineno-38-2"></a><span class="w">    </span><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-38-3" name="__codelineno-38-3"></a>
<a id="__codelineno-38-4" name="__codelineno-38-4"></a><span class="w">    </span><span class="c1">// 複数のユーザーを取得</span>
<a id="__codelineno-38-5" name="__codelineno-38-5"></a><span class="w">    </span><span class="nx">users</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Users</span><span class="p">().</span><span class="nx">All</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-38-6" name="__codelineno-38-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-38-7" name="__codelineno-38-7"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-38-8" name="__codelineno-38-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-38-9" name="__codelineno-38-9"></a>
<a id="__codelineno-38-10" name="__codelineno-38-10"></a><span class="w">    </span><span class="c1">// ユーザーのチェックインログをイーガーロード</span>
<a id="__codelineno-38-11" name="__codelineno-38-11"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">userL</span><span class="p">.</span><span class="nx">LoadCheckinLogs</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nx">users</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-38-12" name="__codelineno-38-12"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-38-13" name="__codelineno-38-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-38-14" name="__codelineno-38-14"></a>
<a id="__codelineno-38-15" name="__codelineno-38-15"></a><span class="w">    </span><span class="c1">// チェックインログを表示</span>
<a id="__codelineno-38-16" name="__codelineno-38-16"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">users</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-38-17" name="__codelineno-38-17"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;ユーザー名: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
<a id="__codelineno-38-18" name="__codelineno-38-18"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">log</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">CheckinLogs</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-38-19" name="__codelineno-38-19"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;  チェックイン日: %s, メッセージ: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">log</span><span class="p">.</span><span class="nx">Date</span><span class="p">,</span><span class="w"> </span><span class="nx">log</span><span class="p">.</span><span class="nx">Message</span><span class="p">)</span>
<a id="__codelineno-38-20" name="__codelineno-38-20"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-38-21" name="__codelineno-38-21"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-38-22" name="__codelineno-38-22"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="_62">説明</h4>
<p>上記の例では、すべてのユーザーを取得し、そのユーザーに関連するチェックインログをイーガーロードしています。<code>user.R.CheckinLogs</code>を通じて、各ユーザーのチェックインログにアクセスできます。</p>
<h2 id="loadpointlogs">LoadPointLogs関数</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-39-1">  1</a></span>
<span class="normal"><a href="#__codelineno-39-2">  2</a></span>
<span class="normal"><a href="#__codelineno-39-3">  3</a></span>
<span class="normal"><a href="#__codelineno-39-4">  4</a></span>
<span class="normal"><a href="#__codelineno-39-5">  5</a></span>
<span class="normal"><a href="#__codelineno-39-6">  6</a></span>
<span class="normal"><a href="#__codelineno-39-7">  7</a></span>
<span class="normal"><a href="#__codelineno-39-8">  8</a></span>
<span class="normal"><a href="#__codelineno-39-9">  9</a></span>
<span class="normal"><a href="#__codelineno-39-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-39-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-39-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-39-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-39-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-39-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-39-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-39-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-39-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-39-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-39-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-39-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-39-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-39-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-39-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-39-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-39-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-39-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-39-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-39-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-39-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-39-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-39-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-39-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-39-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-39-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-39-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-39-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-39-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-39-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-39-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-39-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-39-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-39-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-39-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-39-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-39-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-39-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-39-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-39-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-39-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-39-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-39-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-39-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-39-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-39-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-39-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-39-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-39-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-39-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-39-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-39-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-39-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-39-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-39-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-39-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-39-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-39-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-39-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-39-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-39-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-39-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-39-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-39-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-39-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-39-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-39-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-39-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-39-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-39-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-39-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-39-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-39-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-39-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-39-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-39-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-39-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-39-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-39-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-39-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-39-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-39-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-39-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-39-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-39-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-39-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-39-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-39-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-39-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-39-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-39-100">100</a></span>
<span class="normal"><a href="#__codelineno-39-101">101</a></span>
<span class="normal"><a href="#__codelineno-39-102">102</a></span>
<span class="normal"><a href="#__codelineno-39-103">103</a></span>
<span class="normal"><a href="#__codelineno-39-104">104</a></span>
<span class="normal"><a href="#__codelineno-39-105">105</a></span>
<span class="normal"><a href="#__codelineno-39-106">106</a></span>
<span class="normal"><a href="#__codelineno-39-107">107</a></span>
<span class="normal"><a href="#__codelineno-39-108">108</a></span>
<span class="normal"><a href="#__codelineno-39-109">109</a></span>
<span class="normal"><a href="#__codelineno-39-110">110</a></span>
<span class="normal"><a href="#__codelineno-39-111">111</a></span>
<span class="normal"><a href="#__codelineno-39-112">112</a></span>
<span class="normal"><a href="#__codelineno-39-113">113</a></span>
<span class="normal"><a href="#__codelineno-39-114">114</a></span>
<span class="normal"><a href="#__codelineno-39-115">115</a></span>
<span class="normal"><a href="#__codelineno-39-116">116</a></span>
<span class="normal"><a href="#__codelineno-39-117">117</a></span>
<span class="normal"><a href="#__codelineno-39-118">118</a></span>
<span class="normal"><a href="#__codelineno-39-119">119</a></span>
<span class="normal"><a href="#__codelineno-39-120">120</a></span>
<span class="normal"><a href="#__codelineno-39-121">121</a></span>
<span class="normal"><a href="#__codelineno-39-122">122</a></span>
<span class="normal"><a href="#__codelineno-39-123">123</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1"></a><span class="c1">// LoadPointLogsは、値のイーガーロードを行い、</span>
<a id="__codelineno-39-2" name="__codelineno-39-2"></a><span class="c1">// オブジェクトの読み込まれた構造体にキャッシュします。</span>
<a id="__codelineno-39-3" name="__codelineno-39-3"></a><span class="c1">// これは1-MやN-Mのリレーションシップの場合に使用します。</span>
<a id="__codelineno-39-4" name="__codelineno-39-4"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">userL</span><span class="p">)</span><span class="w"> </span><span class="nx">LoadPointLogs</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">singular</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="nx">maybeUser</span><span class="w"> </span><span class="kd">interface</span><span class="p">{},</span><span class="w"> </span><span class="nx">mods</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">Applicator</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-5" name="__codelineno-39-5"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">slice</span><span class="w"> </span><span class="p">[]</span><span class="o">*</span><span class="nx">User</span>
<a id="__codelineno-39-6" name="__codelineno-39-6"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">object</span><span class="w"> </span><span class="o">*</span><span class="nx">User</span>
<a id="__codelineno-39-7" name="__codelineno-39-7"></a>
<a id="__codelineno-39-8" name="__codelineno-39-8"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">singular</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-9" name="__codelineno-39-9"></a><span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="kt">bool</span>
<a id="__codelineno-39-10" name="__codelineno-39-10"></a><span class="w">        </span><span class="nx">object</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">maybeUser</span><span class="p">.(</span><span class="o">*</span><span class="nx">User</span><span class="p">)</span>
<a id="__codelineno-39-11" name="__codelineno-39-11"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-12" name="__codelineno-39-12"></a><span class="w">            </span><span class="nx">object</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">new</span><span class="p">(</span><span class="nx">User</span><span class="p">)</span>
<a id="__codelineno-39-13" name="__codelineno-39-13"></a><span class="w">            </span><span class="nx">ok</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetFromEmbeddedStruct</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">object</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">maybeUser</span><span class="p">)</span>
<a id="__codelineno-39-14" name="__codelineno-39-14"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-15" name="__codelineno-39-15"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;埋め込み構造体%Tから%Tへの設定に失敗しました&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">object</span><span class="p">,</span><span class="w"> </span><span class="nx">maybeUser</span><span class="p">))</span>
<a id="__codelineno-39-16" name="__codelineno-39-16"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-39-17" name="__codelineno-39-17"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-39-18" name="__codelineno-39-18"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-19" name="__codelineno-39-19"></a><span class="w">        </span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">maybeUser</span><span class="p">.(</span><span class="o">*</span><span class="p">[]</span><span class="o">*</span><span class="nx">User</span><span class="p">)</span>
<a id="__codelineno-39-20" name="__codelineno-39-20"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-21" name="__codelineno-39-21"></a><span class="w">            </span><span class="nx">slice</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">*</span><span class="nx">s</span>
<a id="__codelineno-39-22" name="__codelineno-39-22"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-23" name="__codelineno-39-23"></a><span class="w">            </span><span class="nx">ok</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetFromEmbeddedStruct</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">slice</span><span class="p">,</span><span class="w"> </span><span class="nx">maybeUser</span><span class="p">)</span>
<a id="__codelineno-39-24" name="__codelineno-39-24"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-25" name="__codelineno-39-25"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;埋め込み構造体%Tから%Tへの設定に失敗しました&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">slice</span><span class="p">,</span><span class="w"> </span><span class="nx">maybeUser</span><span class="p">))</span>
<a id="__codelineno-39-26" name="__codelineno-39-26"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-39-27" name="__codelineno-39-27"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-39-28" name="__codelineno-39-28"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-39-29" name="__codelineno-39-29"></a>
<a id="__codelineno-39-30" name="__codelineno-39-30"></a><span class="w">    </span><span class="c1">// ユーザーIDのマップを作成</span>
<a id="__codelineno-39-31" name="__codelineno-39-31"></a><span class="w">    </span><span class="nx">args</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kd">interface</span><span class="p">{}]</span><span class="kd">struct</span><span class="p">{})</span>
<a id="__codelineno-39-32" name="__codelineno-39-32"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">singular</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-33" name="__codelineno-39-33"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">object</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-34" name="__codelineno-39-34"></a><span class="w">            </span><span class="nx">object</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">userR</span><span class="p">{}</span>
<a id="__codelineno-39-35" name="__codelineno-39-35"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-39-36" name="__codelineno-39-36"></a><span class="w">        </span><span class="nx">args</span><span class="p">[</span><span class="nx">object</span><span class="p">.</span><span class="nx">UserID</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}{}</span>
<a id="__codelineno-39-37" name="__codelineno-39-37"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-38" name="__codelineno-39-38"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">slice</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-39" name="__codelineno-39-39"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">obj</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-40" name="__codelineno-39-40"></a><span class="w">                </span><span class="nx">obj</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">userR</span><span class="p">{}</span>
<a id="__codelineno-39-41" name="__codelineno-39-41"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-39-42" name="__codelineno-39-42"></a><span class="w">            </span><span class="nx">args</span><span class="p">[</span><span class="nx">obj</span><span class="p">.</span><span class="nx">UserID</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}{}</span>
<a id="__codelineno-39-43" name="__codelineno-39-43"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-39-44" name="__codelineno-39-44"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-39-45" name="__codelineno-39-45"></a>
<a id="__codelineno-39-46" name="__codelineno-39-46"></a><span class="w">    </span><span class="c1">// ロードすべきユーザーが存在しない場合は終了</span>
<a id="__codelineno-39-47" name="__codelineno-39-47"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-48" name="__codelineno-39-48"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-39-49" name="__codelineno-39-49"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-39-50" name="__codelineno-39-50"></a>
<a id="__codelineno-39-51" name="__codelineno-39-51"></a><span class="w">    </span><span class="c1">// ユーザーIDをスライスに変換</span>
<a id="__codelineno-39-52" name="__codelineno-39-52"></a><span class="w">    </span><span class="nx">argsSlice</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kd">interface</span><span class="p">{},</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">args</span><span class="p">))</span>
<a id="__codelineno-39-53" name="__codelineno-39-53"></a><span class="w">    </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span>
<a id="__codelineno-39-54" name="__codelineno-39-54"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">arg</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">args</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-55" name="__codelineno-39-55"></a><span class="w">        </span><span class="nx">argsSlice</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">arg</span>
<a id="__codelineno-39-56" name="__codelineno-39-56"></a><span class="w">        </span><span class="nx">i</span><span class="o">++</span>
<a id="__codelineno-39-57" name="__codelineno-39-57"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-39-58" name="__codelineno-39-58"></a>
<a id="__codelineno-39-59" name="__codelineno-39-59"></a><span class="w">    </span><span class="c1">// クエリを作成</span>
<a id="__codelineno-39-60" name="__codelineno-39-60"></a><span class="w">    </span><span class="nx">query</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">NewQuery</span><span class="p">(</span>
<a id="__codelineno-39-61" name="__codelineno-39-61"></a><span class="w">        </span><span class="nx">qm</span><span class="p">.</span><span class="nx">From</span><span class="p">(</span><span class="s">`point_logs`</span><span class="p">),</span>
<a id="__codelineno-39-62" name="__codelineno-39-62"></a><span class="w">        </span><span class="nx">qm</span><span class="p">.</span><span class="nx">WhereIn</span><span class="p">(</span><span class="s">`point_logs.user_id in ?`</span><span class="p">,</span><span class="w"> </span><span class="nx">argsSlice</span><span class="o">...</span><span class="p">),</span>
<a id="__codelineno-39-63" name="__codelineno-39-63"></a><span class="w">    </span><span class="p">)</span>
<a id="__codelineno-39-64" name="__codelineno-39-64"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">mods</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-65" name="__codelineno-39-65"></a><span class="w">        </span><span class="nx">mods</span><span class="p">.</span><span class="nx">Apply</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span>
<a id="__codelineno-39-66" name="__codelineno-39-66"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-39-67" name="__codelineno-39-67"></a>
<a id="__codelineno-39-68" name="__codelineno-39-68"></a><span class="w">    </span><span class="c1">// クエリを実行し結果を取得</span>
<a id="__codelineno-39-69" name="__codelineno-39-69"></a><span class="w">    </span><span class="nx">results</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">query</span><span class="p">.</span><span class="nx">QueryContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="p">)</span>
<a id="__codelineno-39-70" name="__codelineno-39-70"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-71" name="__codelineno-39-71"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;point_logsのイーガーロードに失敗しました&quot;</span><span class="p">)</span>
<a id="__codelineno-39-72" name="__codelineno-39-72"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-39-73" name="__codelineno-39-73"></a>
<a id="__codelineno-39-74" name="__codelineno-39-74"></a><span class="w">    </span><span class="c1">// 結果をバインド</span>
<a id="__codelineno-39-75" name="__codelineno-39-75"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">resultSlice</span><span class="w"> </span><span class="p">[]</span><span class="o">*</span><span class="nx">PointLog</span>
<a id="__codelineno-39-76" name="__codelineno-39-76"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">Bind</span><span class="p">(</span><span class="nx">results</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">resultSlice</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-77" name="__codelineno-39-77"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;イーガーロードされたpoint_logsのスライスへのバインドに失敗しました&quot;</span><span class="p">)</span>
<a id="__codelineno-39-78" name="__codelineno-39-78"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-39-79" name="__codelineno-39-79"></a>
<a id="__codelineno-39-80" name="__codelineno-39-80"></a><span class="w">    </span><span class="c1">// クローズ処理</span>
<a id="__codelineno-39-81" name="__codelineno-39-81"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">results</span><span class="p">.</span><span class="nx">Close</span><span class="p">();</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-82" name="__codelineno-39-82"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;point_logsのイーガーロード中の結果のクローズに失敗しました&quot;</span><span class="p">)</span>
<a id="__codelineno-39-83" name="__codelineno-39-83"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-39-84" name="__codelineno-39-84"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">results</span><span class="p">.</span><span class="nx">Err</span><span class="p">();</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-85" name="__codelineno-39-85"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;point_logsのイーガーロード中にエラーが発生しました&quot;</span><span class="p">)</span>
<a id="__codelineno-39-86" name="__codelineno-39-86"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-39-87" name="__codelineno-39-87"></a>
<a id="__codelineno-39-88" name="__codelineno-39-88"></a><span class="w">    </span><span class="c1">// フックの処理</span>
<a id="__codelineno-39-89" name="__codelineno-39-89"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">pointLogAfterSelectHooks</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-90" name="__codelineno-39-90"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">resultSlice</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-91" name="__codelineno-39-91"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">obj</span><span class="p">.</span><span class="nx">doAfterSelectHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-92" name="__codelineno-39-92"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-39-93" name="__codelineno-39-93"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-39-94" name="__codelineno-39-94"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-39-95" name="__codelineno-39-95"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-39-96" name="__codelineno-39-96"></a>
<a id="__codelineno-39-97" name="__codelineno-39-97"></a><span class="w">    </span><span class="c1">// 結果をユーザーオブジェクトに関連付ける</span>
<a id="__codelineno-39-98" name="__codelineno-39-98"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">singular</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-99" name="__codelineno-39-99"></a><span class="w">        </span><span class="nx">object</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">PointLogs</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">resultSlice</span>
<a id="__codelineno-39-100" name="__codelineno-39-100"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">foreign</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">resultSlice</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-101" name="__codelineno-39-101"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">foreign</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-102" name="__codelineno-39-102"></a><span class="w">                </span><span class="nx">foreign</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">pointLogR</span><span class="p">{}</span>
<a id="__codelineno-39-103" name="__codelineno-39-103"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-39-104" name="__codelineno-39-104"></a><span class="w">            </span><span class="nx">foreign</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">User</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">object</span>
<a id="__codelineno-39-105" name="__codelineno-39-105"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-39-106" name="__codelineno-39-106"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-39-107" name="__codelineno-39-107"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-39-108" name="__codelineno-39-108"></a>
<a id="__codelineno-39-109" name="__codelineno-39-109"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">foreign</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">resultSlice</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-110" name="__codelineno-39-110"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">local</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">slice</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-111" name="__codelineno-39-111"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">local</span><span class="p">.</span><span class="nx">UserID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">foreign</span><span class="p">.</span><span class="nx">UserID</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-112" name="__codelineno-39-112"></a><span class="w">                </span><span class="nx">local</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">PointLogs</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">local</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">PointLogs</span><span class="p">,</span><span class="w"> </span><span class="nx">foreign</span><span class="p">)</span>
<a id="__codelineno-39-113" name="__codelineno-39-113"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="nx">foreign</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-114" name="__codelineno-39-114"></a><span class="w">                    </span><span class="nx">foreign</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">pointLogR</span><span class="p">{}</span>
<a id="__codelineno-39-115" name="__codelineno-39-115"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-39-116" name="__codelineno-39-116"></a><span class="w">                </span><span class="nx">foreign</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">User</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">local</span>
<a id="__codelineno-39-117" name="__codelineno-39-117"></a><span class="w">                </span><span class="k">break</span>
<a id="__codelineno-39-118" name="__codelineno-39-118"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-39-119" name="__codelineno-39-119"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-39-120" name="__codelineno-39-120"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-39-121" name="__codelineno-39-121"></a>
<a id="__codelineno-39-122" name="__codelineno-39-122"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-39-123" name="__codelineno-39-123"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_63">説明</h3>
<p><code>LoadPointLogs</code>関数は、ユーザーに関連する<code>PointLog</code>（ポイントログ）をイーガーロードするための関数です。これにより、ユーザーオブジェクトと関連するポイントログを効率的に取得できます。</p>
<h4 id="_64">関数の流れ</h4>
<p>この関数の流れは<code>LoadCheckinLogs</code>とほぼ同じですが、操作対象が<code>point_logs</code>テーブルであり、<code>PointLog</code>オブジェクトを扱います。</p>
<h3 id="_65">使用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-40-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-40-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-40-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-40-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-40-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-40-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-40-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-40-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-40-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-40-10">10</a></span>
<span class="normal"><a href="#__codelineno-40-11">11</a></span>
<span class="normal"><a href="#__codelineno-40-12">12</a></span>
<span class="normal"><a href="#__codelineno-40-13">13</a></span>
<span class="normal"><a href="#__codelineno-40-14">14</a></span>
<span class="normal"><a href="#__codelineno-40-15">15</a></span>
<span class="normal"><a href="#__codelineno-40-16">16</a></span>
<span class="normal"><a href="#__codelineno-40-17">17</a></span>
<span class="normal"><a href="#__codelineno-40-18">18</a></span>
<span class="normal"><a href="#__codelineno-40-19">19</a></span>
<span class="normal"><a href="#__codelineno-40-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-2" name="__codelineno-40-2"></a><span class="w">    </span><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-40-3" name="__codelineno-40-3"></a>
<a id="__codelineno-40-4" name="__codelineno-40-4"></a><span class="w">    </span><span class="c1">// 単一のユーザーを取得</span>
<a id="__codelineno-40-5" name="__codelineno-40-5"></a><span class="w">    </span><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Users</span><span class="p">(</span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;id = ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)).</span><span class="nx">One</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-40-6" name="__codelineno-40-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-7" name="__codelineno-40-7"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-40-8" name="__codelineno-40-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-40-9" name="__codelineno-40-9"></a>
<a id="__codelineno-40-10" name="__codelineno-40-10"></a><span class="w">    </span><span class="c1">// ユーザーのポイントログをイーガーロード</span>
<a id="__codelineno-40-11" name="__codelineno-40-11"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">userL</span><span class="p">.</span><span class="nx">LoadPointLogs</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-12" name="__codelineno-40-12"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-40-13" name="__codelineno-40-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-40-14" name="__codelineno-40-14"></a>
<a id="__codelineno-40-15" name="__codelineno-40-15"></a><span class="w">    </span><span class="c1">// ポイントログを表示</span>
<a id="__codelineno-40-16" name="__codelineno-40-16"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;ユーザー名: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
<a id="__codelineno-40-17" name="__codelineno-40-17"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">log</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">PointLogs</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-18" name="__codelineno-40-18"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;  日付: %s, ポイント変動: %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">log</span><span class="p">.</span><span class="nx">Date</span><span class="p">,</span><span class="w"> </span><span class="nx">log</span><span class="p">.</span><span class="nx">Change</span><span class="p">)</span>
<a id="__codelineno-40-19" name="__codelineno-40-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-40-20" name="__codelineno-40-20"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="_66">説明</h4>
<p>上記の例では、IDが1のユーザーを取得し、そのユーザーに関連するポイントログをイーガーロードしています。<code>user.R.PointLogs</code>を通じて、ユーザーのポイントログにアクセスできます。</p>
<h2 id="_67">注意事項</h2>
<ul>
<li><strong>イーガーロードの利点</strong>: イーガーロードを使用することで、関連データを一度のデータベースクエリで取得でき、N+1問題を防ぐことができます。</li>
<li><strong>メモリの使用</strong>: 一度に大量のデータをロードする場合、メモリ使用量が増加する可能性があります。必要なデータのみをロードするようにクエリを調整してください。</li>
<li><strong>引数の<code>mods</code>の活用</strong>: <code>mods</code>引数を使用して、クエリにフィルタやソートなどの条件を追加できます。</li>
</ul>
<h2 id="loadcheckinlogsloadpointlogs_1"><code>LoadCheckinLogs</code>、<code>LoadPointLogs</code>関数まとめ</h2>
<p><code>LoadCheckinLogs</code>と<code>LoadPointLogs</code>関数は、ユーザーと関連するチェックインログやポイントログを効率的に取得するための強力なツールです。これらの関数を適切に活用することで、データベースアクセスのパフォーマンスを向上させ、アプリケーションの効率化に貢献できます。</p>
<hr />
<h2 id="loadseichies"><code>LoadSeichies</code> 関数の詳細な解説と利用例</h2>
<p><code>LoadSeichies</code> 関数は、Go言語におけるデータベース操作のための関数であり、特定のユーザー（<code>User</code>）に関連する「聖地」（<code>Seichies</code>）を効率的にロードするために使用されます。この関数は、1対多（1-M）または多対多（N-M）のリレーションシップに対応しており、関連するデータをキャッシュし、効率的な検索を可能にします。</p>
<p>以下では、この関数のコードを詳細に解説し、開発者がどのように利用できるかを具体的なコード例とともに示します。</p>
<hr />
<h2 id="_68">関数のシグネチャ</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-41-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">userL</span><span class="p">)</span><span class="w"> </span><span class="nx">LoadSeichies</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">singular</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="nx">maybeUser</span><span class="w"> </span><span class="kd">interface</span><span class="p">{},</span><span class="w"> </span><span class="nx">mods</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">Applicator</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>ctx context.Context</code>：コンテキスト。リクエストのキャンセルやタイムアウトなどの制御に使用。</li>
<li><code>e boil.ContextExecutor</code>：データベースへのクエリを実行するためのエグゼキューター。通常はデータベース接続。</li>
<li><code>singular bool</code>：<code>maybeUser</code> が単一の <code>User</code> オブジェクトか、それとも <code>User</code> のスライスかを示すフラグ。</li>
<li><code>maybeUser interface{}</code>：<code>User</code> 型または <code>User</code> のスライス。ローディング対象のユーザーオブジェクト。</li>
<li><code>mods queries.Applicator</code>：クエリを修正するためのモディファイア。条件の追加などに使用。</li>
</ul>
<hr />
<h2 id="_69">コードの詳細な解説</h2>
<h3 id="1">1. 変数の初期化</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-42-1">1</a></span>
<span class="normal"><a href="#__codelineno-42-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">slice</span><span class="w"> </span><span class="p">[]</span><span class="o">*</span><span class="nx">User</span>
<a id="__codelineno-42-2" name="__codelineno-42-2"></a><span class="kd">var</span><span class="w"> </span><span class="nx">object</span><span class="w"> </span><span class="o">*</span><span class="nx">User</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>slice</code>：ユーザーオブジェクトのスライス。複数のユーザーの場合に使用。</li>
<li><code>object</code>：単一のユーザーオブジェクトの場合に使用。</li>
</ul>
<h3 id="2">2. 単一オブジェクトか複数オブジェクトかの判定</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-43-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-43-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-43-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-43-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-43-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-43-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-43-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-43-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-43-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-43-10">10</a></span>
<span class="normal"><a href="#__codelineno-43-11">11</a></span>
<span class="normal"><a href="#__codelineno-43-12">12</a></span>
<span class="normal"><a href="#__codelineno-43-13">13</a></span>
<span class="normal"><a href="#__codelineno-43-14">14</a></span>
<span class="normal"><a href="#__codelineno-43-15">15</a></span>
<span class="normal"><a href="#__codelineno-43-16">16</a></span>
<span class="normal"><a href="#__codelineno-43-17">17</a></span>
<span class="normal"><a href="#__codelineno-43-18">18</a></span>
<span class="normal"><a href="#__codelineno-43-19">19</a></span>
<span class="normal"><a href="#__codelineno-43-20">20</a></span>
<span class="normal"><a href="#__codelineno-43-21">21</a></span>
<span class="normal"><a href="#__codelineno-43-22">22</a></span>
<span class="normal"><a href="#__codelineno-43-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1"></a><span class="k">if</span><span class="w"> </span><span class="nx">singular</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-2" name="__codelineno-43-2"></a><span class="w">    </span><span class="c1">// 単一のユーザーオブジェクトの場合</span>
<a id="__codelineno-43-3" name="__codelineno-43-3"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="kt">bool</span>
<a id="__codelineno-43-4" name="__codelineno-43-4"></a><span class="w">    </span><span class="nx">object</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">maybeUser</span><span class="p">.(</span><span class="o">*</span><span class="nx">User</span><span class="p">)</span>
<a id="__codelineno-43-5" name="__codelineno-43-5"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-6" name="__codelineno-43-6"></a><span class="w">        </span><span class="nx">object</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">new</span><span class="p">(</span><span class="nx">User</span><span class="p">)</span>
<a id="__codelineno-43-7" name="__codelineno-43-7"></a><span class="w">        </span><span class="nx">ok</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetFromEmbeddedStruct</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">object</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">maybeUser</span><span class="p">)</span>
<a id="__codelineno-43-8" name="__codelineno-43-8"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-9" name="__codelineno-43-9"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;failed to set %T from embedded struct %T&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">object</span><span class="p">,</span><span class="w"> </span><span class="nx">maybeUser</span><span class="p">))</span>
<a id="__codelineno-43-10" name="__codelineno-43-10"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-43-11" name="__codelineno-43-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-43-12" name="__codelineno-43-12"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-13" name="__codelineno-43-13"></a><span class="w">    </span><span class="c1">// ユーザーオブジェクトのスライスの場合</span>
<a id="__codelineno-43-14" name="__codelineno-43-14"></a><span class="w">    </span><span class="nx">s</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">maybeUser</span><span class="p">.(</span><span class="o">*</span><span class="p">[]</span><span class="o">*</span><span class="nx">User</span><span class="p">)</span>
<a id="__codelineno-43-15" name="__codelineno-43-15"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-16" name="__codelineno-43-16"></a><span class="w">        </span><span class="nx">slice</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">*</span><span class="nx">s</span>
<a id="__codelineno-43-17" name="__codelineno-43-17"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-18" name="__codelineno-43-18"></a><span class="w">        </span><span class="nx">ok</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetFromEmbeddedStruct</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">slice</span><span class="p">,</span><span class="w"> </span><span class="nx">maybeUser</span><span class="p">)</span>
<a id="__codelineno-43-19" name="__codelineno-43-19"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-20" name="__codelineno-43-20"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;failed to set %T from embedded struct %T&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">slice</span><span class="p">,</span><span class="w"> </span><span class="nx">maybeUser</span><span class="p">))</span>
<a id="__codelineno-43-21" name="__codelineno-43-21"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-43-22" name="__codelineno-43-22"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-43-23" name="__codelineno-43-23"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>singular</code> フラグに基づいて、<code>maybeUser</code> を適切な型にキャストしています。<ul>
<li>単一オブジェクトの場合：<code>*User</code> 型にキャスト。</li>
<li>複数オブジェクトの場合：<code>*[]*User</code> 型にキャスト。</li>
</ul>
</li>
<li>キャストが失敗した場合は、埋め込み構造体から設定を試みます。</li>
<li>キャストや設定が失敗した場合、エラーを返します。</li>
</ul>
<h3 id="3-args">3. <code>args</code> の準備</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-44-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-44-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-44-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-44-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-44-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-44-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-44-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-44-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-44-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-44-10">10</a></span>
<span class="normal"><a href="#__codelineno-44-11">11</a></span>
<span class="normal"><a href="#__codelineno-44-12">12</a></span>
<span class="normal"><a href="#__codelineno-44-13">13</a></span>
<span class="normal"><a href="#__codelineno-44-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1"></a><span class="nx">args</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kd">interface</span><span class="p">{}]</span><span class="kd">struct</span><span class="p">{})</span>
<a id="__codelineno-44-2" name="__codelineno-44-2"></a><span class="k">if</span><span class="w"> </span><span class="nx">singular</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-44-3" name="__codelineno-44-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">object</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-44-4" name="__codelineno-44-4"></a><span class="w">        </span><span class="nx">object</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">userR</span><span class="p">{}</span>
<a id="__codelineno-44-5" name="__codelineno-44-5"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-44-6" name="__codelineno-44-6"></a><span class="w">    </span><span class="nx">args</span><span class="p">[</span><span class="nx">object</span><span class="p">.</span><span class="nx">UserID</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}{}</span>
<a id="__codelineno-44-7" name="__codelineno-44-7"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-44-8" name="__codelineno-44-8"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">slice</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-44-9" name="__codelineno-44-9"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">obj</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-44-10" name="__codelineno-44-10"></a><span class="w">            </span><span class="nx">obj</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">userR</span><span class="p">{}</span>
<a id="__codelineno-44-11" name="__codelineno-44-11"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-44-12" name="__codelineno-44-12"></a><span class="w">        </span><span class="nx">args</span><span class="p">[</span><span class="nx">obj</span><span class="p">.</span><span class="nx">UserID</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}{}</span>
<a id="__codelineno-44-13" name="__codelineno-44-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-44-14" name="__codelineno-44-14"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>args</code>：ユーザーIDをキーとするマップ。重複を避けるためにマップを使用しています。</li>
<li>単一オブジェクトの場合：<ul>
<li><code>object.R</code> が <code>nil</code> の場合、新しく初期化します。</li>
<li><code>args</code> に <code>object.UserID</code> を追加。</li>
</ul>
</li>
<li>複数オブジェクトの場合：<ul>
<li>各 <code>obj</code> に対して、<code>R</code> フィールドを初期化。</li>
<li><code>args</code> に各 <code>obj.UserID</code> を追加。</li>
</ul>
</li>
</ul>
<h3 id="4-args">4. <code>args</code> の内容確認</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-45-1">1</a></span>
<span class="normal"><a href="#__codelineno-45-2">2</a></span>
<span class="normal"><a href="#__codelineno-45-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1"></a><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-45-2" name="__codelineno-45-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-45-3" name="__codelineno-45-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>args</code> が空の場合、関連するデータがないため、処理を終了します。</li>
</ul>
<h3 id="5">5. クエリの作成</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-46-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-46-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-46-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-46-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-46-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-46-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-46-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-46-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-46-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-46-10">10</a></span>
<span class="normal"><a href="#__codelineno-46-11">11</a></span>
<span class="normal"><a href="#__codelineno-46-12">12</a></span>
<span class="normal"><a href="#__codelineno-46-13">13</a></span>
<span class="normal"><a href="#__codelineno-46-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1"></a><span class="nx">argsSlice</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kd">interface</span><span class="p">{},</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">args</span><span class="p">))</span>
<a id="__codelineno-46-2" name="__codelineno-46-2"></a><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span>
<a id="__codelineno-46-3" name="__codelineno-46-3"></a><span class="k">for</span><span class="w"> </span><span class="nx">arg</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">args</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-46-4" name="__codelineno-46-4"></a><span class="w">    </span><span class="nx">argsSlice</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">arg</span>
<a id="__codelineno-46-5" name="__codelineno-46-5"></a><span class="w">    </span><span class="nx">i</span><span class="o">++</span>
<a id="__codelineno-46-6" name="__codelineno-46-6"></a><span class="p">}</span>
<a id="__codelineno-46-7" name="__codelineno-46-7"></a>
<a id="__codelineno-46-8" name="__codelineno-46-8"></a><span class="nx">query</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">NewQuery</span><span class="p">(</span>
<a id="__codelineno-46-9" name="__codelineno-46-9"></a><span class="w">    </span><span class="nx">qm</span><span class="p">.</span><span class="nx">From</span><span class="p">(</span><span class="s">`seichies`</span><span class="p">),</span>
<a id="__codelineno-46-10" name="__codelineno-46-10"></a><span class="w">    </span><span class="nx">qm</span><span class="p">.</span><span class="nx">WhereIn</span><span class="p">(</span><span class="s">`seichies.user_id in ?`</span><span class="p">,</span><span class="w"> </span><span class="nx">argsSlice</span><span class="o">...</span><span class="p">),</span>
<a id="__codelineno-46-11" name="__codelineno-46-11"></a><span class="p">)</span>
<a id="__codelineno-46-12" name="__codelineno-46-12"></a><span class="k">if</span><span class="w"> </span><span class="nx">mods</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-46-13" name="__codelineno-46-13"></a><span class="w">    </span><span class="nx">mods</span><span class="p">.</span><span class="nx">Apply</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span>
<a id="__codelineno-46-14" name="__codelineno-46-14"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>args</code> のキーをスライス <code>argsSlice</code> に変換。<code>WhereIn</code> クエリで使用します。</li>
<li>クエリビルダーを使用して、<code>seichies</code> テーブルから <code>user_id</code> が <code>argsSlice</code> に含まれるレコードを選択するクエリを作成。</li>
<li><code>mods</code> が提供されている場合、クエリに適用。</li>
</ul>
<h3 id="6">6. クエリの実行と結果の取得</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-47-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-47-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-47-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-47-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-47-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-47-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-47-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-47-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-47-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-47-10">10</a></span>
<span class="normal"><a href="#__codelineno-47-11">11</a></span>
<span class="normal"><a href="#__codelineno-47-12">12</a></span>
<span class="normal"><a href="#__codelineno-47-13">13</a></span>
<span class="normal"><a href="#__codelineno-47-14">14</a></span>
<span class="normal"><a href="#__codelineno-47-15">15</a></span>
<span class="normal"><a href="#__codelineno-47-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1"></a><span class="nx">results</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">query</span><span class="p">.</span><span class="nx">QueryContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="p">)</span>
<a id="__codelineno-47-2" name="__codelineno-47-2"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-47-3" name="__codelineno-47-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;failed to eager load seichies&quot;</span><span class="p">)</span>
<a id="__codelineno-47-4" name="__codelineno-47-4"></a><span class="p">}</span>
<a id="__codelineno-47-5" name="__codelineno-47-5"></a>
<a id="__codelineno-47-6" name="__codelineno-47-6"></a><span class="kd">var</span><span class="w"> </span><span class="nx">resultSlice</span><span class="w"> </span><span class="p">[]</span><span class="o">*</span><span class="nx">Seichy</span>
<a id="__codelineno-47-7" name="__codelineno-47-7"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">Bind</span><span class="p">(</span><span class="nx">results</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">resultSlice</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-47-8" name="__codelineno-47-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;failed to bind eager loaded slice seichies&quot;</span><span class="p">)</span>
<a id="__codelineno-47-9" name="__codelineno-47-9"></a><span class="p">}</span>
<a id="__codelineno-47-10" name="__codelineno-47-10"></a>
<a id="__codelineno-47-11" name="__codelineno-47-11"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">results</span><span class="p">.</span><span class="nx">Close</span><span class="p">();</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-47-12" name="__codelineno-47-12"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;failed to close results in eager load on seichies&quot;</span><span class="p">)</span>
<a id="__codelineno-47-13" name="__codelineno-47-13"></a><span class="p">}</span>
<a id="__codelineno-47-14" name="__codelineno-47-14"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">results</span><span class="p">.</span><span class="nx">Err</span><span class="p">();</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-47-15" name="__codelineno-47-15"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;error occurred during iteration of eager loaded relations for seichies&quot;</span><span class="p">)</span>
<a id="__codelineno-47-16" name="__codelineno-47-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>クエリを実行し、結果を取得。</li>
<li>結果を <code>resultSlice</code> にバインド。</li>
<li>結果セットを閉じ、エラーを確認。</li>
</ul>
<h3 id="7">7. フックの処理</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-48-1">1</a></span>
<span class="normal"><a href="#__codelineno-48-2">2</a></span>
<span class="normal"><a href="#__codelineno-48-3">3</a></span>
<span class="normal"><a href="#__codelineno-48-4">4</a></span>
<span class="normal"><a href="#__codelineno-48-5">5</a></span>
<span class="normal"><a href="#__codelineno-48-6">6</a></span>
<span class="normal"><a href="#__codelineno-48-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1"></a><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">seichyAfterSelectHooks</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-48-2" name="__codelineno-48-2"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">resultSlice</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-48-3" name="__codelineno-48-3"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">obj</span><span class="p">.</span><span class="nx">doAfterSelectHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-48-4" name="__codelineno-48-4"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-48-5" name="__codelineno-48-5"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-48-6" name="__codelineno-48-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-48-7" name="__codelineno-48-7"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>seichyAfterSelectHooks</code> が存在する場合、各 <code>Seichy</code> オブジェクトに対してフックを実行。</li>
</ul>
<h3 id="8">8. 結果のマッピング</h3>
<ul>
<li>単一オブジェクトの場合：</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-49-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-49-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-49-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-49-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-49-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-49-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-49-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-49-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-49-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-49-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1"></a><span class="k">if</span><span class="w"> </span><span class="nx">singular</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-49-2" name="__codelineno-49-2"></a><span class="w">    </span><span class="nx">object</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">Seichies</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">resultSlice</span>
<a id="__codelineno-49-3" name="__codelineno-49-3"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">foreign</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">resultSlice</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-49-4" name="__codelineno-49-4"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">foreign</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-49-5" name="__codelineno-49-5"></a><span class="w">            </span><span class="nx">foreign</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">seichyR</span><span class="p">{}</span>
<a id="__codelineno-49-6" name="__codelineno-49-6"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-49-7" name="__codelineno-49-7"></a><span class="w">        </span><span class="nx">foreign</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">User</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">object</span>
<a id="__codelineno-49-8" name="__codelineno-49-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-49-9" name="__codelineno-49-9"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-49-10" name="__codelineno-49-10"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>object.R.Seichies</code> に結果をセット。</li>
<li>
<p>各 <code>foreign</code>（<code>Seichy</code> オブジェクト）に対して、その <code>R.User</code> フィールドを設定。</p>
</li>
<li>
<p>複数オブジェクトの場合：</p>
</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-50-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-50-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-50-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-50-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-50-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-50-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-50-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-50-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-50-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-50-10">10</a></span>
<span class="normal"><a href="#__codelineno-50-11">11</a></span>
<span class="normal"><a href="#__codelineno-50-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1"></a><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">foreign</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">resultSlice</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-50-2" name="__codelineno-50-2"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">local</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">slice</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-50-3" name="__codelineno-50-3"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">local</span><span class="p">.</span><span class="nx">UserID</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">foreign</span><span class="p">.</span><span class="nx">UserID</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-50-4" name="__codelineno-50-4"></a><span class="w">            </span><span class="nx">local</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">Seichies</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">local</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">Seichies</span><span class="p">,</span><span class="w"> </span><span class="nx">foreign</span><span class="p">)</span>
<a id="__codelineno-50-5" name="__codelineno-50-5"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">foreign</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-50-6" name="__codelineno-50-6"></a><span class="w">                </span><span class="nx">foreign</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">seichyR</span><span class="p">{}</span>
<a id="__codelineno-50-7" name="__codelineno-50-7"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-50-8" name="__codelineno-50-8"></a><span class="w">            </span><span class="nx">foreign</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">User</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">local</span>
<a id="__codelineno-50-9" name="__codelineno-50-9"></a><span class="w">            </span><span class="k">break</span>
<a id="__codelineno-50-10" name="__codelineno-50-10"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-50-11" name="__codelineno-50-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-50-12" name="__codelineno-50-12"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>各 <code>foreign</code>（<code>Seichy</code> オブジェクト）に対して、対応する <code>local</code>（<code>User</code> オブジェクト）を探索。</li>
<li><code>UserID</code> が一致する場合、<code>local.R.Seichies</code> に <code>foreign</code> を追加。</li>
<li><code>foreign.R.User</code> を <code>local</code> に設定。</li>
</ul>
<h3 id="9">9. 終了処理</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-51-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1"></a><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>正常に処理が完了した場合、<code>nil</code> を返す。</li>
</ul>
<hr />
<h2 id="_70">開発者向け利用例</h2>
<p>以下に、<code>LoadSeichies</code> 関数を使用してユーザーに関連する「聖地」をロードする具体的な例を示します。</p>
<h3 id="_71">単一のユーザーの場合</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-52-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-52-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-52-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-52-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-52-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-52-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-52-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-52-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-52-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-52-10">10</a></span>
<span class="normal"><a href="#__codelineno-52-11">11</a></span>
<span class="normal"><a href="#__codelineno-52-12">12</a></span>
<span class="normal"><a href="#__codelineno-52-13">13</a></span>
<span class="normal"><a href="#__codelineno-52-14">14</a></span>
<span class="normal"><a href="#__codelineno-52-15">15</a></span>
<span class="normal"><a href="#__codelineno-52-16">16</a></span>
<span class="normal"><a href="#__codelineno-52-17">17</a></span>
<span class="normal"><a href="#__codelineno-52-18">18</a></span>
<span class="normal"><a href="#__codelineno-52-19">19</a></span>
<span class="normal"><a href="#__codelineno-52-20">20</a></span>
<span class="normal"><a href="#__codelineno-52-21">21</a></span>
<span class="normal"><a href="#__codelineno-52-22">22</a></span>
<span class="normal"><a href="#__codelineno-52-23">23</a></span>
<span class="normal"><a href="#__codelineno-52-24">24</a></span>
<span class="normal"><a href="#__codelineno-52-25">25</a></span>
<span class="normal"><a href="#__codelineno-52-26">26</a></span>
<span class="normal"><a href="#__codelineno-52-27">27</a></span>
<span class="normal"><a href="#__codelineno-52-28">28</a></span>
<span class="normal"><a href="#__codelineno-52-29">29</a></span>
<span class="normal"><a href="#__codelineno-52-30">30</a></span>
<span class="normal"><a href="#__codelineno-52-31">31</a></span>
<span class="normal"><a href="#__codelineno-52-32">32</a></span>
<span class="normal"><a href="#__codelineno-52-33">33</a></span>
<span class="normal"><a href="#__codelineno-52-34">34</a></span>
<span class="normal"><a href="#__codelineno-52-35">35</a></span>
<span class="normal"><a href="#__codelineno-52-36">36</a></span>
<span class="normal"><a href="#__codelineno-52-37">37</a></span>
<span class="normal"><a href="#__codelineno-52-38">38</a></span>
<span class="normal"><a href="#__codelineno-52-39">39</a></span>
<span class="normal"><a href="#__codelineno-52-40">40</a></span>
<span class="normal"><a href="#__codelineno-52-41">41</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-52-2" name="__codelineno-52-2"></a>
<a id="__codelineno-52-3" name="__codelineno-52-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-52-4" name="__codelineno-52-4"></a><span class="w">    </span><span class="s">&quot;context&quot;</span>
<a id="__codelineno-52-5" name="__codelineno-52-5"></a><span class="w">    </span><span class="s">&quot;database/sql&quot;</span>
<a id="__codelineno-52-6" name="__codelineno-52-6"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-52-7" name="__codelineno-52-7"></a>
<a id="__codelineno-52-8" name="__codelineno-52-8"></a><span class="w">    </span><span class="nx">_</span><span class="w"> </span><span class="s">&quot;github.com/go-sql-driver/mysql&quot;</span>
<a id="__codelineno-52-9" name="__codelineno-52-9"></a><span class="w">    </span><span class="s">&quot;github.com/volatiletech/sqlboiler/boil&quot;</span>
<a id="__codelineno-52-10" name="__codelineno-52-10"></a><span class="w">    </span><span class="s">&quot;github.com/volatiletech/sqlboiler/queries/qm&quot;</span>
<a id="__codelineno-52-11" name="__codelineno-52-11"></a><span class="p">)</span>
<a id="__codelineno-52-12" name="__codelineno-52-12"></a>
<a id="__codelineno-52-13" name="__codelineno-52-13"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-52-14" name="__codelineno-52-14"></a><span class="w">    </span><span class="c1">// データベースへの接続</span>
<a id="__codelineno-52-15" name="__codelineno-52-15"></a><span class="w">    </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-52-16" name="__codelineno-52-16"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-52-17" name="__codelineno-52-17"></a><span class="w">        </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-52-18" name="__codelineno-52-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-52-19" name="__codelineno-52-19"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-52-20" name="__codelineno-52-20"></a>
<a id="__codelineno-52-21" name="__codelineno-52-21"></a><span class="w">    </span><span class="c1">// コンテキストの作成</span>
<a id="__codelineno-52-22" name="__codelineno-52-22"></a><span class="w">    </span><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-52-23" name="__codelineno-52-23"></a>
<a id="__codelineno-52-24" name="__codelineno-52-24"></a><span class="w">    </span><span class="c1">// ユーザーの取得</span>
<a id="__codelineno-52-25" name="__codelineno-52-25"></a><span class="w">    </span><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Users</span><span class="p">(</span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;id = ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)).</span><span class="nx">One</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-52-26" name="__codelineno-52-26"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-52-27" name="__codelineno-52-27"></a><span class="w">        </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-52-28" name="__codelineno-52-28"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-52-29" name="__codelineno-52-29"></a>
<a id="__codelineno-52-30" name="__codelineno-52-30"></a><span class="w">    </span><span class="c1">// 関連する聖地をロード</span>
<a id="__codelineno-52-31" name="__codelineno-52-31"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">LoadSeichies</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<a id="__codelineno-52-32" name="__codelineno-52-32"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-52-33" name="__codelineno-52-33"></a><span class="w">        </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-52-34" name="__codelineno-52-34"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-52-35" name="__codelineno-52-35"></a>
<a id="__codelineno-52-36" name="__codelineno-52-36"></a><span class="w">    </span><span class="c1">// 結果の表示</span>
<a id="__codelineno-52-37" name="__codelineno-52-37"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;User: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
<a id="__codelineno-52-38" name="__codelineno-52-38"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">seichy</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">Seichies</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-52-39" name="__codelineno-52-39"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Seichy: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">seichy</span><span class="p">.</span><span class="nx">Title</span><span class="p">)</span>
<a id="__codelineno-52-40" name="__codelineno-52-40"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-52-41" name="__codelineno-52-41"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ユーザーIDが1のユーザーをデータベースから取得。</li>
<li><code>LoadSeichies</code> 関数を使用して、そのユーザーに関連する聖地をロード。</li>
<li>ロードされた聖地を出力。</li>
</ul>
<h3 id="_72">複数のユーザーの場合</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-53-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-53-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-53-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-53-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-53-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-53-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-53-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-53-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-53-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-53-10">10</a></span>
<span class="normal"><a href="#__codelineno-53-11">11</a></span>
<span class="normal"><a href="#__codelineno-53-12">12</a></span>
<span class="normal"><a href="#__codelineno-53-13">13</a></span>
<span class="normal"><a href="#__codelineno-53-14">14</a></span>
<span class="normal"><a href="#__codelineno-53-15">15</a></span>
<span class="normal"><a href="#__codelineno-53-16">16</a></span>
<span class="normal"><a href="#__codelineno-53-17">17</a></span>
<span class="normal"><a href="#__codelineno-53-18">18</a></span>
<span class="normal"><a href="#__codelineno-53-19">19</a></span>
<span class="normal"><a href="#__codelineno-53-20">20</a></span>
<span class="normal"><a href="#__codelineno-53-21">21</a></span>
<span class="normal"><a href="#__codelineno-53-22">22</a></span>
<span class="normal"><a href="#__codelineno-53-23">23</a></span>
<span class="normal"><a href="#__codelineno-53-24">24</a></span>
<span class="normal"><a href="#__codelineno-53-25">25</a></span>
<span class="normal"><a href="#__codelineno-53-26">26</a></span>
<span class="normal"><a href="#__codelineno-53-27">27</a></span>
<span class="normal"><a href="#__codelineno-53-28">28</a></span>
<span class="normal"><a href="#__codelineno-53-29">29</a></span>
<span class="normal"><a href="#__codelineno-53-30">30</a></span>
<span class="normal"><a href="#__codelineno-53-31">31</a></span>
<span class="normal"><a href="#__codelineno-53-32">32</a></span>
<span class="normal"><a href="#__codelineno-53-33">33</a></span>
<span class="normal"><a href="#__codelineno-53-34">34</a></span>
<span class="normal"><a href="#__codelineno-53-35">35</a></span>
<span class="normal"><a href="#__codelineno-53-36">36</a></span>
<span class="normal"><a href="#__codelineno-53-37">37</a></span>
<span class="normal"><a href="#__codelineno-53-38">38</a></span>
<span class="normal"><a href="#__codelineno-53-39">39</a></span>
<span class="normal"><a href="#__codelineno-53-40">40</a></span>
<span class="normal"><a href="#__codelineno-53-41">41</a></span>
<span class="normal"><a href="#__codelineno-53-42">42</a></span>
<span class="normal"><a href="#__codelineno-53-43">43</a></span>
<span class="normal"><a href="#__codelineno-53-44">44</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-53-2" name="__codelineno-53-2"></a>
<a id="__codelineno-53-3" name="__codelineno-53-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-53-4" name="__codelineno-53-4"></a><span class="w">    </span><span class="s">&quot;context&quot;</span>
<a id="__codelineno-53-5" name="__codelineno-53-5"></a><span class="w">    </span><span class="s">&quot;database/sql&quot;</span>
<a id="__codelineno-53-6" name="__codelineno-53-6"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-53-7" name="__codelineno-53-7"></a>
<a id="__codelineno-53-8" name="__codelineno-53-8"></a><span class="w">    </span><span class="nx">_</span><span class="w"> </span><span class="s">&quot;github.com/go-sql-driver/mysql&quot;</span>
<a id="__codelineno-53-9" name="__codelineno-53-9"></a><span class="w">    </span><span class="s">&quot;github.com/volatiletech/sqlboiler/boil&quot;</span>
<a id="__codelineno-53-10" name="__codelineno-53-10"></a><span class="w">    </span><span class="s">&quot;github.com/volatiletech/sqlboiler/queries/qm&quot;</span>
<a id="__codelineno-53-11" name="__codelineno-53-11"></a><span class="p">)</span>
<a id="__codelineno-53-12" name="__codelineno-53-12"></a>
<a id="__codelineno-53-13" name="__codelineno-53-13"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-53-14" name="__codelineno-53-14"></a><span class="w">    </span><span class="c1">// データベースへの接続</span>
<a id="__codelineno-53-15" name="__codelineno-53-15"></a><span class="w">    </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-53-16" name="__codelineno-53-16"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-53-17" name="__codelineno-53-17"></a><span class="w">        </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-53-18" name="__codelineno-53-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-53-19" name="__codelineno-53-19"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-53-20" name="__codelineno-53-20"></a>
<a id="__codelineno-53-21" name="__codelineno-53-21"></a><span class="w">    </span><span class="c1">// コンテキストの作成</span>
<a id="__codelineno-53-22" name="__codelineno-53-22"></a><span class="w">    </span><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-53-23" name="__codelineno-53-23"></a>
<a id="__codelineno-53-24" name="__codelineno-53-24"></a><span class="w">    </span><span class="c1">// 複数のユーザーの取得</span>
<a id="__codelineno-53-25" name="__codelineno-53-25"></a><span class="w">    </span><span class="nx">users</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Users</span><span class="p">(</span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;active = ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)).</span><span class="nx">All</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-53-26" name="__codelineno-53-26"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-53-27" name="__codelineno-53-27"></a><span class="w">        </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-53-28" name="__codelineno-53-28"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-53-29" name="__codelineno-53-29"></a>
<a id="__codelineno-53-30" name="__codelineno-53-30"></a><span class="w">    </span><span class="c1">// 関連する聖地をロード</span>
<a id="__codelineno-53-31" name="__codelineno-53-31"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">userL</span><span class="w"> </span><span class="nx">userL</span>
<a id="__codelineno-53-32" name="__codelineno-53-32"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">userL</span><span class="p">.</span><span class="nx">LoadSeichies</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">users</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<a id="__codelineno-53-33" name="__codelineno-53-33"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-53-34" name="__codelineno-53-34"></a><span class="w">        </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-53-35" name="__codelineno-53-35"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-53-36" name="__codelineno-53-36"></a>
<a id="__codelineno-53-37" name="__codelineno-53-37"></a><span class="w">    </span><span class="c1">// 結果の表示</span>
<a id="__codelineno-53-38" name="__codelineno-53-38"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">users</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-53-39" name="__codelineno-53-39"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;User: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
<a id="__codelineno-53-40" name="__codelineno-53-40"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">seichy</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">Seichies</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-53-41" name="__codelineno-53-41"></a><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;  Seichy: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">seichy</span><span class="p">.</span><span class="nx">Title</span><span class="p">)</span>
<a id="__codelineno-53-42" name="__codelineno-53-42"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-53-43" name="__codelineno-53-43"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-53-44" name="__codelineno-53-44"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>アクティブな全てのユーザーを取得。</li>
<li><code>LoadSeichies</code> 関数を使用して、各ユーザーに関連する聖地をロード。</li>
<li>各ユーザーとその聖地を出力。</li>
</ul>
<h3 id="_73">クエリモディファイアを使用したカスタマイズ</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-54-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-54-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-54-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-54-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-54-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-54-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-54-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-54-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-54-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-54-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1"></a><span class="c1">// 特定の条件を追加</span>
<a id="__codelineno-54-2" name="__codelineno-54-2"></a><span class="nx">mods</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;seichies.published = ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
<a id="__codelineno-54-3" name="__codelineno-54-3"></a>
<a id="__codelineno-54-4" name="__codelineno-54-4"></a><span class="c1">// ロード時にモディファイアを適用</span>
<a id="__codelineno-54-5" name="__codelineno-54-5"></a><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">LoadSeichies</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="nx">mods</span><span class="p">)</span>
<a id="__codelineno-54-6" name="__codelineno-54-6"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-54-7" name="__codelineno-54-7"></a><span class="w">    </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-54-8" name="__codelineno-54-8"></a><span class="p">}</span>
<a id="__codelineno-54-9" name="__codelineno-54-9"></a>
<a id="__codelineno-54-10" name="__codelineno-54-10"></a><span class="c1">// 公開されている聖地のみがロードされる</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>モディファイア <code>mods</code> を定義し、公開されている聖地のみをロードする条件を追加。</li>
<li><code>LoadSeichies</code> 関数の <code>mods</code> 引数に渡すことで、クエリに条件を適用。</li>
</ul>
<hr />
<h2 id="loadseichies_1">LoadSeichies` 関数まとめ</h2>
<p><code>LoadSeichies</code> 関数は、ユーザーに関連する聖地を効率的にロードするための強力なツールです。単一および複数のユーザーに対して機能し、カスタムクエリモディファイアを使用して結果をフィルタリングすることもできます。データベース操作を最適化し、関連データの取得を簡素化するために、この関数を適切に活用してください。</p>
<hr />
<h2 id="setpoint"><code>SetPoint</code> 関数と関連関数の詳細な解説と利用例</h2>
<p>これらの関数は、ユーザー（<code>User</code>）と関連するデータ（<code>Point</code>、<code>CheckinLog</code>、<code>PointLog</code>、<code>Seichy</code>）との関係を設定・追加するために使用されます。また、ユーザーをデータベースから取得するための関数も含まれています。</p>
<p>各関数の詳細な解説と、開発者が利用する際の具体的なコード例を示します。</p>
<hr />
<h2 id="1-setpoint">1. <code>SetPoint</code> 関数</h2>
<h3 id="_74">説明</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-55-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">User</span><span class="p">)</span><span class="w"> </span><span class="nx">SetPoint</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">insert</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="nx">related</span><span class="w"> </span><span class="o">*</span><span class="nx">Point</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>目的</strong>: ユーザー (<code>User</code>) に関連付けられたポイント (<code>Point</code>) を設定します。</li>
<li><strong>パラメータ</strong>:</li>
<li><code>ctx context.Context</code>: コンテキスト。リクエストのキャンセルやタイムアウトの制御に使用。</li>
<li><code>exec boil.ContextExecutor</code>: データベース操作を実行するためのエグゼキューター。</li>
<li><code>insert bool</code>: <code>true</code> の場合、新しい <code>Point</code> レコードをデータベースに挿入します。<code>false</code> の場合、既存のレコードを更新します。</li>
<li><code>related *Point</code>: 関連付ける <code>Point</code> オブジェクト。</li>
<li><strong>戻り値</strong>: エラー情報。正常終了の場合は <code>nil</code>。</li>
</ul>
<h3 id="_75">コードの詳細な解説</h3>
<ol>
<li>
<p><strong>エラーハンドリングの変数初期化</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-56-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span>
</code></pre></div></td></tr></table></div>
</li>
<li>
<p><strong><code>insert</code> フラグの処理</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-57-1">1</a></span>
<span class="normal"><a href="#__codelineno-57-2">2</a></span>
<span class="normal"><a href="#__codelineno-57-3">3</a></span>
<span class="normal"><a href="#__codelineno-57-4">4</a></span>
<span class="normal"><a href="#__codelineno-57-5">5</a></span>
<span class="normal"><a href="#__codelineno-57-6">6</a></span>
<span class="normal"><a href="#__codelineno-57-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1"></a><span class="k">if</span><span class="w"> </span><span class="nx">insert</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-57-2" name="__codelineno-57-2"></a><span class="w">    </span><span class="nx">related</span><span class="p">.</span><span class="nx">UserID</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">UserID</span>
<a id="__codelineno-57-3" name="__codelineno-57-3"></a>
<a id="__codelineno-57-4" name="__codelineno-57-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">related</span><span class="p">.</span><span class="nx">Insert</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">Infer</span><span class="p">());</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-57-5" name="__codelineno-57-5"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;failed to insert into foreign table&quot;</span><span class="p">)</span>
<a id="__codelineno-57-6" name="__codelineno-57-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-57-7" name="__codelineno-57-7"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>insert</code> が <code>true</code> の場合:</li>
<li><code>related</code>（<code>Point</code> オブジェクト）の <code>UserID</code> フィールドに、<code>User</code> オブジェクトの <code>UserID</code> をセット。</li>
<li><code>related.Insert</code> を呼び出して、データベースに新しい <code>Point</code> レコードを挿入。</li>
<li>挿入に失敗した場合、エラーを返す。</li>
</ul>
</li>
<li>
<p><strong>既存レコードの更新</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-58-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-58-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-58-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-58-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-58-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-58-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-58-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-58-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-58-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-58-10">10</a></span>
<span class="normal"><a href="#__codelineno-58-11">11</a></span>
<span class="normal"><a href="#__codelineno-58-12">12</a></span>
<span class="normal"><a href="#__codelineno-58-13">13</a></span>
<span class="normal"><a href="#__codelineno-58-14">14</a></span>
<span class="normal"><a href="#__codelineno-58-15">15</a></span>
<span class="normal"><a href="#__codelineno-58-16">16</a></span>
<span class="normal"><a href="#__codelineno-58-17">17</a></span>
<span class="normal"><a href="#__codelineno-58-18">18</a></span>
<span class="normal"><a href="#__codelineno-58-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1"></a><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-58-2" name="__codelineno-58-2"></a><span class="w">    </span><span class="nx">updateQuery</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span>
<a id="__codelineno-58-3" name="__codelineno-58-3"></a><span class="w">        </span><span class="s">&quot;UPDATE `points` SET %s WHERE %s&quot;</span><span class="p">,</span>
<a id="__codelineno-58-4" name="__codelineno-58-4"></a><span class="w">        </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">SetParamNames</span><span class="p">(</span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;user_id&quot;</span><span class="p">}),</span>
<a id="__codelineno-58-5" name="__codelineno-58-5"></a><span class="w">        </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">WhereClause</span><span class="p">(</span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">pointPrimaryKeyColumns</span><span class="p">),</span>
<a id="__codelineno-58-6" name="__codelineno-58-6"></a><span class="w">    </span><span class="p">)</span>
<a id="__codelineno-58-7" name="__codelineno-58-7"></a><span class="w">    </span><span class="nx">values</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span><span class="nx">o</span><span class="p">.</span><span class="nx">UserID</span><span class="p">,</span><span class="w"> </span><span class="nx">related</span><span class="p">.</span><span class="nx">UserID</span><span class="p">}</span>
<a id="__codelineno-58-8" name="__codelineno-58-8"></a>
<a id="__codelineno-58-9" name="__codelineno-58-9"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">IsDebug</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-58-10" name="__codelineno-58-10"></a><span class="w">        </span><span class="nx">writer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">DebugWriterFrom</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<a id="__codelineno-58-11" name="__codelineno-58-11"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">updateQuery</span><span class="p">)</span>
<a id="__codelineno-58-12" name="__codelineno-58-12"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">values</span><span class="p">)</span>
<a id="__codelineno-58-13" name="__codelineno-58-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-58-14" name="__codelineno-58-14"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">exec</span><span class="p">.</span><span class="nx">ExecContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">updateQuery</span><span class="p">,</span><span class="w"> </span><span class="nx">values</span><span class="o">...</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-58-15" name="__codelineno-58-15"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;failed to update foreign table&quot;</span><span class="p">)</span>
<a id="__codelineno-58-16" name="__codelineno-58-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-58-17" name="__codelineno-58-17"></a>
<a id="__codelineno-58-18" name="__codelineno-58-18"></a><span class="w">    </span><span class="nx">related</span><span class="p">.</span><span class="nx">UserID</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">UserID</span>
<a id="__codelineno-58-19" name="__codelineno-58-19"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>insert</code> が <code>false</code> の場合（既存のレコードを更新）:</li>
<li><code>UPDATE</code> クエリを作成し、<code>points</code> テーブルの <code>user_id</code> を更新。</li>
<li>デバッグモードの場合、クエリと値を出力。</li>
<li>クエリを実行し、エラーチェック。</li>
<li><code>related.UserID</code> を更新。</li>
</ul>
</li>
<li>
<p><strong>リレーションシップの設定</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-59-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-59-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-59-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-59-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-59-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-59-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-59-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-59-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-59-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-59-10">10</a></span>
<span class="normal"><a href="#__codelineno-59-11">11</a></span>
<span class="normal"><a href="#__codelineno-59-12">12</a></span>
<span class="normal"><a href="#__codelineno-59-13">13</a></span>
<span class="normal"><a href="#__codelineno-59-14">14</a></span>
<span class="normal"><a href="#__codelineno-59-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1"></a><span class="k">if</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-59-2" name="__codelineno-59-2"></a><span class="w">    </span><span class="nx">o</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">userR</span><span class="p">{</span>
<a id="__codelineno-59-3" name="__codelineno-59-3"></a><span class="w">        </span><span class="nx">Point</span><span class="p">:</span><span class="w"> </span><span class="nx">related</span><span class="p">,</span>
<a id="__codelineno-59-4" name="__codelineno-59-4"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-59-5" name="__codelineno-59-5"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-59-6" name="__codelineno-59-6"></a><span class="w">    </span><span class="nx">o</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">Point</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">related</span>
<a id="__codelineno-59-7" name="__codelineno-59-7"></a><span class="p">}</span>
<a id="__codelineno-59-8" name="__codelineno-59-8"></a>
<a id="__codelineno-59-9" name="__codelineno-59-9"></a><span class="k">if</span><span class="w"> </span><span class="nx">related</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-59-10" name="__codelineno-59-10"></a><span class="w">    </span><span class="nx">related</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">pointR</span><span class="p">{</span>
<a id="__codelineno-59-11" name="__codelineno-59-11"></a><span class="w">        </span><span class="nx">User</span><span class="p">:</span><span class="w"> </span><span class="nx">o</span><span class="p">,</span>
<a id="__codelineno-59-12" name="__codelineno-59-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-59-13" name="__codelineno-59-13"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-59-14" name="__codelineno-59-14"></a><span class="w">    </span><span class="nx">related</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">User</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">o</span>
<a id="__codelineno-59-15" name="__codelineno-59-15"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>User</code> オブジェクトと <code>Point</code> オブジェクトの双方向のリレーションシップを設定。</li>
<li><code>o.R</code> は <code>User</code> オブジェクトのリレーションを格納するフィールド。</li>
<li><code>related.R</code> は <code>Point</code> オブジェクトのリレーションを格納するフィールド。</li>
</ul>
</li>
<li>
<p><strong>関数の終了</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-60-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1"></a><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>正常に処理が完了した場合、<code>nil</code> を返す。</li>
</ul>
</li>
</ol>
<h3 id="_76">利用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-61-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-61-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-61-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-61-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-61-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-61-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-61-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-61-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-61-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-61-10">10</a></span>
<span class="normal"><a href="#__codelineno-61-11">11</a></span>
<span class="normal"><a href="#__codelineno-61-12">12</a></span>
<span class="normal"><a href="#__codelineno-61-13">13</a></span>
<span class="normal"><a href="#__codelineno-61-14">14</a></span>
<span class="normal"><a href="#__codelineno-61-15">15</a></span>
<span class="normal"><a href="#__codelineno-61-16">16</a></span>
<span class="normal"><a href="#__codelineno-61-17">17</a></span>
<span class="normal"><a href="#__codelineno-61-18">18</a></span>
<span class="normal"><a href="#__codelineno-61-19">19</a></span>
<span class="normal"><a href="#__codelineno-61-20">20</a></span>
<span class="normal"><a href="#__codelineno-61-21">21</a></span>
<span class="normal"><a href="#__codelineno-61-22">22</a></span>
<span class="normal"><a href="#__codelineno-61-23">23</a></span>
<span class="normal"><a href="#__codelineno-61-24">24</a></span>
<span class="normal"><a href="#__codelineno-61-25">25</a></span>
<span class="normal"><a href="#__codelineno-61-26">26</a></span>
<span class="normal"><a href="#__codelineno-61-27">27</a></span>
<span class="normal"><a href="#__codelineno-61-28">28</a></span>
<span class="normal"><a href="#__codelineno-61-29">29</a></span>
<span class="normal"><a href="#__codelineno-61-30">30</a></span>
<span class="normal"><a href="#__codelineno-61-31">31</a></span>
<span class="normal"><a href="#__codelineno-61-32">32</a></span>
<span class="normal"><a href="#__codelineno-61-33">33</a></span>
<span class="normal"><a href="#__codelineno-61-34">34</a></span>
<span class="normal"><a href="#__codelineno-61-35">35</a></span>
<span class="normal"><a href="#__codelineno-61-36">36</a></span>
<span class="normal"><a href="#__codelineno-61-37">37</a></span>
<span class="normal"><a href="#__codelineno-61-38">38</a></span>
<span class="normal"><a href="#__codelineno-61-39">39</a></span>
<span class="normal"><a href="#__codelineno-61-40">40</a></span>
<span class="normal"><a href="#__codelineno-61-41">41</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-61-2" name="__codelineno-61-2"></a>
<a id="__codelineno-61-3" name="__codelineno-61-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-61-4" name="__codelineno-61-4"></a><span class="w">    </span><span class="s">&quot;context&quot;</span>
<a id="__codelineno-61-5" name="__codelineno-61-5"></a><span class="w">    </span><span class="s">&quot;database/sql&quot;</span>
<a id="__codelineno-61-6" name="__codelineno-61-6"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-61-7" name="__codelineno-61-7"></a>
<a id="__codelineno-61-8" name="__codelineno-61-8"></a><span class="w">    </span><span class="nx">_</span><span class="w"> </span><span class="s">&quot;github.com/go-sql-driver/mysql&quot;</span>
<a id="__codelineno-61-9" name="__codelineno-61-9"></a><span class="w">    </span><span class="s">&quot;github.com/volatiletech/sqlboiler/boil&quot;</span>
<a id="__codelineno-61-10" name="__codelineno-61-10"></a><span class="p">)</span>
<a id="__codelineno-61-11" name="__codelineno-61-11"></a>
<a id="__codelineno-61-12" name="__codelineno-61-12"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-61-13" name="__codelineno-61-13"></a><span class="w">    </span><span class="c1">// データベース接続の設定</span>
<a id="__codelineno-61-14" name="__codelineno-61-14"></a><span class="w">    </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-61-15" name="__codelineno-61-15"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-61-16" name="__codelineno-61-16"></a><span class="w">        </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-61-17" name="__codelineno-61-17"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-61-18" name="__codelineno-61-18"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-61-19" name="__codelineno-61-19"></a>
<a id="__codelineno-61-20" name="__codelineno-61-20"></a><span class="w">    </span><span class="c1">// コンテキストの作成</span>
<a id="__codelineno-61-21" name="__codelineno-61-21"></a><span class="w">    </span><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-61-22" name="__codelineno-61-22"></a>
<a id="__codelineno-61-23" name="__codelineno-61-23"></a><span class="w">    </span><span class="c1">// ユーザーの取得</span>
<a id="__codelineno-61-24" name="__codelineno-61-24"></a><span class="w">    </span><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">FindUser</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-61-25" name="__codelineno-61-25"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-61-26" name="__codelineno-61-26"></a><span class="w">        </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-61-27" name="__codelineno-61-27"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-61-28" name="__codelineno-61-28"></a>
<a id="__codelineno-61-29" name="__codelineno-61-29"></a><span class="w">    </span><span class="c1">// 新しいポイントの作成</span>
<a id="__codelineno-61-30" name="__codelineno-61-30"></a><span class="w">    </span><span class="nx">point</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Point</span><span class="p">{</span>
<a id="__codelineno-61-31" name="__codelineno-61-31"></a><span class="w">        </span><span class="nx">Points</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-61-32" name="__codelineno-61-32"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-61-33" name="__codelineno-61-33"></a>
<a id="__codelineno-61-34" name="__codelineno-61-34"></a><span class="w">    </span><span class="c1">// ポイントをユーザーに設定</span>
<a id="__codelineno-61-35" name="__codelineno-61-35"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">SetPoint</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">point</span><span class="p">)</span>
<a id="__codelineno-61-36" name="__codelineno-61-36"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-61-37" name="__codelineno-61-37"></a><span class="w">        </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-61-38" name="__codelineno-61-38"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-61-39" name="__codelineno-61-39"></a>
<a id="__codelineno-61-40" name="__codelineno-61-40"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;ポイントが設定されました。&quot;</span><span class="p">)</span>
<a id="__codelineno-61-41" name="__codelineno-61-41"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="2-addcheckinlogs">2. <code>AddCheckinLogs</code> 関数</h2>
<h3 id="_77">説明</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-62-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">User</span><span class="p">)</span><span class="w"> </span><span class="nx">AddCheckinLogs</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">insert</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="nx">related</span><span class="w"> </span><span class="o">...*</span><span class="nx">CheckinLog</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>目的</strong>: ユーザーに関連するチェックインログ（<code>CheckinLog</code>）を追加します。必要に応じて新しいレコードをデータベースに挿入します。</li>
<li><strong>パラメータ</strong>:</li>
<li><code>related ...*CheckinLog</code>: 追加する <code>CheckinLog</code> オブジェクトの可変長引数。</li>
<li><strong>戻り値</strong>: エラー情報。</li>
</ul>
<h3 id="_78">コードの詳細な解説</h3>
<ol>
<li>
<p><strong>エラーハンドリングの変数初期化</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-63-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span>
</code></pre></div></td></tr></table></div>
</li>
<li>
<p><strong>関連オブジェクトの処理</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-64-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-64-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-64-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-64-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-64-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-64-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-64-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-64-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-64-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-64-10">10</a></span>
<span class="normal"><a href="#__codelineno-64-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1"></a><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">rel</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">related</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-64-2" name="__codelineno-64-2"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">insert</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-64-3" name="__codelineno-64-3"></a><span class="w">        </span><span class="nx">rel</span><span class="p">.</span><span class="nx">UserID</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">UserID</span>
<a id="__codelineno-64-4" name="__codelineno-64-4"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">rel</span><span class="p">.</span><span class="nx">Insert</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">Infer</span><span class="p">());</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-64-5" name="__codelineno-64-5"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;failed to insert into foreign table&quot;</span><span class="p">)</span>
<a id="__codelineno-64-6" name="__codelineno-64-6"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-64-7" name="__codelineno-64-7"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-64-8" name="__codelineno-64-8"></a><span class="w">        </span><span class="c1">// 既存のレコードの更新</span>
<a id="__codelineno-64-9" name="__codelineno-64-9"></a><span class="w">        </span><span class="c1">// ...</span>
<a id="__codelineno-64-10" name="__codelineno-64-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-64-11" name="__codelineno-64-11"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>各 <code>CheckinLog</code> オブジェクト（<code>rel</code>）に対して処理を行います。</li>
<li><code>insert</code> が <code>true</code> の場合、<code>rel.UserID</code> を設定し、新しいレコードとして挿入。</li>
</ul>
</li>
<li>
<p><strong>既存レコードの更新</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-65-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-65-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-65-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-65-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-65-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-65-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-65-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-65-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-65-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-65-10">10</a></span>
<span class="normal"><a href="#__codelineno-65-11">11</a></span>
<span class="normal"><a href="#__codelineno-65-12">12</a></span>
<span class="normal"><a href="#__codelineno-65-13">13</a></span>
<span class="normal"><a href="#__codelineno-65-14">14</a></span>
<span class="normal"><a href="#__codelineno-65-15">15</a></span>
<span class="normal"><a href="#__codelineno-65-16">16</a></span>
<span class="normal"><a href="#__codelineno-65-17">17</a></span>
<span class="normal"><a href="#__codelineno-65-18">18</a></span>
<span class="normal"><a href="#__codelineno-65-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1"></a><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-65-2" name="__codelineno-65-2"></a><span class="w">    </span><span class="nx">updateQuery</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span>
<a id="__codelineno-65-3" name="__codelineno-65-3"></a><span class="w">        </span><span class="s">&quot;UPDATE `checkin_logs` SET %s WHERE %s&quot;</span><span class="p">,</span>
<a id="__codelineno-65-4" name="__codelineno-65-4"></a><span class="w">        </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">SetParamNames</span><span class="p">(</span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;user_id&quot;</span><span class="p">}),</span>
<a id="__codelineno-65-5" name="__codelineno-65-5"></a><span class="w">        </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">WhereClause</span><span class="p">(</span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">checkinLogPrimaryKeyColumns</span><span class="p">),</span>
<a id="__codelineno-65-6" name="__codelineno-65-6"></a><span class="w">    </span><span class="p">)</span>
<a id="__codelineno-65-7" name="__codelineno-65-7"></a><span class="w">    </span><span class="nx">values</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span><span class="nx">o</span><span class="p">.</span><span class="nx">UserID</span><span class="p">,</span><span class="w"> </span><span class="nx">rel</span><span class="p">.</span><span class="nx">CreatedAt</span><span class="p">,</span><span class="w"> </span><span class="nx">rel</span><span class="p">.</span><span class="nx">UserID</span><span class="p">}</span>
<a id="__codelineno-65-8" name="__codelineno-65-8"></a>
<a id="__codelineno-65-9" name="__codelineno-65-9"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">IsDebug</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-65-10" name="__codelineno-65-10"></a><span class="w">        </span><span class="nx">writer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">DebugWriterFrom</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<a id="__codelineno-65-11" name="__codelineno-65-11"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">updateQuery</span><span class="p">)</span>
<a id="__codelineno-65-12" name="__codelineno-65-12"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">values</span><span class="p">)</span>
<a id="__codelineno-65-13" name="__codelineno-65-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-65-14" name="__codelineno-65-14"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">exec</span><span class="p">.</span><span class="nx">ExecContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">updateQuery</span><span class="p">,</span><span class="w"> </span><span class="nx">values</span><span class="o">...</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-65-15" name="__codelineno-65-15"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;failed to update foreign table&quot;</span><span class="p">)</span>
<a id="__codelineno-65-16" name="__codelineno-65-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-65-17" name="__codelineno-65-17"></a>
<a id="__codelineno-65-18" name="__codelineno-65-18"></a><span class="w">    </span><span class="nx">rel</span><span class="p">.</span><span class="nx">UserID</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">UserID</span>
<a id="__codelineno-65-19" name="__codelineno-65-19"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>insert</code> が <code>false</code> の場合、既存の <code>CheckinLog</code> レコードの <code>user_id</code> を更新。</li>
</ul>
</li>
<li>
<p><strong>リレーションシップの設定</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-66-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-66-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-66-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-66-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-66-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-66-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-66-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-66-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-66-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-66-10">10</a></span>
<span class="normal"><a href="#__codelineno-66-11">11</a></span>
<span class="normal"><a href="#__codelineno-66-12">12</a></span>
<span class="normal"><a href="#__codelineno-66-13">13</a></span>
<span class="normal"><a href="#__codelineno-66-14">14</a></span>
<span class="normal"><a href="#__codelineno-66-15">15</a></span>
<span class="normal"><a href="#__codelineno-66-16">16</a></span>
<span class="normal"><a href="#__codelineno-66-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1"></a><span class="k">if</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-66-2" name="__codelineno-66-2"></a><span class="w">    </span><span class="nx">o</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">userR</span><span class="p">{</span>
<a id="__codelineno-66-3" name="__codelineno-66-3"></a><span class="w">        </span><span class="nx">CheckinLogs</span><span class="p">:</span><span class="w"> </span><span class="nx">related</span><span class="p">,</span>
<a id="__codelineno-66-4" name="__codelineno-66-4"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-66-5" name="__codelineno-66-5"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-66-6" name="__codelineno-66-6"></a><span class="w">    </span><span class="nx">o</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">CheckinLogs</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">CheckinLogs</span><span class="p">,</span><span class="w"> </span><span class="nx">related</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-66-7" name="__codelineno-66-7"></a><span class="p">}</span>
<a id="__codelineno-66-8" name="__codelineno-66-8"></a>
<a id="__codelineno-66-9" name="__codelineno-66-9"></a><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">rel</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">related</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-66-10" name="__codelineno-66-10"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">rel</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-66-11" name="__codelineno-66-11"></a><span class="w">        </span><span class="nx">rel</span><span class="p">.</span><span class="nx">R</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">checkinLogR</span><span class="p">{</span>
<a id="__codelineno-66-12" name="__codelineno-66-12"></a><span class="w">            </span><span class="nx">User</span><span class="p">:</span><span class="w"> </span><span class="nx">o</span><span class="p">,</span>
<a id="__codelineno-66-13" name="__codelineno-66-13"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-66-14" name="__codelineno-66-14"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-66-15" name="__codelineno-66-15"></a><span class="w">        </span><span class="nx">rel</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">User</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">o</span>
<a id="__codelineno-66-16" name="__codelineno-66-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-66-17" name="__codelineno-66-17"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ユーザーとチェックインログ間のリレーションシップを設定。</li>
</ul>
</li>
<li>
<p><strong>関数の終了</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-67-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1"></a><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
</code></pre></div></td></tr></table></div>
</li>
</ol>
<h3 id="_79">利用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-68-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-68-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-68-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-68-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-68-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-68-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-68-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-68-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-68-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-68-10">10</a></span>
<span class="normal"><a href="#__codelineno-68-11">11</a></span>
<span class="normal"><a href="#__codelineno-68-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1"></a><span class="c1">// チェックインログの追加</span>
<a id="__codelineno-68-2" name="__codelineno-68-2"></a><span class="nx">checkinLog</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">CheckinLog</span><span class="p">{</span>
<a id="__codelineno-68-3" name="__codelineno-68-3"></a><span class="w">    </span><span class="nx">CreatedAt</span><span class="p">:</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">(),</span>
<a id="__codelineno-68-4" name="__codelineno-68-4"></a><span class="w">    </span><span class="nx">Location</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;東京駅&quot;</span><span class="p">,</span>
<a id="__codelineno-68-5" name="__codelineno-68-5"></a><span class="p">}</span>
<a id="__codelineno-68-6" name="__codelineno-68-6"></a>
<a id="__codelineno-68-7" name="__codelineno-68-7"></a><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">AddCheckinLogs</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">checkinLog</span><span class="p">)</span>
<a id="__codelineno-68-8" name="__codelineno-68-8"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-68-9" name="__codelineno-68-9"></a><span class="w">    </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-68-10" name="__codelineno-68-10"></a><span class="p">}</span>
<a id="__codelineno-68-11" name="__codelineno-68-11"></a>
<a id="__codelineno-68-12" name="__codelineno-68-12"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;チェックインログが追加されました。&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="3-addpointlogs">3. <code>AddPointLogs</code> 関数</h2>
<h3 id="_80">説明</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-69-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">User</span><span class="p">)</span><span class="w"> </span><span class="nx">AddPointLogs</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">insert</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="nx">related</span><span class="w"> </span><span class="o">...*</span><span class="nx">PointLog</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>目的</strong>: ユーザーに関連するポイントログ（<code>PointLog</code>）を追加します。</li>
<li><strong>パラメータ</strong>は <code>AddCheckinLogs</code> と同様。</li>
</ul>
<h3 id="_81">コードの詳細な解説</h3>
<ul>
<li>この関数は <code>AddCheckinLogs</code> とほぼ同様の構造を持ちますが、対象が <code>PointLog</code> である点が異なります。</li>
<li>コードの各部分は <code>AddCheckinLogs</code> の場合と同様に機能します。</li>
</ul>
<h3 id="_82">利用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-70-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-70-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-70-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-70-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-70-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-70-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-70-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-70-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-70-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-70-10">10</a></span>
<span class="normal"><a href="#__codelineno-70-11">11</a></span>
<span class="normal"><a href="#__codelineno-70-12">12</a></span>
<span class="normal"><a href="#__codelineno-70-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1"></a><span class="c1">// ポイントログの追加</span>
<a id="__codelineno-70-2" name="__codelineno-70-2"></a><span class="nx">pointLog</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">PointLog</span><span class="p">{</span>
<a id="__codelineno-70-3" name="__codelineno-70-3"></a><span class="w">    </span><span class="nx">CreatedAt</span><span class="p">:</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">(),</span>
<a id="__codelineno-70-4" name="__codelineno-70-4"></a><span class="w">    </span><span class="nx">Points</span><span class="p">:</span><span class="w">    </span><span class="mi">50</span><span class="p">,</span>
<a id="__codelineno-70-5" name="__codelineno-70-5"></a><span class="w">    </span><span class="nx">Reason</span><span class="p">:</span><span class="w">    </span><span class="s">&quot;ミッション達成&quot;</span><span class="p">,</span>
<a id="__codelineno-70-6" name="__codelineno-70-6"></a><span class="p">}</span>
<a id="__codelineno-70-7" name="__codelineno-70-7"></a>
<a id="__codelineno-70-8" name="__codelineno-70-8"></a><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">AddPointLogs</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">pointLog</span><span class="p">)</span>
<a id="__codelineno-70-9" name="__codelineno-70-9"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-70-10" name="__codelineno-70-10"></a><span class="w">    </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-70-11" name="__codelineno-70-11"></a><span class="p">}</span>
<a id="__codelineno-70-12" name="__codelineno-70-12"></a>
<a id="__codelineno-70-13" name="__codelineno-70-13"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;ポイントログが追加されました。&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="4-addseichies">4. <code>AddSeichies</code> 関数</h2>
<h3 id="_83">説明</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-71-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">User</span><span class="p">)</span><span class="w"> </span><span class="nx">AddSeichies</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">insert</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="nx">related</span><span class="w"> </span><span class="o">...*</span><span class="nx">Seichy</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>目的</strong>: ユーザーに関連する聖地（<code>Seichy</code>）を追加します。</li>
<li><strong>パラメータ</strong>は前述の関数と同様。</li>
</ul>
<h3 id="_84">コードの詳細な解説</h3>
<ul>
<li>この関数も上記の <code>AddCheckinLogs</code>、<code>AddPointLogs</code> と同様のパターンです。</li>
<li>対象が <code>Seichy</code> オブジェクトである点が異なります。</li>
</ul>
<h3 id="_85">利用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-72-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-72-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-72-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-72-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-72-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-72-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-72-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-72-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-72-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-72-10">10</a></span>
<span class="normal"><a href="#__codelineno-72-11">11</a></span>
<span class="normal"><a href="#__codelineno-72-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1"></a><span class="c1">// 聖地の追加</span>
<a id="__codelineno-72-2" name="__codelineno-72-2"></a><span class="nx">seichy</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Seichy</span><span class="p">{</span>
<a id="__codelineno-72-3" name="__codelineno-72-3"></a><span class="w">    </span><span class="nx">SeichiID</span><span class="p">:</span><span class="w"> </span><span class="mi">123</span><span class="p">,</span>
<a id="__codelineno-72-4" name="__codelineno-72-4"></a><span class="w">    </span><span class="nx">Name</span><span class="p">:</span><span class="w">     </span><span class="s">&quot;秋葉原&quot;</span><span class="p">,</span>
<a id="__codelineno-72-5" name="__codelineno-72-5"></a><span class="p">}</span>
<a id="__codelineno-72-6" name="__codelineno-72-6"></a>
<a id="__codelineno-72-7" name="__codelineno-72-7"></a><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">AddSeichies</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">seichy</span><span class="p">)</span>
<a id="__codelineno-72-8" name="__codelineno-72-8"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-72-9" name="__codelineno-72-9"></a><span class="w">    </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-72-10" name="__codelineno-72-10"></a><span class="p">}</span>
<a id="__codelineno-72-11" name="__codelineno-72-11"></a>
<a id="__codelineno-72-12" name="__codelineno-72-12"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;聖地が追加されました。&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="5-users">5. <code>Users</code> 関数</h2>
<h3 id="_86">説明</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-73-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">Users</span><span class="p">(</span><span class="nx">mods</span><span class="w"> </span><span class="o">...</span><span class="nx">qm</span><span class="p">.</span><span class="nx">QueryMod</span><span class="p">)</span><span class="w"> </span><span class="nx">userQuery</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>目的</strong>: ユーザーテーブルからレコードを取得するためのクエリを生成します。</li>
<li><strong>パラメータ</strong>:</li>
<li><code>mods ...qm.QueryMod</code>: クエリモディファイア。クエリに条件を追加するために使用。</li>
</ul>
<h3 id="_87">コードの詳細な解説</h3>
<ol>
<li>
<p><strong>クエリモディファイアの設定</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-74-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1"></a><span class="nx">mods</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">mods</span><span class="p">,</span><span class="w"> </span><span class="nx">qm</span><span class="p">.</span><span class="nx">From</span><span class="p">(</span><span class="s">&quot;`users`&quot;</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>users</code> テーブルをクエリの対象とします。</li>
</ul>
</li>
<li>
<p><strong>クエリの生成</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-75-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1"></a><span class="nx">q</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">NewQuery</span><span class="p">(</span><span class="nx">mods</span><span class="o">...</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</li>
<li>
<p><strong>デフォルトの SELECT 列の設定</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-76-1">1</a></span>
<span class="normal"><a href="#__codelineno-76-2">2</a></span>
<span class="normal"><a href="#__codelineno-76-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1"></a><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">queries</span><span class="p">.</span><span class="nx">GetSelect</span><span class="p">(</span><span class="nx">q</span><span class="p">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-76-2" name="__codelineno-76-2"></a><span class="w">    </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetSelect</span><span class="p">(</span><span class="nx">q</span><span class="p">,</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;`users`.*&quot;</span><span class="p">})</span>
<a id="__codelineno-76-3" name="__codelineno-76-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>SELECT 句が指定されていない場合、<code>users</code> テーブルの全ての列を選択。</li>
</ul>
</li>
<li>
<p><strong><code>userQuery</code> オブジェクトを返す</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-77-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1"></a><span class="k">return</span><span class="w"> </span><span class="nx">userQuery</span><span class="p">{</span><span class="nx">q</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</li>
</ol>
<h3 id="_88">利用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-78-1">1</a></span>
<span class="normal"><a href="#__codelineno-78-2">2</a></span>
<span class="normal"><a href="#__codelineno-78-3">3</a></span>
<span class="normal"><a href="#__codelineno-78-4">4</a></span>
<span class="normal"><a href="#__codelineno-78-5">5</a></span>
<span class="normal"><a href="#__codelineno-78-6">6</a></span>
<span class="normal"><a href="#__codelineno-78-7">7</a></span>
<span class="normal"><a href="#__codelineno-78-8">8</a></span>
<span class="normal"><a href="#__codelineno-78-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-78-1" name="__codelineno-78-1"></a><span class="c1">// 全てのユーザーを取得</span>
<a id="__codelineno-78-2" name="__codelineno-78-2"></a><span class="nx">users</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Users</span><span class="p">().</span><span class="nx">All</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-78-3" name="__codelineno-78-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-78-4" name="__codelineno-78-4"></a><span class="w">    </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-78-5" name="__codelineno-78-5"></a><span class="p">}</span>
<a id="__codelineno-78-6" name="__codelineno-78-6"></a>
<a id="__codelineno-78-7" name="__codelineno-78-7"></a><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">users</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-78-8" name="__codelineno-78-8"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
<a id="__codelineno-78-9" name="__codelineno-78-9"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="6-finduser">6. <code>FindUser</code> 関数</h2>
<h3 id="_89">説明</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-79-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">FindUser</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">userID</span><span class="w"> </span><span class="kt">uint</span><span class="p">,</span><span class="w"> </span><span class="nx">selectCols</span><span class="w"> </span><span class="o">...</span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">User</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>目的</strong>: 指定した <code>userID</code> のユーザーをデータベースから取得します。</li>
<li><strong>パラメータ</strong>:</li>
<li><code>userID uint</code>: 取得したいユーザーのID。</li>
<li><code>selectCols ...string</code>: 取得する列を指定。省略した場合、全ての列を取得。</li>
</ul>
<h3 id="_90">コードの詳細な解説</h3>
<ol>
<li>
<p><strong>ユーザーオブジェクトの初期化</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-80-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-80-1" name="__codelineno-80-1"></a><span class="nx">userObj</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">User</span><span class="p">{}</span>
</code></pre></div></td></tr></table></div>
</li>
<li>
<p><strong>SELECT 句の設定</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-81-1">1</a></span>
<span class="normal"><a href="#__codelineno-81-2">2</a></span>
<span class="normal"><a href="#__codelineno-81-3">3</a></span>
<span class="normal"><a href="#__codelineno-81-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-81-1" name="__codelineno-81-1"></a><span class="nx">sel</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;*&quot;</span>
<a id="__codelineno-81-2" name="__codelineno-81-2"></a><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">selectCols</span><span class="p">)</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-81-3" name="__codelineno-81-3"></a><span class="w">    </span><span class="nx">sel</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">Join</span><span class="p">(</span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">IdentQuoteSlice</span><span class="p">(</span><span class="nx">dialect</span><span class="p">.</span><span class="nx">LQ</span><span class="p">,</span><span class="w"> </span><span class="nx">dialect</span><span class="p">.</span><span class="nx">RQ</span><span class="p">,</span><span class="w"> </span><span class="nx">selectCols</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;,&quot;</span><span class="p">)</span>
<a id="__codelineno-81-4" name="__codelineno-81-4"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>selectCols</code> が指定されていれば、それらの列のみを取得。</li>
</ul>
</li>
<li>
<p><strong>クエリの作成</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-82-1">1</a></span>
<span class="normal"><a href="#__codelineno-82-2">2</a></span>
<span class="normal"><a href="#__codelineno-82-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-82-1" name="__codelineno-82-1"></a><span class="nx">query</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span>
<a id="__codelineno-82-2" name="__codelineno-82-2"></a><span class="w">    </span><span class="s">&quot;select %s from `users` where `user_id`=?&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">sel</span><span class="p">,</span>
<a id="__codelineno-82-3" name="__codelineno-82-3"></a><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</li>
<li>
<p><strong>クエリの実行と結果のバインド</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-83-1">1</a></span>
<span class="normal"><a href="#__codelineno-83-2">2</a></span>
<span class="normal"><a href="#__codelineno-83-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-83-1" name="__codelineno-83-1"></a><span class="nx">q</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">Raw</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span><span class="w"> </span><span class="nx">userID</span><span class="p">)</span>
<a id="__codelineno-83-2" name="__codelineno-83-2"></a>
<a id="__codelineno-83-3" name="__codelineno-83-3"></a><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">q</span><span class="p">.</span><span class="nx">Bind</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="nx">userObj</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>クエリを実行し、結果を <code>userObj</code> にバインド。</li>
</ul>
</li>
<li>
<p><strong>エラーチェックとフックの実行</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-84-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-84-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-84-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-84-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-84-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-84-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-84-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-84-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-84-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-84-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-84-1" name="__codelineno-84-1"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-84-2" name="__codelineno-84-2"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Is</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">ErrNoRows</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-84-3" name="__codelineno-84-3"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">ErrNoRows</span>
<a id="__codelineno-84-4" name="__codelineno-84-4"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-84-5" name="__codelineno-84-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to select from users&quot;</span><span class="p">)</span>
<a id="__codelineno-84-6" name="__codelineno-84-6"></a><span class="p">}</span>
<a id="__codelineno-84-7" name="__codelineno-84-7"></a>
<a id="__codelineno-84-8" name="__codelineno-84-8"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">userObj</span><span class="p">.</span><span class="nx">doAfterSelectHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-84-9" name="__codelineno-84-9"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">userObj</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-84-10" name="__codelineno-84-10"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ユーザーが存在しない場合、<code>sql.ErrNoRows</code> を返す。</li>
<li>フックが設定されている場合、実行。</li>
</ul>
</li>
<li>
<p><strong>ユーザーオブジェクトを返す</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-85-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-85-1" name="__codelineno-85-1"></a><span class="k">return</span><span class="w"> </span><span class="nx">userObj</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
</code></pre></div></td></tr></table></div>
</li>
</ol>
<h3 id="_91">利用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-86-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-86-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-86-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-86-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-86-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-86-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-86-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-86-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-86-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-86-10">10</a></span>
<span class="normal"><a href="#__codelineno-86-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-86-1" name="__codelineno-86-1"></a><span class="c1">// ユーザーIDが1のユーザーを取得</span>
<a id="__codelineno-86-2" name="__codelineno-86-2"></a><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">FindUser</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-86-3" name="__codelineno-86-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-86-4" name="__codelineno-86-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Is</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">ErrNoRows</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-86-5" name="__codelineno-86-5"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;ユーザーが見つかりませんでした。&quot;</span><span class="p">)</span>
<a id="__codelineno-86-6" name="__codelineno-86-6"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-86-7" name="__codelineno-86-7"></a><span class="w">        </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-86-8" name="__codelineno-86-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-86-9" name="__codelineno-86-9"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-86-10" name="__codelineno-86-10"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;ユーザー名: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
<a id="__codelineno-86-11" name="__codelineno-86-11"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="insert"><code>Insert</code> 関数と関連関数の詳細な解説と利用例</h2>
<p>以下のGoコードは、データベースへのレコードの挿入や更新、削除を行うためのORM（Object-Relational Mapping）ライブラリの一部です。このドキュメントでは、<code>Insert</code>、<code>Update</code>、<code>UpdateAll</code> 関数と関連するキャッシュ機構について詳細に解説し、開発者が理解しやすいように具体的な利用例も示します。</p>
<hr />
<h2 id="1-insert">1. <code>Insert</code> 関数</h2>
<h3 id="_92">説明</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-87-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-87-1" name="__codelineno-87-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">User</span><span class="p">)</span><span class="w"> </span><span class="nx">Insert</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">columns</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">Columns</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>目的</strong>: <code>User</code> オブジェクトをデータベースの <code>users</code> テーブルに挿入します。</li>
<li><strong>パラメータ</strong>:</li>
<li><code>ctx context.Context</code>: コンテキスト。タイムアウトやキャンセルの制御に使用します。</li>
<li><code>exec boil.ContextExecutor</code>: データベースへの実行を行うエグゼキュータ。通常はデータベース接続やトランザクションを指定します。</li>
<li><code>columns boil.Columns</code>: 挿入するカラムを指定します。カラムのホワイトリストやブラックリストを使用できます。</li>
</ul>
<h3 id="_93">コードの詳細な解説</h3>
<ol>
<li>
<p><strong>Null チェック</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-88-1">1</a></span>
<span class="normal"><a href="#__codelineno-88-2">2</a></span>
<span class="normal"><a href="#__codelineno-88-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-88-1" name="__codelineno-88-1"></a><span class="k">if</span><span class="w"> </span><span class="nx">o</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-88-2" name="__codelineno-88-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;models: no users provided for insertion&quot;</span><span class="p">)</span>
<a id="__codelineno-88-3" name="__codelineno-88-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>User</code> オブジェクトが <code>nil</code> の場合、エラーを返します。</li>
</ul>
</li>
<li>
<p><strong>タイムスタンプの設定</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-89-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-89-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-89-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-89-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-89-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-89-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-89-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-89-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-89-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-89-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-89-1" name="__codelineno-89-1"></a><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">boil</span><span class="p">.</span><span class="nx">TimestampsAreSkipped</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-89-2" name="__codelineno-89-2"></a><span class="w">    </span><span class="nx">currTime</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">In</span><span class="p">(</span><span class="nx">boil</span><span class="p">.</span><span class="nx">GetLocation</span><span class="p">())</span>
<a id="__codelineno-89-3" name="__codelineno-89-3"></a>
<a id="__codelineno-89-4" name="__codelineno-89-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">MustTime</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">CreatedAt</span><span class="p">).</span><span class="nx">IsZero</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-89-5" name="__codelineno-89-5"></a><span class="w">        </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetScanner</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">o</span><span class="p">.</span><span class="nx">CreatedAt</span><span class="p">,</span><span class="w"> </span><span class="nx">currTime</span><span class="p">)</span>
<a id="__codelineno-89-6" name="__codelineno-89-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-89-7" name="__codelineno-89-7"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">MustTime</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">UpdatedAt</span><span class="p">).</span><span class="nx">IsZero</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-89-8" name="__codelineno-89-8"></a><span class="w">        </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetScanner</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">o</span><span class="p">.</span><span class="nx">UpdatedAt</span><span class="p">,</span><span class="w"> </span><span class="nx">currTime</span><span class="p">)</span>
<a id="__codelineno-89-9" name="__codelineno-89-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-89-10" name="__codelineno-89-10"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>コンテキストでタイムスタンプのスキップが指定されていない場合、<code>CreatedAt</code> と <code>UpdatedAt</code> フィールドに現在時刻を設定します。</li>
</ul>
</li>
<li>
<p><strong>Before Insert フックの実行</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-90-1">1</a></span>
<span class="normal"><a href="#__codelineno-90-2">2</a></span>
<span class="normal"><a href="#__codelineno-90-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-90-1" name="__codelineno-90-1"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">doBeforeInsertHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-90-2" name="__codelineno-90-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-90-3" name="__codelineno-90-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>挿入前に定義されたフック関数を実行します。</li>
</ul>
</li>
<li>
<p><strong>デフォルト値の設定</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-91-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-91-1" name="__codelineno-91-1"></a><span class="nx">nzDefaults</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">NonZeroDefaultSet</span><span class="p">(</span><span class="nx">userColumnsWithDefault</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>デフォルト値が設定されているカラムのうち、非ゼロの値を持つものを収集します。</li>
</ul>
</li>
<li>
<p><strong>キャッシュキーの作成とキャッシュの取得</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-92-1">1</a></span>
<span class="normal"><a href="#__codelineno-92-2">2</a></span>
<span class="normal"><a href="#__codelineno-92-3">3</a></span>
<span class="normal"><a href="#__codelineno-92-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-92-1" name="__codelineno-92-1"></a><span class="nx">key</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">makeCacheKey</span><span class="p">(</span><span class="nx">columns</span><span class="p">,</span><span class="w"> </span><span class="nx">nzDefaults</span><span class="p">)</span>
<a id="__codelineno-92-2" name="__codelineno-92-2"></a><span class="nx">userInsertCacheMut</span><span class="p">.</span><span class="nx">RLock</span><span class="p">()</span>
<a id="__codelineno-92-3" name="__codelineno-92-3"></a><span class="nx">cache</span><span class="p">,</span><span class="w"> </span><span class="nx">cached</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">userInsertCache</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
<a id="__codelineno-92-4" name="__codelineno-92-4"></a><span class="nx">userInsertCacheMut</span><span class="p">.</span><span class="nx">RUnlock</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>挿入クエリのキャッシュキーを作成し、キャッシュが存在するか確認します。</li>
<li>キャッシュが存在すれば、それを再利用します。</li>
</ul>
</li>
<li>
<p><strong>キャッシュの作成</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-93-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-93-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-93-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-93-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-93-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-93-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-93-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-93-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-93-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-93-10">10</a></span>
<span class="normal"><a href="#__codelineno-93-11">11</a></span>
<span class="normal"><a href="#__codelineno-93-12">12</a></span>
<span class="normal"><a href="#__codelineno-93-13">13</a></span>
<span class="normal"><a href="#__codelineno-93-14">14</a></span>
<span class="normal"><a href="#__codelineno-93-15">15</a></span>
<span class="normal"><a href="#__codelineno-93-16">16</a></span>
<span class="normal"><a href="#__codelineno-93-17">17</a></span>
<span class="normal"><a href="#__codelineno-93-18">18</a></span>
<span class="normal"><a href="#__codelineno-93-19">19</a></span>
<span class="normal"><a href="#__codelineno-93-20">20</a></span>
<span class="normal"><a href="#__codelineno-93-21">21</a></span>
<span class="normal"><a href="#__codelineno-93-22">22</a></span>
<span class="normal"><a href="#__codelineno-93-23">23</a></span>
<span class="normal"><a href="#__codelineno-93-24">24</a></span>
<span class="normal"><a href="#__codelineno-93-25">25</a></span>
<span class="normal"><a href="#__codelineno-93-26">26</a></span>
<span class="normal"><a href="#__codelineno-93-27">27</a></span>
<span class="normal"><a href="#__codelineno-93-28">28</a></span>
<span class="normal"><a href="#__codelineno-93-29">29</a></span>
<span class="normal"><a href="#__codelineno-93-30">30</a></span>
<span class="normal"><a href="#__codelineno-93-31">31</a></span>
<span class="normal"><a href="#__codelineno-93-32">32</a></span>
<span class="normal"><a href="#__codelineno-93-33">33</a></span>
<span class="normal"><a href="#__codelineno-93-34">34</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-93-1" name="__codelineno-93-1"></a><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">cached</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-93-2" name="__codelineno-93-2"></a><span class="w">    </span><span class="c1">// 挿入するカラムと戻り値のカラムを決定</span>
<a id="__codelineno-93-3" name="__codelineno-93-3"></a><span class="w">    </span><span class="nx">wl</span><span class="p">,</span><span class="w"> </span><span class="nx">returnColumns</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">columns</span><span class="p">.</span><span class="nx">InsertColumnSet</span><span class="p">(</span>
<a id="__codelineno-93-4" name="__codelineno-93-4"></a><span class="w">        </span><span class="nx">userAllColumns</span><span class="p">,</span>
<a id="__codelineno-93-5" name="__codelineno-93-5"></a><span class="w">        </span><span class="nx">userColumnsWithDefault</span><span class="p">,</span>
<a id="__codelineno-93-6" name="__codelineno-93-6"></a><span class="w">        </span><span class="nx">userColumnsWithoutDefault</span><span class="p">,</span>
<a id="__codelineno-93-7" name="__codelineno-93-7"></a><span class="w">        </span><span class="nx">nzDefaults</span><span class="p">,</span>
<a id="__codelineno-93-8" name="__codelineno-93-8"></a><span class="w">    </span><span class="p">)</span>
<a id="__codelineno-93-9" name="__codelineno-93-9"></a>
<a id="__codelineno-93-10" name="__codelineno-93-10"></a><span class="w">    </span><span class="c1">// マッピングの作成</span>
<a id="__codelineno-93-11" name="__codelineno-93-11"></a><span class="w">    </span><span class="nx">cache</span><span class="p">.</span><span class="nx">valueMapping</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">BindMapping</span><span class="p">(</span><span class="nx">userType</span><span class="p">,</span><span class="w"> </span><span class="nx">userMapping</span><span class="p">,</span><span class="w"> </span><span class="nx">wl</span><span class="p">)</span>
<a id="__codelineno-93-12" name="__codelineno-93-12"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-93-13" name="__codelineno-93-13"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-93-14" name="__codelineno-93-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-93-15" name="__codelineno-93-15"></a><span class="w">    </span><span class="nx">cache</span><span class="p">.</span><span class="nx">retMapping</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">BindMapping</span><span class="p">(</span><span class="nx">userType</span><span class="p">,</span><span class="w"> </span><span class="nx">userMapping</span><span class="p">,</span><span class="w"> </span><span class="nx">returnColumns</span><span class="p">)</span>
<a id="__codelineno-93-16" name="__codelineno-93-16"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-93-17" name="__codelineno-93-17"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-93-18" name="__codelineno-93-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-93-19" name="__codelineno-93-19"></a>
<a id="__codelineno-93-20" name="__codelineno-93-20"></a><span class="w">    </span><span class="c1">// クエリの組み立て</span>
<a id="__codelineno-93-21" name="__codelineno-93-21"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">wl</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-93-22" name="__codelineno-93-22"></a><span class="w">        </span><span class="nx">cache</span><span class="p">.</span><span class="nx">query</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;INSERT INTO `users` (`%s`) %%sVALUES (%s)%%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">Join</span><span class="p">(</span><span class="nx">wl</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;`,`&quot;</span><span class="p">),</span><span class="w"> </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">Placeholders</span><span class="p">(</span><span class="nx">dialect</span><span class="p">.</span><span class="nx">UseIndexPlaceholders</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">wl</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-93-23" name="__codelineno-93-23"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-93-24" name="__codelineno-93-24"></a><span class="w">        </span><span class="nx">cache</span><span class="p">.</span><span class="nx">query</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;INSERT INTO `users` () VALUES ()%s%s&quot;</span>
<a id="__codelineno-93-25" name="__codelineno-93-25"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-93-26" name="__codelineno-93-26"></a>
<a id="__codelineno-93-27" name="__codelineno-93-27"></a><span class="w">    </span><span class="c1">// 戻り値のクエリが必要な場合の処理</span>
<a id="__codelineno-93-28" name="__codelineno-93-28"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">cache</span><span class="p">.</span><span class="nx">retMapping</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-93-29" name="__codelineno-93-29"></a><span class="w">        </span><span class="nx">cache</span><span class="p">.</span><span class="nx">retQuery</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;SELECT `%s` FROM `users` WHERE %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">Join</span><span class="p">(</span><span class="nx">returnColumns</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;`,`&quot;</span><span class="p">),</span><span class="w"> </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">WhereClause</span><span class="p">(</span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">userPrimaryKeyColumns</span><span class="p">))</span>
<a id="__codelineno-93-30" name="__codelineno-93-30"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-93-31" name="__codelineno-93-31"></a>
<a id="__codelineno-93-32" name="__codelineno-93-32"></a><span class="w">    </span><span class="c1">// フォーマットの適用</span>
<a id="__codelineno-93-33" name="__codelineno-93-33"></a><span class="w">    </span><span class="nx">cache</span><span class="p">.</span><span class="nx">query</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="nx">cache</span><span class="p">.</span><span class="nx">query</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-93-34" name="__codelineno-93-34"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>キャッシュが存在しない場合、挿入クエリを組み立ててキャッシュに保存します。</li>
<li><code>wl</code> は挿入するカラムのリスト、<code>returnColumns</code> は挿入後に取得するカラムのリストです。</li>
<li><code>valueMapping</code> と <code>retMapping</code> は、それぞれ値のマッピングと戻り値のマッピングを保持します。</li>
</ul>
</li>
<li>
<p><strong>値の取得</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-94-1">1</a></span>
<span class="normal"><a href="#__codelineno-94-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-94-1" name="__codelineno-94-1"></a><span class="nx">value</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">Indirect</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="nx">o</span><span class="p">))</span>
<a id="__codelineno-94-2" name="__codelineno-94-2"></a><span class="nx">vals</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">ValuesFromMapping</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">valueMapping</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>User</code> オブジェクトから挿入する値を取得します。</li>
</ul>
</li>
<li>
<p><strong>クエリの実行</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-95-1">1</a></span>
<span class="normal"><a href="#__codelineno-95-2">2</a></span>
<span class="normal"><a href="#__codelineno-95-3">3</a></span>
<span class="normal"><a href="#__codelineno-95-4">4</a></span>
<span class="normal"><a href="#__codelineno-95-5">5</a></span>
<span class="normal"><a href="#__codelineno-95-6">6</a></span>
<span class="normal"><a href="#__codelineno-95-7">7</a></span>
<span class="normal"><a href="#__codelineno-95-8">8</a></span>
<span class="normal"><a href="#__codelineno-95-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-95-1" name="__codelineno-95-1"></a><span class="k">if</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">IsDebug</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-95-2" name="__codelineno-95-2"></a><span class="w">    </span><span class="nx">writer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">DebugWriterFrom</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<a id="__codelineno-95-3" name="__codelineno-95-3"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">query</span><span class="p">)</span>
<a id="__codelineno-95-4" name="__codelineno-95-4"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">vals</span><span class="p">)</span>
<a id="__codelineno-95-5" name="__codelineno-95-5"></a><span class="p">}</span>
<a id="__codelineno-95-6" name="__codelineno-95-6"></a><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">exec</span><span class="p">.</span><span class="nx">ExecContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">query</span><span class="p">,</span><span class="w"> </span><span class="nx">vals</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-95-7" name="__codelineno-95-7"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-95-8" name="__codelineno-95-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to insert into users&quot;</span><span class="p">)</span>
<a id="__codelineno-95-9" name="__codelineno-95-9"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>デバッグモードの場合、クエリと値を出力します。</li>
<li>挿入クエリを実行し、エラーをチェックします。</li>
</ul>
</li>
<li>
<p><strong>戻り値の取得</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-96-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-96-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-96-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-96-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-96-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-96-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-96-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-96-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-96-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-96-10">10</a></span>
<span class="normal"><a href="#__codelineno-96-11">11</a></span>
<span class="normal"><a href="#__codelineno-96-12">12</a></span>
<span class="normal"><a href="#__codelineno-96-13">13</a></span>
<span class="normal"><a href="#__codelineno-96-14">14</a></span>
<span class="normal"><a href="#__codelineno-96-15">15</a></span>
<span class="normal"><a href="#__codelineno-96-16">16</a></span>
<span class="normal"><a href="#__codelineno-96-17">17</a></span>
<span class="normal"><a href="#__codelineno-96-18">18</a></span>
<span class="normal"><a href="#__codelineno-96-19">19</a></span>
<span class="normal"><a href="#__codelineno-96-20">20</a></span>
<span class="normal"><a href="#__codelineno-96-21">21</a></span>
<span class="normal"><a href="#__codelineno-96-22">22</a></span>
<span class="normal"><a href="#__codelineno-96-23">23</a></span>
<span class="normal"><a href="#__codelineno-96-24">24</a></span>
<span class="normal"><a href="#__codelineno-96-25">25</a></span>
<span class="normal"><a href="#__codelineno-96-26">26</a></span>
<span class="normal"><a href="#__codelineno-96-27">27</a></span>
<span class="normal"><a href="#__codelineno-96-28">28</a></span>
<span class="normal"><a href="#__codelineno-96-29">29</a></span>
<span class="normal"><a href="#__codelineno-96-30">30</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-96-1" name="__codelineno-96-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">lastID</span><span class="w"> </span><span class="kt">int64</span>
<a id="__codelineno-96-2" name="__codelineno-96-2"></a><span class="kd">var</span><span class="w"> </span><span class="nx">identifierCols</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}</span>
<a id="__codelineno-96-3" name="__codelineno-96-3"></a>
<a id="__codelineno-96-4" name="__codelineno-96-4"></a><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">cache</span><span class="p">.</span><span class="nx">retMapping</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-96-5" name="__codelineno-96-5"></a><span class="w">    </span><span class="k">goto</span><span class="w"> </span><span class="nx">CacheNoHooks</span>
<a id="__codelineno-96-6" name="__codelineno-96-6"></a><span class="p">}</span>
<a id="__codelineno-96-7" name="__codelineno-96-7"></a>
<a id="__codelineno-96-8" name="__codelineno-96-8"></a><span class="nx">lastID</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">LastInsertId</span><span class="p">()</span>
<a id="__codelineno-96-9" name="__codelineno-96-9"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-96-10" name="__codelineno-96-10"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">ErrSyncFail</span>
<a id="__codelineno-96-11" name="__codelineno-96-11"></a><span class="p">}</span>
<a id="__codelineno-96-12" name="__codelineno-96-12"></a>
<a id="__codelineno-96-13" name="__codelineno-96-13"></a><span class="nx">o</span><span class="p">.</span><span class="nx">UserID</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">uint</span><span class="p">(</span><span class="nx">lastID</span><span class="p">)</span>
<a id="__codelineno-96-14" name="__codelineno-96-14"></a><span class="k">if</span><span class="w"> </span><span class="nx">lastID</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">cache</span><span class="p">.</span><span class="nx">retMapping</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">retMapping</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">userMapping</span><span class="p">[</span><span class="s">&quot;user_id&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-96-15" name="__codelineno-96-15"></a><span class="w">    </span><span class="k">goto</span><span class="w"> </span><span class="nx">CacheNoHooks</span>
<a id="__codelineno-96-16" name="__codelineno-96-16"></a><span class="p">}</span>
<a id="__codelineno-96-17" name="__codelineno-96-17"></a>
<a id="__codelineno-96-18" name="__codelineno-96-18"></a><span class="nx">identifierCols</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span>
<a id="__codelineno-96-19" name="__codelineno-96-19"></a><span class="w">    </span><span class="nx">o</span><span class="p">.</span><span class="nx">UserID</span><span class="p">,</span>
<a id="__codelineno-96-20" name="__codelineno-96-20"></a><span class="p">}</span>
<a id="__codelineno-96-21" name="__codelineno-96-21"></a>
<a id="__codelineno-96-22" name="__codelineno-96-22"></a><span class="k">if</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">IsDebug</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-96-23" name="__codelineno-96-23"></a><span class="w">    </span><span class="nx">writer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">DebugWriterFrom</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<a id="__codelineno-96-24" name="__codelineno-96-24"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">retQuery</span><span class="p">)</span>
<a id="__codelineno-96-25" name="__codelineno-96-25"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">identifierCols</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-96-26" name="__codelineno-96-26"></a><span class="p">}</span>
<a id="__codelineno-96-27" name="__codelineno-96-27"></a><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">exec</span><span class="p">.</span><span class="nx">QueryRowContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">retQuery</span><span class="p">,</span><span class="w"> </span><span class="nx">identifierCols</span><span class="o">...</span><span class="p">).</span><span class="nx">Scan</span><span class="p">(</span><span class="nx">queries</span><span class="p">.</span><span class="nx">PtrsFromMapping</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">retMapping</span><span class="p">)</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-96-28" name="__codelineno-96-28"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-96-29" name="__codelineno-96-29"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to populate default values for users&quot;</span><span class="p">)</span>
<a id="__codelineno-96-30" name="__codelineno-96-30"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>挿入されたレコードの <code>LastInsertId</code> を取得し、<code>UserID</code> に設定します。</li>
<li>必要に応じて、戻り値のクエリを実行してデフォルト値を取得します。</li>
</ul>
</li>
<li>
<p><strong>キャッシュの更新</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-97-1">1</a></span>
<span class="normal"><a href="#__codelineno-97-2">2</a></span>
<span class="normal"><a href="#__codelineno-97-3">3</a></span>
<span class="normal"><a href="#__codelineno-97-4">4</a></span>
<span class="normal"><a href="#__codelineno-97-5">5</a></span>
<span class="normal"><a href="#__codelineno-97-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-97-1" name="__codelineno-97-1"></a><span class="nx">CacheNoHooks</span><span class="p">:</span>
<a id="__codelineno-97-2" name="__codelineno-97-2"></a><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">cached</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-97-3" name="__codelineno-97-3"></a><span class="w">    </span><span class="nx">userInsertCacheMut</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
<a id="__codelineno-97-4" name="__codelineno-97-4"></a><span class="w">    </span><span class="nx">userInsertCache</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">cache</span>
<a id="__codelineno-97-5" name="__codelineno-97-5"></a><span class="w">    </span><span class="nx">userInsertCacheMut</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>
<a id="__codelineno-97-6" name="__codelineno-97-6"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>キャッシュが存在しなかった場合、キャッシュに現在のクエリ情報を保存します。</li>
</ul>
</li>
<li>
<p><strong>After Insert フックの実行</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-98-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-98-1" name="__codelineno-98-1"></a><span class="k">return</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">doAfterInsertHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>挿入後に定義されたフック関数を実行し、処理を終了します。</li>
</ul>
</li>
</ol>
<h3 id="_94">利用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-99-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-99-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-99-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-99-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-99-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-99-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-99-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-99-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-99-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-99-10">10</a></span>
<span class="normal"><a href="#__codelineno-99-11">11</a></span>
<span class="normal"><a href="#__codelineno-99-12">12</a></span>
<span class="normal"><a href="#__codelineno-99-13">13</a></span>
<span class="normal"><a href="#__codelineno-99-14">14</a></span>
<span class="normal"><a href="#__codelineno-99-15">15</a></span>
<span class="normal"><a href="#__codelineno-99-16">16</a></span>
<span class="normal"><a href="#__codelineno-99-17">17</a></span>
<span class="normal"><a href="#__codelineno-99-18">18</a></span>
<span class="normal"><a href="#__codelineno-99-19">19</a></span>
<span class="normal"><a href="#__codelineno-99-20">20</a></span>
<span class="normal"><a href="#__codelineno-99-21">21</a></span>
<span class="normal"><a href="#__codelineno-99-22">22</a></span>
<span class="normal"><a href="#__codelineno-99-23">23</a></span>
<span class="normal"><a href="#__codelineno-99-24">24</a></span>
<span class="normal"><a href="#__codelineno-99-25">25</a></span>
<span class="normal"><a href="#__codelineno-99-26">26</a></span>
<span class="normal"><a href="#__codelineno-99-27">27</a></span>
<span class="normal"><a href="#__codelineno-99-28">28</a></span>
<span class="normal"><a href="#__codelineno-99-29">29</a></span>
<span class="normal"><a href="#__codelineno-99-30">30</a></span>
<span class="normal"><a href="#__codelineno-99-31">31</a></span>
<span class="normal"><a href="#__codelineno-99-32">32</a></span>
<span class="normal"><a href="#__codelineno-99-33">33</a></span>
<span class="normal"><a href="#__codelineno-99-34">34</a></span>
<span class="normal"><a href="#__codelineno-99-35">35</a></span>
<span class="normal"><a href="#__codelineno-99-36">36</a></span>
<span class="normal"><a href="#__codelineno-99-37">37</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-99-1" name="__codelineno-99-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="__codelineno-99-2" name="__codelineno-99-2"></a>
<a id="__codelineno-99-3" name="__codelineno-99-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-99-4" name="__codelineno-99-4"></a><span class="w">    </span><span class="s">&quot;context&quot;</span>
<a id="__codelineno-99-5" name="__codelineno-99-5"></a><span class="w">    </span><span class="s">&quot;database/sql&quot;</span>
<a id="__codelineno-99-6" name="__codelineno-99-6"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-99-7" name="__codelineno-99-7"></a>
<a id="__codelineno-99-8" name="__codelineno-99-8"></a><span class="w">    </span><span class="nx">_</span><span class="w"> </span><span class="s">&quot;github.com/go-sql-driver/mysql&quot;</span>
<a id="__codelineno-99-9" name="__codelineno-99-9"></a><span class="w">    </span><span class="s">&quot;github.com/volatiletech/sqlboiler/boil&quot;</span>
<a id="__codelineno-99-10" name="__codelineno-99-10"></a><span class="p">)</span>
<a id="__codelineno-99-11" name="__codelineno-99-11"></a>
<a id="__codelineno-99-12" name="__codelineno-99-12"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-99-13" name="__codelineno-99-13"></a><span class="w">    </span><span class="c1">// データベース接続の設定</span>
<a id="__codelineno-99-14" name="__codelineno-99-14"></a><span class="w">    </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-99-15" name="__codelineno-99-15"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-99-16" name="__codelineno-99-16"></a><span class="w">        </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-99-17" name="__codelineno-99-17"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-99-18" name="__codelineno-99-18"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="__codelineno-99-19" name="__codelineno-99-19"></a>
<a id="__codelineno-99-20" name="__codelineno-99-20"></a><span class="w">    </span><span class="c1">// コンテキストの作成</span>
<a id="__codelineno-99-21" name="__codelineno-99-21"></a><span class="w">    </span><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-99-22" name="__codelineno-99-22"></a>
<a id="__codelineno-99-23" name="__codelineno-99-23"></a><span class="w">    </span><span class="c1">// 新しいユーザーの作成</span>
<a id="__codelineno-99-24" name="__codelineno-99-24"></a><span class="w">    </span><span class="nx">newUser</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">User</span><span class="p">{</span>
<a id="__codelineno-99-25" name="__codelineno-99-25"></a><span class="w">        </span><span class="nx">FirebaseID</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;firebase_unique_id&quot;</span><span class="p">,</span>
<a id="__codelineno-99-26" name="__codelineno-99-26"></a><span class="w">        </span><span class="nx">Name</span><span class="p">:</span><span class="w">       </span><span class="s">&quot;山田 太郎&quot;</span><span class="p">,</span>
<a id="__codelineno-99-27" name="__codelineno-99-27"></a><span class="w">        </span><span class="nx">Email</span><span class="p">:</span><span class="w">      </span><span class="s">&quot;taro.yamada@example.com&quot;</span><span class="p">,</span>
<a id="__codelineno-99-28" name="__codelineno-99-28"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-99-29" name="__codelineno-99-29"></a>
<a id="__codelineno-99-30" name="__codelineno-99-30"></a><span class="w">    </span><span class="c1">// ユーザーの挿入</span>
<a id="__codelineno-99-31" name="__codelineno-99-31"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">newUser</span><span class="p">.</span><span class="nx">Insert</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">Infer</span><span class="p">())</span>
<a id="__codelineno-99-32" name="__codelineno-99-32"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-99-33" name="__codelineno-99-33"></a><span class="w">        </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-99-34" name="__codelineno-99-34"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-99-35" name="__codelineno-99-35"></a>
<a id="__codelineno-99-36" name="__codelineno-99-36"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;新しいユーザーが作成されました。UserID: %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">newUser</span><span class="p">.</span><span class="nx">UserID</span><span class="p">)</span>
<a id="__codelineno-99-37" name="__codelineno-99-37"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="2-update">2. <code>Update</code> 関数</h2>
<h3 id="_95">説明</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-100-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-100-1" name="__codelineno-100-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">User</span><span class="p">)</span><span class="w"> </span><span class="nx">Update</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">columns</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">Columns</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">int64</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>目的</strong>: 既存の <code>User</code> オブジェクトをデータベース上で更新します。</li>
<li><strong>パラメータ</strong>:</li>
<li><code>columns boil.Columns</code>: 更新するカラムを指定します。ホワイトリスト方式やブラックリスト方式で指定可能です。</li>
<li><strong>戻り値</strong>:</li>
<li><code>int64</code>: 更新された行数。</li>
<li><code>error</code>: エラー情報。</li>
</ul>
<h3 id="_96">コードの詳細な解説</h3>
<ol>
<li>
<p><strong>タイムスタンプの更新</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-101-1">1</a></span>
<span class="normal"><a href="#__codelineno-101-2">2</a></span>
<span class="normal"><a href="#__codelineno-101-3">3</a></span>
<span class="normal"><a href="#__codelineno-101-4">4</a></span>
<span class="normal"><a href="#__codelineno-101-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-101-1" name="__codelineno-101-1"></a><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">boil</span><span class="p">.</span><span class="nx">TimestampsAreSkipped</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-2" name="__codelineno-101-2"></a><span class="w">    </span><span class="nx">currTime</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">In</span><span class="p">(</span><span class="nx">boil</span><span class="p">.</span><span class="nx">GetLocation</span><span class="p">())</span>
<a id="__codelineno-101-3" name="__codelineno-101-3"></a>
<a id="__codelineno-101-4" name="__codelineno-101-4"></a><span class="w">    </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetScanner</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">o</span><span class="p">.</span><span class="nx">UpdatedAt</span><span class="p">,</span><span class="w"> </span><span class="nx">currTime</span><span class="p">)</span>
<a id="__codelineno-101-5" name="__codelineno-101-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>UpdatedAt</code> フィールドに現在時刻を設定します。</li>
</ul>
</li>
<li>
<p><strong>Before Update フックの実行</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-102-1">1</a></span>
<span class="normal"><a href="#__codelineno-102-2">2</a></span>
<span class="normal"><a href="#__codelineno-102-3">3</a></span>
<span class="normal"><a href="#__codelineno-102-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-102-1" name="__codelineno-102-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span>
<a id="__codelineno-102-2" name="__codelineno-102-2"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">doBeforeUpdateHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-102-3" name="__codelineno-102-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-102-4" name="__codelineno-102-4"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>更新前に定義されたフック関数を実行します。</li>
</ul>
</li>
<li>
<p><strong>キャッシュキーの作成とキャッシュの取得</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-103-1">1</a></span>
<span class="normal"><a href="#__codelineno-103-2">2</a></span>
<span class="normal"><a href="#__codelineno-103-3">3</a></span>
<span class="normal"><a href="#__codelineno-103-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-103-1" name="__codelineno-103-1"></a><span class="nx">key</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">makeCacheKey</span><span class="p">(</span><span class="nx">columns</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<a id="__codelineno-103-2" name="__codelineno-103-2"></a><span class="nx">userUpdateCacheMut</span><span class="p">.</span><span class="nx">RLock</span><span class="p">()</span>
<a id="__codelineno-103-3" name="__codelineno-103-3"></a><span class="nx">cache</span><span class="p">,</span><span class="w"> </span><span class="nx">cached</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">userUpdateCache</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
<a id="__codelineno-103-4" name="__codelineno-103-4"></a><span class="nx">userUpdateCacheMut</span><span class="p">.</span><span class="nx">RUnlock</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>更新クエリのキャッシュキーを作成し、キャッシュを確認します。</li>
</ul>
</li>
<li>
<p><strong>キャッシュの作成</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-104-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-104-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-104-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-104-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-104-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-104-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-104-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-104-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-104-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-104-10">10</a></span>
<span class="normal"><a href="#__codelineno-104-11">11</a></span>
<span class="normal"><a href="#__codelineno-104-12">12</a></span>
<span class="normal"><a href="#__codelineno-104-13">13</a></span>
<span class="normal"><a href="#__codelineno-104-14">14</a></span>
<span class="normal"><a href="#__codelineno-104-15">15</a></span>
<span class="normal"><a href="#__codelineno-104-16">16</a></span>
<span class="normal"><a href="#__codelineno-104-17">17</a></span>
<span class="normal"><a href="#__codelineno-104-18">18</a></span>
<span class="normal"><a href="#__codelineno-104-19">19</a></span>
<span class="normal"><a href="#__codelineno-104-20">20</a></span>
<span class="normal"><a href="#__codelineno-104-21">21</a></span>
<span class="normal"><a href="#__codelineno-104-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-104-1" name="__codelineno-104-1"></a><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">cached</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-104-2" name="__codelineno-104-2"></a><span class="w">    </span><span class="nx">wl</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">columns</span><span class="p">.</span><span class="nx">UpdateColumnSet</span><span class="p">(</span>
<a id="__codelineno-104-3" name="__codelineno-104-3"></a><span class="w">        </span><span class="nx">userAllColumns</span><span class="p">,</span>
<a id="__codelineno-104-4" name="__codelineno-104-4"></a><span class="w">        </span><span class="nx">userPrimaryKeyColumns</span><span class="p">,</span>
<a id="__codelineno-104-5" name="__codelineno-104-5"></a><span class="w">    </span><span class="p">)</span>
<a id="__codelineno-104-6" name="__codelineno-104-6"></a>
<a id="__codelineno-104-7" name="__codelineno-104-7"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">columns</span><span class="p">.</span><span class="nx">IsWhitelist</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-104-8" name="__codelineno-104-8"></a><span class="w">        </span><span class="nx">wl</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">SetComplement</span><span class="p">(</span><span class="nx">wl</span><span class="p">,</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;created_at&quot;</span><span class="p">})</span>
<a id="__codelineno-104-9" name="__codelineno-104-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-104-10" name="__codelineno-104-10"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">wl</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-104-11" name="__codelineno-104-11"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;models: unable to update users, could not build whitelist&quot;</span><span class="p">)</span>
<a id="__codelineno-104-12" name="__codelineno-104-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-104-13" name="__codelineno-104-13"></a>
<a id="__codelineno-104-14" name="__codelineno-104-14"></a><span class="w">    </span><span class="nx">cache</span><span class="p">.</span><span class="nx">query</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;UPDATE `users` SET %s WHERE %s&quot;</span><span class="p">,</span>
<a id="__codelineno-104-15" name="__codelineno-104-15"></a><span class="w">        </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">SetParamNames</span><span class="p">(</span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">wl</span><span class="p">),</span>
<a id="__codelineno-104-16" name="__codelineno-104-16"></a><span class="w">        </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">WhereClause</span><span class="p">(</span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">userPrimaryKeyColumns</span><span class="p">),</span>
<a id="__codelineno-104-17" name="__codelineno-104-17"></a><span class="w">    </span><span class="p">)</span>
<a id="__codelineno-104-18" name="__codelineno-104-18"></a><span class="w">    </span><span class="nx">cache</span><span class="p">.</span><span class="nx">valueMapping</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">BindMapping</span><span class="p">(</span><span class="nx">userType</span><span class="p">,</span><span class="w"> </span><span class="nx">userMapping</span><span class="p">,</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">wl</span><span class="p">,</span><span class="w"> </span><span class="nx">userPrimaryKeyColumns</span><span class="o">...</span><span class="p">))</span>
<a id="__codelineno-104-19" name="__codelineno-104-19"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-104-20" name="__codelineno-104-20"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-104-21" name="__codelineno-104-21"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-104-22" name="__codelineno-104-22"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>更新するカラムのリストを作成し、更新クエリを組み立てます。</li>
</ul>
</li>
<li>
<p><strong>値の取得</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-105-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-105-1" name="__codelineno-105-1"></a><span class="nx">values</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">ValuesFromMapping</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">Indirect</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="nx">o</span><span class="p">)),</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">valueMapping</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>User</code> オブジェクトから更新する値を取得します。</li>
</ul>
</li>
<li>
<p><strong>クエリの実行</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-106-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-106-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-106-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-106-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-106-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-106-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-106-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-106-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-106-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-106-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-106-1" name="__codelineno-106-1"></a><span class="k">if</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">IsDebug</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-106-2" name="__codelineno-106-2"></a><span class="w">    </span><span class="nx">writer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">DebugWriterFrom</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<a id="__codelineno-106-3" name="__codelineno-106-3"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">query</span><span class="p">)</span>
<a id="__codelineno-106-4" name="__codelineno-106-4"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">values</span><span class="p">)</span>
<a id="__codelineno-106-5" name="__codelineno-106-5"></a><span class="p">}</span>
<a id="__codelineno-106-6" name="__codelineno-106-6"></a><span class="kd">var</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Result</span>
<a id="__codelineno-106-7" name="__codelineno-106-7"></a><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">exec</span><span class="p">.</span><span class="nx">ExecContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">query</span><span class="p">,</span><span class="w"> </span><span class="nx">values</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-106-8" name="__codelineno-106-8"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-106-9" name="__codelineno-106-9"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to update users row&quot;</span><span class="p">)</span>
<a id="__codelineno-106-10" name="__codelineno-106-10"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>更新クエリを実行し、エラーをチェックします。</li>
</ul>
</li>
<li>
<p><strong>更新された行数の取得</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-107-1">1</a></span>
<span class="normal"><a href="#__codelineno-107-2">2</a></span>
<span class="normal"><a href="#__codelineno-107-3">3</a></span>
<span class="normal"><a href="#__codelineno-107-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-107-1" name="__codelineno-107-1"></a><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">RowsAffected</span><span class="p">()</span>
<a id="__codelineno-107-2" name="__codelineno-107-2"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-107-3" name="__codelineno-107-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: failed to get rows affected by update for users&quot;</span><span class="p">)</span>
<a id="__codelineno-107-4" name="__codelineno-107-4"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>更新された行数を取得します。</li>
</ul>
</li>
<li>
<p><strong>キャッシュの更新</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-108-1">1</a></span>
<span class="normal"><a href="#__codelineno-108-2">2</a></span>
<span class="normal"><a href="#__codelineno-108-3">3</a></span>
<span class="normal"><a href="#__codelineno-108-4">4</a></span>
<span class="normal"><a href="#__codelineno-108-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-108-1" name="__codelineno-108-1"></a><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">cached</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-108-2" name="__codelineno-108-2"></a><span class="w">    </span><span class="nx">userUpdateCacheMut</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
<a id="__codelineno-108-3" name="__codelineno-108-3"></a><span class="w">    </span><span class="nx">userUpdateCache</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">cache</span>
<a id="__codelineno-108-4" name="__codelineno-108-4"></a><span class="w">    </span><span class="nx">userUpdateCacheMut</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>
<a id="__codelineno-108-5" name="__codelineno-108-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>キャッシュが存在しなかった場合、キャッシュに現在のクエリ情報を保存します。</li>
</ul>
</li>
<li>
<p><strong>After Update フックの実行</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-109-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-109-1" name="__codelineno-109-1"></a><span class="k">return</span><span class="w"> </span><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">doAfterUpdateHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>更新後に定義されたフック関数を実行し、処理を終了します。</li>
</ul>
</li>
</ol>
<h3 id="_97">利用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-110-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-110-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-110-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-110-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-110-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-110-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-110-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-110-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-110-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-110-10">10</a></span>
<span class="normal"><a href="#__codelineno-110-11">11</a></span>
<span class="normal"><a href="#__codelineno-110-12">12</a></span>
<span class="normal"><a href="#__codelineno-110-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-110-1" name="__codelineno-110-1"></a><span class="c1">// ユーザー情報の更新</span>
<a id="__codelineno-110-2" name="__codelineno-110-2"></a><span class="nx">user</span><span class="p">.</span><span class="nx">Name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;山田 花子&quot;</span>
<a id="__codelineno-110-3" name="__codelineno-110-3"></a><span class="nx">user</span><span class="p">.</span><span class="nx">Email</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;hanako.yamada@example.com&quot;</span>
<a id="__codelineno-110-4" name="__codelineno-110-4"></a>
<a id="__codelineno-110-5" name="__codelineno-110-5"></a><span class="c1">// 更新するカラムを指定（ホワイトリスト方式）</span>
<a id="__codelineno-110-6" name="__codelineno-110-6"></a><span class="nx">columns</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">Whitelist</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;email&quot;</span><span class="p">)</span>
<a id="__codelineno-110-7" name="__codelineno-110-7"></a>
<a id="__codelineno-110-8" name="__codelineno-110-8"></a><span class="nx">rowsAffected</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">Update</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">columns</span><span class="p">)</span>
<a id="__codelineno-110-9" name="__codelineno-110-9"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-110-10" name="__codelineno-110-10"></a><span class="w">    </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-110-11" name="__codelineno-110-11"></a><span class="p">}</span>
<a id="__codelineno-110-12" name="__codelineno-110-12"></a>
<a id="__codelineno-110-13" name="__codelineno-110-13"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%d 行のユーザー情報が更新されました。\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">rowsAffected</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="3-updateall">3. <code>UpdateAll</code> 関数（クエリ構造体のメソッド）</h2>
<h3 id="_98">説明</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-111-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-111-1" name="__codelineno-111-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">q</span><span class="w"> </span><span class="nx">userQuery</span><span class="p">)</span><span class="w"> </span><span class="nx">UpdateAll</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">cols</span><span class="w"> </span><span class="nx">M</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">int64</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>目的</strong>: クエリで指定された条件に一致する全ての <code>User</code> レコードを一括更新します。</li>
<li><strong>パラメータ</strong>:</li>
<li><code>cols M</code>: 更新するカラム名と値のマップ。</li>
<li><strong>戻り値</strong>:</li>
<li><code>int64</code>: 更新された行数。</li>
<li><code>error</code>: エラー情報。</li>
</ul>
<h3 id="_99">コードの詳細な解説</h3>
<ol>
<li>
<p><strong>クエリの更新設定</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-112-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-112-1" name="__codelineno-112-1"></a><span class="nx">queries</span><span class="p">.</span><span class="nx">SetUpdate</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">,</span><span class="w"> </span><span class="nx">cols</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>クエリに更新内容を設定します。</li>
</ul>
</li>
<li>
<p><strong>クエリの実行</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-113-1">1</a></span>
<span class="normal"><a href="#__codelineno-113-2">2</a></span>
<span class="normal"><a href="#__codelineno-113-3">3</a></span>
<span class="normal"><a href="#__codelineno-113-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-113-1" name="__codelineno-113-1"></a><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">.</span><span class="nx">ExecContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">)</span>
<a id="__codelineno-113-2" name="__codelineno-113-2"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-113-3" name="__codelineno-113-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to update all for users&quot;</span><span class="p">)</span>
<a id="__codelineno-113-4" name="__codelineno-113-4"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>更新クエリを実行し、エラーをチェックします。</li>
</ul>
</li>
<li>
<p><strong>更新された行数の取得</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-114-1">1</a></span>
<span class="normal"><a href="#__codelineno-114-2">2</a></span>
<span class="normal"><a href="#__codelineno-114-3">3</a></span>
<span class="normal"><a href="#__codelineno-114-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-114-1" name="__codelineno-114-1"></a><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">RowsAffected</span><span class="p">()</span>
<a id="__codelineno-114-2" name="__codelineno-114-2"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-114-3" name="__codelineno-114-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to retrieve rows affected for users&quot;</span><span class="p">)</span>
<a id="__codelineno-114-4" name="__codelineno-114-4"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>更新された行数を取得します。</li>
</ul>
</li>
</ol>
<h3 id="_100">利用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-115-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-115-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-115-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-115-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-115-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-115-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-115-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-115-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-115-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-115-10">10</a></span>
<span class="normal"><a href="#__codelineno-115-11">11</a></span>
<span class="normal"><a href="#__codelineno-115-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-115-1" name="__codelineno-115-1"></a><span class="c1">// 年齢が30歳以上のユーザーのステータスを「active」に更新</span>
<a id="__codelineno-115-2" name="__codelineno-115-2"></a><span class="nx">q</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Users</span><span class="p">(</span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;age &gt;= ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">))</span>
<a id="__codelineno-115-3" name="__codelineno-115-3"></a><span class="nx">cols</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">M</span><span class="p">{</span>
<a id="__codelineno-115-4" name="__codelineno-115-4"></a><span class="w">    </span><span class="s">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;active&quot;</span><span class="p">,</span>
<a id="__codelineno-115-5" name="__codelineno-115-5"></a><span class="p">}</span>
<a id="__codelineno-115-6" name="__codelineno-115-6"></a>
<a id="__codelineno-115-7" name="__codelineno-115-7"></a><span class="nx">rowsAffected</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">q</span><span class="p">.</span><span class="nx">UpdateAll</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">cols</span><span class="p">)</span>
<a id="__codelineno-115-8" name="__codelineno-115-8"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-115-9" name="__codelineno-115-9"></a><span class="w">    </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-115-10" name="__codelineno-115-10"></a><span class="p">}</span>
<a id="__codelineno-115-11" name="__codelineno-115-11"></a>
<a id="__codelineno-115-12" name="__codelineno-115-12"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%d 行のユーザーのステータスが更新されました。\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">rowsAffected</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="4-updateall">4. <code>UpdateAll</code> 関数（スライスメソッド）</h2>
<h3 id="_101">説明</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-116-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-116-1" name="__codelineno-116-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="nx">UserSlice</span><span class="p">)</span><span class="w"> </span><span class="nx">UpdateAll</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">cols</span><span class="w"> </span><span class="nx">M</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">int64</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>目的</strong>: <code>User</code> オブジェクトのスライス内の全てのレコードを一括更新します。</li>
<li><strong>パラメータ</strong>:</li>
<li><code>cols M</code>: 更新するカラム名と値のマップ。</li>
</ul>
<h3 id="_102">コードの詳細な解説</h3>
<ol>
<li>
<p><strong>スライスの長さチェック</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-117-1">1</a></span>
<span class="normal"><a href="#__codelineno-117-2">2</a></span>
<span class="normal"><a href="#__codelineno-117-3">3</a></span>
<span class="normal"><a href="#__codelineno-117-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-117-1" name="__codelineno-117-1"></a><span class="nx">ln</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">int64</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">o</span><span class="p">))</span>
<a id="__codelineno-117-2" name="__codelineno-117-2"></a><span class="k">if</span><span class="w"> </span><span class="nx">ln</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-117-3" name="__codelineno-117-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-117-4" name="__codelineno-117-4"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>スライスが空の場合、何もせずに終了します。</li>
</ul>
</li>
<li>
<p><strong>更新するカラムと値の準備</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-118-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-118-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-118-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-118-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-118-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-118-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-118-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-118-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-118-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-118-10">10</a></span>
<span class="normal"><a href="#__codelineno-118-11">11</a></span>
<span class="normal"><a href="#__codelineno-118-12">12</a></span>
<span class="normal"><a href="#__codelineno-118-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-118-1" name="__codelineno-118-1"></a><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">cols</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-118-2" name="__codelineno-118-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;models: update all requires at least one column argument&quot;</span><span class="p">)</span>
<a id="__codelineno-118-3" name="__codelineno-118-3"></a><span class="p">}</span>
<a id="__codelineno-118-4" name="__codelineno-118-4"></a>
<a id="__codelineno-118-5" name="__codelineno-118-5"></a><span class="nx">colNames</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">cols</span><span class="p">))</span>
<a id="__codelineno-118-6" name="__codelineno-118-6"></a><span class="nx">args</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kd">interface</span><span class="p">{},</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">cols</span><span class="p">))</span>
<a id="__codelineno-118-7" name="__codelineno-118-7"></a>
<a id="__codelineno-118-8" name="__codelineno-118-8"></a><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span>
<a id="__codelineno-118-9" name="__codelineno-118-9"></a><span class="k">for</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">cols</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-118-10" name="__codelineno-118-10"></a><span class="w">    </span><span class="nx">colNames</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">name</span>
<a id="__codelineno-118-11" name="__codelineno-118-11"></a><span class="w">    </span><span class="nx">args</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">value</span>
<a id="__codelineno-118-12" name="__codelineno-118-12"></a><span class="w">    </span><span class="nx">i</span><span class="o">++</span>
<a id="__codelineno-118-13" name="__codelineno-118-13"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>更新するカラム名と値を準備します。</li>
</ul>
</li>
<li>
<p><strong>主キーの値の取得</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-119-1">1</a></span>
<span class="normal"><a href="#__codelineno-119-2">2</a></span>
<span class="normal"><a href="#__codelineno-119-3">3</a></span>
<span class="normal"><a href="#__codelineno-119-4">4</a></span>
<span class="normal"><a href="#__codelineno-119-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-119-1" name="__codelineno-119-1"></a><span class="c1">// Append all of the primary key values for each column</span>
<a id="__codelineno-119-2" name="__codelineno-119-2"></a><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">o</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-119-3" name="__codelineno-119-3"></a><span class="w">    </span><span class="nx">pkeyArgs</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">ValuesFromMapping</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">Indirect</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="nx">obj</span><span class="p">)),</span><span class="w"> </span><span class="nx">userPrimaryKeyMapping</span><span class="p">)</span>
<a id="__codelineno-119-4" name="__codelineno-119-4"></a><span class="w">    </span><span class="nx">args</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span><span class="w"> </span><span class="nx">pkeyArgs</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-119-5" name="__codelineno-119-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>スライス内の各オブジェクトから、主キーの値を取得し、クエリの引数に追加します。</li>
</ul>
</li>
<li>
<p><strong>クエリの組み立て</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-120-1">1</a></span>
<span class="normal"><a href="#__codelineno-120-2">2</a></span>
<span class="normal"><a href="#__codelineno-120-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-120-1" name="__codelineno-120-1"></a><span class="nx">sql</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;UPDATE `users` SET %s WHERE %s&quot;</span><span class="p">,</span>
<a id="__codelineno-120-2" name="__codelineno-120-2"></a><span class="w">    </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">SetParamNames</span><span class="p">(</span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">colNames</span><span class="p">),</span>
<a id="__codelineno-120-3" name="__codelineno-120-3"></a><span class="w">    </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">WhereClauseRepeated</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">dialect</span><span class="p">.</span><span class="nx">LQ</span><span class="p">),</span><span class="w"> </span><span class="nb">string</span><span class="p">(</span><span class="nx">dialect</span><span class="p">.</span><span class="nx">RQ</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">userPrimaryKeyColumns</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">o</span><span class="p">)))</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>更新クエリを組み立てます。<code>WHERE</code> 句には各オブジェクトの主キーを使って複数の条件を生成します。</li>
</ul>
</li>
<li>
<p><strong>クエリの実行</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-121-1">1</a></span>
<span class="normal"><a href="#__codelineno-121-2">2</a></span>
<span class="normal"><a href="#__codelineno-121-3">3</a></span>
<span class="normal"><a href="#__codelineno-121-4">4</a></span>
<span class="normal"><a href="#__codelineno-121-5">5</a></span>
<span class="normal"><a href="#__codelineno-121-6">6</a></span>
<span class="normal"><a href="#__codelineno-121-7">7</a></span>
<span class="normal"><a href="#__codelineno-121-8">8</a></span>
<span class="normal"><a href="#__codelineno-121-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-121-1" name="__codelineno-121-1"></a><span class="k">if</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">IsDebug</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-121-2" name="__codelineno-121-2"></a><span class="w">    </span><span class="nx">writer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">DebugWriterFrom</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<a id="__codelineno-121-3" name="__codelineno-121-3"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">)</span>
<a id="__codelineno-121-4" name="__codelineno-121-4"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-121-5" name="__codelineno-121-5"></a><span class="p">}</span>
<a id="__codelineno-121-6" name="__codelineno-121-6"></a><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">exec</span><span class="p">.</span><span class="nx">ExecContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-121-7" name="__codelineno-121-7"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-121-8" name="__codelineno-121-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to update all in user slice&quot;</span><span class="p">)</span>
<a id="__codelineno-121-9" name="__codelineno-121-9"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>更新クエリを実行し、エラーをチェックします。</li>
</ul>
</li>
<li>
<p><strong>更新された行数の取得</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-122-1">1</a></span>
<span class="normal"><a href="#__codelineno-122-2">2</a></span>
<span class="normal"><a href="#__codelineno-122-3">3</a></span>
<span class="normal"><a href="#__codelineno-122-4">4</a></span>
<span class="normal"><a href="#__codelineno-122-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-122-1" name="__codelineno-122-1"></a><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">RowsAffected</span><span class="p">()</span>
<a id="__codelineno-122-2" name="__codelineno-122-2"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-122-3" name="__codelineno-122-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to retrieve rows affected all in update all user&quot;</span><span class="p">)</span>
<a id="__codelineno-122-4" name="__codelineno-122-4"></a><span class="p">}</span>
<a id="__codelineno-122-5" name="__codelineno-122-5"></a><span class="k">return</span><span class="w"> </span><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>更新された行数を取得し、返します。</li>
</ul>
</li>
</ol>
<h3 id="_103">利用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-123-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-123-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-123-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-123-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-123-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-123-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-123-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-123-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-123-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-123-10">10</a></span>
<span class="normal"><a href="#__codelineno-123-11">11</a></span>
<span class="normal"><a href="#__codelineno-123-12">12</a></span>
<span class="normal"><a href="#__codelineno-123-13">13</a></span>
<span class="normal"><a href="#__codelineno-123-14">14</a></span>
<span class="normal"><a href="#__codelineno-123-15">15</a></span>
<span class="normal"><a href="#__codelineno-123-16">16</a></span>
<span class="normal"><a href="#__codelineno-123-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-123-1" name="__codelineno-123-1"></a><span class="c1">// ユーザーのスライスを取得</span>
<a id="__codelineno-123-2" name="__codelineno-123-2"></a><span class="nx">users</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Users</span><span class="p">(</span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;status = ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;inactive&quot;</span><span class="p">)).</span><span class="nx">All</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-123-3" name="__codelineno-123-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-123-4" name="__codelineno-123-4"></a><span class="w">    </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-123-5" name="__codelineno-123-5"></a><span class="p">}</span>
<a id="__codelineno-123-6" name="__codelineno-123-6"></a>
<a id="__codelineno-123-7" name="__codelineno-123-7"></a><span class="c1">// ユーザーのステータスを一括更新</span>
<a id="__codelineno-123-8" name="__codelineno-123-8"></a><span class="nx">cols</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">M</span><span class="p">{</span>
<a id="__codelineno-123-9" name="__codelineno-123-9"></a><span class="w">    </span><span class="s">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;active&quot;</span><span class="p">,</span>
<a id="__codelineno-123-10" name="__codelineno-123-10"></a><span class="p">}</span>
<a id="__codelineno-123-11" name="__codelineno-123-11"></a>
<a id="__codelineno-123-12" name="__codelineno-123-12"></a><span class="nx">rowsAffected</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">users</span><span class="p">.</span><span class="nx">UpdateAll</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">cols</span><span class="p">)</span>
<a id="__codelineno-123-13" name="__codelineno-123-13"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-123-14" name="__codelineno-123-14"></a><span class="w">    </span><span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-123-15" name="__codelineno-123-15"></a><span class="p">}</span>
<a id="__codelineno-123-16" name="__codelineno-123-16"></a>
<a id="__codelineno-123-17" name="__codelineno-123-17"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%d 行のユーザーのステータスが更新されました。\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">rowsAffected</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="5-mysqluseruniquecolumns">5. <code>mySQLUserUniqueColumns</code> 変数</h2>
<h3 id="_104">説明</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-124-1">1</a></span>
<span class="normal"><a href="#__codelineno-124-2">2</a></span>
<span class="normal"><a href="#__codelineno-124-3">3</a></span>
<span class="normal"><a href="#__codelineno-124-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-124-1" name="__codelineno-124-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">mySQLUserUniqueColumns</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span>
<a id="__codelineno-124-2" name="__codelineno-124-2"></a><span class="w">    </span><span class="s">&quot;user_id&quot;</span><span class="p">,</span>
<a id="__codelineno-124-3" name="__codelineno-124-3"></a><span class="w">    </span><span class="s">&quot;firebase_id&quot;</span><span class="p">,</span>
<a id="__codelineno-124-4" name="__codelineno-124-4"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>目的</strong>: MySQLデータベースにおける <code>users</code> テーブルのユニークなカラムを定義します。</li>
<li><strong>用途</strong>: ユニークインデックスの設定や、データの一意性チェックに使用します。</li>
</ul>
<hr />
<h2 id="_105">注意事項</h2>
<ul>
<li><strong>エラーハンドリング</strong>: エラーが発生した場合は、適切に処理し、必要に応じてログを出力してください。</li>
<li><strong>データの整合性</strong>: データベースの制約（ユニークキー、外部キーなど）を考慮してデータ操作を行ってください。</li>
<li><strong>トランザクション</strong>: 一連の操作がトランザクションとして扱われる必要がある場合、<code>exec</code> にトランザクションオブジェクトを渡してください。</li>
<li><strong>セキュリティ</strong>: ユーザーからの入力を直接クエリに使用しないようにし、SQLインジェクションに注意してください。</li>
</ul>
<hr />
<h2 id="upsert"><code>Upsert</code>メソッドの解説</h2>
<h3 id="_106">概要</h3>
<p><code>Upsert</code>メソッドは、データベースに対してレコードの挿入（INSERT）を試み、もし主キーやユニークキーの衝突が発生した場合には更新（UPDATE）または無視（IGNORE）を行います。これは、レコードの存在有無にかかわらずデータを適切に保持するための操作です。</p>
<h3 id="_107">関数シグネチャ</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-125-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-125-1" name="__codelineno-125-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">User</span><span class="p">)</span><span class="w"> </span><span class="nx">Upsert</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">updateColumns</span><span class="p">,</span><span class="w"> </span><span class="nx">insertColumns</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">Columns</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>ctx</code>: コンテキスト。リクエストのスコープやキャンセルなどの制御に使用。</li>
<li><code>exec</code>: データベース操作を行うためのエグゼキュータ。</li>
<li><code>updateColumns</code>: 衝突時に更新するカラムの指定。</li>
<li><code>insertColumns</code>: 挿入時に指定するカラムの指定。</li>
</ul>
<h3 id="_108">処理の流れ</h3>
<ol>
<li><strong>nilチェック</strong>:</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-126-1">1</a></span>
<span class="normal"><a href="#__codelineno-126-2">2</a></span>
<span class="normal"><a href="#__codelineno-126-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-126-1" name="__codelineno-126-1"></a><span class="k">if</span><span class="w"> </span><span class="nx">o</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-126-2" name="__codelineno-126-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;models: no users provided for upsert&quot;</span><span class="p">)</span>
<a id="__codelineno-126-3" name="__codelineno-126-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><code>User</code>オブジェクトがnilの場合、エラーを返します。</p>
<ol>
<li><strong>タイムスタンプの設定</strong>:</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-127-1">1</a></span>
<span class="normal"><a href="#__codelineno-127-2">2</a></span>
<span class="normal"><a href="#__codelineno-127-3">3</a></span>
<span class="normal"><a href="#__codelineno-127-4">4</a></span>
<span class="normal"><a href="#__codelineno-127-5">5</a></span>
<span class="normal"><a href="#__codelineno-127-6">6</a></span>
<span class="normal"><a href="#__codelineno-127-7">7</a></span>
<span class="normal"><a href="#__codelineno-127-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-127-1" name="__codelineno-127-1"></a><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">boil</span><span class="p">.</span><span class="nx">TimestampsAreSkipped</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-127-2" name="__codelineno-127-2"></a><span class="w">    </span><span class="nx">currTime</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">In</span><span class="p">(</span><span class="nx">boil</span><span class="p">.</span><span class="nx">GetLocation</span><span class="p">())</span>
<a id="__codelineno-127-3" name="__codelineno-127-3"></a>
<a id="__codelineno-127-4" name="__codelineno-127-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">MustTime</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">CreatedAt</span><span class="p">).</span><span class="nx">IsZero</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-127-5" name="__codelineno-127-5"></a><span class="w">        </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetScanner</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">o</span><span class="p">.</span><span class="nx">CreatedAt</span><span class="p">,</span><span class="w"> </span><span class="nx">currTime</span><span class="p">)</span>
<a id="__codelineno-127-6" name="__codelineno-127-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-127-7" name="__codelineno-127-7"></a><span class="w">    </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetScanner</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">o</span><span class="p">.</span><span class="nx">UpdatedAt</span><span class="p">,</span><span class="w"> </span><span class="nx">currTime</span><span class="p">)</span>
<a id="__codelineno-127-8" name="__codelineno-127-8"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>
<p><code>CreatedAt</code>や<code>UpdatedAt</code>が未設定の場合、現在の時刻を設定します。</p>
</li>
<li>
<p><strong><code>BeforeUpsert</code>フックの実行</strong>:</p>
</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-128-1">1</a></span>
<span class="normal"><a href="#__codelineno-128-2">2</a></span>
<span class="normal"><a href="#__codelineno-128-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-128-1" name="__codelineno-128-1"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">doBeforeUpsertHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-128-2" name="__codelineno-128-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-128-3" name="__codelineno-128-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>
<p>登録されている<code>BeforeUpsert</code>フックを実行します。フックがエラーを返した場合、処理を中断します。</p>
</li>
<li>
<p><strong>デフォルト値とユニークキーの取得</strong>:</p>
</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-129-1">1</a></span>
<span class="normal"><a href="#__codelineno-129-2">2</a></span>
<span class="normal"><a href="#__codelineno-129-3">3</a></span>
<span class="normal"><a href="#__codelineno-129-4">4</a></span>
<span class="normal"><a href="#__codelineno-129-5">5</a></span>
<span class="normal"><a href="#__codelineno-129-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-129-1" name="__codelineno-129-1"></a><span class="nx">nzDefaults</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">NonZeroDefaultSet</span><span class="p">(</span><span class="nx">userColumnsWithDefault</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">)</span>
<a id="__codelineno-129-2" name="__codelineno-129-2"></a><span class="nx">nzUniques</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">NonZeroDefaultSet</span><span class="p">(</span><span class="nx">mySQLUserUniqueColumns</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">)</span>
<a id="__codelineno-129-3" name="__codelineno-129-3"></a>
<a id="__codelineno-129-4" name="__codelineno-129-4"></a><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">nzUniques</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-129-5" name="__codelineno-129-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;cannot upsert with a table that cannot conflict on a unique column&quot;</span><span class="p">)</span>
<a id="__codelineno-129-6" name="__codelineno-129-6"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>非ゼロのデフォルト値とユニークカラムを取得。</li>
<li>
<p>ユニークカラムがない場合、エラーを返します。</p>
</li>
<li>
<p><strong>キャッシュキーの生成</strong>:</p>
</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-130-1">1</a></span>
<span class="normal"><a href="#__codelineno-130-2">2</a></span>
<span class="normal"><a href="#__codelineno-130-3">3</a></span>
<span class="normal"><a href="#__codelineno-130-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-130-1" name="__codelineno-130-1"></a><span class="nx">buf</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">GetBuffer</span><span class="p">()</span>
<a id="__codelineno-130-2" name="__codelineno-130-2"></a><span class="c1">// キャッシュキーの構築...</span>
<a id="__codelineno-130-3" name="__codelineno-130-3"></a><span class="nx">key</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">buf</span><span class="p">.</span><span class="nx">String</span><span class="p">()</span>
<a id="__codelineno-130-4" name="__codelineno-130-4"></a><span class="nx">strmangle</span><span class="p">.</span><span class="nx">PutBuffer</span><span class="p">(</span><span class="nx">buf</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>
<p>クエリの再利用のため、キャッシュキーを生成。</p>
</li>
<li>
<p><strong>キャッシュの確認</strong>:</p>
</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-131-1">1</a></span>
<span class="normal"><a href="#__codelineno-131-2">2</a></span>
<span class="normal"><a href="#__codelineno-131-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-131-1" name="__codelineno-131-1"></a><span class="nx">userUpsertCacheMut</span><span class="p">.</span><span class="nx">RLock</span><span class="p">()</span>
<a id="__codelineno-131-2" name="__codelineno-131-2"></a><span class="nx">cache</span><span class="p">,</span><span class="w"> </span><span class="nx">cached</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">userUpsertCache</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
<a id="__codelineno-131-3" name="__codelineno-131-3"></a><span class="nx">userUpsertCacheMut</span><span class="p">.</span><span class="nx">RUnlock</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>
<p>既存のクエリがキャッシュされているか確認。</p>
</li>
<li>
<p><strong>クエリの構築</strong>:</p>
</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-132-1">1</a></span>
<span class="normal"><a href="#__codelineno-132-2">2</a></span>
<span class="normal"><a href="#__codelineno-132-3">3</a></span>
<span class="normal"><a href="#__codelineno-132-4">4</a></span>
<span class="normal"><a href="#__codelineno-132-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-132-1" name="__codelineno-132-1"></a><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">cached</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-132-2" name="__codelineno-132-2"></a><span class="w">    </span><span class="c1">// 挿入と更新のカラムセットを構築</span>
<a id="__codelineno-132-3" name="__codelineno-132-3"></a><span class="w">    </span><span class="c1">// MySQL用のアップサートクエリを構築</span>
<a id="__codelineno-132-4" name="__codelineno-132-4"></a><span class="w">    </span><span class="c1">// クエリ結果を取得するためのクエリを構築</span>
<a id="__codelineno-132-5" name="__codelineno-132-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>
<p>キャッシュがない場合、新しくクエリを構築します。</p>
</li>
<li>
<p><strong>値の取得</strong>:</p>
</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-133-1">1</a></span>
<span class="normal"><a href="#__codelineno-133-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-133-1" name="__codelineno-133-1"></a><span class="nx">value</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">Indirect</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="nx">o</span><span class="p">))</span>
<a id="__codelineno-133-2" name="__codelineno-133-2"></a><span class="nx">vals</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">ValuesFromMapping</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">valueMapping</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>
<p><code>User</code>オブジェクトからデータベースに渡す値を取得。</p>
</li>
<li>
<p><strong>クエリの実行</strong>:</p>
</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-134-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-134-1" name="__codelineno-134-1"></a><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">exec</span><span class="p">.</span><span class="nx">ExecContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">query</span><span class="p">,</span><span class="w"> </span><span class="nx">vals</span><span class="o">...</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>
<p>構築したアップサートクエリを実行。</p>
</li>
<li>
<p><strong>エラーハンドリングと結果の処理</strong>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-135-1">1</a></span>
<span class="normal"><a href="#__codelineno-135-2">2</a></span>
<span class="normal"><a href="#__codelineno-135-3">3</a></span>
<span class="normal"><a href="#__codelineno-135-4">4</a></span>
<span class="normal"><a href="#__codelineno-135-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-135-1" name="__codelineno-135-1"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-135-2" name="__codelineno-135-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to upsert for users&quot;</span><span class="p">)</span>
<a id="__codelineno-135-3" name="__codelineno-135-3"></a><span class="p">}</span>
<a id="__codelineno-135-4" name="__codelineno-135-4"></a>
<a id="__codelineno-135-5" name="__codelineno-135-5"></a><span class="c1">// 最後に挿入したIDを取得し、オブジェクトに設定</span>
</code></pre></div></td></tr></table></div>
</li>
<li>
<p><strong><code>AfterUpsert</code>フックの実行</strong>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-136-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-136-1" name="__codelineno-136-1"></a><span class="k">return</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">doAfterUpsertHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>登録されている<code>AfterUpsert</code>フックを実行します。</li>
</ul>
</li>
</ul>
<h3 id="_109">注意点</h3>
<ul>
<li><strong>トランザクション管理</strong>: このメソッド内でトランザクションを開始・終了していないため、呼び出し元で必要に応じてトランザクションを管理する必要があります。</li>
<li><strong>エラーハンドリング</strong>: データベース操作に失敗した場合、適切にエラーを処理する必要があります。</li>
</ul>
<h3 id="_110">利用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-137-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-137-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-137-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-137-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-137-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-137-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-137-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-137-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-137-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-137-10">10</a></span>
<span class="normal"><a href="#__codelineno-137-11">11</a></span>
<span class="normal"><a href="#__codelineno-137-12">12</a></span>
<span class="normal"><a href="#__codelineno-137-13">13</a></span>
<span class="normal"><a href="#__codelineno-137-14">14</a></span>
<span class="normal"><a href="#__codelineno-137-15">15</a></span>
<span class="normal"><a href="#__codelineno-137-16">16</a></span>
<span class="normal"><a href="#__codelineno-137-17">17</a></span>
<span class="normal"><a href="#__codelineno-137-18">18</a></span>
<span class="normal"><a href="#__codelineno-137-19">19</a></span>
<span class="normal"><a href="#__codelineno-137-20">20</a></span>
<span class="normal"><a href="#__codelineno-137-21">21</a></span>
<span class="normal"><a href="#__codelineno-137-22">22</a></span>
<span class="normal"><a href="#__codelineno-137-23">23</a></span>
<span class="normal"><a href="#__codelineno-137-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-137-1" name="__codelineno-137-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-137-2" name="__codelineno-137-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-137-3" name="__codelineno-137-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-137-4" name="__codelineno-137-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-137-5" name="__codelineno-137-5"></a><span class="p">}</span>
<a id="__codelineno-137-6" name="__codelineno-137-6"></a>
<a id="__codelineno-137-7" name="__codelineno-137-7"></a><span class="nx">user</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">User</span><span class="p">{</span>
<a id="__codelineno-137-8" name="__codelineno-137-8"></a><span class="w">    </span><span class="nx">UserID</span><span class="p">:</span><span class="w">   </span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-137-9" name="__codelineno-137-9"></a><span class="w">    </span><span class="nx">Name</span><span class="p">:</span><span class="w">     </span><span class="s">&quot;新しいユーザー&quot;</span><span class="p">,</span>
<a id="__codelineno-137-10" name="__codelineno-137-10"></a><span class="w">    </span><span class="nx">Email</span><span class="p">:</span><span class="w">    </span><span class="s">&quot;newuser@example.com&quot;</span><span class="p">,</span>
<a id="__codelineno-137-11" name="__codelineno-137-11"></a><span class="w">    </span><span class="c1">// その他フィールドの設定</span>
<a id="__codelineno-137-12" name="__codelineno-137-12"></a><span class="p">}</span>
<a id="__codelineno-137-13" name="__codelineno-137-13"></a>
<a id="__codelineno-137-14" name="__codelineno-137-14"></a><span class="nx">insertColumns</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">Infer</span><span class="p">()</span>
<a id="__codelineno-137-15" name="__codelineno-137-15"></a><span class="nx">updateColumns</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">Set</span><span class="p">(</span>
<a id="__codelineno-137-16" name="__codelineno-137-16"></a><span class="w">    </span><span class="s">&quot;name&quot;</span><span class="p">,</span>
<a id="__codelineno-137-17" name="__codelineno-137-17"></a><span class="w">    </span><span class="s">&quot;email&quot;</span><span class="p">,</span>
<a id="__codelineno-137-18" name="__codelineno-137-18"></a><span class="w">    </span><span class="c1">// 更新したいカラム名を指定</span>
<a id="__codelineno-137-19" name="__codelineno-137-19"></a><span class="p">)</span>
<a id="__codelineno-137-20" name="__codelineno-137-20"></a>
<a id="__codelineno-137-21" name="__codelineno-137-21"></a><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">Upsert</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">updateColumns</span><span class="p">,</span><span class="w"> </span><span class="nx">insertColumns</span><span class="p">)</span>
<a id="__codelineno-137-22" name="__codelineno-137-22"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-137-23" name="__codelineno-137-23"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-137-24" name="__codelineno-137-24"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="delete"><code>Delete</code>メソッドの解説</h2>
<h3 id="_111">概要</h3>
<p><code>Delete</code>メソッドは、<code>User</code>オブジェクトに対応するレコードをデータベースから削除します。削除は主キーに基づいて行われます。</p>
<h3 id="_112">関数シグネチャ</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-138-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-138-1" name="__codelineno-138-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">User</span><span class="p">)</span><span class="w"> </span><span class="nx">Delete</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">int64</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>ctx</code>: コンテキスト。</li>
<li><code>exec</code>: データベース操作を行うエグゼキュータ。</li>
<li>戻り値:</li>
<li><code>int64</code>: 削除された行数。</li>
<li><code>error</code>: エラー情報。</li>
</ul>
<h3 id="_113">処理の流れ</h3>
<ol>
<li><strong>nilチェック</strong>:</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-139-1">1</a></span>
<span class="normal"><a href="#__codelineno-139-2">2</a></span>
<span class="normal"><a href="#__codelineno-139-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-139-1" name="__codelineno-139-1"></a><span class="k">if</span><span class="w"> </span><span class="nx">o</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-139-2" name="__codelineno-139-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;models: no User provided for delete&quot;</span><span class="p">)</span>
<a id="__codelineno-139-3" name="__codelineno-139-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>
<p><code>User</code>オブジェクトがnilの場合、エラーを返します。</p>
</li>
<li>
<p><strong><code>BeforeDelete</code>フックの実行</strong>:</p>
</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-140-1">1</a></span>
<span class="normal"><a href="#__codelineno-140-2">2</a></span>
<span class="normal"><a href="#__codelineno-140-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-140-1" name="__codelineno-140-1"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">doBeforeDeleteHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-140-2" name="__codelineno-140-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-140-3" name="__codelineno-140-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ol>
<li><strong>主キーの値取得</strong>:</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-141-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-141-1" name="__codelineno-141-1"></a><span class="nx">args</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">ValuesFromMapping</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">Indirect</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="nx">o</span><span class="p">)),</span><span class="w"> </span><span class="nx">userPrimaryKeyMapping</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>
<p>オブジェクトから主キーの値を取得します。</p>
</li>
<li>
<p><strong>削除クエリの構築</strong>:</p>
</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-142-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-142-1" name="__codelineno-142-1"></a><span class="nx">sql</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;DELETE FROM `users` WHERE `user_id`=?&quot;</span>
</code></pre></div></td></tr></table></div>
<ol>
<li><strong>クエリの実行</strong>:</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-143-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-143-1" name="__codelineno-143-1"></a><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">exec</span><span class="p">.</span><span class="nx">ExecContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="o">...</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ol>
<li><strong>削除された行数の取得</strong>:</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-144-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-144-1" name="__codelineno-144-1"></a><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">RowsAffected</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<ol>
<li><strong><code>AfterDelete</code>フックの実行</strong>:</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-145-1">1</a></span>
<span class="normal"><a href="#__codelineno-145-2">2</a></span>
<span class="normal"><a href="#__codelineno-145-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-145-1" name="__codelineno-145-1"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">doAfterDeleteHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-145-2" name="__codelineno-145-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-145-3" name="__codelineno-145-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_114">利用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-146-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-146-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-146-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-146-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-146-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-146-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-146-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-146-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-146-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-146-10">10</a></span>
<span class="normal"><a href="#__codelineno-146-11">11</a></span>
<span class="normal"><a href="#__codelineno-146-12">12</a></span>
<span class="normal"><a href="#__codelineno-146-13">13</a></span>
<span class="normal"><a href="#__codelineno-146-14">14</a></span>
<span class="normal"><a href="#__codelineno-146-15">15</a></span>
<span class="normal"><a href="#__codelineno-146-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-146-1" name="__codelineno-146-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-146-2" name="__codelineno-146-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-146-3" name="__codelineno-146-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-146-4" name="__codelineno-146-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-146-5" name="__codelineno-146-5"></a><span class="p">}</span>
<a id="__codelineno-146-6" name="__codelineno-146-6"></a>
<a id="__codelineno-146-7" name="__codelineno-146-7"></a><span class="nx">user</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">User</span><span class="p">{</span>
<a id="__codelineno-146-8" name="__codelineno-146-8"></a><span class="w">    </span><span class="nx">UserID</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-146-9" name="__codelineno-146-9"></a><span class="p">}</span>
<a id="__codelineno-146-10" name="__codelineno-146-10"></a>
<a id="__codelineno-146-11" name="__codelineno-146-11"></a><span class="nx">rowsAffected</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">Delete</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-146-12" name="__codelineno-146-12"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-146-13" name="__codelineno-146-13"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-146-14" name="__codelineno-146-14"></a><span class="p">}</span>
<a id="__codelineno-146-15" name="__codelineno-146-15"></a>
<a id="__codelineno-146-16" name="__codelineno-146-16"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%d 行のユーザーが削除されました。\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">rowsAffected</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="deleteall"><code>DeleteAll</code>メソッドの解説（クエリからの削除）</h2>
<h3 id="_115">概要</h3>
<p><code>DeleteAll</code>メソッドは、クエリにマッチするすべての<code>User</code>レコードを削除します。</p>
<h3 id="_116">関数シグネチャ</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-147-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-147-1" name="__codelineno-147-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">q</span><span class="w"> </span><span class="nx">userQuery</span><span class="p">)</span><span class="w"> </span><span class="nx">DeleteAll</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">int64</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h3 id="_117">処理の流れ</h3>
<ol>
<li><strong>クエリの存在確認</strong>:</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-148-1">1</a></span>
<span class="normal"><a href="#__codelineno-148-2">2</a></span>
<span class="normal"><a href="#__codelineno-148-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-148-1" name="__codelineno-148-1"></a><span class="k">if</span><span class="w"> </span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-148-2" name="__codelineno-148-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;models: no userQuery provided for delete all&quot;</span><span class="p">)</span>
<a id="__codelineno-148-3" name="__codelineno-148-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ol>
<li><strong>削除フラグの設定</strong>:</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-149-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-149-1" name="__codelineno-149-1"></a><span class="nx">queries</span><span class="p">.</span><span class="nx">SetDelete</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>
<p>クエリが削除操作であることを指定します。</p>
</li>
<li>
<p><strong>クエリの実行</strong>:</p>
</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-150-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-150-1" name="__codelineno-150-1"></a><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">.</span><span class="nx">ExecContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ol>
<li><strong>削除された行数の取得</strong>:</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-151-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-151-1" name="__codelineno-151-1"></a><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">RowsAffected</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<h3 id="_118">利用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-152-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-152-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-152-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-152-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-152-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-152-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-152-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-152-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-152-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-152-10">10</a></span>
<span class="normal"><a href="#__codelineno-152-11">11</a></span>
<span class="normal"><a href="#__codelineno-152-12">12</a></span>
<span class="normal"><a href="#__codelineno-152-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-152-1" name="__codelineno-152-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-152-2" name="__codelineno-152-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-152-3" name="__codelineno-152-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-152-4" name="__codelineno-152-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-152-5" name="__codelineno-152-5"></a><span class="p">}</span>
<a id="__codelineno-152-6" name="__codelineno-152-6"></a>
<a id="__codelineno-152-7" name="__codelineno-152-7"></a><span class="c1">// 条件にマッチするユーザーを削除</span>
<a id="__codelineno-152-8" name="__codelineno-152-8"></a><span class="nx">rowsAffected</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Users</span><span class="p">(</span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;created_at &lt; ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;2022-01-01&quot;</span><span class="p">)).</span><span class="nx">DeleteAll</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-152-9" name="__codelineno-152-9"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-152-10" name="__codelineno-152-10"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-152-11" name="__codelineno-152-11"></a><span class="p">}</span>
<a id="__codelineno-152-12" name="__codelineno-152-12"></a>
<a id="__codelineno-152-13" name="__codelineno-152-13"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%d 行の古いユーザーが削除されました。\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">rowsAffected</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="deleteall_1"><code>DeleteAll</code>メソッドの解説（スライスからの削除）</h2>
<h3 id="_119">概要</h3>
<p><code>UserSlice</code>型のスライスに対して、含まれるすべての<code>User</code>オブジェクトをデータベースから削除します。</p>
<h3 id="_120">関数シグネチャ</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-153-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-153-1" name="__codelineno-153-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="nx">UserSlice</span><span class="p">)</span><span class="w"> </span><span class="nx">DeleteAll</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">int64</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h3 id="_121">処理の流れ</h3>
<ol>
<li><strong>スライスの長さ確認</strong>:</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-154-1">1</a></span>
<span class="normal"><a href="#__codelineno-154-2">2</a></span>
<span class="normal"><a href="#__codelineno-154-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-154-1" name="__codelineno-154-1"></a><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-154-2" name="__codelineno-154-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-154-3" name="__codelineno-154-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>
<p>スライスが空の場合、削除する行はないため0を返します。</p>
</li>
<li>
<p><strong><code>BeforeDelete</code>フックの実行</strong>:</p>
</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-155-1">1</a></span>
<span class="normal"><a href="#__codelineno-155-2">2</a></span>
<span class="normal"><a href="#__codelineno-155-3">3</a></span>
<span class="normal"><a href="#__codelineno-155-4">4</a></span>
<span class="normal"><a href="#__codelineno-155-5">5</a></span>
<span class="normal"><a href="#__codelineno-155-6">6</a></span>
<span class="normal"><a href="#__codelineno-155-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-155-1" name="__codelineno-155-1"></a><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">userBeforeDeleteHooks</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-155-2" name="__codelineno-155-2"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">o</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-155-3" name="__codelineno-155-3"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">obj</span><span class="p">.</span><span class="nx">doBeforeDeleteHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-155-4" name="__codelineno-155-4"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-155-5" name="__codelineno-155-5"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-155-6" name="__codelineno-155-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-155-7" name="__codelineno-155-7"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ol>
<li><strong>主キーの値収集</strong>:</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-156-1">1</a></span>
<span class="normal"><a href="#__codelineno-156-2">2</a></span>
<span class="normal"><a href="#__codelineno-156-3">3</a></span>
<span class="normal"><a href="#__codelineno-156-4">4</a></span>
<span class="normal"><a href="#__codelineno-156-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-156-1" name="__codelineno-156-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">args</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}</span>
<a id="__codelineno-156-2" name="__codelineno-156-2"></a><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">o</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-156-3" name="__codelineno-156-3"></a><span class="w">    </span><span class="nx">pkeyArgs</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">ValuesFromMapping</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">Indirect</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="nx">obj</span><span class="p">)),</span><span class="w"> </span><span class="nx">userPrimaryKeyMapping</span><span class="p">)</span>
<a id="__codelineno-156-4" name="__codelineno-156-4"></a><span class="w">    </span><span class="nx">args</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span><span class="w"> </span><span class="nx">pkeyArgs</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-156-5" name="__codelineno-156-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ol>
<li><strong>削除クエリの構築</strong>:</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-157-1">1</a></span>
<span class="normal"><a href="#__codelineno-157-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-157-1" name="__codelineno-157-1"></a><span class="nx">sql</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;DELETE FROM `users` WHERE &quot;</span><span class="w"> </span><span class="o">+</span>
<a id="__codelineno-157-2" name="__codelineno-157-2"></a><span class="w">    </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">WhereClauseRepeated</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">dialect</span><span class="p">.</span><span class="nx">LQ</span><span class="p">),</span><span class="w"> </span><span class="nb">string</span><span class="p">(</span><span class="nx">dialect</span><span class="p">.</span><span class="nx">RQ</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">userPrimaryKeyColumns</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">o</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
<ol>
<li><strong>クエリの実行</strong>:</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-158-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-158-1" name="__codelineno-158-1"></a><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">exec</span><span class="p">.</span><span class="nx">ExecContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="o">...</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ol>
<li><strong>削除された行数の取得</strong>:</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-159-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-159-1" name="__codelineno-159-1"></a><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">RowsAffected</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<ol>
<li><strong><code>AfterDelete</code>フックの実行</strong>:</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-160-1">1</a></span>
<span class="normal"><a href="#__codelineno-160-2">2</a></span>
<span class="normal"><a href="#__codelineno-160-3">3</a></span>
<span class="normal"><a href="#__codelineno-160-4">4</a></span>
<span class="normal"><a href="#__codelineno-160-5">5</a></span>
<span class="normal"><a href="#__codelineno-160-6">6</a></span>
<span class="normal"><a href="#__codelineno-160-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-160-1" name="__codelineno-160-1"></a><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">userAfterDeleteHooks</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-160-2" name="__codelineno-160-2"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">o</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-160-3" name="__codelineno-160-3"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">obj</span><span class="p">.</span><span class="nx">doAfterDeleteHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-160-4" name="__codelineno-160-4"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-160-5" name="__codelineno-160-5"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-160-6" name="__codelineno-160-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-160-7" name="__codelineno-160-7"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_122">利用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-161-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-161-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-161-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-161-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-161-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-161-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-161-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-161-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-161-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-161-10">10</a></span>
<span class="normal"><a href="#__codelineno-161-11">11</a></span>
<span class="normal"><a href="#__codelineno-161-12">12</a></span>
<span class="normal"><a href="#__codelineno-161-13">13</a></span>
<span class="normal"><a href="#__codelineno-161-14">14</a></span>
<span class="normal"><a href="#__codelineno-161-15">15</a></span>
<span class="normal"><a href="#__codelineno-161-16">16</a></span>
<span class="normal"><a href="#__codelineno-161-17">17</a></span>
<span class="normal"><a href="#__codelineno-161-18">18</a></span>
<span class="normal"><a href="#__codelineno-161-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-161-1" name="__codelineno-161-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-161-2" name="__codelineno-161-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-161-3" name="__codelineno-161-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-161-4" name="__codelineno-161-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-161-5" name="__codelineno-161-5"></a><span class="p">}</span>
<a id="__codelineno-161-6" name="__codelineno-161-6"></a>
<a id="__codelineno-161-7" name="__codelineno-161-7"></a><span class="c1">// 削除したいユーザーのスライス</span>
<a id="__codelineno-161-8" name="__codelineno-161-8"></a><span class="nx">users</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">UserSlice</span><span class="p">{</span>
<a id="__codelineno-161-9" name="__codelineno-161-9"></a><span class="w">    </span><span class="o">&amp;</span><span class="nx">User</span><span class="p">{</span><span class="nx">UserID</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">},</span>
<a id="__codelineno-161-10" name="__codelineno-161-10"></a><span class="w">    </span><span class="o">&amp;</span><span class="nx">User</span><span class="p">{</span><span class="nx">UserID</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">},</span>
<a id="__codelineno-161-11" name="__codelineno-161-11"></a><span class="w">    </span><span class="c1">// その他のユーザー</span>
<a id="__codelineno-161-12" name="__codelineno-161-12"></a><span class="p">}</span>
<a id="__codelineno-161-13" name="__codelineno-161-13"></a>
<a id="__codelineno-161-14" name="__codelineno-161-14"></a><span class="nx">rowsAffected</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">users</span><span class="p">.</span><span class="nx">DeleteAll</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-161-15" name="__codelineno-161-15"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-161-16" name="__codelineno-161-16"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-161-17" name="__codelineno-161-17"></a><span class="p">}</span>
<a id="__codelineno-161-18" name="__codelineno-161-18"></a>
<a id="__codelineno-161-19" name="__codelineno-161-19"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%d 行のユーザーが削除されました。\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">rowsAffected</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="reload"><code>Reload</code>メソッドの解説</h2>
<h3 id="_123">概要</h3>
<p><code>Reload</code>メソッドは、現在の<code>User</code>オブジェクトをデータベースから再取得し、最新の状態に更新します。</p>
<h3 id="_124">関数シグネチャ</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-162-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-162-1" name="__codelineno-162-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">User</span><span class="p">)</span><span class="w"> </span><span class="nx">Reload</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>
</code></pre></div></td></tr></table></div>
<h3 id="_125">処理の流れ</h3>
<ol>
<li><strong>データベースから再取得</strong>:</li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-163-1">1</a></span>
<span class="normal"><a href="#__codelineno-163-2">2</a></span>
<span class="normal"><a href="#__codelineno-163-3">3</a></span>
<span class="normal"><a href="#__codelineno-163-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-163-1" name="__codelineno-163-1"></a><span class="nx">ret</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">FindUser</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">UserID</span><span class="p">)</span>
<a id="__codelineno-163-2" name="__codelineno-163-2"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-163-3" name="__codelineno-163-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-163-4" name="__codelineno-163-4"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>
<p>主キーを用いてデータベースから最新の<code>User</code>レコードを取得します。</p>
</li>
<li>
<p><strong>オブジェクトの更新</strong>:</p>
</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-164-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-164-1" name="__codelineno-164-1"></a><span class="o">*</span><span class="nx">o</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">*</span><span class="nx">ret</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>現在のオブジェクトに取得したデータを反映させます。</li>
</ul>
<h3 id="_126">利用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-165-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-165-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-165-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-165-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-165-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-165-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-165-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-165-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-165-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-165-10">10</a></span>
<span class="normal"><a href="#__codelineno-165-11">11</a></span>
<span class="normal"><a href="#__codelineno-165-12">12</a></span>
<span class="normal"><a href="#__codelineno-165-13">13</a></span>
<span class="normal"><a href="#__codelineno-165-14">14</a></span>
<span class="normal"><a href="#__codelineno-165-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-165-1" name="__codelineno-165-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-165-2" name="__codelineno-165-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-165-3" name="__codelineno-165-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-165-4" name="__codelineno-165-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-165-5" name="__codelineno-165-5"></a><span class="p">}</span>
<a id="__codelineno-165-6" name="__codelineno-165-6"></a>
<a id="__codelineno-165-7" name="__codelineno-165-7"></a><span class="nx">user</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">User</span><span class="p">{</span><span class="nx">UserID</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">}</span>
<a id="__codelineno-165-8" name="__codelineno-165-8"></a>
<a id="__codelineno-165-9" name="__codelineno-165-9"></a><span class="c1">// 他の処理でユーザー情報が更新されている可能性がある場合</span>
<a id="__codelineno-165-10" name="__codelineno-165-10"></a><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">Reload</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-165-11" name="__codelineno-165-11"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-165-12" name="__codelineno-165-12"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-165-13" name="__codelineno-165-13"></a><span class="p">}</span>
<a id="__codelineno-165-14" name="__codelineno-165-14"></a>
<a id="__codelineno-165-15" name="__codelineno-165-15"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;最新のユーザー情報: %+v\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>データベース操作における一般的なCRUD（作成、読み取り、更新、削除）操作を実装しています。特に、<code>Upsert</code>メソッドは挿入と更新を組み合わせた便利な機能であり、データの整合性を維持するのに役立ちます。</p>
<p>これらのメソッドを適切に利用することで、データベースとのやり取りを効率的かつ安全に行うことができます。開発者は、エラーハンドリングやトランザクション管理に留意しつつ、提供されたメソッドを活用してください。</p>
<hr />
<h2 id="reloadall"><code>ReloadAll</code>メソッドの解説</h2>
<h3 id="_127">概要</h3>
<p><code>ReloadAll</code>メソッドは、<code>UserSlice</code>（<code>User</code>オブジェクトのスライス）内の各<code>User</code>オブジェクトに対して、対応するデータベース上の最新のレコードを再取得し、元のスライスを更新します。これにより、スライス内のすべてのオブジェクトがデータベースの最新状態と同期されます。</p>
<h3 id="_128">関数シグネチャ</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-166-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-166-1" name="__codelineno-166-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">UserSlice</span><span class="p">)</span><span class="w"> </span><span class="nx">ReloadAll</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>o</code>: <code>UserSlice</code>のポインタ。再読み込み対象の<code>User</code>オブジェクトのスライス。</li>
<li><code>ctx</code>: コンテキスト。リクエストのスコープやキャンセルなどの制御に使用。</li>
<li><code>exec</code>: データベース操作を行うためのエグゼキュータ。</li>
</ul>
<h3 id="_129">処理の流れ</h3>
<ol>
<li><strong>入力データの検証</strong></li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-167-1">1</a></span>
<span class="normal"><a href="#__codelineno-167-2">2</a></span>
<span class="normal"><a href="#__codelineno-167-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-167-1" name="__codelineno-167-1"></a><span class="k">if</span><span class="w"> </span><span class="nx">o</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="o">*</span><span class="nx">o</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-167-2" name="__codelineno-167-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-167-3" name="__codelineno-167-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>
<p><code>UserSlice</code>が<code>nil</code>または空の場合、処理を終了します。エラーではなく<code>nil</code>を返すのは、再読み込みするオブジェクトがないため問題がないからです。</p>
</li>
<li>
<p><strong>再取得するオブジェクトの主キー値を収集</strong></p>
</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-168-1">1</a></span>
<span class="normal"><a href="#__codelineno-168-2">2</a></span>
<span class="normal"><a href="#__codelineno-168-3">3</a></span>
<span class="normal"><a href="#__codelineno-168-4">4</a></span>
<span class="normal"><a href="#__codelineno-168-5">5</a></span>
<span class="normal"><a href="#__codelineno-168-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-168-1" name="__codelineno-168-1"></a><span class="nx">slice</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">UserSlice</span><span class="p">{}</span>
<a id="__codelineno-168-2" name="__codelineno-168-2"></a><span class="kd">var</span><span class="w"> </span><span class="nx">args</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}</span>
<a id="__codelineno-168-3" name="__codelineno-168-3"></a><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="o">*</span><span class="nx">o</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-168-4" name="__codelineno-168-4"></a><span class="w">    </span><span class="nx">pkeyArgs</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">ValuesFromMapping</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">Indirect</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="nx">obj</span><span class="p">)),</span><span class="w"> </span><span class="nx">userPrimaryKeyMapping</span><span class="p">)</span>
<a id="__codelineno-168-5" name="__codelineno-168-5"></a><span class="w">    </span><span class="nx">args</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span><span class="w"> </span><span class="nx">pkeyArgs</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-168-6" name="__codelineno-168-6"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>新しい<code>UserSlice</code>である<code>slice</code>を作成します。</li>
<li>
<p>各<code>User</code>オブジェクトの主キー値（<code>user_id</code>）を取得し、<code>args</code>に追加します。</p>
</li>
<li>
<p><strong>再取得用のSQLクエリの構築</strong></p>
</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-169-1">1</a></span>
<span class="normal"><a href="#__codelineno-169-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-169-1" name="__codelineno-169-1"></a><span class="nx">sql</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;SELECT `users`.* FROM `users` WHERE &quot;</span><span class="w"> </span><span class="o">+</span>
<a id="__codelineno-169-2" name="__codelineno-169-2"></a><span class="w">    </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">WhereClauseRepeated</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">dialect</span><span class="p">.</span><span class="nx">LQ</span><span class="p">),</span><span class="w"> </span><span class="nb">string</span><span class="p">(</span><span class="nx">dialect</span><span class="p">.</span><span class="nx">RQ</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">userPrimaryKeyColumns</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="o">*</span><span class="nx">o</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>strmangle.WhereClauseRepeated</code>関数を使用して、主キーに基づくWHERE句を生成します。</li>
<li>
<p>生成されるSQLクエリは、例えば以下のようになります：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-170-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-170-1" name="__codelineno-170-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">`</span><span class="n">users</span><span class="o">`</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="o">`</span><span class="n">users</span><span class="o">`</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">user_id</span><span class="o">`=?</span><span class="p">)</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">user_id</span><span class="o">`=?</span><span class="p">)</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="p">...</span>
</code></pre></div></td></tr></table></div>
<p>主キーの数だけ<code>OR</code>条件が追加されます。</p>
</li>
<li>
<p><strong>クエリの実行</strong></p>
</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-171-1">1</a></span>
<span class="normal"><a href="#__codelineno-171-2">2</a></span>
<span class="normal"><a href="#__codelineno-171-3">3</a></span>
<span class="normal"><a href="#__codelineno-171-4">4</a></span>
<span class="normal"><a href="#__codelineno-171-5">5</a></span>
<span class="normal"><a href="#__codelineno-171-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-171-1" name="__codelineno-171-1"></a><span class="nx">q</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">Raw</span><span class="p">(</span><span class="nx">sql</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-171-2" name="__codelineno-171-2"></a>
<a id="__codelineno-171-3" name="__codelineno-171-3"></a><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">q</span><span class="p">.</span><span class="nx">Bind</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">slice</span><span class="p">)</span>
<a id="__codelineno-171-4" name="__codelineno-171-4"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-171-5" name="__codelineno-171-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to reload all in UserSlice&quot;</span><span class="p">)</span>
<a id="__codelineno-171-6" name="__codelineno-171-6"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>生のSQLクエリを作成し、<code>args</code>をバインドします。</li>
<li>クエリを実行し、結果を<code>slice</code>にバインドします。</li>
<li>
<p>エラーが発生した場合、適切なエラーメッセージを返します。</p>
</li>
<li>
<p><strong>元のスライスの更新</strong></p>
</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-172-1">1</a></span>
<span class="normal"><a href="#__codelineno-172-2">2</a></span>
<span class="normal"><a href="#__codelineno-172-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-172-1" name="__codelineno-172-1"></a><span class="o">*</span><span class="nx">o</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">slice</span>
<a id="__codelineno-172-2" name="__codelineno-172-2"></a>
<a id="__codelineno-172-3" name="__codelineno-172-3"></a><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>新しく取得した<code>slice</code>で、元の<code>UserSlice</code>の内容を置き換えます。</li>
<li>最後に<code>nil</code>を返し、処理が正常に完了したことを示します。</li>
</ul>
<h3 id="_130">利用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-173-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-173-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-173-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-173-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-173-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-173-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-173-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-173-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-173-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-173-10">10</a></span>
<span class="normal"><a href="#__codelineno-173-11">11</a></span>
<span class="normal"><a href="#__codelineno-173-12">12</a></span>
<span class="normal"><a href="#__codelineno-173-13">13</a></span>
<span class="normal"><a href="#__codelineno-173-14">14</a></span>
<span class="normal"><a href="#__codelineno-173-15">15</a></span>
<span class="normal"><a href="#__codelineno-173-16">16</a></span>
<span class="normal"><a href="#__codelineno-173-17">17</a></span>
<span class="normal"><a href="#__codelineno-173-18">18</a></span>
<span class="normal"><a href="#__codelineno-173-19">19</a></span>
<span class="normal"><a href="#__codelineno-173-20">20</a></span>
<span class="normal"><a href="#__codelineno-173-21">21</a></span>
<span class="normal"><a href="#__codelineno-173-22">22</a></span>
<span class="normal"><a href="#__codelineno-173-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-173-1" name="__codelineno-173-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-173-2" name="__codelineno-173-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-173-3" name="__codelineno-173-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-173-4" name="__codelineno-173-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-173-5" name="__codelineno-173-5"></a><span class="p">}</span>
<a id="__codelineno-173-6" name="__codelineno-173-6"></a>
<a id="__codelineno-173-7" name="__codelineno-173-7"></a><span class="c1">// 既存のユーザーオブジェクトのスライス</span>
<a id="__codelineno-173-8" name="__codelineno-173-8"></a><span class="nx">users</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">UserSlice</span><span class="p">{</span>
<a id="__codelineno-173-9" name="__codelineno-173-9"></a><span class="w">    </span><span class="o">&amp;</span><span class="nx">User</span><span class="p">{</span><span class="nx">UserID</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">},</span>
<a id="__codelineno-173-10" name="__codelineno-173-10"></a><span class="w">    </span><span class="o">&amp;</span><span class="nx">User</span><span class="p">{</span><span class="nx">UserID</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">},</span>
<a id="__codelineno-173-11" name="__codelineno-173-11"></a><span class="w">    </span><span class="o">&amp;</span><span class="nx">User</span><span class="p">{</span><span class="nx">UserID</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">},</span>
<a id="__codelineno-173-12" name="__codelineno-173-12"></a><span class="p">}</span>
<a id="__codelineno-173-13" name="__codelineno-173-13"></a>
<a id="__codelineno-173-14" name="__codelineno-173-14"></a><span class="c1">// データベース上の最新の情報に更新</span>
<a id="__codelineno-173-15" name="__codelineno-173-15"></a><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">users</span><span class="p">.</span><span class="nx">ReloadAll</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-173-16" name="__codelineno-173-16"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-173-17" name="__codelineno-173-17"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-173-18" name="__codelineno-173-18"></a><span class="p">}</span>
<a id="__codelineno-173-19" name="__codelineno-173-19"></a>
<a id="__codelineno-173-20" name="__codelineno-173-20"></a><span class="c1">// 更新されたユーザー情報を表示</span>
<a id="__codelineno-173-21" name="__codelineno-173-21"></a><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">users</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-173-22" name="__codelineno-173-22"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;ユーザーID: %d, 名前: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">UserID</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
<a id="__codelineno-173-23" name="__codelineno-173-23"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>この例では、<code>users</code>スライス内の各<code>User</code>オブジェクトがデータベースから再取得され、最新の情報に更新されます。</p>
<hr />
<h2 id="userexists"><code>UserExists</code>関数の解説</h2>
<h3 id="_131">概要</h3>
<p><code>UserExists</code>関数は、指定した<code>user_id</code>を持つ<code>User</code>レコードがデータベースに存在するかどうかをチェックします。</p>
<h3 id="_132">関数シグネチャ</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-174-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-174-1" name="__codelineno-174-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">UserExists</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">userID</span><span class="w"> </span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>ctx</code>: コンテキスト。</li>
<li><code>exec</code>: データベース操作を行うエグゼキュータ。</li>
<li><code>userID</code>: 存在確認したい<code>User</code>の<code>user_id</code>。</li>
<li>戻り値:</li>
<li><code>bool</code>: 存在する場合は<code>true</code>、存在しない場合は<code>false</code>。</li>
<li><code>error</code>: エラー情報。</li>
</ul>
<h3 id="_133">処理の流れ</h3>
<ol>
<li><strong>存在確認用のSQLクエリの作成</strong></li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-175-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-175-1" name="__codelineno-175-1"></a><span class="nx">sql</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;select exists(select 1 from `users` where `user_id`=? limit 1)&quot;</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>指定した<code>user_id</code>を持つレコードが存在するかをチェックするSQLクエリを作成します。</li>
<li>
<p><code>EXISTS</code>句を使用して、存在の有無を効率的に確認します。</p>
</li>
<li>
<p><strong>デバッグログの出力（任意）</strong></p>
</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-176-1">1</a></span>
<span class="normal"><a href="#__codelineno-176-2">2</a></span>
<span class="normal"><a href="#__codelineno-176-3">3</a></span>
<span class="normal"><a href="#__codelineno-176-4">4</a></span>
<span class="normal"><a href="#__codelineno-176-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-176-1" name="__codelineno-176-1"></a><span class="k">if</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">IsDebug</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-176-2" name="__codelineno-176-2"></a><span class="w">    </span><span class="nx">writer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">DebugWriterFrom</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<a id="__codelineno-176-3" name="__codelineno-176-3"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">)</span>
<a id="__codelineno-176-4" name="__codelineno-176-4"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">userID</span><span class="p">)</span>
<a id="__codelineno-176-5" name="__codelineno-176-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>
<p>デバッグモードの場合、実行するSQLクエリとパラメータをログに出力します。</p>
</li>
<li>
<p><strong>クエリの実行と結果の取得</strong></p>
</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-177-1">1</a></span>
<span class="normal"><a href="#__codelineno-177-2">2</a></span>
<span class="normal"><a href="#__codelineno-177-3">3</a></span>
<span class="normal"><a href="#__codelineno-177-4">4</a></span>
<span class="normal"><a href="#__codelineno-177-5">5</a></span>
<span class="normal"><a href="#__codelineno-177-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-177-1" name="__codelineno-177-1"></a><span class="nx">row</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">exec</span><span class="p">.</span><span class="nx">QueryRowContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">,</span><span class="w"> </span><span class="nx">userID</span><span class="p">)</span>
<a id="__codelineno-177-2" name="__codelineno-177-2"></a>
<a id="__codelineno-177-3" name="__codelineno-177-3"></a><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">row</span><span class="p">.</span><span class="nx">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">exists</span><span class="p">)</span>
<a id="__codelineno-177-4" name="__codelineno-177-4"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-177-5" name="__codelineno-177-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to check if users exists&quot;</span><span class="p">)</span>
<a id="__codelineno-177-6" name="__codelineno-177-6"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>クエリを実行し、結果を<code>exists</code>変数にスキャンします。</li>
<li>
<p>エラーが発生した場合、エラーメッセージを返します。</p>
</li>
<li>
<p><strong>存在結果の返却</strong></p>
</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-178-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-178-1" name="__codelineno-178-1"></a><span class="k">return</span><span class="w"> </span><span class="nx">exists</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>存在確認の結果を返します。</li>
</ul>
<h3 id="_134">利用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-179-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-179-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-179-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-179-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-179-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-179-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-179-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-179-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-179-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-179-10">10</a></span>
<span class="normal"><a href="#__codelineno-179-11">11</a></span>
<span class="normal"><a href="#__codelineno-179-12">12</a></span>
<span class="normal"><a href="#__codelineno-179-13">13</a></span>
<span class="normal"><a href="#__codelineno-179-14">14</a></span>
<span class="normal"><a href="#__codelineno-179-15">15</a></span>
<span class="normal"><a href="#__codelineno-179-16">16</a></span>
<span class="normal"><a href="#__codelineno-179-17">17</a></span>
<span class="normal"><a href="#__codelineno-179-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-179-1" name="__codelineno-179-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-179-2" name="__codelineno-179-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-179-3" name="__codelineno-179-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-179-4" name="__codelineno-179-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-179-5" name="__codelineno-179-5"></a><span class="p">}</span>
<a id="__codelineno-179-6" name="__codelineno-179-6"></a>
<a id="__codelineno-179-7" name="__codelineno-179-7"></a><span class="nx">userID</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">uint</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-179-8" name="__codelineno-179-8"></a>
<a id="__codelineno-179-9" name="__codelineno-179-9"></a><span class="nx">exists</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">UserExists</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">userID</span><span class="p">)</span>
<a id="__codelineno-179-10" name="__codelineno-179-10"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-179-11" name="__codelineno-179-11"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-179-12" name="__codelineno-179-12"></a><span class="p">}</span>
<a id="__codelineno-179-13" name="__codelineno-179-13"></a>
<a id="__codelineno-179-14" name="__codelineno-179-14"></a><span class="k">if</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-179-15" name="__codelineno-179-15"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;ユーザーID %d は存在します。\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">userID</span><span class="p">)</span>
<a id="__codelineno-179-16" name="__codelineno-179-16"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-179-17" name="__codelineno-179-17"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;ユーザーID %d は存在しません。\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">userID</span><span class="p">)</span>
<a id="__codelineno-179-18" name="__codelineno-179-18"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>この例では、指定した<code>userID</code>の<code>User</code>が存在するかをチェックし、その結果に応じてメッセージを表示します。</p>
<hr />
<h2 id="exists_1"><code>Exists</code>メソッドの解説</h2>
<h3 id="_135">概要</h3>
<p><code>Exists</code>メソッドは、<code>User</code>オブジェクトに対応するレコードがデータベースに存在するかどうかを確認します。<code>User</code>オブジェクトの<code>UserID</code>を使用して存在確認を行います。</p>
<h3 id="_136">関数シグネチャ</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-180-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-180-1" name="__codelineno-180-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">User</span><span class="p">)</span><span class="w"> </span><span class="nx">Exists</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>o</code>: <code>User</code>オブジェクト。</li>
<li><code>ctx</code>: コンテキスト。</li>
<li><code>exec</code>: データベース操作を行うエグゼキュータ。</li>
<li>戻り値:</li>
<li><code>bool</code>: 存在する場合は<code>true</code>、存在しない場合は<code>false</code>。</li>
<li><code>error</code>: エラー情報。</li>
</ul>
<h3 id="_137">処理の流れ</h3>
<ol>
<li><strong><code>UserExists</code>関数の呼び出し</strong></li>
</ol>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-181-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-181-1" name="__codelineno-181-1"></a><span class="k">return</span><span class="w"> </span><span class="nx">UserExists</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">UserID</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>User</code>オブジェクトの<code>UserID</code>を使用して、<code>UserExists</code>関数を呼び出します。</li>
<li>これにより、指定した<code>UserID</code>のレコードが存在するかを確認します。</li>
</ul>
<h3 id="_138">利用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-182-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-182-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-182-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-182-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-182-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-182-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-182-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-182-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-182-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-182-10">10</a></span>
<span class="normal"><a href="#__codelineno-182-11">11</a></span>
<span class="normal"><a href="#__codelineno-182-12">12</a></span>
<span class="normal"><a href="#__codelineno-182-13">13</a></span>
<span class="normal"><a href="#__codelineno-182-14">14</a></span>
<span class="normal"><a href="#__codelineno-182-15">15</a></span>
<span class="normal"><a href="#__codelineno-182-16">16</a></span>
<span class="normal"><a href="#__codelineno-182-17">17</a></span>
<span class="normal"><a href="#__codelineno-182-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-182-1" name="__codelineno-182-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-182-2" name="__codelineno-182-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-182-3" name="__codelineno-182-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-182-4" name="__codelineno-182-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-182-5" name="__codelineno-182-5"></a><span class="p">}</span>
<a id="__codelineno-182-6" name="__codelineno-182-6"></a>
<a id="__codelineno-182-7" name="__codelineno-182-7"></a><span class="nx">user</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">User</span><span class="p">{</span><span class="nx">UserID</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">}</span>
<a id="__codelineno-182-8" name="__codelineno-182-8"></a>
<a id="__codelineno-182-9" name="__codelineno-182-9"></a><span class="nx">exists</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">Exists</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-182-10" name="__codelineno-182-10"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-182-11" name="__codelineno-182-11"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-182-12" name="__codelineno-182-12"></a><span class="p">}</span>
<a id="__codelineno-182-13" name="__codelineno-182-13"></a>
<a id="__codelineno-182-14" name="__codelineno-182-14"></a><span class="k">if</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-182-15" name="__codelineno-182-15"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;ユーザーID %d は存在します。\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">UserID</span><span class="p">)</span>
<a id="__codelineno-182-16" name="__codelineno-182-16"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-182-17" name="__codelineno-182-17"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;ユーザーID %d は存在しません。\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">UserID</span><span class="p">)</span>
<a id="__codelineno-182-18" name="__codelineno-182-18"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>この例では、<code>User</code>オブジェクトを使用して存在確認を行い、その結果に応じてメッセージを表示します。</p>
<p><code>User</code>オブジェクトやそのスライスに対するデータベースとの同期や存在確認を効率的に行うためのメソッドと関数です。</p>
<ul>
<li>
<p><strong><code>ReloadAll</code></strong>: スライス内のすべての<code>User</code>オブジェクトをデータベース上の最新状態に更新します。大量の<code>User</code>を扱う場合に非常に便利です。</p>
</li>
<li>
<p><strong><code>UserExists</code></strong>: 特定の<code>user_id</code>を持つ<code>User</code>レコードがデータベースに存在するかを確認します。存在確認のためのユーティリティ関数です。</p>
</li>
<li>
<p><strong><code>Exists</code></strong>: <code>User</code>オブジェクト自身に対して、対応するレコードの存在を確認します。オブジェクトの状態とデータベースの状態を同期させる際に役立ちます。</p>
</li>
</ul>
<p>これらのメソッドや関数を活用することで、データの整合性を保ちながら効率的なデータベース操作が可能となります。開発者は、アプリケーションの要件に応じてこれらの機能を統合し、堅牢なデータ管理を実現してください。</p>
<hr />
<h2 id="_139">参考資料</h2>
<ul>
<li><a href="https://github.com/volatiletech/sqlboiler">SQLBoiler ドキュメント</a></li>
<li><a href="https://pkg.go.dev/database/sql">Go 言語 データベース操作</a></li>
<li><a href="https://pkg.go.dev/context">コンテキストパッケージ</a></li>
</ul>
<hr />












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/GradProjectHub/GradProject" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.annotate"], "search": "../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
    
  </body>
</html>