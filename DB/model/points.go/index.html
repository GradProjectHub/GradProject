
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../point_logs.go/">
      
      
        <link rel="next" href="../users.go/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.44">
    
    
      
        <title>Pointモデルの詳細解説と利用例 - My Docs</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.0253249f.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="cyan" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#point" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="My Docs" class="md-header__button md-logo" aria-label="My Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            My Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Pointモデルの詳細解説と利用例
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="My Docs" class="md-nav__button md-logo" aria-label="My Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    My Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Welcome to MkDocs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E3%83%9E%E3%83%BC%E3%82%AB%E3%83%BC%E7%94%BB%E5%83%8F/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    画像の保存
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    DB
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            DB
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" checked>
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Model
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            Model
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../point_logs.go/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PointLog構造体の詳細な解説と利用例
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Pointモデルの詳細解説と利用例
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Pointモデルの詳細解説と利用例
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      コードの概要
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#point_1" class="md-nav__link">
    <span class="md-ellipsis">
      Point構造体の解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Point構造体の解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      構造体の定義
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      フィールド変数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pointrpointl" class="md-nav__link">
    <span class="md-ellipsis">
      pointRとpointL構造体
    </span>
  </a>
  
    <nav class="md-nav" aria-label="pointRとpointL構造体">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      リレーションシップ構造体
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      リレーションのロードメソッド
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      カラムリストと主キー
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hooks" class="md-nav__link">
    <span class="md-ellipsis">
      フック（Hooks）の解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="フック（Hooks）の解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      フックの種類
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      フックの定義と実行
    </span>
  </a>
  
    <nav class="md-nav" aria-label="フックの定義と実行">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      フック関数の型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      フックの登録
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      フックの実行
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
    <nav class="md-nav" aria-label="利用例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      フック関数の実装と登録
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      データベース操作のメソッド
    </span>
  </a>
  
    <nav class="md-nav" aria-label="データベース操作のメソッド">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#insert" class="md-nav__link">
    <span class="md-ellipsis">
      Insertメソッド
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Insertメソッド">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      概要
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      関数シグネチャ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      処理の流れ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update" class="md-nav__link">
    <span class="md-ellipsis">
      Updateメソッド
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Updateメソッド">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      概要
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      関数シグネチャ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete" class="md-nav__link">
    <span class="md-ellipsis">
      Deleteメソッド
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Deleteメソッド">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      概要
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    <span class="md-ellipsis">
      クエリの作成と実行
    </span>
  </a>
  
    <nav class="md-nav" aria-label="クエリの作成と実行">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    <span class="md-ellipsis">
      ポイントの取得
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ポイントの取得">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    <span class="md-ellipsis">
      単一のポイントを取得
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    <span class="md-ellipsis">
      ポイントのリストを取得
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    <span class="md-ellipsis">
      リレーションのロード
    </span>
  </a>
  
    <nav class="md-nav" aria-label="リレーションのロード">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    <span class="md-ellipsis">
      リレーションのロード方法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#point_2" class="md-nav__link">
    <span class="md-ellipsis">
      Point構造体の単一レコード取得メソッド
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Point構造体の単一レコード取得メソッド">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#point_3" class="md-nav__link">
    <span class="md-ellipsis">
      Point構造体の全レコード取得メソッド
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Point構造体の全レコード取得メソッド">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#point_4" class="md-nav__link">
    <span class="md-ellipsis">
      Pointレコードのカウント取得メソッド
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pointレコードのカウント取得メソッド">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_34" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_35" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#point_5" class="md-nav__link">
    <span class="md-ellipsis">
      Pointレコードの存在確認メソッド
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pointレコードの存在確認メソッド">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_36" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_37" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user" class="md-nav__link">
    <span class="md-ellipsis">
      外部キーによるUserの取得
    </span>
  </a>
  
    <nav class="md-nav" aria-label="外部キーによるUserの取得">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_38" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_39" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#n-1user" class="md-nav__link">
    <span class="md-ellipsis">
      N-1リレーションのロード（Userのロード）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="N-1リレーションのロード（Userのロード）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_40" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_41" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pointuser" class="md-nav__link">
    <span class="md-ellipsis">
      PointオブジェクトへのUserのセット
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PointオブジェクトへのUserのセット">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_42" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_43" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#points" class="md-nav__link">
    <span class="md-ellipsis">
      Pointsクエリの生成
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pointsクエリの生成">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_44" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_45" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#point_6" class="md-nav__link">
    <span class="md-ellipsis">
      特定のPointレコードの検索
    </span>
  </a>
  
    <nav class="md-nav" aria-label="特定のPointレコードの検索">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_46" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_47" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#point_7" class="md-nav__link">
    <span class="md-ellipsis">
      Point構造体のレコード挿入メソッド
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Point構造体のレコード挿入メソッド">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_48" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_49" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#point_8" class="md-nav__link">
    <span class="md-ellipsis">
      Point構造体のレコード更新メソッド
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Point構造体のレコード更新メソッド">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_50" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_51" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_52" class="md-nav__link">
    <span class="md-ellipsis">
      クエリにマッチする全レコードの更新メソッド
    </span>
  </a>
  
    <nav class="md-nav" aria-label="クエリにマッチする全レコードの更新メソッド">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_53" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_54" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pointslice" class="md-nav__link">
    <span class="md-ellipsis">
      PointSliceの一括更新メソッド
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PointSliceの一括更新メソッド">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_55" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_56" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysqlpoint" class="md-nav__link">
    <span class="md-ellipsis">
      MySQLにおけるPointテーブルのユニークカラム
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MySQLにおけるPointテーブルのユニークカラム">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_57" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_58" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../users.go/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Userモデルの詳細解説と利用例
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Git
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Git
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Git/Fetch%E3%81%A8Pull/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fetchとpullはどう違うのか
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Git/origin%28%E3%83%AA%E3%83%A2%E3%83%BC%E3%83%88%29%E3%83%96%E3%83%A9%E3%83%B3%E3%83%81%E5%89%8A%E9%99%A4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Origin(リモート)ブランチ削除
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Google Maps
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Google Maps
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Google%20Maps/Maps%20JavaScript%20API/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Maps JavaScript API
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      コードの概要
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#point_1" class="md-nav__link">
    <span class="md-ellipsis">
      Point構造体の解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Point構造体の解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      構造体の定義
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      フィールド変数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pointrpointl" class="md-nav__link">
    <span class="md-ellipsis">
      pointRとpointL構造体
    </span>
  </a>
  
    <nav class="md-nav" aria-label="pointRとpointL構造体">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      リレーションシップ構造体
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      リレーションのロードメソッド
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      カラムリストと主キー
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hooks" class="md-nav__link">
    <span class="md-ellipsis">
      フック（Hooks）の解説
    </span>
  </a>
  
    <nav class="md-nav" aria-label="フック（Hooks）の解説">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      フックの種類
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      フックの定義と実行
    </span>
  </a>
  
    <nav class="md-nav" aria-label="フックの定義と実行">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      フック関数の型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      フックの登録
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      フックの実行
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
    <nav class="md-nav" aria-label="利用例">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      フック関数の実装と登録
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      データベース操作のメソッド
    </span>
  </a>
  
    <nav class="md-nav" aria-label="データベース操作のメソッド">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#insert" class="md-nav__link">
    <span class="md-ellipsis">
      Insertメソッド
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Insertメソッド">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      概要
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      関数シグネチャ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      処理の流れ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update" class="md-nav__link">
    <span class="md-ellipsis">
      Updateメソッド
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Updateメソッド">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      概要
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      関数シグネチャ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete" class="md-nav__link">
    <span class="md-ellipsis">
      Deleteメソッド
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Deleteメソッド">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      概要
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    <span class="md-ellipsis">
      クエリの作成と実行
    </span>
  </a>
  
    <nav class="md-nav" aria-label="クエリの作成と実行">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    <span class="md-ellipsis">
      ポイントの取得
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ポイントの取得">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    <span class="md-ellipsis">
      単一のポイントを取得
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    <span class="md-ellipsis">
      ポイントのリストを取得
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    <span class="md-ellipsis">
      リレーションのロード
    </span>
  </a>
  
    <nav class="md-nav" aria-label="リレーションのロード">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    <span class="md-ellipsis">
      リレーションのロード方法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#point_2" class="md-nav__link">
    <span class="md-ellipsis">
      Point構造体の単一レコード取得メソッド
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Point構造体の単一レコード取得メソッド">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#point_3" class="md-nav__link">
    <span class="md-ellipsis">
      Point構造体の全レコード取得メソッド
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Point構造体の全レコード取得メソッド">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#point_4" class="md-nav__link">
    <span class="md-ellipsis">
      Pointレコードのカウント取得メソッド
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pointレコードのカウント取得メソッド">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_34" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_35" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#point_5" class="md-nav__link">
    <span class="md-ellipsis">
      Pointレコードの存在確認メソッド
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pointレコードの存在確認メソッド">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_36" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_37" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#user" class="md-nav__link">
    <span class="md-ellipsis">
      外部キーによるUserの取得
    </span>
  </a>
  
    <nav class="md-nav" aria-label="外部キーによるUserの取得">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_38" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_39" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#n-1user" class="md-nav__link">
    <span class="md-ellipsis">
      N-1リレーションのロード（Userのロード）
    </span>
  </a>
  
    <nav class="md-nav" aria-label="N-1リレーションのロード（Userのロード）">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_40" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_41" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pointuser" class="md-nav__link">
    <span class="md-ellipsis">
      PointオブジェクトへのUserのセット
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PointオブジェクトへのUserのセット">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_42" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_43" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#points" class="md-nav__link">
    <span class="md-ellipsis">
      Pointsクエリの生成
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pointsクエリの生成">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_44" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_45" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#point_6" class="md-nav__link">
    <span class="md-ellipsis">
      特定のPointレコードの検索
    </span>
  </a>
  
    <nav class="md-nav" aria-label="特定のPointレコードの検索">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_46" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_47" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#point_7" class="md-nav__link">
    <span class="md-ellipsis">
      Point構造体のレコード挿入メソッド
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Point構造体のレコード挿入メソッド">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_48" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_49" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#point_8" class="md-nav__link">
    <span class="md-ellipsis">
      Point構造体のレコード更新メソッド
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Point構造体のレコード更新メソッド">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_50" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_51" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_52" class="md-nav__link">
    <span class="md-ellipsis">
      クエリにマッチする全レコードの更新メソッド
    </span>
  </a>
  
    <nav class="md-nav" aria-label="クエリにマッチする全レコードの更新メソッド">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_53" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_54" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pointslice" class="md-nav__link">
    <span class="md-ellipsis">
      PointSliceの一括更新メソッド
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PointSliceの一括更新メソッド">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_55" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_56" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mysqlpoint" class="md-nav__link">
    <span class="md-ellipsis">
      MySQLにおけるPointテーブルのユニークカラム
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MySQLにおけるPointテーブルのユニークカラム">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_57" class="md-nav__link">
    <span class="md-ellipsis">
      解説
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_58" class="md-nav__link">
    <span class="md-ellipsis">
      利用例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="point">Pointモデルの詳細解説と利用例</h1>
<h2 id="_1">コードの概要</h2>
<p>このコードは、SQLBoilerによって自動生成された<code>Point</code>モデルに関するものです。<code>Point</code>モデルは、データベース内の<code>points</code>テーブルを表現し、ユーザーのポイント情報を管理します。このモデルには、データベース操作を行うためのさまざまなメソッドや関数が含まれています。</p>
<hr />
<h2 id="point_1"><code>Point</code>構造体の解説</h2>
<h3 id="_2">構造体の定義</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span>
<span class="normal"><a href="#__codelineno-0-3">3</a></span>
<span class="normal"><a href="#__codelineno-0-4">4</a></span>
<span class="normal"><a href="#__codelineno-0-5">5</a></span>
<span class="normal"><a href="#__codelineno-0-6">6</a></span>
<span class="normal"><a href="#__codelineno-0-7">7</a></span>
<span class="normal"><a href="#__codelineno-0-8">8</a></span>
<span class="normal"><a href="#__codelineno-0-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="kd">type</span><span class="w"> </span><span class="nx">Point</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="w">    </span><span class="nx">UserID</span><span class="w">       </span><span class="kt">uint</span><span class="w">      </span><span class="s">`boil:&quot;user_id&quot; json:&quot;user_id&quot; toml:&quot;user_id&quot; yaml:&quot;user_id&quot;`</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="w">    </span><span class="nx">CurrentPoint</span><span class="w"> </span><span class="kt">int</span><span class="w">       </span><span class="s">`boil:&quot;current_point&quot; json:&quot;current_point&quot; toml:&quot;current_point&quot; yaml:&quot;current_point&quot;`</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="w">    </span><span class="nx">CreatedAt</span><span class="w">    </span><span class="nx">time</span><span class="p">.</span><span class="nx">Time</span><span class="w"> </span><span class="s">`boil:&quot;created_at&quot; json:&quot;created_at&quot; toml:&quot;created_at&quot; yaml:&quot;created_at&quot;`</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="w">    </span><span class="nx">UpdatedAt</span><span class="w">    </span><span class="nx">time</span><span class="p">.</span><span class="nx">Time</span><span class="w"> </span><span class="s">`boil:&quot;updated_at&quot; json:&quot;updated_at&quot; toml:&quot;updated_at&quot; yaml:&quot;updated_at&quot;`</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="w">    </span><span class="nx">R</span><span class="w"> </span><span class="o">*</span><span class="nx">pointR</span><span class="w"> </span><span class="s">`boil:&quot;-&quot; json:&quot;-&quot; toml:&quot;-&quot; yaml:&quot;-&quot;`</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="w">    </span><span class="nx">L</span><span class="w"> </span><span class="nx">pointL</span><span class="w">  </span><span class="s">`boil:&quot;-&quot; json:&quot;-&quot; toml:&quot;-&quot; yaml:&quot;-&quot;`</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong>フィールドの説明</strong>:</li>
<li><code>UserID</code>: ユーザーの識別子。<code>users</code>テーブルの外部キー。</li>
<li><code>CurrentPoint</code>: 現在のポイント数。</li>
<li><code>CreatedAt</code>: レコードの作成日時。</li>
<li>
<p><code>UpdatedAt</code>: レコードの更新日時。</p>
</li>
<li>
<p><strong>タグ</strong>:</p>
</li>
<li><code>boil</code>タグは、SQLBoilerがデータベースのカラム名とフィールドをマッピングするために使用します。</li>
<li>
<p><code>json</code>、<code>toml</code>、<code>yaml</code>タグは、それぞれのフォーマットでのシリアライズ時のフィールド名を指定します。</p>
</li>
<li>
<p><strong>リレーションシップフィールド</strong>:</p>
</li>
<li><code>R *pointR</code>: リレーションを保持するフィールド。関連するオブジェクトへのアクセスに使用します。</li>
<li><code>L pointL</code>: リレーションのロードメソッドを提供します。</li>
</ul>
<h3 id="_3">フィールド変数</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span>
<span class="normal"><a href="#__codelineno-1-11">11</a></span>
<span class="normal"><a href="#__codelineno-1-12">12</a></span>
<span class="normal"><a href="#__codelineno-1-13">13</a></span>
<span class="normal"><a href="#__codelineno-1-14">14</a></span>
<span class="normal"><a href="#__codelineno-1-15">15</a></span>
<span class="normal"><a href="#__codelineno-1-16">16</a></span>
<span class="normal"><a href="#__codelineno-1-17">17</a></span>
<span class="normal"><a href="#__codelineno-1-18">18</a></span>
<span class="normal"><a href="#__codelineno-1-19">19</a></span>
<span class="normal"><a href="#__codelineno-1-20">20</a></span>
<span class="normal"><a href="#__codelineno-1-21">21</a></span>
<span class="normal"><a href="#__codelineno-1-22">22</a></span>
<span class="normal"><a href="#__codelineno-1-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">PointColumns</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="w">    </span><span class="nx">UserID</span><span class="w">       </span><span class="kt">string</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="w">    </span><span class="nx">CurrentPoint</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="w">    </span><span class="nx">CreatedAt</span><span class="w">    </span><span class="kt">string</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="w">    </span><span class="nx">UpdatedAt</span><span class="w">    </span><span class="kt">string</span>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="p">}{</span>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="w">    </span><span class="nx">UserID</span><span class="p">:</span><span class="w">       </span><span class="s">&quot;user_id&quot;</span><span class="p">,</span>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="w">    </span><span class="nx">CurrentPoint</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;current_point&quot;</span><span class="p">,</span>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="w">    </span><span class="nx">CreatedAt</span><span class="p">:</span><span class="w">    </span><span class="s">&quot;created_at&quot;</span><span class="p">,</span>
<a id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="w">    </span><span class="nx">UpdatedAt</span><span class="p">:</span><span class="w">    </span><span class="s">&quot;updated_at&quot;</span><span class="p">,</span>
<a id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="p">}</span>
<a id="__codelineno-1-12" name="__codelineno-1-12"></a>
<a id="__codelineno-1-13" name="__codelineno-1-13"></a><span class="kd">var</span><span class="w"> </span><span class="nx">PointTableColumns</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-14" name="__codelineno-1-14"></a><span class="w">    </span><span class="nx">UserID</span><span class="w">       </span><span class="kt">string</span>
<a id="__codelineno-1-15" name="__codelineno-1-15"></a><span class="w">    </span><span class="nx">CurrentPoint</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-1-16" name="__codelineno-1-16"></a><span class="w">    </span><span class="nx">CreatedAt</span><span class="w">    </span><span class="kt">string</span>
<a id="__codelineno-1-17" name="__codelineno-1-17"></a><span class="w">    </span><span class="nx">UpdatedAt</span><span class="w">    </span><span class="kt">string</span>
<a id="__codelineno-1-18" name="__codelineno-1-18"></a><span class="p">}{</span>
<a id="__codelineno-1-19" name="__codelineno-1-19"></a><span class="w">    </span><span class="nx">UserID</span><span class="p">:</span><span class="w">       </span><span class="s">&quot;points.user_id&quot;</span><span class="p">,</span>
<a id="__codelineno-1-20" name="__codelineno-1-20"></a><span class="w">    </span><span class="nx">CurrentPoint</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;points.current_point&quot;</span><span class="p">,</span>
<a id="__codelineno-1-21" name="__codelineno-1-21"></a><span class="w">    </span><span class="nx">CreatedAt</span><span class="p">:</span><span class="w">    </span><span class="s">&quot;points.created_at&quot;</span><span class="p">,</span>
<a id="__codelineno-1-22" name="__codelineno-1-22"></a><span class="w">    </span><span class="nx">UpdatedAt</span><span class="p">:</span><span class="w">    </span><span class="s">&quot;points.updated_at&quot;</span><span class="p">,</span>
<a id="__codelineno-1-23" name="__codelineno-1-23"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong><code>PointColumns</code></strong>: テーブル内の各カラム名を定義します。</li>
<li><strong><code>PointTableColumns</code></strong>: テーブル名を含めたカラム名を定義します。</li>
</ul>
<p>これらの変数は、クエリを作成する際に便利です。</p>
<h3 id="pointrpointl"><code>pointR</code>と<code>pointL</code>構造体</h3>
<h4 id="_4">リレーションシップ構造体</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span>
<span class="normal"><a href="#__codelineno-2-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="kd">type</span><span class="w"> </span><span class="nx">pointR</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="w">    </span><span class="nx">User</span><span class="w"> </span><span class="o">*</span><span class="nx">User</span><span class="w"> </span><span class="s">`boil:&quot;User&quot; json:&quot;User&quot; toml:&quot;User&quot; yaml:&quot;User&quot;`</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>pointR</code>はリレーションを保持するための構造体です。</li>
<li><strong><code>User *User</code></strong>: <code>Point</code>が関連付けられている<code>User</code>オブジェクトへの参照。</li>
</ul>
<h4 id="_5">リレーションのロードメソッド</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="kd">type</span><span class="w"> </span><span class="nx">pointL</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>pointL</code>は、関連するオブジェクトをロードするためのメソッドを提供します。</li>
</ul>
<h3 id="_6">カラムリストと主キー</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span>
<span class="normal"><a href="#__codelineno-4-2">2</a></span>
<span class="normal"><a href="#__codelineno-4-3">3</a></span>
<span class="normal"><a href="#__codelineno-4-4">4</a></span>
<span class="normal"><a href="#__codelineno-4-5">5</a></span>
<span class="normal"><a href="#__codelineno-4-6">6</a></span>
<span class="normal"><a href="#__codelineno-4-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="kd">var</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="w">    </span><span class="nx">pointAllColumns</span><span class="w">            </span><span class="p">=</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;user_id&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;current_point&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;created_at&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;updated_at&quot;</span><span class="p">}</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="w">    </span><span class="nx">pointColumnsWithoutDefault</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;user_id&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;current_point&quot;</span><span class="p">}</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="w">    </span><span class="nx">pointColumnsWithDefault</span><span class="w">    </span><span class="p">=</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;created_at&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;updated_at&quot;</span><span class="p">}</span>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="w">    </span><span class="nx">pointPrimaryKeyColumns</span><span class="w">     </span><span class="p">=</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;user_id&quot;</span><span class="p">}</span>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a><span class="w">    </span><span class="nx">pointGeneratedColumns</span><span class="w">      </span><span class="p">=</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{}</span>
<a id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong><code>pointAllColumns</code></strong>: テーブルのすべてのカラム名のスライス。</li>
<li><strong><code>pointColumnsWithoutDefault</code></strong>: デフォルト値を持たないカラムのスライス。</li>
<li><strong><code>pointColumnsWithDefault</code></strong>: デフォルト値を持つカラムのスライス。</li>
<li><strong><code>pointPrimaryKeyColumns</code></strong>: 主キーとなるカラム名のスライス。</li>
<li><strong><code>pointGeneratedColumns</code></strong>: データベースによって自動生成されるカラムのスライス。</li>
</ul>
<p>これらの変数は、データベース操作時にカラムを動的に指定するために使用されます。</p>
<hr />
<h2 id="hooks">フック（Hooks）の解説</h2>
<p>フックは、特定のデータベース操作の前後にカスタムロジックを挿入するために使用されます。</p>
<h3 id="_7">フックの種類</h3>
<ul>
<li><strong>After Select Hook</strong>: データベースからレコードを取得した後に実行。</li>
<li><strong>Before Insert Hook</strong>: レコードを挿入する前に実行。</li>
<li><strong>After Insert Hook</strong>: レコードを挿入した後に実行。</li>
<li><strong>Before Update Hook</strong>: レコードを更新する前に実行。</li>
<li><strong>After Update Hook</strong>: レコードを更新した後に実行。</li>
<li><strong>Before Delete Hook</strong>: レコードを削除する前に実行。</li>
<li><strong>After Delete Hook</strong>: レコードを削除した後に実行。</li>
<li><strong>Before Upsert Hook</strong>: アップサート操作の前に実行。</li>
<li><strong>After Upsert Hook</strong>: アップサート操作の後に実行。</li>
</ul>
<h3 id="_8">フックの定義と実行</h3>
<h4 id="_9">フック関数の型</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="kd">type</span><span class="w"> </span><span class="nx">PointHook</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="nx">Point</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>フック関数は、このシグネチャに従う必要があります。</li>
</ul>
<h4 id="_10">フックの登録</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">1</a></span>
<span class="normal"><a href="#__codelineno-6-2">2</a></span>
<span class="normal"><a href="#__codelineno-6-3">3</a></span>
<span class="normal"><a href="#__codelineno-6-4">4</a></span>
<span class="normal"><a href="#__codelineno-6-5">5</a></span>
<span class="normal"><a href="#__codelineno-6-6">6</a></span>
<span class="normal"><a href="#__codelineno-6-7">7</a></span>
<span class="normal"><a href="#__codelineno-6-8">8</a></span>
<span class="normal"><a href="#__codelineno-6-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">AddPointHook</span><span class="p">(</span><span class="nx">hookPoint</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">HookPoint</span><span class="p">,</span><span class="w"> </span><span class="nx">pointHook</span><span class="w"> </span><span class="nx">PointHook</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="nx">hookPoint</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">AfterSelectHook</span><span class="p">:</span>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="w">        </span><span class="nx">pointAfterSelectMu</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="w">        </span><span class="nx">pointAfterSelectHooks</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">pointAfterSelectHooks</span><span class="p">,</span><span class="w"> </span><span class="nx">pointHook</span><span class="p">)</span>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="w">        </span><span class="nx">pointAfterSelectMu</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>
<a id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="w">    </span><span class="c1">// その他のフックポイント</span>
<a id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>AddPointHook</code>関数を使用して、特定のフックポイントにフック関数を登録できます。</li>
<li>フックはスライスに追加され、該当するデータベース操作時に実行されます。</li>
</ul>
<h4 id="_11">フックの実行</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-7-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-7-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-7-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-7-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-7-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-7-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-7-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-7-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-7-10">10</a></span>
<span class="normal"><a href="#__codelineno-7-11">11</a></span>
<span class="normal"><a href="#__codelineno-7-12">12</a></span>
<span class="normal"><a href="#__codelineno-7-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">Point</span><span class="p">)</span><span class="w"> </span><span class="nx">doAfterSelectHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">HooksAreSkipped</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">hook</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">pointAfterSelectHooks</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">hook</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-8" name="__codelineno-7-8"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-7-9" name="__codelineno-7-9"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-7-10" name="__codelineno-7-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-7-11" name="__codelineno-7-11"></a>
<a id="__codelineno-7-12" name="__codelineno-7-12"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-7-13" name="__codelineno-7-13"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>各フックポイントに対応する<code>doXxxHooks</code>メソッドがあります。</li>
<li>フックが登録されている場合、それらを順番に実行します。</li>
<li>フック内でエラーが発生した場合、そのエラーを返します。</li>
</ul>
<h3 id="_12">利用例</h3>
<h4 id="_13">フック関数の実装と登録</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-8-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-8-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-8-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-8-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-8-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-8-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-8-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-8-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-8-10">10</a></span>
<span class="normal"><a href="#__codelineno-8-11">11</a></span>
<span class="normal"><a href="#__codelineno-8-12">12</a></span>
<span class="normal"><a href="#__codelineno-8-13">13</a></span>
<span class="normal"><a href="#__codelineno-8-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="c1">// ポイントが挿入される前にポイント数を検証するフック</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="kd">func</span><span class="w"> </span><span class="nx">validatePointBeforeInsert</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="w"> </span><span class="o">*</span><span class="nx">Point</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">CurrentPoint</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;ポイント数は0以上でなければなりません&quot;</span><span class="p">)</span>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="p">}</span>
<a id="__codelineno-8-8" name="__codelineno-8-8"></a>
<a id="__codelineno-8-9" name="__codelineno-8-9"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-10" name="__codelineno-8-10"></a><span class="w">    </span><span class="c1">// フックを登録</span>
<a id="__codelineno-8-11" name="__codelineno-8-11"></a><span class="w">    </span><span class="nx">AddPointHook</span><span class="p">(</span><span class="nx">boil</span><span class="p">.</span><span class="nx">BeforeInsertHook</span><span class="p">,</span><span class="w"> </span><span class="nx">validatePointBeforeInsert</span><span class="p">)</span>
<a id="__codelineno-8-12" name="__codelineno-8-12"></a>
<a id="__codelineno-8-13" name="__codelineno-8-13"></a><span class="w">    </span><span class="c1">// 以降、ポイントの挿入時にこのフックが適用されます</span>
<a id="__codelineno-8-14" name="__codelineno-8-14"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>この例では、ポイントが負の値でないことを保証するために、挿入前に検証を行います。</p>
<hr />
<h2 id="_14">データベース操作のメソッド</h2>
<p><code>Point</code>モデルには、データベースとのやり取りを行うためのメソッドが自動生成されています。ここでは、一般的な操作のメソッドについて解説します。</p>
<h3 id="insert"><code>Insert</code>メソッド</h3>
<h4 id="_15">概要</h4>
<p><code>Insert</code>メソッドは、新しい<code>Point</code>レコードをデータベースに挿入します。</p>
<h4 id="_16">関数シグネチャ</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">Point</span><span class="p">)</span><span class="w"> </span><span class="nx">Insert</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">columns</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">Columns</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>ctx</code>: コンテキスト。</li>
<li><code>exec</code>: データベース操作を行うエグゼキュータ。</li>
<li><code>columns</code>: 挿入するカラムを指定するオプション。</li>
</ul>
<h4 id="_17">処理の流れ</h4>
<ol>
<li><strong><code>BeforeInsert</code>フックの実行</strong>:</li>
<li>
<p>登録されている<code>BeforeInsert</code>フックを実行します。</p>
</li>
<li>
<p><strong>タイムスタンプの設定</strong>:</p>
</li>
<li>
<p><code>CreatedAt</code>と<code>UpdatedAt</code>フィールドに現在の時刻を設定します。</p>
</li>
<li>
<p><strong>挿入クエリの作成</strong>:</p>
</li>
<li>
<p>挿入するカラムと値を決定し、クエリを構築します。</p>
</li>
<li>
<p><strong>クエリの実行</strong>:</p>
</li>
<li>
<p>構築したクエリを実行し、レコードを挿入します。</p>
</li>
<li>
<p><strong><code>AfterInsert</code>フックの実行</strong>:</p>
</li>
<li>登録されている<code>AfterInsert</code>フックを実行します。</li>
</ol>
<h4 id="_18">利用例</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-10-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-10-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-10-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-10-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-10-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-10-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-10-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-10-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-10-10">10</a></span>
<span class="normal"><a href="#__codelineno-10-11">11</a></span>
<span class="normal"><a href="#__codelineno-10-12">12</a></span>
<span class="normal"><a href="#__codelineno-10-13">13</a></span>
<span class="normal"><a href="#__codelineno-10-14">14</a></span>
<span class="normal"><a href="#__codelineno-10-15">15</a></span>
<span class="normal"><a href="#__codelineno-10-16">16</a></span>
<span class="normal"><a href="#__codelineno-10-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="p">}</span>
<a id="__codelineno-10-6" name="__codelineno-10-6"></a>
<a id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="nx">point</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Point</span><span class="p">{</span>
<a id="__codelineno-10-8" name="__codelineno-10-8"></a><span class="w">    </span><span class="nx">UserID</span><span class="p">:</span><span class="w">       </span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-10-9" name="__codelineno-10-9"></a><span class="w">    </span><span class="nx">CurrentPoint</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-10-10" name="__codelineno-10-10"></a><span class="p">}</span>
<a id="__codelineno-10-11" name="__codelineno-10-11"></a>
<a id="__codelineno-10-12" name="__codelineno-10-12"></a><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">point</span><span class="p">.</span><span class="nx">Insert</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">Infer</span><span class="p">())</span>
<a id="__codelineno-10-13" name="__codelineno-10-13"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-14" name="__codelineno-10-14"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-10-15" name="__codelineno-10-15"></a><span class="p">}</span>
<a id="__codelineno-10-16" name="__codelineno-10-16"></a>
<a id="__codelineno-10-17" name="__codelineno-10-17"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;ポイントが挿入されました。&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>この例では、新しいポイントをデータベースに挿入しています。</p>
<h3 id="update"><code>Update</code>メソッド</h3>
<h4 id="_19">概要</h4>
<p><code>Update</code>メソッドは、既存の<code>Point</code>レコードを更新します。</p>
<h4 id="_20">関数シグネチャ</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">Point</span><span class="p">)</span><span class="w"> </span><span class="nx">Update</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">columns</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">Columns</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">int64</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>戻り値:</li>
<li><code>int64</code>: 更新された行数。</li>
<li><code>error</code>: エラー情報。</li>
</ul>
<h4 id="_21">利用例</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span>
<span class="normal"><a href="#__codelineno-12-2">2</a></span>
<span class="normal"><a href="#__codelineno-12-3">3</a></span>
<span class="normal"><a href="#__codelineno-12-4">4</a></span>
<span class="normal"><a href="#__codelineno-12-5">5</a></span>
<span class="normal"><a href="#__codelineno-12-6">6</a></span>
<span class="normal"><a href="#__codelineno-12-7">7</a></span>
<span class="normal"><a href="#__codelineno-12-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="nx">point</span><span class="p">.</span><span class="nx">CurrentPoint</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">50</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="nx">rowsAffected</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">point</span><span class="p">.</span><span class="nx">Update</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">Whitelist</span><span class="p">(</span><span class="s">&quot;current_point&quot;</span><span class="p">))</span>
<a id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-12-6" name="__codelineno-12-6"></a><span class="p">}</span>
<a id="__codelineno-12-7" name="__codelineno-12-7"></a>
<a id="__codelineno-12-8" name="__codelineno-12-8"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%d 行のポイントが更新されました。\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">rowsAffected</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>この例では、<code>current_point</code>カラムを更新しています。</p>
<h3 id="delete"><code>Delete</code>メソッド</h3>
<h4 id="_22">概要</h4>
<p><code>Delete</code>メソッドは、<code>Point</code>レコードを削除します。</p>
<h4 id="_23">利用例</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1">1</a></span>
<span class="normal"><a href="#__codelineno-13-2">2</a></span>
<span class="normal"><a href="#__codelineno-13-3">3</a></span>
<span class="normal"><a href="#__codelineno-13-4">4</a></span>
<span class="normal"><a href="#__codelineno-13-5">5</a></span>
<span class="normal"><a href="#__codelineno-13-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="nx">rowsAffected</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">point</span><span class="p">.</span><span class="nx">Delete</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="p">}</span>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a>
<a id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%d 行のポイントが削除されました。\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">rowsAffected</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="_24">クエリの作成と実行</h2>
<h3 id="_25">ポイントの取得</h3>
<h4 id="_26">単一のポイントを取得</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-14-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-14-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-14-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-14-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-14-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-14-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-14-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-14-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-14-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="nx">point</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">FindPoint</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="c1">// UserIDが1のポイントを取得</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Is</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">ErrNoRows</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;ポイントが存在しません。&quot;</span><span class="p">)</span>
<a id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-14-8" name="__codelineno-14-8"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-9" name="__codelineno-14-9"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;ユーザーID: %d のポイント: %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">point</span><span class="p">.</span><span class="nx">UserID</span><span class="p">,</span><span class="w"> </span><span class="nx">point</span><span class="p">.</span><span class="nx">CurrentPoint</span><span class="p">)</span>
<a id="__codelineno-14-10" name="__codelineno-14-10"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="_27">ポイントのリストを取得</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-15-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-15-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-15-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-15-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-15-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-15-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-15-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-15-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-15-10">10</a></span>
<span class="normal"><a href="#__codelineno-15-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="nx">points</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Points</span><span class="p">(</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="w">    </span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;current_point &gt; ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">),</span>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="w">    </span><span class="nx">qm</span><span class="p">.</span><span class="nx">OrderBy</span><span class="p">(</span><span class="s">&quot;current_point DESC&quot;</span><span class="p">),</span>
<a id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="p">).</span><span class="nx">All</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-6" name="__codelineno-15-6"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="p">}</span>
<a id="__codelineno-15-8" name="__codelineno-15-8"></a>
<a id="__codelineno-15-9" name="__codelineno-15-9"></a><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">points</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-10" name="__codelineno-15-10"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;ユーザーID: %d のポイント: %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">UserID</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">CurrentPoint</span><span class="p">)</span>
<a id="__codelineno-15-11" name="__codelineno-15-11"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="_28">リレーションのロード</h2>
<p><code>Point</code>モデルと<code>User</code>モデルは関連付けられています。<code>Point</code>から関連する<code>User</code>をロードすることが可能です。</p>
<h3 id="_29">リレーションのロード方法</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1">1</a></span>
<span class="normal"><a href="#__codelineno-16-2">2</a></span>
<span class="normal"><a href="#__codelineno-16-3">3</a></span>
<span class="normal"><a href="#__codelineno-16-4">4</a></span>
<span class="normal"><a href="#__codelineno-16-5">5</a></span>
<span class="normal"><a href="#__codelineno-16-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">point</span><span class="p">.</span><span class="nx">L</span><span class="p">.</span><span class="nx">LoadUser</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">point</span><span class="p">)</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="p">}</span>
<a id="__codelineno-16-5" name="__codelineno-16-5"></a>
<a id="__codelineno-16-6" name="__codelineno-16-6"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;ポイント所有者の名前: %s\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">point</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">User</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><strong><code>LoadUser</code>メソッド</strong>: <code>Point</code>オブジェクトに関連する<code>User</code>オブジェクトをロードします。</li>
<li>ロード後、<code>point.R.User</code>を通じてユーザー情報にアクセスできます。</li>
</ul>
<hr />
<p>以下では、提供されたGo言語のコードについて、すべてのコード部分を詳細に解説します。また、開発者向けに利用例も詳細なコード例として示します。</p>
<hr />
<h3 id="point_2">Point構造体の単一レコード取得メソッド</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-17-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-17-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-17-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-17-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-17-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-17-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-17-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-17-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-17-10">10</a></span>
<span class="normal"><a href="#__codelineno-17-11">11</a></span>
<span class="normal"><a href="#__codelineno-17-12">12</a></span>
<span class="normal"><a href="#__codelineno-17-13">13</a></span>
<span class="normal"><a href="#__codelineno-17-14">14</a></span>
<span class="normal"><a href="#__codelineno-17-15">15</a></span>
<span class="normal"><a href="#__codelineno-17-16">16</a></span>
<span class="normal"><a href="#__codelineno-17-17">17</a></span>
<span class="normal"><a href="#__codelineno-17-18">18</a></span>
<span class="normal"><a href="#__codelineno-17-19">19</a></span>
<span class="normal"><a href="#__codelineno-17-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="c1">// One returns a single point record from the query.</span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">q</span><span class="w"> </span><span class="nx">pointQuery</span><span class="p">)</span><span class="w"> </span><span class="nx">One</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">Point</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="w">    </span><span class="nx">o</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Point</span><span class="p">{}</span>
<a id="__codelineno-17-4" name="__codelineno-17-4"></a>
<a id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="w">    </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetLimit</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-17-6" name="__codelineno-17-6"></a>
<a id="__codelineno-17-7" name="__codelineno-17-7"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">q</span><span class="p">.</span><span class="nx">Bind</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">)</span>
<a id="__codelineno-17-8" name="__codelineno-17-8"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-9" name="__codelineno-17-9"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Is</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">ErrNoRows</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-10" name="__codelineno-17-10"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">ErrNoRows</span>
<a id="__codelineno-17-11" name="__codelineno-17-11"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-17-12" name="__codelineno-17-12"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: failed to execute a one query for points&quot;</span><span class="p">)</span>
<a id="__codelineno-17-13" name="__codelineno-17-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-17-14" name="__codelineno-17-14"></a>
<a id="__codelineno-17-15" name="__codelineno-17-15"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">doAfterSelectHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-16" name="__codelineno-17-16"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">o</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-17-17" name="__codelineno-17-17"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-17-18" name="__codelineno-17-18"></a>
<a id="__codelineno-17-19" name="__codelineno-17-19"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">o</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-17-20" name="__codelineno-17-20"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="_30">解説</h4>
<ul>
<li>
<p><strong>関数の概要</strong>: クエリから単一の<code>Point</code>レコードを取得します。</p>
</li>
<li>
<p><strong>引数</strong>:</p>
</li>
<li><code>ctx context.Context</code>: コンテキスト情報。</li>
<li>
<p><code>exec boil.ContextExecutor</code>: データベース操作を実行するためのエグゼキュータ。</p>
</li>
<li>
<p><strong>処理の流れ</strong>:</p>
</li>
<li>新しい<code>Point</code>構造体のインスタンス<code>o</code>を作成。
     <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="nx">o</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Point</span><span class="p">{}</span>
</code></pre></div></td></tr></table></div></li>
<li>クエリのリミットを1に設定。これにより、クエリが最大1件のレコードを返すようになります。
     <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="nx">queries</span><span class="p">.</span><span class="nx">SetLimit</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div></li>
<li>クエリ結果を<code>o</code>にバインド（データをマッピング）します。
     <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">q</span><span class="p">.</span><span class="nx">Bind</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">)</span>
</code></pre></div></td></tr></table></div></li>
<li>エラー処理:<ul>
<li>レコードが見つからない場合（<code>sql.ErrNoRows</code>）、<code>nil</code>と<code>sql.ErrNoRows</code>を返す。</li>
<li>その他のエラーが発生した場合、エラーメッセージをラップして返す。</li>
</ul>
</li>
<li><code>o</code>にアフターセレクトフック処理を実行。これは、データ取得後の追加処理がある場合に使用します。
     <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1">1</a></span>
<span class="normal"><a href="#__codelineno-21-2">2</a></span>
<span class="normal"><a href="#__codelineno-21-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">doAfterSelectHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">o</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div></li>
<li>最終的に結果の<code>Point</code>オブジェクト<code>o</code>を返す。</li>
</ul>
<h4 id="_31">利用例</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-22-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-22-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-22-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-22-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-22-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-22-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-22-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-22-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-22-10">10</a></span>
<span class="normal"><a href="#__codelineno-22-11">11</a></span>
<span class="normal"><a href="#__codelineno-22-12">12</a></span>
<span class="normal"><a href="#__codelineno-22-13">13</a></span>
<span class="normal"><a href="#__codelineno-22-14">14</a></span>
<span class="normal"><a href="#__codelineno-22-15">15</a></span>
<span class="normal"><a href="#__codelineno-22-16">16</a></span>
<span class="normal"><a href="#__codelineno-22-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-22-3" name="__codelineno-22-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-4" name="__codelineno-22-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-22-5" name="__codelineno-22-5"></a><span class="p">}</span>
<a id="__codelineno-22-6" name="__codelineno-22-6"></a>
<a id="__codelineno-22-7" name="__codelineno-22-7"></a><span class="nx">pointQuery</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Points</span><span class="p">(</span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;id = ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-22-8" name="__codelineno-22-8"></a><span class="nx">point</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">pointQuery</span><span class="p">.</span><span class="nx">One</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-22-9" name="__codelineno-22-9"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-10" name="__codelineno-22-10"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Is</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">ErrNoRows</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-11" name="__codelineno-22-11"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;レコードが見つかりませんでした&quot;</span><span class="p">)</span>
<a id="__codelineno-22-12" name="__codelineno-22-12"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-13" name="__codelineno-22-13"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">&quot;エラー: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-22-14" name="__codelineno-22-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-22-15" name="__codelineno-22-15"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-16" name="__codelineno-22-16"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;取得したポイント: %+v\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">point</span><span class="p">)</span>
<a id="__codelineno-22-17" name="__codelineno-22-17"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<hr />
<h3 id="point_3">Point構造体の全レコード取得メソッド</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-23-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-23-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-23-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-23-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-23-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-23-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-23-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-23-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-23-10">10</a></span>
<span class="normal"><a href="#__codelineno-23-11">11</a></span>
<span class="normal"><a href="#__codelineno-23-12">12</a></span>
<span class="normal"><a href="#__codelineno-23-13">13</a></span>
<span class="normal"><a href="#__codelineno-23-14">14</a></span>
<span class="normal"><a href="#__codelineno-23-15">15</a></span>
<span class="normal"><a href="#__codelineno-23-16">16</a></span>
<span class="normal"><a href="#__codelineno-23-17">17</a></span>
<span class="normal"><a href="#__codelineno-23-18">18</a></span>
<span class="normal"><a href="#__codelineno-23-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="c1">// All returns all Point records from the query.</span>
<a id="__codelineno-23-2" name="__codelineno-23-2"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">q</span><span class="w"> </span><span class="nx">pointQuery</span><span class="p">)</span><span class="w"> </span><span class="nx">All</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">PointSlice</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">o</span><span class="w"> </span><span class="p">[]</span><span class="o">*</span><span class="nx">Point</span>
<a id="__codelineno-23-4" name="__codelineno-23-4"></a>
<a id="__codelineno-23-5" name="__codelineno-23-5"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">q</span><span class="p">.</span><span class="nx">Bind</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">o</span><span class="p">)</span>
<a id="__codelineno-23-6" name="__codelineno-23-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-7" name="__codelineno-23-7"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: failed to assign all query results to Point slice&quot;</span><span class="p">)</span>
<a id="__codelineno-23-8" name="__codelineno-23-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-23-9" name="__codelineno-23-9"></a>
<a id="__codelineno-23-10" name="__codelineno-23-10"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">pointAfterSelectHooks</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-11" name="__codelineno-23-11"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">o</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-12" name="__codelineno-23-12"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">obj</span><span class="p">.</span><span class="nx">doAfterSelectHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-13" name="__codelineno-23-13"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nx">o</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-23-14" name="__codelineno-23-14"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-23-15" name="__codelineno-23-15"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-23-16" name="__codelineno-23-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-23-17" name="__codelineno-23-17"></a>
<a id="__codelineno-23-18" name="__codelineno-23-18"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">o</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-23-19" name="__codelineno-23-19"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="_32">解説</h4>
<ul>
<li>
<p><strong>関数の概要</strong>: クエリからすべての<code>Point</code>レコードを取得します。</p>
</li>
<li>
<p><strong>引数</strong>:</p>
</li>
<li><code>ctx context.Context</code>: コンテキスト情報。</li>
<li>
<p><code>exec boil.ContextExecutor</code>: データベース操作を実行するためのエグゼキュータ。</p>
</li>
<li>
<p><strong>処理の流れ</strong>:</p>
</li>
<li><code>Point</code>構造体のスライス<code>o</code>を定義。
     <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">o</span><span class="w"> </span><span class="p">[]</span><span class="o">*</span><span class="nx">Point</span>
</code></pre></div></td></tr></table></div></li>
<li>クエリ結果を<code>o</code>にバインド（データをマッピング）します。
     <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">q</span><span class="p">.</span><span class="nx">Bind</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">o</span><span class="p">)</span>
</code></pre></div></td></tr></table></div></li>
<li>エラー処理:<ul>
<li>エラーが発生した場合、エラーメッセージをラップして返す。</li>
</ul>
</li>
<li>アフターセレクトフックが定義されている場合、各<code>Point</code>オブジェクトに対してフック処理を実行。</li>
<li>最終的に<code>Point</code>オブジェクトのスライス<code>o</code>を返す。</li>
</ul>
<h4 id="_33">利用例</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-26-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-26-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-26-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-26-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-26-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-26-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-26-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-26-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-26-10">10</a></span>
<span class="normal"><a href="#__codelineno-26-11">11</a></span>
<span class="normal"><a href="#__codelineno-26-12">12</a></span>
<span class="normal"><a href="#__codelineno-26-13">13</a></span>
<span class="normal"><a href="#__codelineno-26-14">14</a></span>
<span class="normal"><a href="#__codelineno-26-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-26-2" name="__codelineno-26-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-26-3" name="__codelineno-26-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-26-4" name="__codelineno-26-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-26-5" name="__codelineno-26-5"></a><span class="p">}</span>
<a id="__codelineno-26-6" name="__codelineno-26-6"></a>
<a id="__codelineno-26-7" name="__codelineno-26-7"></a><span class="nx">pointQuery</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Points</span><span class="p">()</span>
<a id="__codelineno-26-8" name="__codelineno-26-8"></a><span class="nx">points</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">pointQuery</span><span class="p">.</span><span class="nx">All</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-26-9" name="__codelineno-26-9"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-26-10" name="__codelineno-26-10"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">&quot;エラー: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-26-11" name="__codelineno-26-11"></a><span class="p">}</span>
<a id="__codelineno-26-12" name="__codelineno-26-12"></a>
<a id="__codelineno-26-13" name="__codelineno-26-13"></a><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">point</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">points</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-26-14" name="__codelineno-26-14"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;ポイント: %+v\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">point</span><span class="p">)</span>
<a id="__codelineno-26-15" name="__codelineno-26-15"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<hr />
<h3 id="point_4">Pointレコードのカウント取得メソッド</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-27-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-27-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-27-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-27-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-27-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-27-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-27-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-27-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-27-10">10</a></span>
<span class="normal"><a href="#__codelineno-27-11">11</a></span>
<span class="normal"><a href="#__codelineno-27-12">12</a></span>
<span class="normal"><a href="#__codelineno-27-13">13</a></span>
<span class="normal"><a href="#__codelineno-27-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="c1">// Count returns the count of all Point records in the query.</span>
<a id="__codelineno-27-2" name="__codelineno-27-2"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">q</span><span class="w"> </span><span class="nx">pointQuery</span><span class="p">)</span><span class="w"> </span><span class="nx">Count</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">int64</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-27-3" name="__codelineno-27-3"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="kt">int64</span>
<a id="__codelineno-27-4" name="__codelineno-27-4"></a>
<a id="__codelineno-27-5" name="__codelineno-27-5"></a><span class="w">    </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetSelect</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<a id="__codelineno-27-6" name="__codelineno-27-6"></a><span class="w">    </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetCount</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">)</span>
<a id="__codelineno-27-7" name="__codelineno-27-7"></a>
<a id="__codelineno-27-8" name="__codelineno-27-8"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">.</span><span class="nx">QueryRowContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">).</span><span class="nx">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">count</span><span class="p">)</span>
<a id="__codelineno-27-9" name="__codelineno-27-9"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-27-10" name="__codelineno-27-10"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: failed to count points rows&quot;</span><span class="p">)</span>
<a id="__codelineno-27-11" name="__codelineno-27-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-27-12" name="__codelineno-27-12"></a>
<a id="__codelineno-27-13" name="__codelineno-27-13"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">count</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-27-14" name="__codelineno-27-14"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="_34">解説</h4>
<ul>
<li>
<p><strong>関数の概要</strong>: クエリにマッチする<code>Point</code>レコードの総数を取得します。</p>
</li>
<li>
<p><strong>引数</strong>:</p>
</li>
<li><code>ctx context.Context</code>: コンテキスト情報。</li>
<li>
<p><code>exec boil.ContextExecutor</code>: データベース操作を実行するためのエグゼキュータ。</p>
</li>
<li>
<p><strong>処理の流れ</strong>:</p>
</li>
<li>カウント結果を格納する変数<code>count</code>を宣言。
     <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-28-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="kt">int64</span>
</code></pre></div></td></tr></table></div></li>
<li>クエリのSELECT句をクリアし、COUNT句を設定。
     <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-29-1">1</a></span>
<span class="normal"><a href="#__codelineno-29-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="nx">queries</span><span class="p">.</span><span class="nx">SetSelect</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<a id="__codelineno-29-2" name="__codelineno-29-2"></a><span class="nx">queries</span><span class="p">.</span><span class="nx">SetCount</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">)</span>
</code></pre></div></td></tr></table></div></li>
<li>クエリを実行し、結果を<code>count</code>にスキャン。
     <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-30-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">.</span><span class="nx">QueryRowContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">).</span><span class="nx">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">count</span><span class="p">)</span>
</code></pre></div></td></tr></table></div></li>
<li>エラー処理:<ul>
<li>エラーが発生した場合、エラーメッセージをラップして返す。</li>
</ul>
</li>
<li>カウント結果<code>count</code>を返す。</li>
</ul>
<h4 id="_35">利用例</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-31-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-31-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-31-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-31-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-31-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-31-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-31-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-31-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-31-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-31-10">10</a></span>
<span class="normal"><a href="#__codelineno-31-11">11</a></span>
<span class="normal"><a href="#__codelineno-31-12">12</a></span>
<span class="normal"><a href="#__codelineno-31-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-31-2" name="__codelineno-31-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-31-3" name="__codelineno-31-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-31-4" name="__codelineno-31-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-31-5" name="__codelineno-31-5"></a><span class="p">}</span>
<a id="__codelineno-31-6" name="__codelineno-31-6"></a>
<a id="__codelineno-31-7" name="__codelineno-31-7"></a><span class="nx">pointQuery</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Points</span><span class="p">()</span>
<a id="__codelineno-31-8" name="__codelineno-31-8"></a><span class="nx">count</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">pointQuery</span><span class="p">.</span><span class="nx">Count</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-31-9" name="__codelineno-31-9"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-31-10" name="__codelineno-31-10"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">&quot;エラー: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-31-11" name="__codelineno-31-11"></a><span class="p">}</span>
<a id="__codelineno-31-12" name="__codelineno-31-12"></a>
<a id="__codelineno-31-13" name="__codelineno-31-13"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;ポイントの総数: %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">count</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<h3 id="point_5">Pointレコードの存在確認メソッド</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-32-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-32-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-32-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-32-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-32-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-32-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-32-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-32-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-32-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-32-10">10</a></span>
<span class="normal"><a href="#__codelineno-32-11">11</a></span>
<span class="normal"><a href="#__codelineno-32-12">12</a></span>
<span class="normal"><a href="#__codelineno-32-13">13</a></span>
<span class="normal"><a href="#__codelineno-32-14">14</a></span>
<span class="normal"><a href="#__codelineno-32-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="c1">// Exists checks if the row exists in the table.</span>
<a id="__codelineno-32-2" name="__codelineno-32-2"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">q</span><span class="w"> </span><span class="nx">pointQuery</span><span class="p">)</span><span class="w"> </span><span class="nx">Exists</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-3" name="__codelineno-32-3"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="kt">int64</span>
<a id="__codelineno-32-4" name="__codelineno-32-4"></a>
<a id="__codelineno-32-5" name="__codelineno-32-5"></a><span class="w">    </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetSelect</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<a id="__codelineno-32-6" name="__codelineno-32-6"></a><span class="w">    </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetCount</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">)</span>
<a id="__codelineno-32-7" name="__codelineno-32-7"></a><span class="w">    </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetLimit</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-32-8" name="__codelineno-32-8"></a>
<a id="__codelineno-32-9" name="__codelineno-32-9"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">.</span><span class="nx">QueryRowContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">).</span><span class="nx">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">count</span><span class="p">)</span>
<a id="__codelineno-32-10" name="__codelineno-32-10"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-11" name="__codelineno-32-11"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: failed to check if points exists&quot;</span><span class="p">)</span>
<a id="__codelineno-32-12" name="__codelineno-32-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-32-13" name="__codelineno-32-13"></a>
<a id="__codelineno-32-14" name="__codelineno-32-14"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-32-15" name="__codelineno-32-15"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="_36">解説</h4>
<ul>
<li>
<p><strong>関数の概要</strong>: クエリにマッチする<code>Point</code>レコードが存在するかをチェックします。</p>
</li>
<li>
<p><strong>引数</strong>:</p>
</li>
<li><code>ctx context.Context</code>: コンテキスト情報。</li>
<li>
<p><code>exec boil.ContextExecutor</code>: データベース操作を実行するためのエグゼキュータ。</p>
</li>
<li>
<p><strong>処理の流れ</strong>:</p>
</li>
<li>カウント結果を格納する変数<code>count</code>を宣言。
     <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-33-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="kt">int64</span>
</code></pre></div></td></tr></table></div></li>
<li>クエリのSELECT句をクリアし、COUNT句を設定し、リミットを1に設定。
     <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-34-1">1</a></span>
<span class="normal"><a href="#__codelineno-34-2">2</a></span>
<span class="normal"><a href="#__codelineno-34-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1"></a><span class="nx">queries</span><span class="p">.</span><span class="nx">SetSelect</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<a id="__codelineno-34-2" name="__codelineno-34-2"></a><span class="nx">queries</span><span class="p">.</span><span class="nx">SetCount</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">)</span>
<a id="__codelineno-34-3" name="__codelineno-34-3"></a><span class="nx">queries</span><span class="p">.</span><span class="nx">SetLimit</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div></li>
<li>クエリを実行し、結果を<code>count</code>にスキャン。</li>
<li>エラー処理:<ul>
<li>エラーが発生した場合、<code>false</code>とエラーメッセージを返す。</li>
</ul>
</li>
<li><code>count</code>が0より大きいかをチェックし、存在する場合は<code>true</code>を返す。</li>
</ul>
<h4 id="_37">利用例</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-35-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-35-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-35-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-35-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-35-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-35-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-35-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-35-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-35-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-35-10">10</a></span>
<span class="normal"><a href="#__codelineno-35-11">11</a></span>
<span class="normal"><a href="#__codelineno-35-12">12</a></span>
<span class="normal"><a href="#__codelineno-35-13">13</a></span>
<span class="normal"><a href="#__codelineno-35-14">14</a></span>
<span class="normal"><a href="#__codelineno-35-15">15</a></span>
<span class="normal"><a href="#__codelineno-35-16">16</a></span>
<span class="normal"><a href="#__codelineno-35-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-35-2" name="__codelineno-35-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-35-3" name="__codelineno-35-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-4" name="__codelineno-35-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-35-5" name="__codelineno-35-5"></a><span class="p">}</span>
<a id="__codelineno-35-6" name="__codelineno-35-6"></a>
<a id="__codelineno-35-7" name="__codelineno-35-7"></a><span class="nx">pointQuery</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Points</span><span class="p">(</span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;id = ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-35-8" name="__codelineno-35-8"></a><span class="nx">exists</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">pointQuery</span><span class="p">.</span><span class="nx">Exists</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-35-9" name="__codelineno-35-9"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-10" name="__codelineno-35-10"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">&quot;エラー: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-35-11" name="__codelineno-35-11"></a><span class="p">}</span>
<a id="__codelineno-35-12" name="__codelineno-35-12"></a>
<a id="__codelineno-35-13" name="__codelineno-35-13"></a><span class="k">if</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-14" name="__codelineno-35-14"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;ポイントレコードは存在します&quot;</span><span class="p">)</span>
<a id="__codelineno-35-15" name="__codelineno-35-15"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-16" name="__codelineno-35-16"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;ポイントレコードは存在しません&quot;</span><span class="p">)</span>
<a id="__codelineno-35-17" name="__codelineno-35-17"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<hr />
<h3 id="user">外部キーによるUserの取得</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-36-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-36-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-36-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-36-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-36-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-36-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-36-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-36-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-36-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-36-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1"></a><span class="c1">// User pointed to by the foreign key.</span>
<a id="__codelineno-36-2" name="__codelineno-36-2"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">Point</span><span class="p">)</span><span class="w"> </span><span class="nx">User</span><span class="p">(</span><span class="nx">mods</span><span class="w"> </span><span class="o">...</span><span class="nx">qm</span><span class="p">.</span><span class="nx">QueryMod</span><span class="p">)</span><span class="w"> </span><span class="nx">userQuery</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-3" name="__codelineno-36-3"></a><span class="w">    </span><span class="nx">queryMods</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="nx">qm</span><span class="p">.</span><span class="nx">QueryMod</span><span class="p">{</span>
<a id="__codelineno-36-4" name="__codelineno-36-4"></a><span class="w">        </span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;`user_id` = ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">UserID</span><span class="p">),</span>
<a id="__codelineno-36-5" name="__codelineno-36-5"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-36-6" name="__codelineno-36-6"></a>
<a id="__codelineno-36-7" name="__codelineno-36-7"></a><span class="w">    </span><span class="nx">queryMods</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">queryMods</span><span class="p">,</span><span class="w"> </span><span class="nx">mods</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-36-8" name="__codelineno-36-8"></a>
<a id="__codelineno-36-9" name="__codelineno-36-9"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">Users</span><span class="p">(</span><span class="nx">queryMods</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-36-10" name="__codelineno-36-10"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="_38">解説</h4>
<ul>
<li>
<p><strong>関数の概要</strong>: <code>Point</code>オブジェクトに関連する<code>User</code>を取得するためのクエリを生成します。</p>
</li>
<li>
<p><strong>引数</strong>:</p>
</li>
<li>
<p><code>mods ...qm.QueryMod</code>: クエリ修飾子。追加のクエリ条件を付加するために使用。</p>
</li>
<li>
<p><strong>処理の流れ</strong>:</p>
</li>
<li><code>Point</code>の<code>UserID</code>を条件にしたクエリ修飾子を作成。
     <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-37-1">1</a></span>
<span class="normal"><a href="#__codelineno-37-2">2</a></span>
<span class="normal"><a href="#__codelineno-37-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1"></a><span class="nx">queryMods</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="p">[]</span><span class="nx">qm</span><span class="p">.</span><span class="nx">QueryMod</span><span class="p">{</span>
<a id="__codelineno-37-2" name="__codelineno-37-2"></a><span class="w">    </span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;`user_id` = ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">UserID</span><span class="p">),</span>
<a id="__codelineno-37-3" name="__codelineno-37-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div></li>
<li>追加のクエリ修飾子が渡された場合、それらを<code>queryMods</code>に追加。
     <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-38-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1"></a><span class="nx">queryMods</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">queryMods</span><span class="p">,</span><span class="w"> </span><span class="nx">mods</span><span class="o">...</span><span class="p">)</span>
</code></pre></div></td></tr></table></div></li>
<li><code>Users</code>クエリを生成して返す。</li>
</ul>
<h4 id="_39">利用例</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-39-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-39-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-39-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-39-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-39-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-39-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-39-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-39-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-39-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-39-10">10</a></span>
<span class="normal"><a href="#__codelineno-39-11">11</a></span>
<span class="normal"><a href="#__codelineno-39-12">12</a></span>
<span class="normal"><a href="#__codelineno-39-13">13</a></span>
<span class="normal"><a href="#__codelineno-39-14">14</a></span>
<span class="normal"><a href="#__codelineno-39-15">15</a></span>
<span class="normal"><a href="#__codelineno-39-16">16</a></span>
<span class="normal"><a href="#__codelineno-39-17">17</a></span>
<span class="normal"><a href="#__codelineno-39-18">18</a></span>
<span class="normal"><a href="#__codelineno-39-19">19</a></span>
<span class="normal"><a href="#__codelineno-39-20">20</a></span>
<span class="normal"><a href="#__codelineno-39-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-39-2" name="__codelineno-39-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-39-3" name="__codelineno-39-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-4" name="__codelineno-39-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-39-5" name="__codelineno-39-5"></a><span class="p">}</span>
<a id="__codelineno-39-6" name="__codelineno-39-6"></a>
<a id="__codelineno-39-7" name="__codelineno-39-7"></a><span class="c1">// ポイントを取得</span>
<a id="__codelineno-39-8" name="__codelineno-39-8"></a><span class="nx">pointQuery</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Points</span><span class="p">(</span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;id = ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-39-9" name="__codelineno-39-9"></a><span class="nx">point</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">pointQuery</span><span class="p">.</span><span class="nx">One</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-39-10" name="__codelineno-39-10"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-11" name="__codelineno-39-11"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-39-12" name="__codelineno-39-12"></a><span class="p">}</span>
<a id="__codelineno-39-13" name="__codelineno-39-13"></a>
<a id="__codelineno-39-14" name="__codelineno-39-14"></a><span class="c1">// 関連するユーザーを取得</span>
<a id="__codelineno-39-15" name="__codelineno-39-15"></a><span class="nx">userQuery</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">point</span><span class="p">.</span><span class="nx">User</span><span class="p">()</span>
<a id="__codelineno-39-16" name="__codelineno-39-16"></a><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">userQuery</span><span class="p">.</span><span class="nx">One</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-39-17" name="__codelineno-39-17"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-18" name="__codelineno-39-18"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-39-19" name="__codelineno-39-19"></a><span class="p">}</span>
<a id="__codelineno-39-20" name="__codelineno-39-20"></a>
<a id="__codelineno-39-21" name="__codelineno-39-21"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;ポイントの所有者ユーザー: %+v\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<h3 id="n-1user">N-1リレーションのロード（Userのロード）</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-40-1">1</a></span>
<span class="normal"><a href="#__codelineno-40-2">2</a></span>
<span class="normal"><a href="#__codelineno-40-3">3</a></span>
<span class="normal"><a href="#__codelineno-40-4">4</a></span>
<span class="normal"><a href="#__codelineno-40-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1"></a><span class="c1">// LoadUser allows an eager lookup of values, cached into the</span>
<a id="__codelineno-40-2" name="__codelineno-40-2"></a><span class="c1">// loaded structs of the objects. This is for an N-1 relationship.</span>
<a id="__codelineno-40-3" name="__codelineno-40-3"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">pointL</span><span class="p">)</span><span class="w"> </span><span class="nx">LoadUser</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">singular</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="nx">maybePoint</span><span class="w"> </span><span class="kd">interface</span><span class="p">{},</span><span class="w"> </span><span class="nx">mods</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">Applicator</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-4" name="__codelineno-40-4"></a><span class="w">    </span><span class="c1">// ここから省略（詳細は後述）</span>
<a id="__codelineno-40-5" name="__codelineno-40-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="_40">解説</h4>
<ul>
<li>
<p><strong>関数の概要</strong>: <code>Point</code>オブジェクトに関連する<code>User</code>を一括でロードします。N対1のリレーションシップにおける関連データをキャッシュします。</p>
</li>
<li>
<p><strong>引数</strong>:</p>
</li>
<li><code>ctx context.Context</code>: コンテキスト情報。</li>
<li><code>e boil.ContextExecutor</code>: データベース操作を実行するためのエグゼキュータ。</li>
<li><code>singular bool</code>: 単一オブジェクトかどうかを示すフラグ。</li>
<li><code>maybePoint interface{}</code>: <code>Point</code>オブジェクトまたは<code>Point</code>オブジェクトのスライス。</li>
<li>
<p><code>mods queries.Applicator</code>: クエリ修飾子。</p>
</li>
<li>
<p><strong>処理の流れ</strong>:</p>
</li>
<li><code>maybePoint</code>が単一の<code>Point</code>オブジェクトか、<code>Point</code>オブジェクトのスライスかを判定。</li>
<li>関連する<code>UserID</code>を収集。</li>
<li>収集した<code>UserID</code>を使用して、関連する<code>User</code>を一括で取得するクエリを作成。</li>
<li>クエリを実行して<code>User</code>のスライスを取得。</li>
<li>取得した<code>User</code>を<code>Point</code>オブジェクトの<code>R.User</code>に設定し、逆に<code>User</code>の<code>R.Point</code>にも<code>Point</code>オブジェクトを設定。</li>
</ul>
<h4 id="_41">利用例</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-41-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-41-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-41-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-41-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-41-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-41-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-41-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-41-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-41-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-41-10">10</a></span>
<span class="normal"><a href="#__codelineno-41-11">11</a></span>
<span class="normal"><a href="#__codelineno-41-12">12</a></span>
<span class="normal"><a href="#__codelineno-41-13">13</a></span>
<span class="normal"><a href="#__codelineno-41-14">14</a></span>
<span class="normal"><a href="#__codelineno-41-15">15</a></span>
<span class="normal"><a href="#__codelineno-41-16">16</a></span>
<span class="normal"><a href="#__codelineno-41-17">17</a></span>
<span class="normal"><a href="#__codelineno-41-18">18</a></span>
<span class="normal"><a href="#__codelineno-41-19">19</a></span>
<span class="normal"><a href="#__codelineno-41-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-41-2" name="__codelineno-41-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-41-3" name="__codelineno-41-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-41-4" name="__codelineno-41-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-41-5" name="__codelineno-41-5"></a><span class="p">}</span>
<a id="__codelineno-41-6" name="__codelineno-41-6"></a>
<a id="__codelineno-41-7" name="__codelineno-41-7"></a><span class="c1">// 複数のポイントを取得</span>
<a id="__codelineno-41-8" name="__codelineno-41-8"></a><span class="nx">points</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Points</span><span class="p">().</span><span class="nx">All</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-41-9" name="__codelineno-41-9"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-41-10" name="__codelineno-41-10"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-41-11" name="__codelineno-41-11"></a><span class="p">}</span>
<a id="__codelineno-41-12" name="__codelineno-41-12"></a>
<a id="__codelineno-41-13" name="__codelineno-41-13"></a><span class="c1">// 関連するユーザーを一括ロード</span>
<a id="__codelineno-41-14" name="__codelineno-41-14"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">pointL</span><span class="p">.</span><span class="nx">LoadUser</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">points</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-41-15" name="__codelineno-41-15"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-41-16" name="__codelineno-41-16"></a><span class="p">}</span>
<a id="__codelineno-41-17" name="__codelineno-41-17"></a>
<a id="__codelineno-41-18" name="__codelineno-41-18"></a><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">point</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">points</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-41-19" name="__codelineno-41-19"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;ポイント: %+v, ユーザー: %+v\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">point</span><span class="p">,</span><span class="w"> </span><span class="nx">point</span><span class="p">.</span><span class="nx">R</span><span class="p">.</span><span class="nx">User</span><span class="p">)</span>
<a id="__codelineno-41-20" name="__codelineno-41-20"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<hr />
<h3 id="pointuser">PointオブジェクトへのUserのセット</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-42-1">1</a></span>
<span class="normal"><a href="#__codelineno-42-2">2</a></span>
<span class="normal"><a href="#__codelineno-42-3">3</a></span>
<span class="normal"><a href="#__codelineno-42-4">4</a></span>
<span class="normal"><a href="#__codelineno-42-5">5</a></span>
<span class="normal"><a href="#__codelineno-42-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1"></a><span class="c1">// SetUser of the point to the related item.</span>
<a id="__codelineno-42-2" name="__codelineno-42-2"></a><span class="c1">// Sets o.R.User to related.</span>
<a id="__codelineno-42-3" name="__codelineno-42-3"></a><span class="c1">// Adds o to related.R.Point.</span>
<a id="__codelineno-42-4" name="__codelineno-42-4"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">Point</span><span class="p">)</span><span class="w"> </span><span class="nx">SetUser</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">insert</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="nx">related</span><span class="w"> </span><span class="o">*</span><span class="nx">User</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-42-5" name="__codelineno-42-5"></a><span class="w">    </span><span class="c1">// ここから省略（詳細は後述）</span>
<a id="__codelineno-42-6" name="__codelineno-42-6"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="_42">解説</h4>
<ul>
<li>
<p><strong>関数の概要</strong>: <code>Point</code>オブジェクトに関連する<code>User</code>を設定します。<code>Point</code>の<code>UserID</code>を更新し、関連を双方向に設定します。</p>
</li>
<li>
<p><strong>引数</strong>:</p>
</li>
<li><code>ctx context.Context</code>: コンテキスト情報。</li>
<li><code>exec boil.ContextExecutor</code>: データベース操作を実行するためのエグゼキュータ。</li>
<li><code>insert bool</code>: <code>related</code>をデータベースに挿入するかどうか。</li>
<li>
<p><code>related *User</code>: 関連付ける<code>User</code>オブジェクト。</p>
</li>
<li>
<p><strong>処理の流れ</strong>:</p>
</li>
<li><code>insert</code>フラグが<code>true</code>の場合、<code>related</code>をデータベースに挿入。</li>
<li><code>points</code>テーブルの<code>user_id</code>を更新。</li>
<li><code>Point</code>オブジェクトの<code>UserID</code>を更新し、<code>R.User</code>に<code>related</code>を設定。</li>
<li><code>User</code>オブジェクトの<code>R.Point</code>に<code>Point</code>オブジェクトを設定。</li>
</ul>
<h4 id="_43">利用例</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-43-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-43-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-43-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-43-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-43-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-43-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-43-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-43-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-43-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-43-10">10</a></span>
<span class="normal"><a href="#__codelineno-43-11">11</a></span>
<span class="normal"><a href="#__codelineno-43-12">12</a></span>
<span class="normal"><a href="#__codelineno-43-13">13</a></span>
<span class="normal"><a href="#__codelineno-43-14">14</a></span>
<span class="normal"><a href="#__codelineno-43-15">15</a></span>
<span class="normal"><a href="#__codelineno-43-16">16</a></span>
<span class="normal"><a href="#__codelineno-43-17">17</a></span>
<span class="normal"><a href="#__codelineno-43-18">18</a></span>
<span class="normal"><a href="#__codelineno-43-19">19</a></span>
<span class="normal"><a href="#__codelineno-43-20">20</a></span>
<span class="normal"><a href="#__codelineno-43-21">21</a></span>
<span class="normal"><a href="#__codelineno-43-22">22</a></span>
<span class="normal"><a href="#__codelineno-43-23">23</a></span>
<span class="normal"><a href="#__codelineno-43-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-43-2" name="__codelineno-43-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-43-3" name="__codelineno-43-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-4" name="__codelineno-43-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-43-5" name="__codelineno-43-5"></a><span class="p">}</span>
<a id="__codelineno-43-6" name="__codelineno-43-6"></a>
<a id="__codelineno-43-7" name="__codelineno-43-7"></a><span class="c1">// 新しいユーザーを作成</span>
<a id="__codelineno-43-8" name="__codelineno-43-8"></a><span class="nx">user</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">User</span><span class="p">{</span>
<a id="__codelineno-43-9" name="__codelineno-43-9"></a><span class="w">    </span><span class="nx">UserID</span><span class="p">:</span><span class="w"> </span><span class="mi">123</span><span class="p">,</span>
<a id="__codelineno-43-10" name="__codelineno-43-10"></a><span class="w">    </span><span class="nx">Name</span><span class="p">:</span><span class="w">   </span><span class="s">&quot;新しいユーザー&quot;</span><span class="p">,</span>
<a id="__codelineno-43-11" name="__codelineno-43-11"></a><span class="p">}</span>
<a id="__codelineno-43-12" name="__codelineno-43-12"></a>
<a id="__codelineno-43-13" name="__codelineno-43-13"></a><span class="c1">// ポイントを取得</span>
<a id="__codelineno-43-14" name="__codelineno-43-14"></a><span class="nx">point</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">FindPoint</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-43-15" name="__codelineno-43-15"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-16" name="__codelineno-43-16"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-43-17" name="__codelineno-43-17"></a><span class="p">}</span>
<a id="__codelineno-43-18" name="__codelineno-43-18"></a>
<a id="__codelineno-43-19" name="__codelineno-43-19"></a><span class="c1">// ポイントにユーザーを関連付け</span>
<a id="__codelineno-43-20" name="__codelineno-43-20"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">point</span><span class="p">.</span><span class="nx">SetUser</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-21" name="__codelineno-43-21"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-43-22" name="__codelineno-43-22"></a><span class="p">}</span>
<a id="__codelineno-43-23" name="__codelineno-43-23"></a>
<a id="__codelineno-43-24" name="__codelineno-43-24"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;更新後のポイント: %+v\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">point</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<h3 id="points">Pointsクエリの生成</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-44-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-44-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-44-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-44-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-44-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-44-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-44-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-44-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-44-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-44-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1"></a><span class="c1">// Points retrieves all the records using an executor.</span>
<a id="__codelineno-44-2" name="__codelineno-44-2"></a><span class="kd">func</span><span class="w"> </span><span class="nx">Points</span><span class="p">(</span><span class="nx">mods</span><span class="w"> </span><span class="o">...</span><span class="nx">qm</span><span class="p">.</span><span class="nx">QueryMod</span><span class="p">)</span><span class="w"> </span><span class="nx">pointQuery</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-44-3" name="__codelineno-44-3"></a><span class="w">    </span><span class="nx">mods</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">mods</span><span class="p">,</span><span class="w"> </span><span class="nx">qm</span><span class="p">.</span><span class="nx">From</span><span class="p">(</span><span class="s">&quot;`points`&quot;</span><span class="p">))</span>
<a id="__codelineno-44-4" name="__codelineno-44-4"></a><span class="w">    </span><span class="nx">q</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">NewQuery</span><span class="p">(</span><span class="nx">mods</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-44-5" name="__codelineno-44-5"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">queries</span><span class="p">.</span><span class="nx">GetSelect</span><span class="p">(</span><span class="nx">q</span><span class="p">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-44-6" name="__codelineno-44-6"></a><span class="w">        </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetSelect</span><span class="p">(</span><span class="nx">q</span><span class="p">,</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;`points`.*&quot;</span><span class="p">})</span>
<a id="__codelineno-44-7" name="__codelineno-44-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-44-8" name="__codelineno-44-8"></a>
<a id="__codelineno-44-9" name="__codelineno-44-9"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">pointQuery</span><span class="p">{</span><span class="nx">q</span><span class="p">}</span>
<a id="__codelineno-44-10" name="__codelineno-44-10"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="_44">解説</h4>
<ul>
<li>
<p><strong>関数の概要</strong>: <code>points</code>テーブルに対するクエリを生成します。</p>
</li>
<li>
<p><strong>引数</strong>:</p>
</li>
<li>
<p><code>mods ...qm.QueryMod</code>: クエリ修飾子。</p>
</li>
<li>
<p><strong>処理の流れ</strong>:</p>
</li>
<li>クエリ修飾子に<code>FROM "points"</code>を追加。</li>
<li>新しいクエリを生成。</li>
<li><code>SELECT</code>句が未設定の場合、<code>points</code>テーブルのすべてのカラムを選択するように設定。</li>
<li><code>pointQuery</code>を返す。</li>
</ul>
<h4 id="_45">利用例</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-45-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-45-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-45-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-45-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-45-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-45-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-45-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-45-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-45-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-45-10">10</a></span>
<span class="normal"><a href="#__codelineno-45-11">11</a></span>
<span class="normal"><a href="#__codelineno-45-12">12</a></span>
<span class="normal"><a href="#__codelineno-45-13">13</a></span>
<span class="normal"><a href="#__codelineno-45-14">14</a></span>
<span class="normal"><a href="#__codelineno-45-15">15</a></span>
<span class="normal"><a href="#__codelineno-45-16">16</a></span>
<span class="normal"><a href="#__codelineno-45-17">17</a></span>
<span class="normal"><a href="#__codelineno-45-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-45-2" name="__codelineno-45-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-45-3" name="__codelineno-45-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-45-4" name="__codelineno-45-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-45-5" name="__codelineno-45-5"></a><span class="p">}</span>
<a id="__codelineno-45-6" name="__codelineno-45-6"></a>
<a id="__codelineno-45-7" name="__codelineno-45-7"></a><span class="c1">// ポイントのクエリを生成</span>
<a id="__codelineno-45-8" name="__codelineno-45-8"></a><span class="nx">pointQuery</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Points</span><span class="p">(</span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;score &gt; ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">))</span>
<a id="__codelineno-45-9" name="__codelineno-45-9"></a>
<a id="__codelineno-45-10" name="__codelineno-45-10"></a><span class="c1">// クエリを実行してポイントを取得</span>
<a id="__codelineno-45-11" name="__codelineno-45-11"></a><span class="nx">points</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">pointQuery</span><span class="p">.</span><span class="nx">All</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-45-12" name="__codelineno-45-12"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-45-13" name="__codelineno-45-13"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-45-14" name="__codelineno-45-14"></a><span class="p">}</span>
<a id="__codelineno-45-15" name="__codelineno-45-15"></a>
<a id="__codelineno-45-16" name="__codelineno-45-16"></a><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">point</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">points</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-45-17" name="__codelineno-45-17"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;ポイント: %+v\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">point</span><span class="p">)</span>
<a id="__codelineno-45-18" name="__codelineno-45-18"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<hr />
<h3 id="point_6">特定のPointレコードの検索</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-46-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-46-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-46-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-46-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-46-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-46-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-46-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-46-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-46-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-46-10">10</a></span>
<span class="normal"><a href="#__codelineno-46-11">11</a></span>
<span class="normal"><a href="#__codelineno-46-12">12</a></span>
<span class="normal"><a href="#__codelineno-46-13">13</a></span>
<span class="normal"><a href="#__codelineno-46-14">14</a></span>
<span class="normal"><a href="#__codelineno-46-15">15</a></span>
<span class="normal"><a href="#__codelineno-46-16">16</a></span>
<span class="normal"><a href="#__codelineno-46-17">17</a></span>
<span class="normal"><a href="#__codelineno-46-18">18</a></span>
<span class="normal"><a href="#__codelineno-46-19">19</a></span>
<span class="normal"><a href="#__codelineno-46-20">20</a></span>
<span class="normal"><a href="#__codelineno-46-21">21</a></span>
<span class="normal"><a href="#__codelineno-46-22">22</a></span>
<span class="normal"><a href="#__codelineno-46-23">23</a></span>
<span class="normal"><a href="#__codelineno-46-24">24</a></span>
<span class="normal"><a href="#__codelineno-46-25">25</a></span>
<span class="normal"><a href="#__codelineno-46-26">26</a></span>
<span class="normal"><a href="#__codelineno-46-27">27</a></span>
<span class="normal"><a href="#__codelineno-46-28">28</a></span>
<span class="normal"><a href="#__codelineno-46-29">29</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1"></a><span class="c1">// FindPoint retrieves a single record by ID with an executor.</span>
<a id="__codelineno-46-2" name="__codelineno-46-2"></a><span class="c1">// If selectCols is empty Find will return all columns.</span>
<a id="__codelineno-46-3" name="__codelineno-46-3"></a><span class="kd">func</span><span class="w"> </span><span class="nx">FindPoint</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">userID</span><span class="w"> </span><span class="kt">uint</span><span class="p">,</span><span class="w"> </span><span class="nx">selectCols</span><span class="w"> </span><span class="o">...</span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">Point</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-46-4" name="__codelineno-46-4"></a><span class="w">    </span><span class="nx">pointObj</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Point</span><span class="p">{}</span>
<a id="__codelineno-46-5" name="__codelineno-46-5"></a>
<a id="__codelineno-46-6" name="__codelineno-46-6"></a><span class="w">    </span><span class="nx">sel</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;*&quot;</span>
<a id="__codelineno-46-7" name="__codelineno-46-7"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">selectCols</span><span class="p">)</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-46-8" name="__codelineno-46-8"></a><span class="w">        </span><span class="nx">sel</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">Join</span><span class="p">(</span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">IdentQuoteSlice</span><span class="p">(</span><span class="nx">dialect</span><span class="p">.</span><span class="nx">LQ</span><span class="p">,</span><span class="w"> </span><span class="nx">dialect</span><span class="p">.</span><span class="nx">RQ</span><span class="p">,</span><span class="w"> </span><span class="nx">selectCols</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;,&quot;</span><span class="p">)</span>
<a id="__codelineno-46-9" name="__codelineno-46-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-46-10" name="__codelineno-46-10"></a><span class="w">    </span><span class="nx">query</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span>
<a id="__codelineno-46-11" name="__codelineno-46-11"></a><span class="w">        </span><span class="s">&quot;select %s from `points` where `user_id`=?&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">sel</span><span class="p">,</span>
<a id="__codelineno-46-12" name="__codelineno-46-12"></a><span class="w">    </span><span class="p">)</span>
<a id="__codelineno-46-13" name="__codelineno-46-13"></a>
<a id="__codelineno-46-14" name="__codelineno-46-14"></a><span class="w">    </span><span class="nx">q</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">Raw</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span><span class="w"> </span><span class="nx">userID</span><span class="p">)</span>
<a id="__codelineno-46-15" name="__codelineno-46-15"></a>
<a id="__codelineno-46-16" name="__codelineno-46-16"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">q</span><span class="p">.</span><span class="nx">Bind</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="nx">pointObj</span><span class="p">)</span>
<a id="__codelineno-46-17" name="__codelineno-46-17"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-46-18" name="__codelineno-46-18"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Is</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">ErrNoRows</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-46-19" name="__codelineno-46-19"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">ErrNoRows</span>
<a id="__codelineno-46-20" name="__codelineno-46-20"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-46-21" name="__codelineno-46-21"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to select from points&quot;</span><span class="p">)</span>
<a id="__codelineno-46-22" name="__codelineno-46-22"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-46-23" name="__codelineno-46-23"></a>
<a id="__codelineno-46-24" name="__codelineno-46-24"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">pointObj</span><span class="p">.</span><span class="nx">doAfterSelectHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-46-25" name="__codelineno-46-25"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">pointObj</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-46-26" name="__codelineno-46-26"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-46-27" name="__codelineno-46-27"></a>
<a id="__codelineno-46-28" name="__codelineno-46-28"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">pointObj</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-46-29" name="__codelineno-46-29"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="_46">解説</h4>
<ul>
<li>
<p><strong>関数の概要</strong>: <code>user_id</code>を指定して<code>Point</code>レコードを1件取得します。<code>selectCols</code>が指定されていない場合、すべてのカラムを取得します。</p>
</li>
<li>
<p><strong>引数</strong>:</p>
</li>
<li><code>ctx context.Context</code>: コンテキスト情報。</li>
<li><code>exec boil.ContextExecutor</code>: データベース操作を実行するためのエグゼキュータ。</li>
<li><code>userID uint</code>: 取得する<code>Point</code>レコードの<code>user_id</code>。</li>
<li>
<p><code>selectCols ...string</code>: 取得するカラム名の可変長引数。</p>
</li>
<li>
<p><strong>処理の流れ</strong>:</p>
</li>
<li>新しい<code>Point</code>オブジェクトを作成。
     <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-47-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1"></a><span class="nx">pointObj</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Point</span><span class="p">{}</span>
</code></pre></div></td></tr></table></div></li>
<li><code>selectCols</code>が指定されているかチェックし、<code>SELECT</code>句を設定。</li>
<li><code>user_id</code>を条件にした<code>SELECT</code>クエリを文字列として作成。</li>
<li>生クエリ<code>q</code>を作成し、パラメータとして<code>userID</code>を指定。</li>
<li>クエリ結果を<code>pointObj</code>にバインド。</li>
<li>エラー処理:<ul>
<li>レコードが見つからない場合、<code>nil</code>と<code>sql.ErrNoRows</code>を返す。</li>
<li>その他のエラーが発生した場合、エラーメッセージをラップして返す。</li>
</ul>
</li>
<li><code>pointObj</code>にアフターセレクトフック処理を実行。</li>
<li>最終的に<code>pointObj</code>を返す。</li>
</ul>
<h4 id="_47">利用例</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-48-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-48-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-48-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-48-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-48-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-48-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-48-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-48-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-48-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-48-10">10</a></span>
<span class="normal"><a href="#__codelineno-48-11">11</a></span>
<span class="normal"><a href="#__codelineno-48-12">12</a></span>
<span class="normal"><a href="#__codelineno-48-13">13</a></span>
<span class="normal"><a href="#__codelineno-48-14">14</a></span>
<span class="normal"><a href="#__codelineno-48-15">15</a></span>
<span class="normal"><a href="#__codelineno-48-16">16</a></span>
<span class="normal"><a href="#__codelineno-48-17">17</a></span>
<span class="normal"><a href="#__codelineno-48-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-48-2" name="__codelineno-48-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-48-3" name="__codelineno-48-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-48-4" name="__codelineno-48-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-48-5" name="__codelineno-48-5"></a><span class="p">}</span>
<a id="__codelineno-48-6" name="__codelineno-48-6"></a>
<a id="__codelineno-48-7" name="__codelineno-48-7"></a><span class="c1">// 特定のユーザーIDのポイントを取得</span>
<a id="__codelineno-48-8" name="__codelineno-48-8"></a><span class="nx">userID</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">uint</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<a id="__codelineno-48-9" name="__codelineno-48-9"></a><span class="nx">point</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">FindPoint</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">userID</span><span class="p">)</span>
<a id="__codelineno-48-10" name="__codelineno-48-10"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-48-11" name="__codelineno-48-11"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Is</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">ErrNoRows</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-48-12" name="__codelineno-48-12"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;ポイントが見つかりませんでした&quot;</span><span class="p">)</span>
<a id="__codelineno-48-13" name="__codelineno-48-13"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-48-14" name="__codelineno-48-14"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">&quot;エラー: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-48-15" name="__codelineno-48-15"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-48-16" name="__codelineno-48-16"></a><span class="p">}</span>
<a id="__codelineno-48-17" name="__codelineno-48-17"></a>
<a id="__codelineno-48-18" name="__codelineno-48-18"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;取得したポイント: %+v\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">point</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<p>以下では、提供されたGo言語のコードについて、すべてのコード部分を詳細に解説します。また、開発者向けに利用例も詳細なコード例として示します。</p>
<hr />
<h3 id="point_7">Point構造体のレコード挿入メソッド</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-49-1">  1</a></span>
<span class="normal"><a href="#__codelineno-49-2">  2</a></span>
<span class="normal"><a href="#__codelineno-49-3">  3</a></span>
<span class="normal"><a href="#__codelineno-49-4">  4</a></span>
<span class="normal"><a href="#__codelineno-49-5">  5</a></span>
<span class="normal"><a href="#__codelineno-49-6">  6</a></span>
<span class="normal"><a href="#__codelineno-49-7">  7</a></span>
<span class="normal"><a href="#__codelineno-49-8">  8</a></span>
<span class="normal"><a href="#__codelineno-49-9">  9</a></span>
<span class="normal"><a href="#__codelineno-49-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-49-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-49-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-49-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-49-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-49-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-49-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-49-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-49-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-49-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-49-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-49-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-49-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-49-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-49-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-49-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-49-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-49-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-49-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-49-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-49-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-49-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-49-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-49-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-49-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-49-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-49-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-49-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-49-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-49-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-49-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-49-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-49-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-49-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-49-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-49-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-49-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-49-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-49-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-49-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-49-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-49-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-49-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-49-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-49-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-49-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-49-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-49-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-49-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-49-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-49-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-49-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-49-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-49-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-49-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-49-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-49-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-49-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-49-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-49-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-49-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-49-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-49-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-49-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-49-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-49-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-49-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-49-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-49-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-49-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-49-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-49-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-49-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-49-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-49-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-49-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-49-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-49-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-49-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-49-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-49-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-49-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-49-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-49-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-49-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-49-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-49-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-49-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-49-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-49-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-49-100">100</a></span>
<span class="normal"><a href="#__codelineno-49-101">101</a></span>
<span class="normal"><a href="#__codelineno-49-102">102</a></span>
<span class="normal"><a href="#__codelineno-49-103">103</a></span>
<span class="normal"><a href="#__codelineno-49-104">104</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1"></a><span class="c1">// Insert a single record using an executor.</span>
<a id="__codelineno-49-2" name="__codelineno-49-2"></a><span class="c1">// See boil.Columns.InsertColumnSet documentation to understand column list inference for inserts.</span>
<a id="__codelineno-49-3" name="__codelineno-49-3"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">Point</span><span class="p">)</span><span class="w"> </span><span class="nx">Insert</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">columns</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">Columns</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-49-4" name="__codelineno-49-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">o</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-49-5" name="__codelineno-49-5"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;models: no points provided for insertion&quot;</span><span class="p">)</span>
<a id="__codelineno-49-6" name="__codelineno-49-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-49-7" name="__codelineno-49-7"></a>
<a id="__codelineno-49-8" name="__codelineno-49-8"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span>
<a id="__codelineno-49-9" name="__codelineno-49-9"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">boil</span><span class="p">.</span><span class="nx">TimestampsAreSkipped</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-49-10" name="__codelineno-49-10"></a><span class="w">        </span><span class="nx">currTime</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">In</span><span class="p">(</span><span class="nx">boil</span><span class="p">.</span><span class="nx">GetLocation</span><span class="p">())</span>
<a id="__codelineno-49-11" name="__codelineno-49-11"></a>
<a id="__codelineno-49-12" name="__codelineno-49-12"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">CreatedAt</span><span class="p">.</span><span class="nx">IsZero</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-49-13" name="__codelineno-49-13"></a><span class="w">            </span><span class="nx">o</span><span class="p">.</span><span class="nx">CreatedAt</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">currTime</span>
<a id="__codelineno-49-14" name="__codelineno-49-14"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-49-15" name="__codelineno-49-15"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">UpdatedAt</span><span class="p">.</span><span class="nx">IsZero</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-49-16" name="__codelineno-49-16"></a><span class="w">            </span><span class="nx">o</span><span class="p">.</span><span class="nx">UpdatedAt</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">currTime</span>
<a id="__codelineno-49-17" name="__codelineno-49-17"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-49-18" name="__codelineno-49-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-49-19" name="__codelineno-49-19"></a>
<a id="__codelineno-49-20" name="__codelineno-49-20"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">doBeforeInsertHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-49-21" name="__codelineno-49-21"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-49-22" name="__codelineno-49-22"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-49-23" name="__codelineno-49-23"></a>
<a id="__codelineno-49-24" name="__codelineno-49-24"></a><span class="w">    </span><span class="nx">nzDefaults</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">NonZeroDefaultSet</span><span class="p">(</span><span class="nx">pointColumnsWithDefault</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">)</span>
<a id="__codelineno-49-25" name="__codelineno-49-25"></a>
<a id="__codelineno-49-26" name="__codelineno-49-26"></a><span class="w">    </span><span class="nx">key</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">makeCacheKey</span><span class="p">(</span><span class="nx">columns</span><span class="p">,</span><span class="w"> </span><span class="nx">nzDefaults</span><span class="p">)</span>
<a id="__codelineno-49-27" name="__codelineno-49-27"></a><span class="w">    </span><span class="nx">pointInsertCacheMut</span><span class="p">.</span><span class="nx">RLock</span><span class="p">()</span>
<a id="__codelineno-49-28" name="__codelineno-49-28"></a><span class="w">    </span><span class="nx">cache</span><span class="p">,</span><span class="w"> </span><span class="nx">cached</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">pointInsertCache</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
<a id="__codelineno-49-29" name="__codelineno-49-29"></a><span class="w">    </span><span class="nx">pointInsertCacheMut</span><span class="p">.</span><span class="nx">RUnlock</span><span class="p">()</span>
<a id="__codelineno-49-30" name="__codelineno-49-30"></a>
<a id="__codelineno-49-31" name="__codelineno-49-31"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">cached</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-49-32" name="__codelineno-49-32"></a><span class="w">        </span><span class="nx">wl</span><span class="p">,</span><span class="w"> </span><span class="nx">returnColumns</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">columns</span><span class="p">.</span><span class="nx">InsertColumnSet</span><span class="p">(</span>
<a id="__codelineno-49-33" name="__codelineno-49-33"></a><span class="w">            </span><span class="nx">pointAllColumns</span><span class="p">,</span>
<a id="__codelineno-49-34" name="__codelineno-49-34"></a><span class="w">            </span><span class="nx">pointColumnsWithDefault</span><span class="p">,</span>
<a id="__codelineno-49-35" name="__codelineno-49-35"></a><span class="w">            </span><span class="nx">pointColumnsWithoutDefault</span><span class="p">,</span>
<a id="__codelineno-49-36" name="__codelineno-49-36"></a><span class="w">            </span><span class="nx">nzDefaults</span><span class="p">,</span>
<a id="__codelineno-49-37" name="__codelineno-49-37"></a><span class="w">        </span><span class="p">)</span>
<a id="__codelineno-49-38" name="__codelineno-49-38"></a>
<a id="__codelineno-49-39" name="__codelineno-49-39"></a><span class="w">        </span><span class="nx">cache</span><span class="p">.</span><span class="nx">valueMapping</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">BindMapping</span><span class="p">(</span><span class="nx">pointType</span><span class="p">,</span><span class="w"> </span><span class="nx">pointMapping</span><span class="p">,</span><span class="w"> </span><span class="nx">wl</span><span class="p">)</span>
<a id="__codelineno-49-40" name="__codelineno-49-40"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-49-41" name="__codelineno-49-41"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-49-42" name="__codelineno-49-42"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-49-43" name="__codelineno-49-43"></a><span class="w">        </span><span class="nx">cache</span><span class="p">.</span><span class="nx">retMapping</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">BindMapping</span><span class="p">(</span><span class="nx">pointType</span><span class="p">,</span><span class="w"> </span><span class="nx">pointMapping</span><span class="p">,</span><span class="w"> </span><span class="nx">returnColumns</span><span class="p">)</span>
<a id="__codelineno-49-44" name="__codelineno-49-44"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-49-45" name="__codelineno-49-45"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-49-46" name="__codelineno-49-46"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-49-47" name="__codelineno-49-47"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">wl</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-49-48" name="__codelineno-49-48"></a><span class="w">            </span><span class="nx">cache</span><span class="p">.</span><span class="nx">query</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;INSERT INTO `points` (`%s`) %%sVALUES (%s)%%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">Join</span><span class="p">(</span><span class="nx">wl</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;`,`&quot;</span><span class="p">),</span><span class="w"> </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">Placeholders</span><span class="p">(</span><span class="nx">dialect</span><span class="p">.</span><span class="nx">UseIndexPlaceholders</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">wl</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-49-49" name="__codelineno-49-49"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-49-50" name="__codelineno-49-50"></a><span class="w">            </span><span class="nx">cache</span><span class="p">.</span><span class="nx">query</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;INSERT INTO `points` () VALUES ()%s%s&quot;</span>
<a id="__codelineno-49-51" name="__codelineno-49-51"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-49-52" name="__codelineno-49-52"></a>
<a id="__codelineno-49-53" name="__codelineno-49-53"></a><span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">queryOutput</span><span class="p">,</span><span class="w"> </span><span class="nx">queryReturning</span><span class="w"> </span><span class="kt">string</span>
<a id="__codelineno-49-54" name="__codelineno-49-54"></a>
<a id="__codelineno-49-55" name="__codelineno-49-55"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">cache</span><span class="p">.</span><span class="nx">retMapping</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-49-56" name="__codelineno-49-56"></a><span class="w">            </span><span class="nx">cache</span><span class="p">.</span><span class="nx">retQuery</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;SELECT `%s` FROM `points` WHERE %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nx">Join</span><span class="p">(</span><span class="nx">returnColumns</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;`,`&quot;</span><span class="p">),</span><span class="w"> </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">WhereClause</span><span class="p">(</span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">pointPrimaryKeyColumns</span><span class="p">))</span>
<a id="__codelineno-49-57" name="__codelineno-49-57"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-49-58" name="__codelineno-49-58"></a>
<a id="__codelineno-49-59" name="__codelineno-49-59"></a><span class="w">        </span><span class="nx">cache</span><span class="p">.</span><span class="nx">query</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="nx">cache</span><span class="p">.</span><span class="nx">query</span><span class="p">,</span><span class="w"> </span><span class="nx">queryOutput</span><span class="p">,</span><span class="w"> </span><span class="nx">queryReturning</span><span class="p">)</span>
<a id="__codelineno-49-60" name="__codelineno-49-60"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-49-61" name="__codelineno-49-61"></a>
<a id="__codelineno-49-62" name="__codelineno-49-62"></a><span class="w">    </span><span class="nx">value</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">Indirect</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="nx">o</span><span class="p">))</span>
<a id="__codelineno-49-63" name="__codelineno-49-63"></a><span class="w">    </span><span class="nx">vals</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">ValuesFromMapping</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">valueMapping</span><span class="p">)</span>
<a id="__codelineno-49-64" name="__codelineno-49-64"></a>
<a id="__codelineno-49-65" name="__codelineno-49-65"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">IsDebug</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-49-66" name="__codelineno-49-66"></a><span class="w">        </span><span class="nx">writer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">DebugWriterFrom</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<a id="__codelineno-49-67" name="__codelineno-49-67"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">query</span><span class="p">)</span>
<a id="__codelineno-49-68" name="__codelineno-49-68"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">vals</span><span class="p">)</span>
<a id="__codelineno-49-69" name="__codelineno-49-69"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-49-70" name="__codelineno-49-70"></a><span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">exec</span><span class="p">.</span><span class="nx">ExecContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">query</span><span class="p">,</span><span class="w"> </span><span class="nx">vals</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-49-71" name="__codelineno-49-71"></a>
<a id="__codelineno-49-72" name="__codelineno-49-72"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-49-73" name="__codelineno-49-73"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to insert into points&quot;</span><span class="p">)</span>
<a id="__codelineno-49-74" name="__codelineno-49-74"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-49-75" name="__codelineno-49-75"></a>
<a id="__codelineno-49-76" name="__codelineno-49-76"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">identifierCols</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}</span>
<a id="__codelineno-49-77" name="__codelineno-49-77"></a>
<a id="__codelineno-49-78" name="__codelineno-49-78"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">cache</span><span class="p">.</span><span class="nx">retMapping</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-49-79" name="__codelineno-49-79"></a><span class="w">        </span><span class="k">goto</span><span class="w"> </span><span class="nx">CacheNoHooks</span>
<a id="__codelineno-49-80" name="__codelineno-49-80"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-49-81" name="__codelineno-49-81"></a>
<a id="__codelineno-49-82" name="__codelineno-49-82"></a><span class="w">    </span><span class="nx">identifierCols</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}{</span>
<a id="__codelineno-49-83" name="__codelineno-49-83"></a><span class="w">        </span><span class="nx">o</span><span class="p">.</span><span class="nx">UserID</span><span class="p">,</span>
<a id="__codelineno-49-84" name="__codelineno-49-84"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-49-85" name="__codelineno-49-85"></a>
<a id="__codelineno-49-86" name="__codelineno-49-86"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">IsDebug</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-49-87" name="__codelineno-49-87"></a><span class="w">        </span><span class="nx">writer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">DebugWriterFrom</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<a id="__codelineno-49-88" name="__codelineno-49-88"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">retQuery</span><span class="p">)</span>
<a id="__codelineno-49-89" name="__codelineno-49-89"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">identifierCols</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-49-90" name="__codelineno-49-90"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-49-91" name="__codelineno-49-91"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">exec</span><span class="p">.</span><span class="nx">QueryRowContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">retQuery</span><span class="p">,</span><span class="w"> </span><span class="nx">identifierCols</span><span class="o">...</span><span class="p">).</span><span class="nx">Scan</span><span class="p">(</span><span class="nx">queries</span><span class="p">.</span><span class="nx">PtrsFromMapping</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">retMapping</span><span class="p">)</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-49-92" name="__codelineno-49-92"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-49-93" name="__codelineno-49-93"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to populate default values for points&quot;</span><span class="p">)</span>
<a id="__codelineno-49-94" name="__codelineno-49-94"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-49-95" name="__codelineno-49-95"></a>
<a id="__codelineno-49-96" name="__codelineno-49-96"></a><span class="nx">CacheNoHooks</span><span class="p">:</span>
<a id="__codelineno-49-97" name="__codelineno-49-97"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">cached</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-49-98" name="__codelineno-49-98"></a><span class="w">        </span><span class="nx">pointInsertCacheMut</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
<a id="__codelineno-49-99" name="__codelineno-49-99"></a><span class="w">        </span><span class="nx">pointInsertCache</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">cache</span>
<a id="__codelineno-49-100" name="__codelineno-49-100"></a><span class="w">        </span><span class="nx">pointInsertCacheMut</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>
<a id="__codelineno-49-101" name="__codelineno-49-101"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-49-102" name="__codelineno-49-102"></a>
<a id="__codelineno-49-103" name="__codelineno-49-103"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">doAfterInsertHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">)</span>
<a id="__codelineno-49-104" name="__codelineno-49-104"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="_48">解説</h4>
<ul>
<li>
<p><strong>関数の概要</strong>: <code>Point</code>構造体のインスタンス<code>o</code>をデータベースに挿入（INSERT）します。</p>
</li>
<li>
<p><strong>引数</strong>:</p>
</li>
<li><code>ctx context.Context</code>: コンテキスト情報。</li>
<li><code>exec boil.ContextExecutor</code>: データベース操作を実行するためのエグゼキュータ。</li>
<li>
<p><code>columns boil.Columns</code>: 挿入するカラムのセット。</p>
</li>
<li>
<p><strong>処理の流れ</strong>:</p>
</li>
<li><strong>nilチェック</strong>:<ul>
<li><code>o</code>が<code>nil</code>の場合、エラーを返します。
   <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-50-1">1</a></span>
<span class="normal"><a href="#__codelineno-50-2">2</a></span>
<span class="normal"><a href="#__codelineno-50-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1"></a><span class="k">if</span><span class="w"> </span><span class="nx">o</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-50-2" name="__codelineno-50-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;models: no points provided for insertion&quot;</span><span class="p">)</span>
<a id="__codelineno-50-3" name="__codelineno-50-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div></li>
</ul>
</li>
<li><strong>タイムスタンプの設定</strong>:<ul>
<li>コンテキストでタイムスタンプがスキップされていない場合、現在時刻を取得し、<code>CreatedAt</code>と<code>UpdatedAt</code>がゼロ値の場合に設定します。
   <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-51-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-51-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-51-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-51-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-51-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-51-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-51-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-51-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-51-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-51-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1"></a><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">boil</span><span class="p">.</span><span class="nx">TimestampsAreSkipped</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-51-2" name="__codelineno-51-2"></a><span class="w">    </span><span class="nx">currTime</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">In</span><span class="p">(</span><span class="nx">boil</span><span class="p">.</span><span class="nx">GetLocation</span><span class="p">())</span>
<a id="__codelineno-51-3" name="__codelineno-51-3"></a>
<a id="__codelineno-51-4" name="__codelineno-51-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">CreatedAt</span><span class="p">.</span><span class="nx">IsZero</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-51-5" name="__codelineno-51-5"></a><span class="w">        </span><span class="nx">o</span><span class="p">.</span><span class="nx">CreatedAt</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">currTime</span>
<a id="__codelineno-51-6" name="__codelineno-51-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-51-7" name="__codelineno-51-7"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">UpdatedAt</span><span class="p">.</span><span class="nx">IsZero</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-51-8" name="__codelineno-51-8"></a><span class="w">        </span><span class="nx">o</span><span class="p">.</span><span class="nx">UpdatedAt</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">currTime</span>
<a id="__codelineno-51-9" name="__codelineno-51-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-51-10" name="__codelineno-51-10"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div></li>
</ul>
</li>
<li><strong>挿入前のフック処理</strong>:<ul>
<li>挿入前に必要なフック処理を実行します。エラーが発生した場合、処理を中断します。
   <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-52-1">1</a></span>
<span class="normal"><a href="#__codelineno-52-2">2</a></span>
<span class="normal"><a href="#__codelineno-52-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">doBeforeInsertHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-52-2" name="__codelineno-52-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-52-3" name="__codelineno-52-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div></li>
</ul>
</li>
<li><strong>デフォルト値のセット</strong>:<ul>
<li>非ゼロのデフォルト値を持つフィールドを特定します。
   <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-53-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1"></a><span class="nx">nzDefaults</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">NonZeroDefaultSet</span><span class="p">(</span><span class="nx">pointColumnsWithDefault</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">)</span>
</code></pre></div></td></tr></table></div></li>
</ul>
</li>
<li><strong>キャッシュのキー作成と取得</strong>:<ul>
<li>キャッシュキーを作成し、挿入用のクエリがキャッシュに存在するかを確認します。
   <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-54-1">1</a></span>
<span class="normal"><a href="#__codelineno-54-2">2</a></span>
<span class="normal"><a href="#__codelineno-54-3">3</a></span>
<span class="normal"><a href="#__codelineno-54-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1"></a><span class="nx">key</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">makeCacheKey</span><span class="p">(</span><span class="nx">columns</span><span class="p">,</span><span class="w"> </span><span class="nx">nzDefaults</span><span class="p">)</span>
<a id="__codelineno-54-2" name="__codelineno-54-2"></a><span class="nx">pointInsertCacheMut</span><span class="p">.</span><span class="nx">RLock</span><span class="p">()</span>
<a id="__codelineno-54-3" name="__codelineno-54-3"></a><span class="nx">cache</span><span class="p">,</span><span class="w"> </span><span class="nx">cached</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">pointInsertCache</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
<a id="__codelineno-54-4" name="__codelineno-54-4"></a><span class="nx">pointInsertCacheMut</span><span class="p">.</span><span class="nx">RUnlock</span><span class="p">()</span>
</code></pre></div></td></tr></table></div></li>
</ul>
</li>
<li><strong>キャッシュが存在しない場合、クエリを構築</strong>:<ul>
<li>挿入するカラムと戻り値のカラムを決定します。</li>
<li>クエリ文字列を構築します。</li>
<li>マッピング情報を設定します。</li>
</ul>
</li>
<li><strong>値の抽出</strong>:<ul>
<li><code>o</code>のフィールド値をマッピング情報に基づいて取得します。
   <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-55-1">1</a></span>
<span class="normal"><a href="#__codelineno-55-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1"></a><span class="nx">value</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">Indirect</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="nx">o</span><span class="p">))</span>
<a id="__codelineno-55-2" name="__codelineno-55-2"></a><span class="nx">vals</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">ValuesFromMapping</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">valueMapping</span><span class="p">)</span>
</code></pre></div></td></tr></table></div></li>
</ul>
</li>
<li><strong>デバッグ情報の出力</strong>:<ul>
<li>デバッグモードの場合、クエリと値を出力します。</li>
</ul>
</li>
<li><strong>データベースへの挿入実行</strong>:<ul>
<li><code>exec.ExecContext</code>を使用してデータを挿入します。
   <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-56-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1"></a><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">exec</span><span class="p">.</span><span class="nx">ExecContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">query</span><span class="p">,</span><span class="w"> </span><span class="nx">vals</span><span class="o">...</span><span class="p">)</span>
</code></pre></div></td></tr></table></div></li>
</ul>
</li>
<li><strong>デフォルト値の取得</strong>:<ul>
<li>必要に応じて、デフォルト値を再取得し、<code>o</code>に設定します。</li>
</ul>
</li>
<li><strong>キャッシュの更新</strong>:<ul>
<li>キャッシュが存在しなかった場合、新しくキャッシュに追加します。</li>
</ul>
</li>
<li><strong>挿入後のフック処理</strong>:<ul>
<li>挿入後に必要なフック処理を実行します。</li>
</ul>
</li>
</ul>
<h4 id="_49">利用例</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-57-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-57-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-57-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-57-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-57-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-57-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-57-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-57-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-57-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-57-10">10</a></span>
<span class="normal"><a href="#__codelineno-57-11">11</a></span>
<span class="normal"><a href="#__codelineno-57-12">12</a></span>
<span class="normal"><a href="#__codelineno-57-13">13</a></span>
<span class="normal"><a href="#__codelineno-57-14">14</a></span>
<span class="normal"><a href="#__codelineno-57-15">15</a></span>
<span class="normal"><a href="#__codelineno-57-16">16</a></span>
<span class="normal"><a href="#__codelineno-57-17">17</a></span>
<span class="normal"><a href="#__codelineno-57-18">18</a></span>
<span class="normal"><a href="#__codelineno-57-19">19</a></span>
<span class="normal"><a href="#__codelineno-57-20">20</a></span>
<span class="normal"><a href="#__codelineno-57-21">21</a></span>
<span class="normal"><a href="#__codelineno-57-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-57-2" name="__codelineno-57-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-57-3" name="__codelineno-57-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-57-4" name="__codelineno-57-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-57-5" name="__codelineno-57-5"></a><span class="p">}</span>
<a id="__codelineno-57-6" name="__codelineno-57-6"></a>
<a id="__codelineno-57-7" name="__codelineno-57-7"></a><span class="c1">// 新しいポイントを作成</span>
<a id="__codelineno-57-8" name="__codelineno-57-8"></a><span class="nx">point</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Point</span><span class="p">{</span>
<a id="__codelineno-57-9" name="__codelineno-57-9"></a><span class="w">    </span><span class="nx">UserID</span><span class="p">:</span><span class="w"> </span><span class="mi">123</span><span class="p">,</span>
<a id="__codelineno-57-10" name="__codelineno-57-10"></a><span class="w">    </span><span class="nx">Score</span><span class="p">:</span><span class="w">  </span><span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-57-11" name="__codelineno-57-11"></a><span class="w">    </span><span class="c1">// 他のフィールドの初期化</span>
<a id="__codelineno-57-12" name="__codelineno-57-12"></a><span class="p">}</span>
<a id="__codelineno-57-13" name="__codelineno-57-13"></a>
<a id="__codelineno-57-14" name="__codelineno-57-14"></a><span class="c1">// 挿入するカラムを指定（必要な場合）</span>
<a id="__codelineno-57-15" name="__codelineno-57-15"></a><span class="nx">columns</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">Infer</span><span class="p">()</span>
<a id="__codelineno-57-16" name="__codelineno-57-16"></a>
<a id="__codelineno-57-17" name="__codelineno-57-17"></a><span class="c1">// ポイントを挿入</span>
<a id="__codelineno-57-18" name="__codelineno-57-18"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">point</span><span class="p">.</span><span class="nx">Insert</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">columns</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-57-19" name="__codelineno-57-19"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">&quot;エラー: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-57-20" name="__codelineno-57-20"></a><span class="p">}</span>
<a id="__codelineno-57-21" name="__codelineno-57-21"></a>
<a id="__codelineno-57-22" name="__codelineno-57-22"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;ポイントが挿入されました:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">point</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<h3 id="point_8">Point構造体のレコード更新メソッド</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-58-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-58-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-58-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-58-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-58-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-58-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-58-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-58-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-58-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-58-10">10</a></span>
<span class="normal"><a href="#__codelineno-58-11">11</a></span>
<span class="normal"><a href="#__codelineno-58-12">12</a></span>
<span class="normal"><a href="#__codelineno-58-13">13</a></span>
<span class="normal"><a href="#__codelineno-58-14">14</a></span>
<span class="normal"><a href="#__codelineno-58-15">15</a></span>
<span class="normal"><a href="#__codelineno-58-16">16</a></span>
<span class="normal"><a href="#__codelineno-58-17">17</a></span>
<span class="normal"><a href="#__codelineno-58-18">18</a></span>
<span class="normal"><a href="#__codelineno-58-19">19</a></span>
<span class="normal"><a href="#__codelineno-58-20">20</a></span>
<span class="normal"><a href="#__codelineno-58-21">21</a></span>
<span class="normal"><a href="#__codelineno-58-22">22</a></span>
<span class="normal"><a href="#__codelineno-58-23">23</a></span>
<span class="normal"><a href="#__codelineno-58-24">24</a></span>
<span class="normal"><a href="#__codelineno-58-25">25</a></span>
<span class="normal"><a href="#__codelineno-58-26">26</a></span>
<span class="normal"><a href="#__codelineno-58-27">27</a></span>
<span class="normal"><a href="#__codelineno-58-28">28</a></span>
<span class="normal"><a href="#__codelineno-58-29">29</a></span>
<span class="normal"><a href="#__codelineno-58-30">30</a></span>
<span class="normal"><a href="#__codelineno-58-31">31</a></span>
<span class="normal"><a href="#__codelineno-58-32">32</a></span>
<span class="normal"><a href="#__codelineno-58-33">33</a></span>
<span class="normal"><a href="#__codelineno-58-34">34</a></span>
<span class="normal"><a href="#__codelineno-58-35">35</a></span>
<span class="normal"><a href="#__codelineno-58-36">36</a></span>
<span class="normal"><a href="#__codelineno-58-37">37</a></span>
<span class="normal"><a href="#__codelineno-58-38">38</a></span>
<span class="normal"><a href="#__codelineno-58-39">39</a></span>
<span class="normal"><a href="#__codelineno-58-40">40</a></span>
<span class="normal"><a href="#__codelineno-58-41">41</a></span>
<span class="normal"><a href="#__codelineno-58-42">42</a></span>
<span class="normal"><a href="#__codelineno-58-43">43</a></span>
<span class="normal"><a href="#__codelineno-58-44">44</a></span>
<span class="normal"><a href="#__codelineno-58-45">45</a></span>
<span class="normal"><a href="#__codelineno-58-46">46</a></span>
<span class="normal"><a href="#__codelineno-58-47">47</a></span>
<span class="normal"><a href="#__codelineno-58-48">48</a></span>
<span class="normal"><a href="#__codelineno-58-49">49</a></span>
<span class="normal"><a href="#__codelineno-58-50">50</a></span>
<span class="normal"><a href="#__codelineno-58-51">51</a></span>
<span class="normal"><a href="#__codelineno-58-52">52</a></span>
<span class="normal"><a href="#__codelineno-58-53">53</a></span>
<span class="normal"><a href="#__codelineno-58-54">54</a></span>
<span class="normal"><a href="#__codelineno-58-55">55</a></span>
<span class="normal"><a href="#__codelineno-58-56">56</a></span>
<span class="normal"><a href="#__codelineno-58-57">57</a></span>
<span class="normal"><a href="#__codelineno-58-58">58</a></span>
<span class="normal"><a href="#__codelineno-58-59">59</a></span>
<span class="normal"><a href="#__codelineno-58-60">60</a></span>
<span class="normal"><a href="#__codelineno-58-61">61</a></span>
<span class="normal"><a href="#__codelineno-58-62">62</a></span>
<span class="normal"><a href="#__codelineno-58-63">63</a></span>
<span class="normal"><a href="#__codelineno-58-64">64</a></span>
<span class="normal"><a href="#__codelineno-58-65">65</a></span>
<span class="normal"><a href="#__codelineno-58-66">66</a></span>
<span class="normal"><a href="#__codelineno-58-67">67</a></span>
<span class="normal"><a href="#__codelineno-58-68">68</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1"></a><span class="c1">// Update uses an executor to update the Point.</span>
<a id="__codelineno-58-2" name="__codelineno-58-2"></a><span class="c1">// See boil.Columns.UpdateColumnSet documentation to understand column list inference for updates.</span>
<a id="__codelineno-58-3" name="__codelineno-58-3"></a><span class="c1">// Update does not automatically update the record in case of default values. Use .Reload() to refresh the records.</span>
<a id="__codelineno-58-4" name="__codelineno-58-4"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">Point</span><span class="p">)</span><span class="w"> </span><span class="nx">Update</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">columns</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">Columns</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">int64</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-58-5" name="__codelineno-58-5"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">boil</span><span class="p">.</span><span class="nx">TimestampsAreSkipped</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-58-6" name="__codelineno-58-6"></a><span class="w">        </span><span class="nx">currTime</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">In</span><span class="p">(</span><span class="nx">boil</span><span class="p">.</span><span class="nx">GetLocation</span><span class="p">())</span>
<a id="__codelineno-58-7" name="__codelineno-58-7"></a>
<a id="__codelineno-58-8" name="__codelineno-58-8"></a><span class="w">        </span><span class="nx">o</span><span class="p">.</span><span class="nx">UpdatedAt</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">currTime</span>
<a id="__codelineno-58-9" name="__codelineno-58-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-58-10" name="__codelineno-58-10"></a>
<a id="__codelineno-58-11" name="__codelineno-58-11"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span>
<a id="__codelineno-58-12" name="__codelineno-58-12"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">doBeforeUpdateHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-58-13" name="__codelineno-58-13"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-58-14" name="__codelineno-58-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-58-15" name="__codelineno-58-15"></a><span class="w">    </span><span class="nx">key</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">makeCacheKey</span><span class="p">(</span><span class="nx">columns</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
<a id="__codelineno-58-16" name="__codelineno-58-16"></a><span class="w">    </span><span class="nx">pointUpdateCacheMut</span><span class="p">.</span><span class="nx">RLock</span><span class="p">()</span>
<a id="__codelineno-58-17" name="__codelineno-58-17"></a><span class="w">    </span><span class="nx">cache</span><span class="p">,</span><span class="w"> </span><span class="nx">cached</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">pointUpdateCache</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
<a id="__codelineno-58-18" name="__codelineno-58-18"></a><span class="w">    </span><span class="nx">pointUpdateCacheMut</span><span class="p">.</span><span class="nx">RUnlock</span><span class="p">()</span>
<a id="__codelineno-58-19" name="__codelineno-58-19"></a>
<a id="__codelineno-58-20" name="__codelineno-58-20"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">cached</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-58-21" name="__codelineno-58-21"></a><span class="w">        </span><span class="nx">wl</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">columns</span><span class="p">.</span><span class="nx">UpdateColumnSet</span><span class="p">(</span>
<a id="__codelineno-58-22" name="__codelineno-58-22"></a><span class="w">            </span><span class="nx">pointAllColumns</span><span class="p">,</span>
<a id="__codelineno-58-23" name="__codelineno-58-23"></a><span class="w">            </span><span class="nx">pointPrimaryKeyColumns</span><span class="p">,</span>
<a id="__codelineno-58-24" name="__codelineno-58-24"></a><span class="w">        </span><span class="p">)</span>
<a id="__codelineno-58-25" name="__codelineno-58-25"></a>
<a id="__codelineno-58-26" name="__codelineno-58-26"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">columns</span><span class="p">.</span><span class="nx">IsWhitelist</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-58-27" name="__codelineno-58-27"></a><span class="w">            </span><span class="nx">wl</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">SetComplement</span><span class="p">(</span><span class="nx">wl</span><span class="p">,</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&quot;created_at&quot;</span><span class="p">})</span>
<a id="__codelineno-58-28" name="__codelineno-58-28"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-58-29" name="__codelineno-58-29"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">wl</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-58-30" name="__codelineno-58-30"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;models: unable to update points, could not build whitelist&quot;</span><span class="p">)</span>
<a id="__codelineno-58-31" name="__codelineno-58-31"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-58-32" name="__codelineno-58-32"></a>
<a id="__codelineno-58-33" name="__codelineno-58-33"></a><span class="w">        </span><span class="nx">cache</span><span class="p">.</span><span class="nx">query</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;UPDATE `points` SET %s WHERE %s&quot;</span><span class="p">,</span>
<a id="__codelineno-58-34" name="__codelineno-58-34"></a><span class="w">            </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">SetParamNames</span><span class="p">(</span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">wl</span><span class="p">),</span>
<a id="__codelineno-58-35" name="__codelineno-58-35"></a><span class="w">            </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">WhereClause</span><span class="p">(</span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">pointPrimaryKeyColumns</span><span class="p">),</span>
<a id="__codelineno-58-36" name="__codelineno-58-36"></a><span class="w">        </span><span class="p">)</span>
<a id="__codelineno-58-37" name="__codelineno-58-37"></a><span class="w">        </span><span class="nx">cache</span><span class="p">.</span><span class="nx">valueMapping</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">BindMapping</span><span class="p">(</span><span class="nx">pointType</span><span class="p">,</span><span class="w"> </span><span class="nx">pointMapping</span><span class="p">,</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">wl</span><span class="p">,</span><span class="w"> </span><span class="nx">pointPrimaryKeyColumns</span><span class="o">...</span><span class="p">))</span>
<a id="__codelineno-58-38" name="__codelineno-58-38"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-58-39" name="__codelineno-58-39"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-58-40" name="__codelineno-58-40"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-58-41" name="__codelineno-58-41"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-58-42" name="__codelineno-58-42"></a>
<a id="__codelineno-58-43" name="__codelineno-58-43"></a><span class="w">    </span><span class="nx">values</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">ValuesFromMapping</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">Indirect</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="nx">o</span><span class="p">)),</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">valueMapping</span><span class="p">)</span>
<a id="__codelineno-58-44" name="__codelineno-58-44"></a>
<a id="__codelineno-58-45" name="__codelineno-58-45"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">IsDebug</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-58-46" name="__codelineno-58-46"></a><span class="w">        </span><span class="nx">writer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">DebugWriterFrom</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<a id="__codelineno-58-47" name="__codelineno-58-47"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">query</span><span class="p">)</span>
<a id="__codelineno-58-48" name="__codelineno-58-48"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">values</span><span class="p">)</span>
<a id="__codelineno-58-49" name="__codelineno-58-49"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-58-50" name="__codelineno-58-50"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Result</span>
<a id="__codelineno-58-51" name="__codelineno-58-51"></a><span class="w">    </span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">exec</span><span class="p">.</span><span class="nx">ExecContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">query</span><span class="p">,</span><span class="w"> </span><span class="nx">values</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-58-52" name="__codelineno-58-52"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-58-53" name="__codelineno-58-53"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to update points row&quot;</span><span class="p">)</span>
<a id="__codelineno-58-54" name="__codelineno-58-54"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-58-55" name="__codelineno-58-55"></a>
<a id="__codelineno-58-56" name="__codelineno-58-56"></a><span class="w">    </span><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">RowsAffected</span><span class="p">()</span>
<a id="__codelineno-58-57" name="__codelineno-58-57"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-58-58" name="__codelineno-58-58"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: failed to get rows affected by update for points&quot;</span><span class="p">)</span>
<a id="__codelineno-58-59" name="__codelineno-58-59"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-58-60" name="__codelineno-58-60"></a>
<a id="__codelineno-58-61" name="__codelineno-58-61"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">cached</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-58-62" name="__codelineno-58-62"></a><span class="w">        </span><span class="nx">pointUpdateCacheMut</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
<a id="__codelineno-58-63" name="__codelineno-58-63"></a><span class="w">        </span><span class="nx">pointUpdateCache</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">cache</span>
<a id="__codelineno-58-64" name="__codelineno-58-64"></a><span class="w">        </span><span class="nx">pointUpdateCacheMut</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>
<a id="__codelineno-58-65" name="__codelineno-58-65"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-58-66" name="__codelineno-58-66"></a>
<a id="__codelineno-58-67" name="__codelineno-58-67"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">doAfterUpdateHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">)</span>
<a id="__codelineno-58-68" name="__codelineno-58-68"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="_50">解説</h4>
<ul>
<li>
<p><strong>関数の概要</strong>: <code>Point</code>構造体のインスタンス<code>o</code>をデータベース内で更新（UPDATE）します。</p>
</li>
<li>
<p><strong>引数</strong>:</p>
</li>
<li><code>ctx context.Context</code>: コンテキスト情報。</li>
<li><code>exec boil.ContextExecutor</code>: データベース操作を実行するためのエグゼキュータ。</li>
<li>
<p><code>columns boil.Columns</code>: 更新するカラムのセット。</p>
</li>
<li>
<p><strong>処理の流れ</strong>:</p>
</li>
<li><strong>タイムスタンプの更新</strong>:<ul>
<li>コンテキストでタイムスタンプがスキップされていない場合、<code>UpdatedAt</code>フィールドを現在時刻に更新します。
   <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-59-1">1</a></span>
<span class="normal"><a href="#__codelineno-59-2">2</a></span>
<span class="normal"><a href="#__codelineno-59-3">3</a></span>
<span class="normal"><a href="#__codelineno-59-4">4</a></span>
<span class="normal"><a href="#__codelineno-59-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1"></a><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">boil</span><span class="p">.</span><span class="nx">TimestampsAreSkipped</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-59-2" name="__codelineno-59-2"></a><span class="w">    </span><span class="nx">currTime</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">In</span><span class="p">(</span><span class="nx">boil</span><span class="p">.</span><span class="nx">GetLocation</span><span class="p">())</span>
<a id="__codelineno-59-3" name="__codelineno-59-3"></a>
<a id="__codelineno-59-4" name="__codelineno-59-4"></a><span class="w">    </span><span class="nx">o</span><span class="p">.</span><span class="nx">UpdatedAt</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">currTime</span>
<a id="__codelineno-59-5" name="__codelineno-59-5"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div></li>
</ul>
</li>
<li><strong>更新前のフック処理</strong>:<ul>
<li>更新前に必要なフック処理を実行します。エラーが発生した場合、処理を中断します。
   <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-60-1">1</a></span>
<span class="normal"><a href="#__codelineno-60-2">2</a></span>
<span class="normal"><a href="#__codelineno-60-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">doBeforeUpdateHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-60-2" name="__codelineno-60-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-60-3" name="__codelineno-60-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div></li>
</ul>
</li>
<li><strong>キャッシュのキー作成と取得</strong>:<ul>
<li>キャッシュキーを作成し、更新用のクエリがキャッシュに存在するかを確認します。</li>
</ul>
</li>
<li><strong>キャッシュが存在しない場合、クエリを構築</strong>:<ul>
<li>更新するカラムのリストを決定します。</li>
<li>デフォルトで<code>created_at</code>フィールドは更新対象から除外します。</li>
<li>クエリ文字列を構築します。</li>
<li>マッピング情報を設定します。</li>
<li>更新するカラムが0の場合、エラーを返します。</li>
</ul>
</li>
<li><strong>値の抽出</strong>:<ul>
<li><code>o</code>のフィールド値をマッピング情報に基づいて取得します。</li>
</ul>
</li>
<li><strong>デバッグ情報の出力</strong>:<ul>
<li>デバッグモードの場合、クエリと値を出力します。</li>
</ul>
</li>
<li><strong>データベースへの更新実行</strong>:<ul>
<li><code>exec.ExecContext</code>を使用してデータを更新します。</li>
</ul>
</li>
<li><strong>影響を受けた行数の取得</strong>:<ul>
<li>更新操作によって影響を受けた行数を取得します。</li>
</ul>
</li>
<li><strong>キャッシュの更新</strong>:<ul>
<li>キャッシュが存在しなかった場合、新しくキャッシュに追加します。</li>
</ul>
</li>
<li>
<p><strong>更新後のフック処理</strong>:</p>
<ul>
<li>更新後に必要なフック処理を実行します。</li>
</ul>
</li>
<li>
<p><strong>注意点</strong>:</p>
</li>
<li>デフォルト値を持つフィールドが更新された場合、自動的に<code>o</code>のフィールド値が更新されません。最新の状態を取得するには<code>.Reload()</code>を使用してレコードを再読み込みする必要があります。</li>
</ul>
<h4 id="_51">利用例</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-61-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-61-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-61-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-61-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-61-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-61-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-61-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-61-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-61-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-61-10">10</a></span>
<span class="normal"><a href="#__codelineno-61-11">11</a></span>
<span class="normal"><a href="#__codelineno-61-12">12</a></span>
<span class="normal"><a href="#__codelineno-61-13">13</a></span>
<span class="normal"><a href="#__codelineno-61-14">14</a></span>
<span class="normal"><a href="#__codelineno-61-15">15</a></span>
<span class="normal"><a href="#__codelineno-61-16">16</a></span>
<span class="normal"><a href="#__codelineno-61-17">17</a></span>
<span class="normal"><a href="#__codelineno-61-18">18</a></span>
<span class="normal"><a href="#__codelineno-61-19">19</a></span>
<span class="normal"><a href="#__codelineno-61-20">20</a></span>
<span class="normal"><a href="#__codelineno-61-21">21</a></span>
<span class="normal"><a href="#__codelineno-61-22">22</a></span>
<span class="normal"><a href="#__codelineno-61-23">23</a></span>
<span class="normal"><a href="#__codelineno-61-24">24</a></span>
<span class="normal"><a href="#__codelineno-61-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-61-2" name="__codelineno-61-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-61-3" name="__codelineno-61-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-61-4" name="__codelineno-61-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-61-5" name="__codelineno-61-5"></a><span class="p">}</span>
<a id="__codelineno-61-6" name="__codelineno-61-6"></a>
<a id="__codelineno-61-7" name="__codelineno-61-7"></a><span class="c1">// 更新したいポイントを取得</span>
<a id="__codelineno-61-8" name="__codelineno-61-8"></a><span class="nx">point</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">FindPoint</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="mi">123</span><span class="p">)</span>
<a id="__codelineno-61-9" name="__codelineno-61-9"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-61-10" name="__codelineno-61-10"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">&quot;エラー: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-61-11" name="__codelineno-61-11"></a><span class="p">}</span>
<a id="__codelineno-61-12" name="__codelineno-61-12"></a>
<a id="__codelineno-61-13" name="__codelineno-61-13"></a><span class="c1">// ポイントのスコアを更新</span>
<a id="__codelineno-61-14" name="__codelineno-61-14"></a><span class="nx">point</span><span class="p">.</span><span class="nx">Score</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">200</span>
<a id="__codelineno-61-15" name="__codelineno-61-15"></a>
<a id="__codelineno-61-16" name="__codelineno-61-16"></a><span class="c1">// 更新するカラムを指定</span>
<a id="__codelineno-61-17" name="__codelineno-61-17"></a><span class="nx">columns</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">Whitelist</span><span class="p">(</span><span class="s">&quot;score&quot;</span><span class="p">)</span>
<a id="__codelineno-61-18" name="__codelineno-61-18"></a>
<a id="__codelineno-61-19" name="__codelineno-61-19"></a><span class="c1">// ポイントを更新</span>
<a id="__codelineno-61-20" name="__codelineno-61-20"></a><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">point</span><span class="p">.</span><span class="nx">Update</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">columns</span><span class="p">)</span>
<a id="__codelineno-61-21" name="__codelineno-61-21"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-61-22" name="__codelineno-61-22"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">&quot;エラー: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-61-23" name="__codelineno-61-23"></a><span class="p">}</span>
<a id="__codelineno-61-24" name="__codelineno-61-24"></a>
<a id="__codelineno-61-25" name="__codelineno-61-25"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;更新された行数: %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">rowsAff</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<h3 id="_52">クエリにマッチする全レコードの更新メソッド</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-62-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-62-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-62-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-62-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-62-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-62-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-62-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-62-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-62-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-62-10">10</a></span>
<span class="normal"><a href="#__codelineno-62-11">11</a></span>
<span class="normal"><a href="#__codelineno-62-12">12</a></span>
<span class="normal"><a href="#__codelineno-62-13">13</a></span>
<span class="normal"><a href="#__codelineno-62-14">14</a></span>
<span class="normal"><a href="#__codelineno-62-15">15</a></span>
<span class="normal"><a href="#__codelineno-62-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1"></a><span class="c1">// UpdateAll updates all rows with the specified column values.</span>
<a id="__codelineno-62-2" name="__codelineno-62-2"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">q</span><span class="w"> </span><span class="nx">pointQuery</span><span class="p">)</span><span class="w"> </span><span class="nx">UpdateAll</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">cols</span><span class="w"> </span><span class="nx">M</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">int64</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-62-3" name="__codelineno-62-3"></a><span class="w">    </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetUpdate</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">,</span><span class="w"> </span><span class="nx">cols</span><span class="p">)</span>
<a id="__codelineno-62-4" name="__codelineno-62-4"></a>
<a id="__codelineno-62-5" name="__codelineno-62-5"></a><span class="w">    </span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">.</span><span class="nx">ExecContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">)</span>
<a id="__codelineno-62-6" name="__codelineno-62-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-62-7" name="__codelineno-62-7"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to update all for points&quot;</span><span class="p">)</span>
<a id="__codelineno-62-8" name="__codelineno-62-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-62-9" name="__codelineno-62-9"></a>
<a id="__codelineno-62-10" name="__codelineno-62-10"></a><span class="w">    </span><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">RowsAffected</span><span class="p">()</span>
<a id="__codelineno-62-11" name="__codelineno-62-11"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-62-12" name="__codelineno-62-12"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to retrieve rows affected for points&quot;</span><span class="p">)</span>
<a id="__codelineno-62-13" name="__codelineno-62-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-62-14" name="__codelineno-62-14"></a>
<a id="__codelineno-62-15" name="__codelineno-62-15"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-62-16" name="__codelineno-62-16"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="_53">解説</h4>
<ul>
<li>
<p><strong>関数の概要</strong>: クエリ<code>q</code>にマッチするすべての<code>Point</code>レコードを一括で更新します。</p>
</li>
<li>
<p><strong>引数</strong>:</p>
</li>
<li><code>ctx context.Context</code>: コンテキスト情報。</li>
<li><code>exec boil.ContextExecutor</code>: データベース操作を実行するためのエグゼキュータ。</li>
<li>
<p><code>cols M</code>: 更新するカラム名と新しい値のマップ。</p>
</li>
<li>
<p><strong>処理の流れ</strong>:</p>
</li>
<li><strong>更新内容の設定</strong>:<ul>
<li>クエリに更新するカラムと値を設定します。
   <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-63-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1"></a><span class="nx">queries</span><span class="p">.</span><span class="nx">SetUpdate</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">,</span><span class="w"> </span><span class="nx">cols</span><span class="p">)</span>
</code></pre></div></td></tr></table></div></li>
</ul>
</li>
<li><strong>データベースへの更新実行</strong>:<ul>
<li>クエリを実行してデータを更新します。</li>
</ul>
</li>
<li><strong>影響を受けた行数の取得</strong>:<ul>
<li>更新操作によって影響を受けた行数を取得します。</li>
</ul>
</li>
<li><strong>行数を返す</strong>:<ul>
<li>更新によって影響を受けた行数を返します。</li>
</ul>
</li>
</ul>
<h4 id="_54">利用例</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-64-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-64-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-64-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-64-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-64-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-64-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-64-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-64-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-64-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-64-10">10</a></span>
<span class="normal"><a href="#__codelineno-64-11">11</a></span>
<span class="normal"><a href="#__codelineno-64-12">12</a></span>
<span class="normal"><a href="#__codelineno-64-13">13</a></span>
<span class="normal"><a href="#__codelineno-64-14">14</a></span>
<span class="normal"><a href="#__codelineno-64-15">15</a></span>
<span class="normal"><a href="#__codelineno-64-16">16</a></span>
<span class="normal"><a href="#__codelineno-64-17">17</a></span>
<span class="normal"><a href="#__codelineno-64-18">18</a></span>
<span class="normal"><a href="#__codelineno-64-19">19</a></span>
<span class="normal"><a href="#__codelineno-64-20">20</a></span>
<span class="normal"><a href="#__codelineno-64-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-64-2" name="__codelineno-64-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-64-3" name="__codelineno-64-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-64-4" name="__codelineno-64-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-64-5" name="__codelineno-64-5"></a><span class="p">}</span>
<a id="__codelineno-64-6" name="__codelineno-64-6"></a>
<a id="__codelineno-64-7" name="__codelineno-64-7"></a><span class="c1">// スコアが100未満のポイントを選択</span>
<a id="__codelineno-64-8" name="__codelineno-64-8"></a><span class="nx">pointQuery</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Points</span><span class="p">(</span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;score &lt; ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">))</span>
<a id="__codelineno-64-9" name="__codelineno-64-9"></a>
<a id="__codelineno-64-10" name="__codelineno-64-10"></a><span class="c1">// 更新するカラムと値を指定</span>
<a id="__codelineno-64-11" name="__codelineno-64-11"></a><span class="nx">cols</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">M</span><span class="p">{</span>
<a id="__codelineno-64-12" name="__codelineno-64-12"></a><span class="w">    </span><span class="s">&quot;score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-64-13" name="__codelineno-64-13"></a><span class="p">}</span>
<a id="__codelineno-64-14" name="__codelineno-64-14"></a>
<a id="__codelineno-64-15" name="__codelineno-64-15"></a><span class="c1">// 該当レコードを一括更新</span>
<a id="__codelineno-64-16" name="__codelineno-64-16"></a><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">pointQuery</span><span class="p">.</span><span class="nx">UpdateAll</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">cols</span><span class="p">)</span>
<a id="__codelineno-64-17" name="__codelineno-64-17"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-64-18" name="__codelineno-64-18"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">&quot;エラー: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-64-19" name="__codelineno-64-19"></a><span class="p">}</span>
<a id="__codelineno-64-20" name="__codelineno-64-20"></a>
<a id="__codelineno-64-21" name="__codelineno-64-21"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;更新された行数: %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">rowsAff</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<h3 id="pointslice">PointSliceの一括更新メソッド</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-65-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-65-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-65-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-65-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-65-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-65-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-65-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-65-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-65-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-65-10">10</a></span>
<span class="normal"><a href="#__codelineno-65-11">11</a></span>
<span class="normal"><a href="#__codelineno-65-12">12</a></span>
<span class="normal"><a href="#__codelineno-65-13">13</a></span>
<span class="normal"><a href="#__codelineno-65-14">14</a></span>
<span class="normal"><a href="#__codelineno-65-15">15</a></span>
<span class="normal"><a href="#__codelineno-65-16">16</a></span>
<span class="normal"><a href="#__codelineno-65-17">17</a></span>
<span class="normal"><a href="#__codelineno-65-18">18</a></span>
<span class="normal"><a href="#__codelineno-65-19">19</a></span>
<span class="normal"><a href="#__codelineno-65-20">20</a></span>
<span class="normal"><a href="#__codelineno-65-21">21</a></span>
<span class="normal"><a href="#__codelineno-65-22">22</a></span>
<span class="normal"><a href="#__codelineno-65-23">23</a></span>
<span class="normal"><a href="#__codelineno-65-24">24</a></span>
<span class="normal"><a href="#__codelineno-65-25">25</a></span>
<span class="normal"><a href="#__codelineno-65-26">26</a></span>
<span class="normal"><a href="#__codelineno-65-27">27</a></span>
<span class="normal"><a href="#__codelineno-65-28">28</a></span>
<span class="normal"><a href="#__codelineno-65-29">29</a></span>
<span class="normal"><a href="#__codelineno-65-30">30</a></span>
<span class="normal"><a href="#__codelineno-65-31">31</a></span>
<span class="normal"><a href="#__codelineno-65-32">32</a></span>
<span class="normal"><a href="#__codelineno-65-33">33</a></span>
<span class="normal"><a href="#__codelineno-65-34">34</a></span>
<span class="normal"><a href="#__codelineno-65-35">35</a></span>
<span class="normal"><a href="#__codelineno-65-36">36</a></span>
<span class="normal"><a href="#__codelineno-65-37">37</a></span>
<span class="normal"><a href="#__codelineno-65-38">38</a></span>
<span class="normal"><a href="#__codelineno-65-39">39</a></span>
<span class="normal"><a href="#__codelineno-65-40">40</a></span>
<span class="normal"><a href="#__codelineno-65-41">41</a></span>
<span class="normal"><a href="#__codelineno-65-42">42</a></span>
<span class="normal"><a href="#__codelineno-65-43">43</a></span>
<span class="normal"><a href="#__codelineno-65-44">44</a></span>
<span class="normal"><a href="#__codelineno-65-45">45</a></span>
<span class="normal"><a href="#__codelineno-65-46">46</a></span>
<span class="normal"><a href="#__codelineno-65-47">47</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1"></a><span class="c1">// UpdateAll updates all rows with the specified column values, using an executor.</span>
<a id="__codelineno-65-2" name="__codelineno-65-2"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="nx">PointSlice</span><span class="p">)</span><span class="w"> </span><span class="nx">UpdateAll</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">cols</span><span class="w"> </span><span class="nx">M</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">int64</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-65-3" name="__codelineno-65-3"></a><span class="w">    </span><span class="nx">ln</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">int64</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">o</span><span class="p">))</span>
<a id="__codelineno-65-4" name="__codelineno-65-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">ln</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-65-5" name="__codelineno-65-5"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-65-6" name="__codelineno-65-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-65-7" name="__codelineno-65-7"></a>
<a id="__codelineno-65-8" name="__codelineno-65-8"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">cols</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-65-9" name="__codelineno-65-9"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;models: update all requires at least one column argument&quot;</span><span class="p">)</span>
<a id="__codelineno-65-10" name="__codelineno-65-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-65-11" name="__codelineno-65-11"></a>
<a id="__codelineno-65-12" name="__codelineno-65-12"></a><span class="w">    </span><span class="nx">colNames</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">cols</span><span class="p">))</span>
<a id="__codelineno-65-13" name="__codelineno-65-13"></a><span class="w">    </span><span class="nx">args</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">make</span><span class="p">([]</span><span class="kd">interface</span><span class="p">{},</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">cols</span><span class="p">))</span>
<a id="__codelineno-65-14" name="__codelineno-65-14"></a>
<a id="__codelineno-65-15" name="__codelineno-65-15"></a><span class="w">    </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span>
<a id="__codelineno-65-16" name="__codelineno-65-16"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">cols</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-65-17" name="__codelineno-65-17"></a><span class="w">        </span><span class="nx">colNames</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">name</span>
<a id="__codelineno-65-18" name="__codelineno-65-18"></a><span class="w">        </span><span class="nx">args</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">value</span>
<a id="__codelineno-65-19" name="__codelineno-65-19"></a><span class="w">        </span><span class="nx">i</span><span class="o">++</span>
<a id="__codelineno-65-20" name="__codelineno-65-20"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-65-21" name="__codelineno-65-21"></a>
<a id="__codelineno-65-22" name="__codelineno-65-22"></a><span class="w">    </span><span class="c1">// Append all of the primary key values for each column</span>
<a id="__codelineno-65-23" name="__codelineno-65-23"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">o</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-65-24" name="__codelineno-65-24"></a><span class="w">        </span><span class="nx">pkeyArgs</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">ValuesFromMapping</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">Indirect</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="nx">obj</span><span class="p">)),</span><span class="w"> </span><span class="nx">pointPrimaryKeyMapping</span><span class="p">)</span>
<a id="__codelineno-65-25" name="__codelineno-65-25"></a><span class="w">        </span><span class="nx">args</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span><span class="w"> </span><span class="nx">pkeyArgs</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-65-26" name="__codelineno-65-26"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-65-27" name="__codelineno-65-27"></a>
<a id="__codelineno-65-28" name="__codelineno-65-28"></a><span class="w">    </span><span class="nx">sql</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;UPDATE `points` SET %s WHERE %s&quot;</span><span class="p">,</span>
<a id="__codelineno-65-29" name="__codelineno-65-29"></a><span class="w">        </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">SetParamNames</span><span class="p">(</span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">colNames</span><span class="p">),</span>
<a id="__codelineno-65-30" name="__codelineno-65-30"></a><span class="w">        </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">WhereClauseRepeated</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">dialect</span><span class="p">.</span><span class="nx">LQ</span><span class="p">),</span><span class="w"> </span><span class="nb">string</span><span class="p">(</span><span class="nx">dialect</span><span class="p">.</span><span class="nx">RQ</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">pointPrimaryKeyColumns</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">o</span><span class="p">)))</span>
<a id="__codelineno-65-31" name="__codelineno-65-31"></a>
<a id="__codelineno-65-32" name="__codelineno-65-32"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">IsDebug</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-65-33" name="__codelineno-65-33"></a><span class="w">        </span><span class="nx">writer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">DebugWriterFrom</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<a id="__codelineno-65-34" name="__codelineno-65-34"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">)</span>
<a id="__codelineno-65-35" name="__codelineno-65-35"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-65-36" name="__codelineno-65-36"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-65-37" name="__codelineno-65-37"></a><span class="w">    </span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">exec</span><span class="p">.</span><span class="nx">ExecContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-65-38" name="__codelineno-65-38"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-65-39" name="__codelineno-65-39"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to update all in point slice&quot;</span><span class="p">)</span>
<a id="__codelineno-65-40" name="__codelineno-65-40"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-65-41" name="__codelineno-65-41"></a>
<a id="__codelineno-65-42" name="__codelineno-65-42"></a><span class="w">    </span><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">RowsAffected</span><span class="p">()</span>
<a id="__codelineno-65-43" name="__codelineno-65-43"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-65-44" name="__codelineno-65-44"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to retrieve rows affected all in update all point&quot;</span><span class="p">)</span>
<a id="__codelineno-65-45" name="__codelineno-65-45"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-65-46" name="__codelineno-65-46"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-65-47" name="__codelineno-65-47"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="_55">解説</h4>
<ul>
<li>
<p><strong>関数の概要</strong>: <code>Point</code>のスライス<code>PointSlice</code>内のすべてのレコードを指定したカラムと値で一括更新します。</p>
</li>
<li>
<p><strong>引数</strong>:</p>
</li>
<li><code>ctx context.Context</code>: コンテキスト情報。</li>
<li><code>exec boil.ContextExecutor</code>: データベース操作を実行するためのエグゼキュータ。</li>
<li>
<p><code>cols M</code>: 更新するカラム名と新しい値のマップ。</p>
</li>
<li>
<p><strong>処理の流れ</strong>:</p>
</li>
<li><strong>スライスの長さを確認</strong>:<ul>
<li>スライスが空の場合、何もせずに終了します。</li>
</ul>
</li>
<li><strong>更新するカラムが指定されているか確認</strong>:<ul>
<li>カラムが指定されていない場合、エラーを返します。</li>
</ul>
</li>
<li><strong>カラム名と値の抽出</strong>:<ul>
<li>更新するカラム名とそれに対応する値を抽出します。</li>
</ul>
</li>
<li><strong>主キー値の収集</strong>:<ul>
<li>各<code>Point</code>オブジェクトの主キー値を抽出し、<code>args</code>に追加します。</li>
</ul>
</li>
<li><strong>SQLクエリの構築</strong>:<ul>
<li>更新クエリを構築し、WHERE句で各レコードを識別します。</li>
</ul>
</li>
<li><strong>デバッグ情報の出力</strong>:<ul>
<li>デバッグモードの場合、クエリと引数を出力します。</li>
</ul>
</li>
<li><strong>データベースへの更新実行</strong>:<ul>
<li><code>exec.ExecContext</code>を使用してデータを更新します。</li>
</ul>
</li>
<li><strong>影響を受けた行数の取得</strong>:<ul>
<li>更新操作によって影響を受けた行数を取得します。</li>
</ul>
</li>
<li>
<p><strong>行数を返す</strong>:</p>
<ul>
<li>更新によって影響を受けた行数を返します。</li>
</ul>
</li>
<li>
<p><strong>注意点</strong>:</p>
</li>
<li>このメソッドは、各<code>Point</code>オブジェクトの主キーを使用して個別にレコードを更新します。</li>
</ul>
<h4 id="_56">利用例</h4>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-66-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-66-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-66-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-66-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-66-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-66-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-66-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-66-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-66-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-66-10">10</a></span>
<span class="normal"><a href="#__codelineno-66-11">11</a></span>
<span class="normal"><a href="#__codelineno-66-12">12</a></span>
<span class="normal"><a href="#__codelineno-66-13">13</a></span>
<span class="normal"><a href="#__codelineno-66-14">14</a></span>
<span class="normal"><a href="#__codelineno-66-15">15</a></span>
<span class="normal"><a href="#__codelineno-66-16">16</a></span>
<span class="normal"><a href="#__codelineno-66-17">17</a></span>
<span class="normal"><a href="#__codelineno-66-18">18</a></span>
<span class="normal"><a href="#__codelineno-66-19">19</a></span>
<span class="normal"><a href="#__codelineno-66-20">20</a></span>
<span class="normal"><a href="#__codelineno-66-21">21</a></span>
<span class="normal"><a href="#__codelineno-66-22">22</a></span>
<span class="normal"><a href="#__codelineno-66-23">23</a></span>
<span class="normal"><a href="#__codelineno-66-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1"></a><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-66-2" name="__codelineno-66-2"></a><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">sql</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;mysql&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user:password@/dbname&quot;</span><span class="p">)</span>
<a id="__codelineno-66-3" name="__codelineno-66-3"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-66-4" name="__codelineno-66-4"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-66-5" name="__codelineno-66-5"></a><span class="p">}</span>
<a id="__codelineno-66-6" name="__codelineno-66-6"></a>
<a id="__codelineno-66-7" name="__codelineno-66-7"></a><span class="c1">// 更新したいポイントのスライスを作成</span>
<a id="__codelineno-66-8" name="__codelineno-66-8"></a><span class="nx">points</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Points</span><span class="p">(</span><span class="nx">qm</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;score &lt; ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">)).</span><span class="nx">All</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-66-9" name="__codelineno-66-9"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-66-10" name="__codelineno-66-10"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">&quot;エラー: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-66-11" name="__codelineno-66-11"></a><span class="p">}</span>
<a id="__codelineno-66-12" name="__codelineno-66-12"></a>
<a id="__codelineno-66-13" name="__codelineno-66-13"></a><span class="c1">// 更新するカラムと値を指定</span>
<a id="__codelineno-66-14" name="__codelineno-66-14"></a><span class="nx">cols</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">M</span><span class="p">{</span>
<a id="__codelineno-66-15" name="__codelineno-66-15"></a><span class="w">    </span><span class="s">&quot;score&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">75</span><span class="p">,</span>
<a id="__codelineno-66-16" name="__codelineno-66-16"></a><span class="p">}</span>
<a id="__codelineno-66-17" name="__codelineno-66-17"></a>
<a id="__codelineno-66-18" name="__codelineno-66-18"></a><span class="c1">// ポイントスライスを一括更新</span>
<a id="__codelineno-66-19" name="__codelineno-66-19"></a><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">points</span><span class="p">.</span><span class="nx">UpdateAll</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">cols</span><span class="p">)</span>
<a id="__codelineno-66-20" name="__codelineno-66-20"></a><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-66-21" name="__codelineno-66-21"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">&quot;エラー: %v&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="__codelineno-66-22" name="__codelineno-66-22"></a><span class="p">}</span>
<a id="__codelineno-66-23" name="__codelineno-66-23"></a>
<a id="__codelineno-66-24" name="__codelineno-66-24"></a><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;更新された行数: %d\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">rowsAff</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<hr />
<h3 id="mysqlpoint">MySQLにおけるPointテーブルのユニークカラム</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-67-1">1</a></span>
<span class="normal"><a href="#__codelineno-67-2">2</a></span>
<span class="normal"><a href="#__codelineno-67-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">mySQLPointUniqueColumns</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span>
<a id="__codelineno-67-2" name="__codelineno-67-2"></a><span class="w">    </span><span class="s">&quot;user_id&quot;</span><span class="p">,</span>
<a id="__codelineno-67-3" name="__codelineno-67-3"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h4 id="_57">解説</h4>
<ul>
<li>
<p><strong>変数の概要</strong>: <code>mySQLPointUniqueColumns</code>は、MySQLデータベースにおいて<code>points</code>テーブルのユニーク制約が設定されているカラムのリストを表します。</p>
</li>
<li>
<p><strong>内容</strong>:</p>
</li>
<li>
<p><code>"user_id"</code>: <code>user_id</code>カラムがユニーク制約を持っていることを示しています。</p>
</li>
<li>
<p><strong>用途</strong>:</p>
</li>
<li>この変数は、ORM（Object-Relational Mapping）やその他のデータベース操作で、特定のカラムがユニークであることをプログラム的に判断するために使用されます。</li>
</ul>
<h4 id="_58">利用例</h4>
<p>ユニーク制約を考慮してデータを挿入する場合や、ユニークキーに基づいてレコードを取得・更新する場合に、この情報を使用して適切な処理を行います。</p>
<hr />
<h1 id="_59">コード解説と使用例</h1>
<p>以下のコードは、Go言語で書かれたORM（Object-Relational Mapping）ライブラリである<code>boil</code>を使用して、データベース操作を行う関数群です。特に、<code>Point</code>というデータモデルに対するアップサート（Upsert）、削除、リロード操作に焦点を当てています。このドキュメントでは、各関数の詳細な解説と、開発者向けの使用例を提供します。</p>
<hr />
<h2 id="_60">目次</h2>
<ul>
<li><code>Upsert</code>関数の詳細解説</li>
<li><code>Delete</code>関数の詳細解説</li>
<li><code>DeleteAll</code>関数の詳細解説</li>
<li><code>Reload</code>関数の詳細解説</li>
<li><code>ReloadAll</code>関数の詳細解説</li>
<li>使用例</li>
</ul>
<hr />
<h2 id="upsert"><code>Upsert</code>関数の詳細解説</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-68-1">  1</a></span>
<span class="normal"><a href="#__codelineno-68-2">  2</a></span>
<span class="normal"><a href="#__codelineno-68-3">  3</a></span>
<span class="normal"><a href="#__codelineno-68-4">  4</a></span>
<span class="normal"><a href="#__codelineno-68-5">  5</a></span>
<span class="normal"><a href="#__codelineno-68-6">  6</a></span>
<span class="normal"><a href="#__codelineno-68-7">  7</a></span>
<span class="normal"><a href="#__codelineno-68-8">  8</a></span>
<span class="normal"><a href="#__codelineno-68-9">  9</a></span>
<span class="normal"><a href="#__codelineno-68-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-68-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-68-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-68-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-68-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-68-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-68-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-68-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-68-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-68-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-68-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-68-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-68-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-68-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-68-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-68-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-68-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-68-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-68-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-68-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-68-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-68-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-68-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-68-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-68-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-68-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-68-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-68-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-68-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-68-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-68-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-68-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-68-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-68-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-68-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-68-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-68-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-68-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-68-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-68-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-68-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-68-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-68-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-68-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-68-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-68-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-68-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-68-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-68-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-68-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-68-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-68-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-68-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-68-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-68-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-68-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-68-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-68-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-68-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-68-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-68-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-68-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-68-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-68-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-68-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-68-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-68-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-68-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-68-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-68-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-68-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-68-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-68-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-68-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-68-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-68-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-68-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-68-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-68-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-68-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-68-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-68-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-68-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-68-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-68-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-68-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-68-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-68-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-68-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-68-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-68-100">100</a></span>
<span class="normal"><a href="#__codelineno-68-101">101</a></span>
<span class="normal"><a href="#__codelineno-68-102">102</a></span>
<span class="normal"><a href="#__codelineno-68-103">103</a></span>
<span class="normal"><a href="#__codelineno-68-104">104</a></span>
<span class="normal"><a href="#__codelineno-68-105">105</a></span>
<span class="normal"><a href="#__codelineno-68-106">106</a></span>
<span class="normal"><a href="#__codelineno-68-107">107</a></span>
<span class="normal"><a href="#__codelineno-68-108">108</a></span>
<span class="normal"><a href="#__codelineno-68-109">109</a></span>
<span class="normal"><a href="#__codelineno-68-110">110</a></span>
<span class="normal"><a href="#__codelineno-68-111">111</a></span>
<span class="normal"><a href="#__codelineno-68-112">112</a></span>
<span class="normal"><a href="#__codelineno-68-113">113</a></span>
<span class="normal"><a href="#__codelineno-68-114">114</a></span>
<span class="normal"><a href="#__codelineno-68-115">115</a></span>
<span class="normal"><a href="#__codelineno-68-116">116</a></span>
<span class="normal"><a href="#__codelineno-68-117">117</a></span>
<span class="normal"><a href="#__codelineno-68-118">118</a></span>
<span class="normal"><a href="#__codelineno-68-119">119</a></span>
<span class="normal"><a href="#__codelineno-68-120">120</a></span>
<span class="normal"><a href="#__codelineno-68-121">121</a></span>
<span class="normal"><a href="#__codelineno-68-122">122</a></span>
<span class="normal"><a href="#__codelineno-68-123">123</a></span>
<span class="normal"><a href="#__codelineno-68-124">124</a></span>
<span class="normal"><a href="#__codelineno-68-125">125</a></span>
<span class="normal"><a href="#__codelineno-68-126">126</a></span>
<span class="normal"><a href="#__codelineno-68-127">127</a></span>
<span class="normal"><a href="#__codelineno-68-128">128</a></span>
<span class="normal"><a href="#__codelineno-68-129">129</a></span>
<span class="normal"><a href="#__codelineno-68-130">130</a></span>
<span class="normal"><a href="#__codelineno-68-131">131</a></span>
<span class="normal"><a href="#__codelineno-68-132">132</a></span>
<span class="normal"><a href="#__codelineno-68-133">133</a></span>
<span class="normal"><a href="#__codelineno-68-134">134</a></span>
<span class="normal"><a href="#__codelineno-68-135">135</a></span>
<span class="normal"><a href="#__codelineno-68-136">136</a></span>
<span class="normal"><a href="#__codelineno-68-137">137</a></span>
<span class="normal"><a href="#__codelineno-68-138">138</a></span>
<span class="normal"><a href="#__codelineno-68-139">139</a></span>
<span class="normal"><a href="#__codelineno-68-140">140</a></span>
<span class="normal"><a href="#__codelineno-68-141">141</a></span>
<span class="normal"><a href="#__codelineno-68-142">142</a></span>
<span class="normal"><a href="#__codelineno-68-143">143</a></span>
<span class="normal"><a href="#__codelineno-68-144">144</a></span>
<span class="normal"><a href="#__codelineno-68-145">145</a></span>
<span class="normal"><a href="#__codelineno-68-146">146</a></span>
<span class="normal"><a href="#__codelineno-68-147">147</a></span>
<span class="normal"><a href="#__codelineno-68-148">148</a></span>
<span class="normal"><a href="#__codelineno-68-149">149</a></span>
<span class="normal"><a href="#__codelineno-68-150">150</a></span>
<span class="normal"><a href="#__codelineno-68-151">151</a></span>
<span class="normal"><a href="#__codelineno-68-152">152</a></span>
<span class="normal"><a href="#__codelineno-68-153">153</a></span>
<span class="normal"><a href="#__codelineno-68-154">154</a></span>
<span class="normal"><a href="#__codelineno-68-155">155</a></span>
<span class="normal"><a href="#__codelineno-68-156">156</a></span>
<span class="normal"><a href="#__codelineno-68-157">157</a></span>
<span class="normal"><a href="#__codelineno-68-158">158</a></span>
<span class="normal"><a href="#__codelineno-68-159">159</a></span>
<span class="normal"><a href="#__codelineno-68-160">160</a></span>
<span class="normal"><a href="#__codelineno-68-161">161</a></span>
<span class="normal"><a href="#__codelineno-68-162">162</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">Point</span><span class="p">)</span><span class="w"> </span><span class="nx">Upsert</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">updateColumns</span><span class="p">,</span><span class="w"> </span><span class="nx">insertColumns</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">Columns</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-68-2" name="__codelineno-68-2"></a><span class="w">    </span><span class="c1">// nilチェック：Pointオブジェクトが提供されているか確認</span>
<a id="__codelineno-68-3" name="__codelineno-68-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">o</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-68-4" name="__codelineno-68-4"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;models: no points provided for upsert&quot;</span><span class="p">)</span>
<a id="__codelineno-68-5" name="__codelineno-68-5"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-68-6" name="__codelineno-68-6"></a>
<a id="__codelineno-68-7" name="__codelineno-68-7"></a><span class="w">    </span><span class="c1">// タイムスタンプの設定：作成日時と更新日時を設定</span>
<a id="__codelineno-68-8" name="__codelineno-68-8"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">boil</span><span class="p">.</span><span class="nx">TimestampsAreSkipped</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-68-9" name="__codelineno-68-9"></a><span class="w">        </span><span class="nx">currTime</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">In</span><span class="p">(</span><span class="nx">boil</span><span class="p">.</span><span class="nx">GetLocation</span><span class="p">())</span>
<a id="__codelineno-68-10" name="__codelineno-68-10"></a>
<a id="__codelineno-68-11" name="__codelineno-68-11"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">CreatedAt</span><span class="p">.</span><span class="nx">IsZero</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-68-12" name="__codelineno-68-12"></a><span class="w">            </span><span class="nx">o</span><span class="p">.</span><span class="nx">CreatedAt</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">currTime</span>
<a id="__codelineno-68-13" name="__codelineno-68-13"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-68-14" name="__codelineno-68-14"></a><span class="w">        </span><span class="nx">o</span><span class="p">.</span><span class="nx">UpdatedAt</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">currTime</span>
<a id="__codelineno-68-15" name="__codelineno-68-15"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-68-16" name="__codelineno-68-16"></a>
<a id="__codelineno-68-17" name="__codelineno-68-17"></a><span class="w">    </span><span class="c1">// Upsert前のフック処理を実行</span>
<a id="__codelineno-68-18" name="__codelineno-68-18"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">doBeforeUpsertHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-68-19" name="__codelineno-68-19"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-68-20" name="__codelineno-68-20"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-68-21" name="__codelineno-68-21"></a>
<a id="__codelineno-68-22" name="__codelineno-68-22"></a><span class="w">    </span><span class="c1">// 非ゼロのデフォルト値とユニークキーのセットを取得</span>
<a id="__codelineno-68-23" name="__codelineno-68-23"></a><span class="w">    </span><span class="nx">nzDefaults</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">NonZeroDefaultSet</span><span class="p">(</span><span class="nx">pointColumnsWithDefault</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">)</span>
<a id="__codelineno-68-24" name="__codelineno-68-24"></a><span class="w">    </span><span class="nx">nzUniques</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">NonZeroDefaultSet</span><span class="p">(</span><span class="nx">mySQLPointUniqueColumns</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">)</span>
<a id="__codelineno-68-25" name="__codelineno-68-25"></a>
<a id="__codelineno-68-26" name="__codelineno-68-26"></a><span class="w">    </span><span class="c1">// ユニークキーが存在しない場合はエラーを返す</span>
<a id="__codelineno-68-27" name="__codelineno-68-27"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">nzUniques</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-68-28" name="__codelineno-68-28"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;cannot upsert with a table that cannot conflict on a unique column&quot;</span><span class="p">)</span>
<a id="__codelineno-68-29" name="__codelineno-68-29"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-68-30" name="__codelineno-68-30"></a>
<a id="__codelineno-68-31" name="__codelineno-68-31"></a><span class="w">    </span><span class="c1">// キャッシュキーの生成</span>
<a id="__codelineno-68-32" name="__codelineno-68-32"></a><span class="w">    </span><span class="nx">buf</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">GetBuffer</span><span class="p">()</span>
<a id="__codelineno-68-33" name="__codelineno-68-33"></a><span class="w">    </span><span class="c1">// updateColumnsとinsertColumnsの情報をキーに含める</span>
<a id="__codelineno-68-34" name="__codelineno-68-34"></a><span class="w">    </span><span class="nx">buf</span><span class="p">.</span><span class="nx">WriteString</span><span class="p">(</span><span class="nx">strconv</span><span class="p">.</span><span class="nx">Itoa</span><span class="p">(</span><span class="nx">updateColumns</span><span class="p">.</span><span class="nx">Kind</span><span class="p">))</span>
<a id="__codelineno-68-35" name="__codelineno-68-35"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">updateColumns</span><span class="p">.</span><span class="nx">Cols</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-68-36" name="__codelineno-68-36"></a><span class="w">        </span><span class="nx">buf</span><span class="p">.</span><span class="nx">WriteString</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span>
<a id="__codelineno-68-37" name="__codelineno-68-37"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-68-38" name="__codelineno-68-38"></a><span class="w">    </span><span class="nx">buf</span><span class="p">.</span><span class="nx">WriteByte</span><span class="p">(</span><span class="sc">&#39;.&#39;</span><span class="p">)</span>
<a id="__codelineno-68-39" name="__codelineno-68-39"></a><span class="w">    </span><span class="nx">buf</span><span class="p">.</span><span class="nx">WriteString</span><span class="p">(</span><span class="nx">strconv</span><span class="p">.</span><span class="nx">Itoa</span><span class="p">(</span><span class="nx">insertColumns</span><span class="p">.</span><span class="nx">Kind</span><span class="p">))</span>
<a id="__codelineno-68-40" name="__codelineno-68-40"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">insertColumns</span><span class="p">.</span><span class="nx">Cols</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-68-41" name="__codelineno-68-41"></a><span class="w">        </span><span class="nx">buf</span><span class="p">.</span><span class="nx">WriteString</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span>
<a id="__codelineno-68-42" name="__codelineno-68-42"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-68-43" name="__codelineno-68-43"></a><span class="w">    </span><span class="nx">buf</span><span class="p">.</span><span class="nx">WriteByte</span><span class="p">(</span><span class="sc">&#39;.&#39;</span><span class="p">)</span>
<a id="__codelineno-68-44" name="__codelineno-68-44"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">nzDefaults</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-68-45" name="__codelineno-68-45"></a><span class="w">        </span><span class="nx">buf</span><span class="p">.</span><span class="nx">WriteString</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span>
<a id="__codelineno-68-46" name="__codelineno-68-46"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-68-47" name="__codelineno-68-47"></a><span class="w">    </span><span class="nx">buf</span><span class="p">.</span><span class="nx">WriteByte</span><span class="p">(</span><span class="sc">&#39;.&#39;</span><span class="p">)</span>
<a id="__codelineno-68-48" name="__codelineno-68-48"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">nzUniques</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-68-49" name="__codelineno-68-49"></a><span class="w">        </span><span class="nx">buf</span><span class="p">.</span><span class="nx">WriteString</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span>
<a id="__codelineno-68-50" name="__codelineno-68-50"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-68-51" name="__codelineno-68-51"></a><span class="w">    </span><span class="nx">key</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">buf</span><span class="p">.</span><span class="nx">String</span><span class="p">()</span>
<a id="__codelineno-68-52" name="__codelineno-68-52"></a><span class="w">    </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">PutBuffer</span><span class="p">(</span><span class="nx">buf</span><span class="p">)</span>
<a id="__codelineno-68-53" name="__codelineno-68-53"></a>
<a id="__codelineno-68-54" name="__codelineno-68-54"></a><span class="w">    </span><span class="c1">// キャッシュのチェック</span>
<a id="__codelineno-68-55" name="__codelineno-68-55"></a><span class="w">    </span><span class="nx">pointUpsertCacheMut</span><span class="p">.</span><span class="nx">RLock</span><span class="p">()</span>
<a id="__codelineno-68-56" name="__codelineno-68-56"></a><span class="w">    </span><span class="nx">cache</span><span class="p">,</span><span class="w"> </span><span class="nx">cached</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">pointUpsertCache</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
<a id="__codelineno-68-57" name="__codelineno-68-57"></a><span class="w">    </span><span class="nx">pointUpsertCacheMut</span><span class="p">.</span><span class="nx">RUnlock</span><span class="p">()</span>
<a id="__codelineno-68-58" name="__codelineno-68-58"></a>
<a id="__codelineno-68-59" name="__codelineno-68-59"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span>
<a id="__codelineno-68-60" name="__codelineno-68-60"></a>
<a id="__codelineno-68-61" name="__codelineno-68-61"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">cached</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-68-62" name="__codelineno-68-62"></a><span class="w">        </span><span class="c1">// 挿入および更新するカラムのセットを作成</span>
<a id="__codelineno-68-63" name="__codelineno-68-63"></a><span class="w">        </span><span class="nx">insert</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">insertColumns</span><span class="p">.</span><span class="nx">InsertColumnSet</span><span class="p">(</span>
<a id="__codelineno-68-64" name="__codelineno-68-64"></a><span class="w">            </span><span class="nx">pointAllColumns</span><span class="p">,</span>
<a id="__codelineno-68-65" name="__codelineno-68-65"></a><span class="w">            </span><span class="nx">pointColumnsWithDefault</span><span class="p">,</span>
<a id="__codelineno-68-66" name="__codelineno-68-66"></a><span class="w">            </span><span class="nx">pointColumnsWithoutDefault</span><span class="p">,</span>
<a id="__codelineno-68-67" name="__codelineno-68-67"></a><span class="w">            </span><span class="nx">nzDefaults</span><span class="p">,</span>
<a id="__codelineno-68-68" name="__codelineno-68-68"></a><span class="w">        </span><span class="p">)</span>
<a id="__codelineno-68-69" name="__codelineno-68-69"></a>
<a id="__codelineno-68-70" name="__codelineno-68-70"></a><span class="w">        </span><span class="nx">update</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">updateColumns</span><span class="p">.</span><span class="nx">UpdateColumnSet</span><span class="p">(</span>
<a id="__codelineno-68-71" name="__codelineno-68-71"></a><span class="w">            </span><span class="nx">pointAllColumns</span><span class="p">,</span>
<a id="__codelineno-68-72" name="__codelineno-68-72"></a><span class="w">            </span><span class="nx">pointPrimaryKeyColumns</span><span class="p">,</span>
<a id="__codelineno-68-73" name="__codelineno-68-73"></a><span class="w">        </span><span class="p">)</span>
<a id="__codelineno-68-74" name="__codelineno-68-74"></a>
<a id="__codelineno-68-75" name="__codelineno-68-75"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">updateColumns</span><span class="p">.</span><span class="nx">IsNone</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">update</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-68-76" name="__codelineno-68-76"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;models: unable to upsert points, could not build update column list&quot;</span><span class="p">)</span>
<a id="__codelineno-68-77" name="__codelineno-68-77"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-68-78" name="__codelineno-68-78"></a>
<a id="__codelineno-68-79" name="__codelineno-68-79"></a><span class="w">        </span><span class="c1">// 戻り値のカラムを決定</span>
<a id="__codelineno-68-80" name="__codelineno-68-80"></a><span class="w">        </span><span class="nx">ret</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">SetComplement</span><span class="p">(</span><span class="nx">pointAllColumns</span><span class="p">,</span><span class="w"> </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">SetIntersect</span><span class="p">(</span><span class="nx">insert</span><span class="p">,</span><span class="w"> </span><span class="nx">update</span><span class="p">))</span>
<a id="__codelineno-68-81" name="__codelineno-68-81"></a>
<a id="__codelineno-68-82" name="__codelineno-68-82"></a><span class="w">        </span><span class="c1">// Upsertクエリを構築</span>
<a id="__codelineno-68-83" name="__codelineno-68-83"></a><span class="w">        </span><span class="nx">cache</span><span class="p">.</span><span class="nx">query</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">buildUpsertQueryMySQL</span><span class="p">(</span><span class="nx">dialect</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;`points`&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">update</span><span class="p">,</span><span class="w"> </span><span class="nx">insert</span><span class="p">)</span>
<a id="__codelineno-68-84" name="__codelineno-68-84"></a><span class="w">        </span><span class="nx">cache</span><span class="p">.</span><span class="nx">retQuery</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span>
<a id="__codelineno-68-85" name="__codelineno-68-85"></a><span class="w">            </span><span class="s">&quot;SELECT %s FROM `points` WHERE %s&quot;</span><span class="p">,</span>
<a id="__codelineno-68-86" name="__codelineno-68-86"></a><span class="w">            </span><span class="nx">strings</span><span class="p">.</span><span class="nx">Join</span><span class="p">(</span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">IdentQuoteSlice</span><span class="p">(</span><span class="nx">dialect</span><span class="p">.</span><span class="nx">LQ</span><span class="p">,</span><span class="w"> </span><span class="nx">dialect</span><span class="p">.</span><span class="nx">RQ</span><span class="p">,</span><span class="w"> </span><span class="nx">ret</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;,&quot;</span><span class="p">),</span>
<a id="__codelineno-68-87" name="__codelineno-68-87"></a><span class="w">            </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">WhereClause</span><span class="p">(</span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;`&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">nzUniques</span><span class="p">),</span>
<a id="__codelineno-68-88" name="__codelineno-68-88"></a><span class="w">        </span><span class="p">)</span>
<a id="__codelineno-68-89" name="__codelineno-68-89"></a>
<a id="__codelineno-68-90" name="__codelineno-68-90"></a><span class="w">        </span><span class="c1">// マッピングの作成</span>
<a id="__codelineno-68-91" name="__codelineno-68-91"></a><span class="w">        </span><span class="nx">cache</span><span class="p">.</span><span class="nx">valueMapping</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">BindMapping</span><span class="p">(</span><span class="nx">pointType</span><span class="p">,</span><span class="w"> </span><span class="nx">pointMapping</span><span class="p">,</span><span class="w"> </span><span class="nx">insert</span><span class="p">)</span>
<a id="__codelineno-68-92" name="__codelineno-68-92"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-68-93" name="__codelineno-68-93"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-68-94" name="__codelineno-68-94"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-68-95" name="__codelineno-68-95"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">ret</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-68-96" name="__codelineno-68-96"></a><span class="w">            </span><span class="nx">cache</span><span class="p">.</span><span class="nx">retMapping</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">BindMapping</span><span class="p">(</span><span class="nx">pointType</span><span class="p">,</span><span class="w"> </span><span class="nx">pointMapping</span><span class="p">,</span><span class="w"> </span><span class="nx">ret</span><span class="p">)</span>
<a id="__codelineno-68-97" name="__codelineno-68-97"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-68-98" name="__codelineno-68-98"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-68-99" name="__codelineno-68-99"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-68-100" name="__codelineno-68-100"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-68-101" name="__codelineno-68-101"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-68-102" name="__codelineno-68-102"></a>
<a id="__codelineno-68-103" name="__codelineno-68-103"></a><span class="w">    </span><span class="c1">// 値と戻り値の取得</span>
<a id="__codelineno-68-104" name="__codelineno-68-104"></a><span class="w">    </span><span class="nx">value</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">reflect</span><span class="p">.</span><span class="nx">Indirect</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="nx">o</span><span class="p">))</span>
<a id="__codelineno-68-105" name="__codelineno-68-105"></a><span class="w">    </span><span class="nx">vals</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">ValuesFromMapping</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">valueMapping</span><span class="p">)</span>
<a id="__codelineno-68-106" name="__codelineno-68-106"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">returns</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}</span>
<a id="__codelineno-68-107" name="__codelineno-68-107"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">cache</span><span class="p">.</span><span class="nx">retMapping</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-68-108" name="__codelineno-68-108"></a><span class="w">        </span><span class="nx">returns</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">PtrsFromMapping</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">retMapping</span><span class="p">)</span>
<a id="__codelineno-68-109" name="__codelineno-68-109"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-68-110" name="__codelineno-68-110"></a>
<a id="__codelineno-68-111" name="__codelineno-68-111"></a><span class="w">    </span><span class="c1">// デバッグログの出力</span>
<a id="__codelineno-68-112" name="__codelineno-68-112"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">IsDebug</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-68-113" name="__codelineno-68-113"></a><span class="w">        </span><span class="nx">writer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">DebugWriterFrom</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<a id="__codelineno-68-114" name="__codelineno-68-114"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">query</span><span class="p">)</span>
<a id="__codelineno-68-115" name="__codelineno-68-115"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">vals</span><span class="p">)</span>
<a id="__codelineno-68-116" name="__codelineno-68-116"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-68-117" name="__codelineno-68-117"></a>
<a id="__codelineno-68-118" name="__codelineno-68-118"></a><span class="w">    </span><span class="c1">// クエリの実行</span>
<a id="__codelineno-68-119" name="__codelineno-68-119"></a><span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">exec</span><span class="p">.</span><span class="nx">ExecContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">query</span><span class="p">,</span><span class="w"> </span><span class="nx">vals</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-68-120" name="__codelineno-68-120"></a>
<a id="__codelineno-68-121" name="__codelineno-68-121"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-68-122" name="__codelineno-68-122"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to upsert for points&quot;</span><span class="p">)</span>
<a id="__codelineno-68-123" name="__codelineno-68-123"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-68-124" name="__codelineno-68-124"></a>
<a id="__codelineno-68-125" name="__codelineno-68-125"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">uniqueMap</span><span class="w"> </span><span class="p">[]</span><span class="kt">uint64</span>
<a id="__codelineno-68-126" name="__codelineno-68-126"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">nzUniqueCols</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}</span>
<a id="__codelineno-68-127" name="__codelineno-68-127"></a>
<a id="__codelineno-68-128" name="__codelineno-68-128"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">cache</span><span class="p">.</span><span class="nx">retMapping</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-68-129" name="__codelineno-68-129"></a><span class="w">        </span><span class="k">goto</span><span class="w"> </span><span class="nx">CacheNoHooks</span>
<a id="__codelineno-68-130" name="__codelineno-68-130"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-68-131" name="__codelineno-68-131"></a>
<a id="__codelineno-68-132" name="__codelineno-68-132"></a><span class="w">    </span><span class="c1">// ユニークキーの値を取得</span>
<a id="__codelineno-68-133" name="__codelineno-68-133"></a><span class="w">    </span><span class="nx">uniqueMap</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">BindMapping</span><span class="p">(</span><span class="nx">pointType</span><span class="p">,</span><span class="w"> </span><span class="nx">pointMapping</span><span class="p">,</span><span class="w"> </span><span class="nx">nzUniques</span><span class="p">)</span>
<a id="__codelineno-68-134" name="__codelineno-68-134"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-68-135" name="__codelineno-68-135"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to retrieve unique values for points&quot;</span><span class="p">)</span>
<a id="__codelineno-68-136" name="__codelineno-68-136"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-68-137" name="__codelineno-68-137"></a><span class="w">    </span><span class="nx">nzUniqueCols</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">ValuesFromMapping</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">Indirect</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="nx">o</span><span class="p">)),</span><span class="w"> </span><span class="nx">uniqueMap</span><span class="p">)</span>
<a id="__codelineno-68-138" name="__codelineno-68-138"></a>
<a id="__codelineno-68-139" name="__codelineno-68-139"></a><span class="w">    </span><span class="c1">// デバッグログの出力</span>
<a id="__codelineno-68-140" name="__codelineno-68-140"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">IsDebug</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-68-141" name="__codelineno-68-141"></a><span class="w">        </span><span class="nx">writer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">DebugWriterFrom</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<a id="__codelineno-68-142" name="__codelineno-68-142"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">retQuery</span><span class="p">)</span>
<a id="__codelineno-68-143" name="__codelineno-68-143"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">nzUniqueCols</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-68-144" name="__codelineno-68-144"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-68-145" name="__codelineno-68-145"></a>
<a id="__codelineno-68-146" name="__codelineno-68-146"></a><span class="w">    </span><span class="c1">// デフォルト値の取得</span>
<a id="__codelineno-68-147" name="__codelineno-68-147"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">exec</span><span class="p">.</span><span class="nx">QueryRowContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">cache</span><span class="p">.</span><span class="nx">retQuery</span><span class="p">,</span><span class="w"> </span><span class="nx">nzUniqueCols</span><span class="o">...</span><span class="p">).</span><span class="nx">Scan</span><span class="p">(</span><span class="nx">returns</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-68-148" name="__codelineno-68-148"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-68-149" name="__codelineno-68-149"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to populate default values for points&quot;</span><span class="p">)</span>
<a id="__codelineno-68-150" name="__codelineno-68-150"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-68-151" name="__codelineno-68-151"></a>
<a id="__codelineno-68-152" name="__codelineno-68-152"></a><span class="nx">CacheNoHooks</span><span class="p">:</span>
<a id="__codelineno-68-153" name="__codelineno-68-153"></a><span class="w">    </span><span class="c1">// キャッシュに保存</span>
<a id="__codelineno-68-154" name="__codelineno-68-154"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">cached</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-68-155" name="__codelineno-68-155"></a><span class="w">        </span><span class="nx">pointUpsertCacheMut</span><span class="p">.</span><span class="nx">Lock</span><span class="p">()</span>
<a id="__codelineno-68-156" name="__codelineno-68-156"></a><span class="w">        </span><span class="nx">pointUpsertCache</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">cache</span>
<a id="__codelineno-68-157" name="__codelineno-68-157"></a><span class="w">        </span><span class="nx">pointUpsertCacheMut</span><span class="p">.</span><span class="nx">Unlock</span><span class="p">()</span>
<a id="__codelineno-68-158" name="__codelineno-68-158"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-68-159" name="__codelineno-68-159"></a>
<a id="__codelineno-68-160" name="__codelineno-68-160"></a><span class="w">    </span><span class="c1">// Upsert後のフック処理を実行</span>
<a id="__codelineno-68-161" name="__codelineno-68-161"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">doAfterUpsertHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">)</span>
<a id="__codelineno-68-162" name="__codelineno-68-162"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_61">解説</h3>
<ul>
<li><strong>関数シグネチャ</strong>:</li>
<li><code>Upsert</code>は、<code>Point</code>型のオブジェクトに対してアップサート操作を行います。</li>
<li>
<p>パラメータ：</p>
<ul>
<li><code>ctx</code>：コンテキスト</li>
<li><code>exec</code>：データベース操作を行うためのエグゼキューター</li>
<li><code>updateColumns</code>：更新対象のカラム</li>
<li><code>insertColumns</code>：挿入対象のカラム</li>
</ul>
</li>
<li>
<p><strong>nilチェック</strong>:</p>
</li>
<li>
<p><code>o</code>が<code>nil</code>の場合、エラーを返します。</p>
</li>
<li>
<p><strong>タイムスタンプの設定</strong>:</p>
</li>
<li><code>CreatedAt</code>と<code>UpdatedAt</code>フィールドに現在の時間を設定します。</li>
<li>
<p>これは、オブジェクトの作成および更新日時を自動的に管理するためです。</p>
</li>
<li>
<p><strong>フック処理の呼び出し</strong>:</p>
</li>
<li>
<p><code>doBeforeUpsertHooks</code>：アップサート操作の前に実行されるフック関数を呼び出します。</p>
</li>
<li>
<p><strong>ユニークキーの確認</strong>:</p>
</li>
<li>アップサート操作を行うためには、ユニークキーが必要です。</li>
<li>
<p>ユニークキーが存在しない場合、エラーを返します。</p>
</li>
<li>
<p><strong>キャッシュキーの生成</strong>:</p>
</li>
<li>アップサートクエリのパフォーマンスを改善するために、クエリをキャッシュします。</li>
<li>
<p>キャッシュキーは、更新カラム、挿入カラム、デフォルト値、ユニークキーの組み合わせから構築されます。</p>
</li>
<li>
<p><strong>キャッシュの利用</strong>:</p>
</li>
<li>キャッシュにクエリが存在する場合、それを使用します。</li>
<li>
<p>存在しない場合、新たにクエリを構築し、キャッシュに保存します。</p>
</li>
<li>
<p><strong>クエリの構築</strong>:</p>
</li>
<li><code>buildUpsertQueryMySQL</code>関数を使用して、MySQL用のアップサートクエリを構築します。</li>
<li>
<p>戻り値クエリも構築し、挿入後に自動生成されたIDやデフォルト値を取得します。</p>
</li>
<li>
<p><strong>値のバインディング</strong>:</p>
</li>
<li>
<p><code>BindMapping</code>と<code>ValuesFromMapping</code>を使用して、構造体のフィールドとデータベースカラムのマッピングを行い、値を取得します。</p>
</li>
<li>
<p><strong>デバッグログの出力</strong>:</p>
</li>
<li>
<p>デバッグモードが有効な場合、実行するクエリとバインドする値をログに出力します。</p>
</li>
<li>
<p><strong>クエリの実行</strong>:</p>
</li>
<li>
<p>構築したアップサートクエリを実行します。</p>
</li>
<li>
<p><strong>戻り値の取得</strong>:</p>
</li>
<li>
<p>アップサート後に必要なデフォルト値や自動生成された値を取得します。</p>
</li>
<li>
<p><strong>キャッシュへの保存</strong>:</p>
</li>
<li>
<p>新たに構築したクエリは、キャッシュに保存されます。</p>
</li>
<li>
<p><strong>フック処理の呼び出し（後処理）</strong>:</p>
</li>
<li><code>doAfterUpsertHooks</code>：アップサート操作の後に実行されるフック関数を呼び出します。</li>
</ul>
<hr />
<h2 id="delete_1"><code>Delete</code>関数の詳細解説</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-69-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-69-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-69-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-69-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-69-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-69-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-69-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-69-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-69-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-69-10">10</a></span>
<span class="normal"><a href="#__codelineno-69-11">11</a></span>
<span class="normal"><a href="#__codelineno-69-12">12</a></span>
<span class="normal"><a href="#__codelineno-69-13">13</a></span>
<span class="normal"><a href="#__codelineno-69-14">14</a></span>
<span class="normal"><a href="#__codelineno-69-15">15</a></span>
<span class="normal"><a href="#__codelineno-69-16">16</a></span>
<span class="normal"><a href="#__codelineno-69-17">17</a></span>
<span class="normal"><a href="#__codelineno-69-18">18</a></span>
<span class="normal"><a href="#__codelineno-69-19">19</a></span>
<span class="normal"><a href="#__codelineno-69-20">20</a></span>
<span class="normal"><a href="#__codelineno-69-21">21</a></span>
<span class="normal"><a href="#__codelineno-69-22">22</a></span>
<span class="normal"><a href="#__codelineno-69-23">23</a></span>
<span class="normal"><a href="#__codelineno-69-24">24</a></span>
<span class="normal"><a href="#__codelineno-69-25">25</a></span>
<span class="normal"><a href="#__codelineno-69-26">26</a></span>
<span class="normal"><a href="#__codelineno-69-27">27</a></span>
<span class="normal"><a href="#__codelineno-69-28">28</a></span>
<span class="normal"><a href="#__codelineno-69-29">29</a></span>
<span class="normal"><a href="#__codelineno-69-30">30</a></span>
<span class="normal"><a href="#__codelineno-69-31">31</a></span>
<span class="normal"><a href="#__codelineno-69-32">32</a></span>
<span class="normal"><a href="#__codelineno-69-33">33</a></span>
<span class="normal"><a href="#__codelineno-69-34">34</a></span>
<span class="normal"><a href="#__codelineno-69-35">35</a></span>
<span class="normal"><a href="#__codelineno-69-36">36</a></span>
<span class="normal"><a href="#__codelineno-69-37">37</a></span>
<span class="normal"><a href="#__codelineno-69-38">38</a></span>
<span class="normal"><a href="#__codelineno-69-39">39</a></span>
<span class="normal"><a href="#__codelineno-69-40">40</a></span>
<span class="normal"><a href="#__codelineno-69-41">41</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">Point</span><span class="p">)</span><span class="w"> </span><span class="nx">Delete</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">int64</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-69-2" name="__codelineno-69-2"></a><span class="w">    </span><span class="c1">// nilチェック：Pointオブジェクトが提供されているか確認</span>
<a id="__codelineno-69-3" name="__codelineno-69-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">o</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-69-4" name="__codelineno-69-4"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;models: no Point provided for delete&quot;</span><span class="p">)</span>
<a id="__codelineno-69-5" name="__codelineno-69-5"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-69-6" name="__codelineno-69-6"></a>
<a id="__codelineno-69-7" name="__codelineno-69-7"></a><span class="w">    </span><span class="c1">// 削除前のフック処理を実行</span>
<a id="__codelineno-69-8" name="__codelineno-69-8"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">doBeforeDeleteHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-69-9" name="__codelineno-69-9"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-69-10" name="__codelineno-69-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-69-11" name="__codelineno-69-11"></a>
<a id="__codelineno-69-12" name="__codelineno-69-12"></a><span class="w">    </span><span class="c1">// プライマリキーの値を取得</span>
<a id="__codelineno-69-13" name="__codelineno-69-13"></a><span class="w">    </span><span class="nx">args</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">ValuesFromMapping</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">Indirect</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="nx">o</span><span class="p">)),</span><span class="w"> </span><span class="nx">pointPrimaryKeyMapping</span><span class="p">)</span>
<a id="__codelineno-69-14" name="__codelineno-69-14"></a><span class="w">    </span><span class="nx">sql</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;DELETE FROM `points` WHERE `user_id`=?&quot;</span>
<a id="__codelineno-69-15" name="__codelineno-69-15"></a>
<a id="__codelineno-69-16" name="__codelineno-69-16"></a><span class="w">    </span><span class="c1">// デバッグログの出力</span>
<a id="__codelineno-69-17" name="__codelineno-69-17"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">IsDebug</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-69-18" name="__codelineno-69-18"></a><span class="w">        </span><span class="nx">writer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">DebugWriterFrom</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<a id="__codelineno-69-19" name="__codelineno-69-19"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">)</span>
<a id="__codelineno-69-20" name="__codelineno-69-20"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-69-21" name="__codelineno-69-21"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-69-22" name="__codelineno-69-22"></a>
<a id="__codelineno-69-23" name="__codelineno-69-23"></a><span class="w">    </span><span class="c1">// クエリの実行</span>
<a id="__codelineno-69-24" name="__codelineno-69-24"></a><span class="w">    </span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">exec</span><span class="p">.</span><span class="nx">ExecContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-69-25" name="__codelineno-69-25"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-69-26" name="__codelineno-69-26"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to delete from points&quot;</span><span class="p">)</span>
<a id="__codelineno-69-27" name="__codelineno-69-27"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-69-28" name="__codelineno-69-28"></a>
<a id="__codelineno-69-29" name="__codelineno-69-29"></a><span class="w">    </span><span class="c1">// 影響を受けた行数の取得</span>
<a id="__codelineno-69-30" name="__codelineno-69-30"></a><span class="w">    </span><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">RowsAffected</span><span class="p">()</span>
<a id="__codelineno-69-31" name="__codelineno-69-31"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-69-32" name="__codelineno-69-32"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: failed to get rows affected by delete for points&quot;</span><span class="p">)</span>
<a id="__codelineno-69-33" name="__codelineno-69-33"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-69-34" name="__codelineno-69-34"></a>
<a id="__codelineno-69-35" name="__codelineno-69-35"></a><span class="w">    </span><span class="c1">// 削除後のフック処理を実行</span>
<a id="__codelineno-69-36" name="__codelineno-69-36"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">doAfterDeleteHooks</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-69-37" name="__codelineno-69-37"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-69-38" name="__codelineno-69-38"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-69-39" name="__codelineno-69-39"></a>
<a id="__codelineno-69-40" name="__codelineno-69-40"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-69-41" name="__codelineno-69-41"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_62">解説</h3>
<ul>
<li><strong>関数シグネチャ</strong>:</li>
<li><code>Delete</code>は、<code>Point</code>オブジェクトをデータベースから削除します。</li>
<li>
<p>戻り値は、削除された行数とエラー情報です。</p>
</li>
<li>
<p><strong>nilチェック</strong>:</p>
</li>
<li>
<p><code>o</code>が<code>nil</code>の場合、エラーを返します。</p>
</li>
<li>
<p><strong>フック処理の呼び出し（前処理）</strong>:</p>
</li>
<li>
<p><code>doBeforeDeleteHooks</code>：削除操作の前に実行されるフック関数を呼び出します。</p>
</li>
<li>
<p><strong>クエリの構築</strong>:</p>
</li>
<li>
<p>プライマリキー（<code>user_id</code>）を使用して削除クエリを構築します。</p>
</li>
<li>
<p><strong>デバッグログの出力</strong>:</p>
</li>
<li>
<p>デバッグモードが有効な場合、実行するクエリとバインドする値をログに出力します。</p>
</li>
<li>
<p><strong>クエリの実行</strong>:</p>
</li>
<li>
<p>削除クエリを実行します。</p>
</li>
<li>
<p><strong>影響を受けた行数の取得</strong>:</p>
</li>
<li>
<p><code>RowsAffected</code>を使用して、削除された行数を取得します。</p>
</li>
<li>
<p><strong>フック処理の呼び出し（後処理）</strong>:</p>
</li>
<li><code>doAfterDeleteHooks</code>：削除操作の後に実行されるフック関数を呼び出します。</li>
</ul>
<hr />
<h2 id="deleteall"><code>DeleteAll</code>関数の詳細解説</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-70-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-70-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-70-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-70-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-70-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-70-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-70-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-70-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-70-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-70-10">10</a></span>
<span class="normal"><a href="#__codelineno-70-11">11</a></span>
<span class="normal"><a href="#__codelineno-70-12">12</a></span>
<span class="normal"><a href="#__codelineno-70-13">13</a></span>
<span class="normal"><a href="#__codelineno-70-14">14</a></span>
<span class="normal"><a href="#__codelineno-70-15">15</a></span>
<span class="normal"><a href="#__codelineno-70-16">16</a></span>
<span class="normal"><a href="#__codelineno-70-17">17</a></span>
<span class="normal"><a href="#__codelineno-70-18">18</a></span>
<span class="normal"><a href="#__codelineno-70-19">19</a></span>
<span class="normal"><a href="#__codelineno-70-20">20</a></span>
<span class="normal"><a href="#__codelineno-70-21">21</a></span>
<span class="normal"><a href="#__codelineno-70-22">22</a></span>
<span class="normal"><a href="#__codelineno-70-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">q</span><span class="w"> </span><span class="nx">pointQuery</span><span class="p">)</span><span class="w"> </span><span class="nx">DeleteAll</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">int64</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-70-2" name="__codelineno-70-2"></a><span class="w">    </span><span class="c1">// クエリが存在するか確認</span>
<a id="__codelineno-70-3" name="__codelineno-70-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-70-4" name="__codelineno-70-4"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;models: no pointQuery provided for delete all&quot;</span><span class="p">)</span>
<a id="__codelineno-70-5" name="__codelineno-70-5"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-70-6" name="__codelineno-70-6"></a>
<a id="__codelineno-70-7" name="__codelineno-70-7"></a><span class="w">    </span><span class="c1">// クエリを削除操作に設定</span>
<a id="__codelineno-70-8" name="__codelineno-70-8"></a><span class="w">    </span><span class="nx">queries</span><span class="p">.</span><span class="nx">SetDelete</span><span class="p">(</span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">)</span>
<a id="__codelineno-70-9" name="__codelineno-70-9"></a>
<a id="__codelineno-70-10" name="__codelineno-70-10"></a><span class="w">    </span><span class="c1">// クエリの実行</span>
<a id="__codelineno-70-11" name="__codelineno-70-11"></a><span class="w">    </span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">q</span><span class="p">.</span><span class="nx">Query</span><span class="p">.</span><span class="nx">ExecContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">)</span>
<a id="__codelineno-70-12" name="__codelineno-70-12"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-70-13" name="__codelineno-70-13"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to delete all from points&quot;</span><span class="p">)</span>
<a id="__codelineno-70-14" name="__codelineno-70-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-70-15" name="__codelineno-70-15"></a>
<a id="__codelineno-70-16" name="__codelineno-70-16"></a><span class="w">    </span><span class="c1">// 影響を受けた行数の取得</span>
<a id="__codelineno-70-17" name="__codelineno-70-17"></a><span class="w">    </span><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">RowsAffected</span><span class="p">()</span>
<a id="__codelineno-70-18" name="__codelineno-70-18"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-70-19" name="__codelineno-70-19"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: failed to get rows affected by deleteall for points&quot;</span><span class="p">)</span>
<a id="__codelineno-70-20" name="__codelineno-70-20"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-70-21" name="__codelineno-70-21"></a>
<a id="__codelineno-70-22" name="__codelineno-70-22"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">rowsAff</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-70-23" name="__codelineno-70-23"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_63">解説</h3>
<ul>
<li><strong>関数シグネチャ</strong>:</li>
<li><code>DeleteAll</code>は、<code>pointQuery</code>によって定義された条件にマッチする全てのレコードを削除します。</li>
<li>
<p>戻り値は、削除された行数とエラー情報です。</p>
</li>
<li>
<p><strong>クエリの検証</strong>:</p>
</li>
<li>
<p>クエリが<code>nil</code>の場合、エラーを返します。</p>
</li>
<li>
<p><strong>クエリの設定</strong>:</p>
</li>
<li>
<p><code>SetDelete</code>関数を使用して、クエリを削除操作に設定します。</p>
</li>
<li>
<p><strong>クエリの実行とエラーハンドリング</strong>:</p>
</li>
<li>
<p>クエリを実行し、エラーが発生した場合は詳細なエラー情報を返します。</p>
</li>
<li>
<p><strong>影響を受けた行数の取得</strong>:</p>
</li>
<li><code>RowsAffected</code>を使用して、削除された行数を取得します。</li>
</ul>
<hr />
<h2 id="reload"><code>Reload</code>関数の詳細解説</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-71-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-71-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-71-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-71-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-71-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-71-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-71-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-71-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-71-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-71-10">10</a></span>
<span class="normal"><a href="#__codelineno-71-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">Point</span><span class="p">)</span><span class="w"> </span><span class="nx">Reload</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-71-2" name="__codelineno-71-2"></a><span class="w">    </span><span class="c1">// プライマリキーを使用してデータを再取得</span>
<a id="__codelineno-71-3" name="__codelineno-71-3"></a><span class="w">    </span><span class="nx">ret</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">FindPoint</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">UserID</span><span class="p">)</span>
<a id="__codelineno-71-4" name="__codelineno-71-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-71-5" name="__codelineno-71-5"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-71-6" name="__codelineno-71-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-71-7" name="__codelineno-71-7"></a>
<a id="__codelineno-71-8" name="__codelineno-71-8"></a><span class="w">    </span><span class="c1">// オブジェクトを更新</span>
<a id="__codelineno-71-9" name="__codelineno-71-9"></a><span class="w">    </span><span class="o">*</span><span class="nx">o</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">*</span><span class="nx">ret</span>
<a id="__codelineno-71-10" name="__codelineno-71-10"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-71-11" name="__codelineno-71-11"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_64">解説</h3>
<ul>
<li><strong>関数シグネチャ</strong>:</li>
<li>
<p><code>Reload</code>は、現在の<code>Point</code>オブジェクトをデータベースの最新状態で更新します。</p>
</li>
<li>
<p><strong>データの再取得</strong>:</p>
</li>
<li>
<p><code>FindPoint</code>関数を使用して、プライマリキー（<code>UserID</code>）を元にデータを再取得します。</p>
</li>
<li>
<p><strong>オブジェクトの更新</strong>:</p>
</li>
<li>取得したデータで現在のオブジェクトを上書きします。</li>
</ul>
<hr />
<h2 id="reloadall"><code>ReloadAll</code>関数の詳細解説</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-72-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-72-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-72-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-72-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-72-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-72-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-72-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-72-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-72-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-72-10">10</a></span>
<span class="normal"><a href="#__codelineno-72-11">11</a></span>
<span class="normal"><a href="#__codelineno-72-12">12</a></span>
<span class="normal"><a href="#__codelineno-72-13">13</a></span>
<span class="normal"><a href="#__codelineno-72-14">14</a></span>
<span class="normal"><a href="#__codelineno-72-15">15</a></span>
<span class="normal"><a href="#__codelineno-72-16">16</a></span>
<span class="normal"><a href="#__codelineno-72-17">17</a></span>
<span class="normal"><a href="#__codelineno-72-18">18</a></span>
<span class="normal"><a href="#__codelineno-72-19">19</a></span>
<span class="normal"><a href="#__codelineno-72-20">20</a></span>
<span class="normal"><a href="#__codelineno-72-21">21</a></span>
<span class="normal"><a href="#__codelineno-72-22">22</a></span>
<span class="normal"><a href="#__codelineno-72-23">23</a></span>
<span class="normal"><a href="#__codelineno-72-24">24</a></span>
<span class="normal"><a href="#__codelineno-72-25">25</a></span>
<span class="normal"><a href="#__codelineno-72-26">26</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">PointSlice</span><span class="p">)</span><span class="w"> </span><span class="nx">ReloadAll</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-72-2" name="__codelineno-72-2"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">o</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="o">*</span><span class="nx">o</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-72-3" name="__codelineno-72-3"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-72-4" name="__codelineno-72-4"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-72-5" name="__codelineno-72-5"></a>
<a id="__codelineno-72-6" name="__codelineno-72-6"></a><span class="w">    </span><span class="nx">slice</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">PointSlice</span><span class="p">{}</span>
<a id="__codelineno-72-7" name="__codelineno-72-7"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">args</span><span class="w"> </span><span class="p">[]</span><span class="kd">interface</span><span class="p">{}</span>
<a id="__codelineno-72-8" name="__codelineno-72-8"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">obj</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="o">*</span><span class="nx">o</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-72-9" name="__codelineno-72-9"></a><span class="w">        </span><span class="nx">pkeyArgs</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">ValuesFromMapping</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">Indirect</span><span class="p">(</span><span class="nx">reflect</span><span class="p">.</span><span class="nx">ValueOf</span><span class="p">(</span><span class="nx">obj</span><span class="p">)),</span><span class="w"> </span><span class="nx">pointPrimaryKeyMapping</span><span class="p">)</span>
<a id="__codelineno-72-10" name="__codelineno-72-10"></a><span class="w">        </span><span class="nx">args</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">append</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span><span class="w"> </span><span class="nx">pkeyArgs</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-72-11" name="__codelineno-72-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-72-12" name="__codelineno-72-12"></a>
<a id="__codelineno-72-13" name="__codelineno-72-13"></a><span class="w">    </span><span class="nx">sql</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;SELECT `points`.* FROM `points` WHERE &quot;</span><span class="w"> </span><span class="o">+</span>
<a id="__codelineno-72-14" name="__codelineno-72-14"></a><span class="w">        </span><span class="nx">strmangle</span><span class="p">.</span><span class="nx">WhereClauseRepeated</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">dialect</span><span class="p">.</span><span class="nx">LQ</span><span class="p">),</span><span class="w"> </span><span class="nb">string</span><span class="p">(</span><span class="nx">dialect</span><span class="p">.</span><span class="nx">RQ</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">pointPrimaryKeyColumns</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="o">*</span><span class="nx">o</span><span class="p">))</span>
<a id="__codelineno-72-15" name="__codelineno-72-15"></a>
<a id="__codelineno-72-16" name="__codelineno-72-16"></a><span class="w">    </span><span class="nx">q</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="nx">Raw</span><span class="p">(</span><span class="nx">sql</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="o">...</span><span class="p">)</span>
<a id="__codelineno-72-17" name="__codelineno-72-17"></a>
<a id="__codelineno-72-18" name="__codelineno-72-18"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">q</span><span class="p">.</span><span class="nx">Bind</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">slice</span><span class="p">)</span>
<a id="__codelineno-72-19" name="__codelineno-72-19"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-72-20" name="__codelineno-72-20"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to reload all in PointSlice&quot;</span><span class="p">)</span>
<a id="__codelineno-72-21" name="__codelineno-72-21"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-72-22" name="__codelineno-72-22"></a>
<a id="__codelineno-72-23" name="__codelineno-72-23"></a><span class="w">    </span><span class="o">*</span><span class="nx">o</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">slice</span>
<a id="__codelineno-72-24" name="__codelineno-72-24"></a>
<a id="__codelineno-72-25" name="__codelineno-72-25"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-72-26" name="__codelineno-72-26"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_65">解説</h3>
<ul>
<li><strong>関数シグネチャ</strong>:</li>
<li>
<p><code>ReloadAll</code>は、<code>PointSlice</code>内の全ての<code>Point</code>オブジェクトをデータベースの最新状態で更新します。</p>
</li>
<li>
<p><strong>空チェック</strong>:</p>
</li>
<li>
<p>スライスが<code>nil</code>または空の場合、何もせずに戻ります。</p>
</li>
<li>
<p><strong>プライマリキーの収集</strong>:</p>
</li>
<li>
<p>スライス内の各オブジェクトからプライマリキーの値を収集します。</p>
</li>
<li>
<p><strong>クエリの構築</strong>:</p>
</li>
<li>
<p>プライマリキーのリストを使用して、複数のレコードを取得するためのクエリを構築します。</p>
</li>
<li>
<p><strong>クエリの実行とデータのバインド</strong>:</p>
</li>
<li>
<p>クエリを実行し、取得したデータを新しいスライスにバインドします。</p>
</li>
<li>
<p><strong>オブジェクトの更新</strong>:</p>
</li>
<li>現在のスライスを取得したデータで上書きします。</li>
</ul>
<hr />
<h2 id="_66">使用例</h2>
<h3 id="1-upsert">1. Upsertの使用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-73-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-73-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-73-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-73-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-73-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-73-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-73-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-73-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-73-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-73-10">10</a></span>
<span class="normal"><a href="#__codelineno-73-11">11</a></span>
<span class="normal"><a href="#__codelineno-73-12">12</a></span>
<span class="normal"><a href="#__codelineno-73-13">13</a></span>
<span class="normal"><a href="#__codelineno-73-14">14</a></span>
<span class="normal"><a href="#__codelineno-73-15">15</a></span>
<span class="normal"><a href="#__codelineno-73-16">16</a></span>
<span class="normal"><a href="#__codelineno-73-17">17</a></span>
<span class="normal"><a href="#__codelineno-73-18">18</a></span>
<span class="normal"><a href="#__codelineno-73-19">19</a></span>
<span class="normal"><a href="#__codelineno-73-20">20</a></span>
<span class="normal"><a href="#__codelineno-73-21">21</a></span>
<span class="normal"><a href="#__codelineno-73-22">22</a></span>
<span class="normal"><a href="#__codelineno-73-23">23</a></span>
<span class="normal"><a href="#__codelineno-73-24">24</a></span>
<span class="normal"><a href="#__codelineno-73-25">25</a></span>
<span class="normal"><a href="#__codelineno-73-26">26</a></span>
<span class="normal"><a href="#__codelineno-73-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-73-2" name="__codelineno-73-2"></a><span class="w">    </span><span class="s">&quot;context&quot;</span>
<a id="__codelineno-73-3" name="__codelineno-73-3"></a><span class="w">    </span><span class="s">&quot;database/sql&quot;</span>
<a id="__codelineno-73-4" name="__codelineno-73-4"></a>
<a id="__codelineno-73-5" name="__codelineno-73-5"></a><span class="w">    </span><span class="s">&quot;github.com/volatiletech/sqlboiler/boil&quot;</span>
<a id="__codelineno-73-6" name="__codelineno-73-6"></a><span class="p">)</span>
<a id="__codelineno-73-7" name="__codelineno-73-7"></a>
<a id="__codelineno-73-8" name="__codelineno-73-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">upsertPointExample</span><span class="p">(</span><span class="nx">db</span><span class="w"> </span><span class="o">*</span><span class="nx">sql</span><span class="p">.</span><span class="nx">DB</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-73-9" name="__codelineno-73-9"></a><span class="w">    </span><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-73-10" name="__codelineno-73-10"></a><span class="w">    </span><span class="nx">exec</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">(</span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-73-11" name="__codelineno-73-11"></a>
<a id="__codelineno-73-12" name="__codelineno-73-12"></a><span class="w">    </span><span class="nx">point</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Point</span><span class="p">{</span>
<a id="__codelineno-73-13" name="__codelineno-73-13"></a><span class="w">        </span><span class="nx">UserID</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-73-14" name="__codelineno-73-14"></a><span class="w">        </span><span class="nx">Score</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-73-15" name="__codelineno-73-15"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-73-16" name="__codelineno-73-16"></a>
<a id="__codelineno-73-17" name="__codelineno-73-17"></a><span class="w">    </span><span class="c1">// 更新するカラムと挿入するカラムを指定</span>
<a id="__codelineno-73-18" name="__codelineno-73-18"></a><span class="w">    </span><span class="nx">updateColumns</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">Whitelist</span><span class="p">(</span><span class="s">&quot;score&quot;</span><span class="p">)</span>
<a id="__codelineno-73-19" name="__codelineno-73-19"></a><span class="w">    </span><span class="nx">insertColumns</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">Whitelist</span><span class="p">(</span><span class="s">&quot;user_id&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;score&quot;</span><span class="p">)</span>
<a id="__codelineno-73-20" name="__codelineno-73-20"></a>
<a id="__codelineno-73-21" name="__codelineno-73-21"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">point</span><span class="p">.</span><span class="nx">Upsert</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="nx">updateColumns</span><span class="p">,</span><span class="w"> </span><span class="nx">insertColumns</span><span class="p">)</span>
<a id="__codelineno-73-22" name="__codelineno-73-22"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-73-23" name="__codelineno-73-23"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-73-24" name="__codelineno-73-24"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-73-25" name="__codelineno-73-25"></a>
<a id="__codelineno-73-26" name="__codelineno-73-26"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-73-27" name="__codelineno-73-27"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_67">解説</h3>
<ul>
<li><code>Point</code>オブジェクトを作成し、<code>UserID</code>と<code>Score</code>を設定します。</li>
<li><code>Upsert</code>関数を呼び出し、<code>score</code>カラムを更新し、<code>user_id</code>と<code>score</code>カラムを挿入します。</li>
<li><code>boil.Whitelist</code>を使用して、対象のカラムを明示的に指定します。</li>
</ul>
<h3 id="2-delete">2. Deleteの使用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-74-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-74-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-74-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-74-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-74-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-74-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-74-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-74-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-74-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-74-10">10</a></span>
<span class="normal"><a href="#__codelineno-74-11">11</a></span>
<span class="normal"><a href="#__codelineno-74-12">12</a></span>
<span class="normal"><a href="#__codelineno-74-13">13</a></span>
<span class="normal"><a href="#__codelineno-74-14">14</a></span>
<span class="normal"><a href="#__codelineno-74-15">15</a></span>
<span class="normal"><a href="#__codelineno-74-16">16</a></span>
<span class="normal"><a href="#__codelineno-74-17">17</a></span>
<span class="normal"><a href="#__codelineno-74-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">deletePointExample</span><span class="p">(</span><span class="nx">db</span><span class="w"> </span><span class="o">*</span><span class="nx">sql</span><span class="p">.</span><span class="nx">DB</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-74-2" name="__codelineno-74-2"></a><span class="w">    </span><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-74-3" name="__codelineno-74-3"></a><span class="w">    </span><span class="nx">exec</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">(</span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-74-4" name="__codelineno-74-4"></a>
<a id="__codelineno-74-5" name="__codelineno-74-5"></a><span class="w">    </span><span class="c1">// 削除するPointオブジェクトを取得</span>
<a id="__codelineno-74-6" name="__codelineno-74-6"></a><span class="w">    </span><span class="nx">point</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">FindPoint</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="c1">// UserIDが1のPointを取得</span>
<a id="__codelineno-74-7" name="__codelineno-74-7"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-74-8" name="__codelineno-74-8"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-74-9" name="__codelineno-74-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-74-10" name="__codelineno-74-10"></a>
<a id="__codelineno-74-11" name="__codelineno-74-11"></a><span class="w">    </span><span class="c1">// 削除</span>
<a id="__codelineno-74-12" name="__codelineno-74-12"></a><span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">point</span><span class="p">.</span><span class="nx">Delete</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">)</span>
<a id="__codelineno-74-13" name="__codelineno-74-13"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-74-14" name="__codelineno-74-14"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-74-15" name="__codelineno-74-15"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-74-16" name="__codelineno-74-16"></a>
<a id="__codelineno-74-17" name="__codelineno-74-17"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-74-18" name="__codelineno-74-18"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_68">解説</h3>
<ul>
<li><code>FindPoint</code>関数を使用して、削除対象の<code>Point</code>オブジェクトを取得します。</li>
<li><code>Delete</code>関数を呼び出して、オブジェクトを削除します。</li>
</ul>
<h3 id="3-reload">3. Reloadの使用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-75-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-75-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-75-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-75-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-75-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-75-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-75-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-75-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-75-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-75-10">10</a></span>
<span class="normal"><a href="#__codelineno-75-11">11</a></span>
<span class="normal"><a href="#__codelineno-75-12">12</a></span>
<span class="normal"><a href="#__codelineno-75-13">13</a></span>
<span class="normal"><a href="#__codelineno-75-14">14</a></span>
<span class="normal"><a href="#__codelineno-75-15">15</a></span>
<span class="normal"><a href="#__codelineno-75-16">16</a></span>
<span class="normal"><a href="#__codelineno-75-17">17</a></span>
<span class="normal"><a href="#__codelineno-75-18">18</a></span>
<span class="normal"><a href="#__codelineno-75-19">19</a></span>
<span class="normal"><a href="#__codelineno-75-20">20</a></span>
<span class="normal"><a href="#__codelineno-75-21">21</a></span>
<span class="normal"><a href="#__codelineno-75-22">22</a></span>
<span class="normal"><a href="#__codelineno-75-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">reloadPointExample</span><span class="p">(</span><span class="nx">db</span><span class="w"> </span><span class="o">*</span><span class="nx">sql</span><span class="p">.</span><span class="nx">DB</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-75-2" name="__codelineno-75-2"></a><span class="w">    </span><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-75-3" name="__codelineno-75-3"></a><span class="w">    </span><span class="nx">exec</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">(</span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-75-4" name="__codelineno-75-4"></a>
<a id="__codelineno-75-5" name="__codelineno-75-5"></a><span class="w">    </span><span class="c1">// Pointオブジェクトを取得</span>
<a id="__codelineno-75-6" name="__codelineno-75-6"></a><span class="w">    </span><span class="nx">point</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">FindPoint</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-75-7" name="__codelineno-75-7"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-75-8" name="__codelineno-75-8"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-75-9" name="__codelineno-75-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-75-10" name="__codelineno-75-10"></a>
<a id="__codelineno-75-11" name="__codelineno-75-11"></a><span class="w">    </span><span class="c1">// データを変更（データベースの状態とは異なる状態にする）</span>
<a id="__codelineno-75-12" name="__codelineno-75-12"></a><span class="w">    </span><span class="nx">point</span><span class="p">.</span><span class="nx">Score</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">200</span>
<a id="__codelineno-75-13" name="__codelineno-75-13"></a>
<a id="__codelineno-75-14" name="__codelineno-75-14"></a><span class="w">    </span><span class="c1">// リロードしてデータベースの最新状態に更新</span>
<a id="__codelineno-75-15" name="__codelineno-75-15"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">point</span><span class="p">.</span><span class="nx">Reload</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">)</span>
<a id="__codelineno-75-16" name="__codelineno-75-16"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-75-17" name="__codelineno-75-17"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-75-18" name="__codelineno-75-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-75-19" name="__codelineno-75-19"></a>
<a id="__codelineno-75-20" name="__codelineno-75-20"></a><span class="w">    </span><span class="c1">// ここでpoint.Scoreはデータベースの値に戻ります</span>
<a id="__codelineno-75-21" name="__codelineno-75-21"></a>
<a id="__codelineno-75-22" name="__codelineno-75-22"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-75-23" name="__codelineno-75-23"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_69">解説</h3>
<ul>
<li>まず<code>FindPoint</code>で<code>Point</code>オブジェクトを取得します。</li>
<li>ローカルで<code>Score</code>を変更します。</li>
<li><code>Reload</code>を呼び出して、データベースの最新状態でオブジェクトを更新します。</li>
</ul>
<hr />
<h1 id="_70">コード解説と使用例</h1>
<p>以下に提供されたGo言語のコードは、データベースにおける<code>Point</code>エンティティの存在確認を行う関数です。特に、<code>PointExists</code>関数と、そのメソッドレシーバーバージョンである<code>Exists</code>関数について詳しく解説し、開発者向けの使用例を示します。</p>
<hr />
<h2 id="pointexists"><code>PointExists</code>関数の詳細解説</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-76-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-76-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-76-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-76-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-76-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-76-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-76-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-76-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-76-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-76-10">10</a></span>
<span class="normal"><a href="#__codelineno-76-11">11</a></span>
<span class="normal"><a href="#__codelineno-76-12">12</a></span>
<span class="normal"><a href="#__codelineno-76-13">13</a></span>
<span class="normal"><a href="#__codelineno-76-14">14</a></span>
<span class="normal"><a href="#__codelineno-76-15">15</a></span>
<span class="normal"><a href="#__codelineno-76-16">16</a></span>
<span class="normal"><a href="#__codelineno-76-17">17</a></span>
<span class="normal"><a href="#__codelineno-76-18">18</a></span>
<span class="normal"><a href="#__codelineno-76-19">19</a></span>
<span class="normal"><a href="#__codelineno-76-20">20</a></span>
<span class="normal"><a href="#__codelineno-76-21">21</a></span>
<span class="normal"><a href="#__codelineno-76-22">22</a></span>
<span class="normal"><a href="#__codelineno-76-23">23</a></span>
<span class="normal"><a href="#__codelineno-76-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1"></a><span class="c1">// PointExists は、指定された userID を持つ Point 行が存在するかチェックします。</span>
<a id="__codelineno-76-2" name="__codelineno-76-2"></a><span class="kd">func</span><span class="w"> </span><span class="nx">PointExists</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">,</span><span class="w"> </span><span class="nx">userID</span><span class="w"> </span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-76-3" name="__codelineno-76-3"></a><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="kt">bool</span>
<a id="__codelineno-76-4" name="__codelineno-76-4"></a><span class="w">    </span><span class="nx">sql</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;select exists(select 1 from `points` where `user_id`=? limit 1)&quot;</span>
<a id="__codelineno-76-5" name="__codelineno-76-5"></a>
<a id="__codelineno-76-6" name="__codelineno-76-6"></a><span class="w">    </span><span class="c1">// デバッグモードが有効な場合は、SQLクエリと引数を出力します。</span>
<a id="__codelineno-76-7" name="__codelineno-76-7"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">IsDebug</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-76-8" name="__codelineno-76-8"></a><span class="w">        </span><span class="nx">writer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">DebugWriterFrom</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<a id="__codelineno-76-9" name="__codelineno-76-9"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">)</span>
<a id="__codelineno-76-10" name="__codelineno-76-10"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintln</span><span class="p">(</span><span class="nx">writer</span><span class="p">,</span><span class="w"> </span><span class="nx">userID</span><span class="p">)</span>
<a id="__codelineno-76-11" name="__codelineno-76-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-76-12" name="__codelineno-76-12"></a>
<a id="__codelineno-76-13" name="__codelineno-76-13"></a><span class="w">    </span><span class="c1">// クエリを実行し、結果を取得します。</span>
<a id="__codelineno-76-14" name="__codelineno-76-14"></a><span class="w">    </span><span class="nx">row</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">exec</span><span class="p">.</span><span class="nx">QueryRowContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">,</span><span class="w"> </span><span class="nx">userID</span><span class="p">)</span>
<a id="__codelineno-76-15" name="__codelineno-76-15"></a>
<a id="__codelineno-76-16" name="__codelineno-76-16"></a><span class="w">    </span><span class="c1">// クエリの結果をスキャンし、exists 変数に代入します。</span>
<a id="__codelineno-76-17" name="__codelineno-76-17"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">row</span><span class="p">.</span><span class="nx">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">exists</span><span class="p">)</span>
<a id="__codelineno-76-18" name="__codelineno-76-18"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-76-19" name="__codelineno-76-19"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="nx">errors</span><span class="p">.</span><span class="nx">Wrap</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;models: unable to check if points exists&quot;</span><span class="p">)</span>
<a id="__codelineno-76-20" name="__codelineno-76-20"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-76-21" name="__codelineno-76-21"></a>
<a id="__codelineno-76-22" name="__codelineno-76-22"></a><span class="w">    </span><span class="c1">// 存在する場合は true、存在しない場合は false を返します。</span>
<a id="__codelineno-76-23" name="__codelineno-76-23"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">exists</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-76-24" name="__codelineno-76-24"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_71">解説</h3>
<ul>
<li>
<p><strong>関数の目的</strong>: 与えられた<code>userID</code>を持つ<code>Point</code>レコードがデータベース内に存在するかを確認します。</p>
</li>
<li>
<p><strong>パラメータ</strong>:</p>
</li>
<li><code>ctx context.Context</code>: コンテキスト。キャンセルやタイムアウトの制御に使用します。</li>
<li><code>exec boil.ContextExecutor</code>: データベース操作を行うためのエグゼキューター（通常は<code>*sql.DB</code>や<code>*sql.Tx</code>）。</li>
<li>
<p><code>userID uint</code>: 存在確認を行いたい<code>Point</code>の<code>userID</code>。</p>
</li>
<li>
<p><strong>処理の流れ</strong>:</p>
</li>
<li><code>exists</code>というブール値の変数を宣言します。この変数にクエリの結果（レコードの存在有無）を格納します。</li>
<li>SQLクエリを定義します。このクエリは、<code>points</code>テーブルから指定された<code>user_id</code>に一致するレコードが存在するかをチェックします。<ul>
<li><code>select exists(select 1 from</code>points<code>where</code>user_id<code>=? limit 1)</code></li>
<li><code>exists</code>関数は、サブクエリの結果が存在する場合に<code>true</code>を返します。</li>
</ul>
</li>
<li>デバッグモードが有効な場合、実行するSQLクエリと引数を標準出力またはログに出力します。</li>
<li><code>QueryRowContext</code>を使用してクエリを実行し、結果の行を取得します。</li>
<li><code>row.Scan(&amp;exists)</code>で、クエリの結果を<code>exists</code>変数にスキャンします。<ul>
<li>エラーが発生した場合、詳細なエラー情報をラップして返します。</li>
</ul>
</li>
<li>
<p>最終的に、存在確認の結果である<code>exists</code>とエラー（エラーがなければ<code>nil</code>）を返します。</p>
</li>
<li>
<p><strong>エラーハンドリング</strong>:</p>
</li>
<li>クエリの実行や結果のスキャン中にエラーが発生した場合、エラーメッセージを詳細にして返します。</li>
</ul>
<hr />
<h2 id="exists"><code>Exists</code>メソッドの詳細解説</h2>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-77-1">1</a></span>
<span class="normal"><a href="#__codelineno-77-2">2</a></span>
<span class="normal"><a href="#__codelineno-77-3">3</a></span>
<span class="normal"><a href="#__codelineno-77-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1"></a><span class="c1">// Exists は、現在の Point オブジェクトがデータベース内に存在するか確認します。</span>
<a id="__codelineno-77-2" name="__codelineno-77-2"></a><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">o</span><span class="w"> </span><span class="o">*</span><span class="nx">Point</span><span class="p">)</span><span class="w"> </span><span class="nx">Exists</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-77-3" name="__codelineno-77-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">PointExists</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="nx">o</span><span class="p">.</span><span class="nx">UserID</span><span class="p">)</span>
<a id="__codelineno-77-4" name="__codelineno-77-4"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_72">解説</h3>
<ul>
<li>
<p><strong>関数の目的</strong>: <code>Point</code>構造体のメソッドとして、自身がデータベース内に存在するかを確認します。</p>
</li>
<li>
<p><strong>パラメータ</strong>:</p>
</li>
<li><code>o *Point</code>: メソッドレシーバー。存在確認を行いたい<code>Point</code>オブジェクト。</li>
<li><code>ctx context.Context</code>: コンテキスト。</li>
<li>
<p><code>exec boil.ContextExecutor</code>: データベース操作を行うためのエグゼキューター。</p>
</li>
<li>
<p><strong>処理の流れ</strong>:</p>
</li>
<li><code>PointExists</code>関数を呼び出し、<code>o.UserID</code>を渡して存在確認を行います。</li>
<li>
<p><code>PointExists</code>関数の戻り値（存在確認結果とエラー）をそのまま返します。</p>
</li>
<li>
<p><strong>メリット</strong>:</p>
</li>
<li>メソッドとして提供することで、<code>Point</code>オブジェクトから直接存在確認を行うことができます。</li>
<li>コードの可読性と使いやすさが向上します。</li>
</ul>
<hr />
<h2 id="_73">使用例</h2>
<p>以下に、開発者がこれらの関数をどのように使用できるかを示す具体的なコード例を示します。</p>
<h3 id="1-pointexists">1. <code>PointExists</code>関数の使用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-78-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-78-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-78-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-78-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-78-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-78-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-78-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-78-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-78-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-78-10">10</a></span>
<span class="normal"><a href="#__codelineno-78-11">11</a></span>
<span class="normal"><a href="#__codelineno-78-12">12</a></span>
<span class="normal"><a href="#__codelineno-78-13">13</a></span>
<span class="normal"><a href="#__codelineno-78-14">14</a></span>
<span class="normal"><a href="#__codelineno-78-15">15</a></span>
<span class="normal"><a href="#__codelineno-78-16">16</a></span>
<span class="normal"><a href="#__codelineno-78-17">17</a></span>
<span class="normal"><a href="#__codelineno-78-18">18</a></span>
<span class="normal"><a href="#__codelineno-78-19">19</a></span>
<span class="normal"><a href="#__codelineno-78-20">20</a></span>
<span class="normal"><a href="#__codelineno-78-21">21</a></span>
<span class="normal"><a href="#__codelineno-78-22">22</a></span>
<span class="normal"><a href="#__codelineno-78-23">23</a></span>
<span class="normal"><a href="#__codelineno-78-24">24</a></span>
<span class="normal"><a href="#__codelineno-78-25">25</a></span>
<span class="normal"><a href="#__codelineno-78-26">26</a></span>
<span class="normal"><a href="#__codelineno-78-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-78-1" name="__codelineno-78-1"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="__codelineno-78-2" name="__codelineno-78-2"></a><span class="w">    </span><span class="s">&quot;context&quot;</span>
<a id="__codelineno-78-3" name="__codelineno-78-3"></a><span class="w">    </span><span class="s">&quot;database/sql&quot;</span>
<a id="__codelineno-78-4" name="__codelineno-78-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
<a id="__codelineno-78-5" name="__codelineno-78-5"></a>
<a id="__codelineno-78-6" name="__codelineno-78-6"></a><span class="w">    </span><span class="s">&quot;github.com/volatiletech/sqlboiler/boil&quot;</span>
<a id="__codelineno-78-7" name="__codelineno-78-7"></a><span class="p">)</span>
<a id="__codelineno-78-8" name="__codelineno-78-8"></a>
<a id="__codelineno-78-9" name="__codelineno-78-9"></a><span class="kd">func</span><span class="w"> </span><span class="nx">checkPointExists</span><span class="p">(</span><span class="nx">db</span><span class="w"> </span><span class="o">*</span><span class="nx">sql</span><span class="p">.</span><span class="nx">DB</span><span class="p">,</span><span class="w"> </span><span class="nx">userID</span><span class="w"> </span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-78-10" name="__codelineno-78-10"></a><span class="w">    </span><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-78-11" name="__codelineno-78-11"></a><span class="w">    </span><span class="c1">// boil.ContextExecutorは、*sql.DBや*sql.Txと互換性があります。</span>
<a id="__codelineno-78-12" name="__codelineno-78-12"></a><span class="w">    </span><span class="nx">exec</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">(</span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-78-13" name="__codelineno-78-13"></a>
<a id="__codelineno-78-14" name="__codelineno-78-14"></a><span class="w">    </span><span class="c1">// 指定された userID を持つ Point が存在するか確認</span>
<a id="__codelineno-78-15" name="__codelineno-78-15"></a><span class="w">    </span><span class="nx">exists</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">PointExists</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">,</span><span class="w"> </span><span class="nx">userID</span><span class="p">)</span>
<a id="__codelineno-78-16" name="__codelineno-78-16"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-78-17" name="__codelineno-78-17"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-78-18" name="__codelineno-78-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-78-19" name="__codelineno-78-19"></a>
<a id="__codelineno-78-20" name="__codelineno-78-20"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-78-21" name="__codelineno-78-21"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;UserID %d の Point レコードは存在します。\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">userID</span><span class="p">)</span>
<a id="__codelineno-78-22" name="__codelineno-78-22"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-78-23" name="__codelineno-78-23"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;UserID %d の Point レコードは存在しません。\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">userID</span><span class="p">)</span>
<a id="__codelineno-78-24" name="__codelineno-78-24"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-78-25" name="__codelineno-78-25"></a>
<a id="__codelineno-78-26" name="__codelineno-78-26"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-78-27" name="__codelineno-78-27"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_74">解説</h3>
<ul>
<li><code>PointExists</code>関数を使用して、特定の<code>userID</code>を持つ<code>Point</code>レコードの存在を確認します。</li>
<li>結果に応じてメッセージを出力します。</li>
<li>エラーハンドリングを適切に行っています。</li>
</ul>
<h3 id="2-exists">2. <code>Exists</code>メソッドの使用例</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-79-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-79-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-79-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-79-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-79-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-79-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-79-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-79-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-79-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-79-10">10</a></span>
<span class="normal"><a href="#__codelineno-79-11">11</a></span>
<span class="normal"><a href="#__codelineno-79-12">12</a></span>
<span class="normal"><a href="#__codelineno-79-13">13</a></span>
<span class="normal"><a href="#__codelineno-79-14">14</a></span>
<span class="normal"><a href="#__codelineno-79-15">15</a></span>
<span class="normal"><a href="#__codelineno-79-16">16</a></span>
<span class="normal"><a href="#__codelineno-79-17">17</a></span>
<span class="normal"><a href="#__codelineno-79-18">18</a></span>
<span class="normal"><a href="#__codelineno-79-19">19</a></span>
<span class="normal"><a href="#__codelineno-79-20">20</a></span>
<span class="normal"><a href="#__codelineno-79-21">21</a></span>
<span class="normal"><a href="#__codelineno-79-22">22</a></span>
<span class="normal"><a href="#__codelineno-79-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1"></a><span class="kd">func</span><span class="w"> </span><span class="nx">checkPointExistsMethod</span><span class="p">(</span><span class="nx">db</span><span class="w"> </span><span class="o">*</span><span class="nx">sql</span><span class="p">.</span><span class="nx">DB</span><span class="p">,</span><span class="w"> </span><span class="nx">userID</span><span class="w"> </span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-2" name="__codelineno-79-2"></a><span class="w">    </span><span class="nx">ctx</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Background</span><span class="p">()</span>
<a id="__codelineno-79-3" name="__codelineno-79-3"></a><span class="w">    </span><span class="nx">exec</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">boil</span><span class="p">.</span><span class="nx">ContextExecutor</span><span class="p">(</span><span class="nx">db</span><span class="p">)</span>
<a id="__codelineno-79-4" name="__codelineno-79-4"></a>
<a id="__codelineno-79-5" name="__codelineno-79-5"></a><span class="w">    </span><span class="c1">// Point オブジェクトを作成（実際にはデータベースから取得している可能性があります）</span>
<a id="__codelineno-79-6" name="__codelineno-79-6"></a><span class="w">    </span><span class="nx">point</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Point</span><span class="p">{</span>
<a id="__codelineno-79-7" name="__codelineno-79-7"></a><span class="w">        </span><span class="nx">UserID</span><span class="p">:</span><span class="w"> </span><span class="nx">userID</span><span class="p">,</span>
<a id="__codelineno-79-8" name="__codelineno-79-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-79-9" name="__codelineno-79-9"></a>
<a id="__codelineno-79-10" name="__codelineno-79-10"></a><span class="w">    </span><span class="c1">// Point オブジェクト自体が存在するか確認</span>
<a id="__codelineno-79-11" name="__codelineno-79-11"></a><span class="w">    </span><span class="nx">exists</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">point</span><span class="p">.</span><span class="nx">Exists</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">exec</span><span class="p">)</span>
<a id="__codelineno-79-12" name="__codelineno-79-12"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-13" name="__codelineno-79-13"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<a id="__codelineno-79-14" name="__codelineno-79-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-79-15" name="__codelineno-79-15"></a>
<a id="__codelineno-79-16" name="__codelineno-79-16"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">exists</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-17" name="__codelineno-79-17"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;UserID %d の Point レコードは存在します。\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">userID</span><span class="p">)</span>
<a id="__codelineno-79-18" name="__codelineno-79-18"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-19" name="__codelineno-79-19"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;UserID %d の Point レコードは存在しません。\n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">userID</span><span class="p">)</span>
<a id="__codelineno-79-20" name="__codelineno-79-20"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-79-21" name="__codelineno-79-21"></a>
<a id="__codelineno-79-22" name="__codelineno-79-22"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<a id="__codelineno-79-23" name="__codelineno-79-23"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="_75">解説</h3>
<ul>
<li><code>Point</code>構造体の<code>Exists</code>メソッドを使用して、自身の存在確認を行います。</li>
<li><code>PointExists</code>関数を直接呼び出す代わりに、オブジェクトからメソッドとして呼び出すことで、コードがよりオブジェクト指向的になります。</li>
</ul>
<hr />
<p>以上が<code>PointExists</code>関数と<code>Exists</code>メソッドの詳細な解説および使用例です。これらの関数を活用して、データベース内のレコードの存在確認を効率的に行うことができます。</p>
<h2 id="_76">注意事項</h2>
<ul>
<li><strong>データベース接続の管理</strong>:</li>
<li><code>sql.DB</code>や<code>sql.Tx</code>を使用してデータベース接続を管理してください。</li>
<li>
<p>適切な接続のクローズやエラーハンドリングを行い、リソースリークを防ぎましょう。</p>
</li>
<li>
<p><strong>コンテキストの利用</strong>:</p>
</li>
<li><code>context.Context</code>を使用して、リクエストのキャンセルやタイムアウトを制御できます。</li>
<li>
<p>特に長時間実行される可能性のあるクエリでは、コンテキストを適切に設定してください。</p>
</li>
<li>
<p><strong>デバッグモード</strong>:</p>
</li>
<li>デバッグモードを有効にすると、実行されるSQLクエリや引数をログに出力できます。</li>
<li>
<p>デバッグ時には<code>boil.DebugMode = true</code>を設定するか、コンテキストにデバッグ情報を追加してください。</p>
</li>
<li>
<p><strong>エラーハンドリング</strong>:</p>
</li>
<li>エラーが発生した場合、詳細なエラー情報を得るために<code>errors.Wrap</code>を使用しています。</li>
<li>実際のアプリケーションでは、エラー内容をユーザーに開示する際に注意が必要です。</li>
</ul>
<hr />












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/GradProjectHub/GradProject" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.annotate"], "search": "../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
    
  </body>
</html>